<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Comparing Milo Implementations in R and Python</title>
      <link href="/en/2025/10/28/%E5%9C%A8R%E5%92%8CPython%E4%B8%8B%E8%BF%90%E8%A1%8Cmilo%E7%9A%84%E5%AF%B9%E6%AF%94/"/>
      <url>/en/2025/10/28/%E5%9C%A8R%E5%92%8CPython%E4%B8%8B%E8%BF%90%E8%A1%8Cmilo%E7%9A%84%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<p>Milo is a differential abundance analysis method for single-cell RNA sequencing data that can detect compositional changes in cell neighborhoods across different conditions.</p><span id="more"></span><h2 id="Introduction-to-the-Milo-Algorithm"><a href="#Introduction-to-the-Milo-Algorithm" class="headerlink" title="Introduction to the Milo Algorithm"></a>Introduction to the Milo Algorithm</h2><p><a href="https://www.nature.com/articles/s41587-021-01033-z">Milo</a> is a differential abundance analysis method specifically designed for single-cell RNA sequencing data. Its core idea is to detect changes in cell population composition across different experimental conditions by constructing cell neighborhoods.</p><p>My understanding is that the purpose of this algorithm is to identify cells with population proportion differences between two conditions without pre-defining them. Once detection results are obtained, these differentially abundant cells can be extracted for further analysis.</p><h2 id="Milo-Implementation-in-R-Environment"><a href="#Milo-Implementation-in-R-Environment" class="headerlink" title="Milo Implementation in R Environment"></a>Milo Implementation in R Environment</h2><p>In R language, the miloR package is used for analysis. Here’s the corresponding implementation:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load required libraries</span></span><br><span class="line">library<span class="punctuation">(</span>Seurat<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>miloR<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>SingleCellExperiment<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>scater<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidyr<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read Seurat object and convert to SingleCellExperiment</span></span><br><span class="line">seurat_obj <span class="operator">&lt;-</span> readRDS<span class="punctuation">(</span><span class="string">&quot;seurat.rds&quot;</span><span class="punctuation">)</span></span><br><span class="line">sce <span class="operator">&lt;-</span> as.SingleCellExperiment<span class="punctuation">(</span>seurat_obj<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set random seed for reproducibility - mainly affects the kNN component</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">4466</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create Milo object</span></span><br><span class="line">milo_obj <span class="operator">&lt;-</span> Milo<span class="punctuation">(</span>sce<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build graph structure - note: k is for kNN, d is for dimensions/components</span></span><br><span class="line">milo_obj <span class="operator">&lt;-</span> buildGraph<span class="punctuation">(</span></span><br><span class="line">    milo_obj<span class="punctuation">,</span></span><br><span class="line">    k <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> d <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    transposed <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> </span><br><span class="line">    reduced.dim <span class="operator">=</span> <span class="string">&quot;UMAP&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define neighborhoods - note: k, d, and reduced_dims should match previous step</span></span><br><span class="line"><span class="comment"># refinement_scheme enables a faster algorithm</span></span><br><span class="line"><span class="comment"># Provides significant computational acceleration for large datasets</span></span><br><span class="line">milo_obj <span class="operator">&lt;-</span> makeNhoods<span class="punctuation">(</span></span><br><span class="line">    x <span class="operator">=</span> milo_obj<span class="punctuation">,</span></span><br><span class="line">    prop <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> d <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    refined <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">    reduced_dims <span class="operator">=</span> <span class="string">&quot;UMAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">    refinement_scheme <span class="operator">=</span> <span class="string">&quot;graph&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Count cells in neighborhoods</span></span><br><span class="line">milo_obj <span class="operator">&lt;-</span> countCells<span class="punctuation">(</span></span><br><span class="line">    milo_obj<span class="punctuation">,</span></span><br><span class="line">    meta.data <span class="operator">=</span> data.frame<span class="punctuation">(</span>colData<span class="punctuation">(</span>milo_obj<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    sample <span class="operator">=</span> <span class="string">&quot;sample_id&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare experimental design - create a data frame with sample IDs and group tags</span></span><br><span class="line">traj_design <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>colData<span class="punctuation">(</span>milo_obj<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample_id&quot;</span><span class="punctuation">,</span> <span class="string">&quot;group&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">%&gt;%</span></span><br><span class="line">    distinct<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">    mutate<span class="punctuation">(</span></span><br><span class="line">        sample_id <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>sample_id<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        group <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>group<span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>traj_design<span class="punctuation">)</span> <span class="operator">&lt;-</span> traj_design<span class="operator">$</span>sample_id</span><br><span class="line">traj_design <span class="operator">&lt;-</span> traj_design<span class="punctuation">[</span>colnames<span class="punctuation">(</span>nhoodCounts<span class="punctuation">(</span>milo_obj<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">,</span> drop<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Differential abundance testing - fdr.weighting = &quot;graph-overlap&quot;</span></span><br><span class="line"><span class="comment"># Works with parameters from makeNhoods to improve computation speed</span></span><br><span class="line"><span class="comment"># Note: Comparison groups can be specified using formula-like syntax</span></span><br><span class="line"><span class="comment"># design = ~ 0 + group means using group variable for grouping, ~ 0 + is fixed syntax</span></span><br><span class="line"><span class="comment"># model.contrasts = c(&#x27;groupCase - groupControl&#x27;) means:</span></span><br><span class="line"><span class="comment"># Use rows where group equals &#x27;Case&#x27; as target, and &#x27;Control&#x27; as reference</span></span><br><span class="line">da_results <span class="operator">&lt;-</span> testNhoods<span class="punctuation">(</span></span><br><span class="line">    milo_obj<span class="punctuation">,</span></span><br><span class="line">    design <span class="operator">=</span> <span class="operator">~</span> <span class="number">0</span> <span class="operator">+</span> group<span class="punctuation">,</span></span><br><span class="line">    model.contrasts <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;groupCase - groupControl&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    design.df <span class="operator">=</span> traj_design<span class="punctuation">,</span></span><br><span class="line">    fdr.weighting <span class="operator">=</span> <span class="string">&quot;graph-overlap&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># View significant results</span></span><br><span class="line">da_results <span class="operator">%&gt;%</span></span><br><span class="line">  arrange<span class="punctuation">(</span>SpatialFDR<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  filter<span class="punctuation">(</span>SpatialFDR <span class="operator">&lt;</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  tail<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build neighborhood graph</span></span><br><span class="line">milo_obj <span class="operator">&lt;-</span> buildNhoodGraph<span class="punctuation">(</span>milo_obj<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># All computation steps completed</span></span><br><span class="line"><span class="comment"># Subsequent visualization can use plotUMAP or other functions</span></span><br></pre></td></tr></table></figure><h2 id="Milo-Implementation-in-Python-Environment"><a href="#Milo-Implementation-in-Python-Environment" class="headerlink" title="Milo Implementation in Python Environment"></a>Milo Implementation in Python Environment</h2><p>Python has multiple Milo implementations. Besides <a href="#">INVALID POST SLUG PROVIDED milopy</a> mentioned in the official <a href="https://github.com/MarioniLab/miloR">miloR project</a>, the <a href="https://github.com/scverse/pertpy">pertpy</a> library also implements the Milo algorithm. Here’s an example using pertpy:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pertpy <span class="keyword">as</span> pt</span><br><span class="line"><span class="keyword">import</span> scanpy <span class="keyword">as</span> sc</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read data</span></span><br><span class="line">adata = sc.read_h5ad(<span class="string">&#x27;adata.h5ad&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize Milo analysis object</span></span><br><span class="line">milo = pt.tl.Milo()</span><br><span class="line">mdata = milo.load(adata)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build neighbor graph</span></span><br><span class="line">sc.pp.neighbors(</span><br><span class="line">    mdata[<span class="string">&quot;rna&quot;</span>],</span><br><span class="line">    use_rep=<span class="string">&quot;X_umap&quot;</span>, <span class="comment"># Use existing UMAP dimensionality reduction</span></span><br><span class="line">    n_pcs=<span class="number">20</span>,         <span class="comment"># Number of principal components, corresponds to d in miloR</span></span><br><span class="line">    n_neighbors=<span class="number">30</span>,   <span class="comment"># Number of neighbors, corresponds to k in miloR</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create neighborhoods</span></span><br><span class="line">milo.make_nhoods(mdata[<span class="string">&quot;rna&quot;</span>], prop=<span class="number">0.1</span>)</span><br><span class="line">mdata = milo.count_nhoods(mdata, sample_col=<span class="string">&quot;sample_id&quot;</span>)</span><br><span class="line"><span class="comment"># Group specification is more intuitive than in miloR, but order differs - Control comes first</span></span><br><span class="line">mdata[<span class="string">&quot;rna&quot;</span>].obs[<span class="string">&quot;group&quot;</span>] = mdata[<span class="string">&quot;rna&quot;</span>].obs[<span class="string">&quot;group&quot;</span>].cat.reorder_categories([<span class="string">&quot;Control&quot;</span>, <span class="string">&quot;Case&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Differential abundance analysis (using pydeseq2 solver)</span></span><br><span class="line">milo.da_nhoods(mdata, design=<span class="string">&quot;~group&quot;</span>, solver=<span class="string">&quot;pydeseq2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build neighborhood graph for visualization</span></span><br><span class="line">milo.build_nhood_graph(mdata)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter significant results</span></span><br><span class="line">significant_results = mdata[<span class="string">&#x27;milo&#x27;</span>].var.query(<span class="string">&#x27;SpatialFDR &lt; 0.1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># All computations completed</span></span><br></pre></td></tr></table></figure><h2 id="Postscript"><a href="#Postscript" class="headerlink" title="Postscript"></a>Postscript</h2><p>In terms of actual performance, there isn’t a huge difference between the two implementations. However, there are differences in computation results since the Python version is an algorithmic implementation rather than a step-by-step reproduction. Regarding computational consistency, I’ll need to find a dataset from cellxgene to perform actual calculations in the future.</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Single-cell analysis </tag>
            
            <tag> Differential abundance analysis </tag>
            
            <tag> Milo </tag>
            
            <tag> Bioinformatics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Setting Up Self-Hosted Codespaces with DevPod</title>
      <link href="/en/2025/10/28/%E4%BD%BF%E7%94%A8devpod%E8%AE%BE%E7%BD%AE%E8%87%AA%E9%83%A8%E7%BD%B2%E7%9A%84codespace/"/>
      <url>/en/2025/10/28/%E4%BD%BF%E7%94%A8devpod%E8%AE%BE%E7%BD%AE%E8%87%AA%E9%83%A8%E7%BD%B2%E7%9A%84codespace/</url>
      
        <content type="html"><![CDATA[<p>DevPod is an open-source development environment management tool that allows you to create development environments similar to GitHub Codespaces on any Kubernetes cluster or Docker host. This article will introduce how to use the DevPod CLI to create workspaces and provide a detailed explanation of writing DevContainer configuration files.</p><span id="more"></span><h2 id="Introduction-to-DevPod"><a href="#Introduction-to-DevPod" class="headerlink" title="Introduction to DevPod"></a>Introduction to DevPod</h2><p>DevPod is an open-source tool developed by Loft Labs that enables developers to create reproducible, disposable development environments on any infrastructure. Similar to GitHub Codespaces, but DevPod is self-hosted and can run on local machines, supported cloud providers, or Kubernetes clusters.</p><p>Key features include:</p><ul><li>Support for multiple backends (Docker, Kubernetes, AWS EC2, etc.)</li><li>Based on the DevContainer standard</li><li>Development environments as code</li><li>Fast environment startup and teardown</li></ul><h2 id="DevPod-Provider-and-Workspace-Creation"><a href="#DevPod-Provider-and-Workspace-Creation" class="headerlink" title="DevPod Provider and Workspace Creation"></a>DevPod Provider and Workspace Creation</h2><h3 id="Installing-DevPod"><a href="#Installing-DevPod" class="headerlink" title="Installing DevPod"></a>Installing DevPod</h3><p>DevPod offers a desktop version, but since I’m running it on FydeOS, I’ll install the DevPod CLI. The DevPod CLI is quite friendly as it has almost no external dependencies and even includes built-in SSH functionality, making it easy to install on FydeOS’s native command line.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/loft-sh/devpod/master/scripts/install.sh | sh</span><br></pre></td></tr></table></figure><h3 id="Configuring-Provider"><a href="#Configuring-Provider" class="headerlink" title="Configuring Provider"></a>Configuring Provider</h3><p>Provider is the backend driver for DevPod, defining where the development environment runs. Using SSH as an example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devpod provider add ssh --name amd -o HOST=AMD</span><br></pre></td></tr></table></figure><p>The above addition method is based on existing SSH configuration, corresponding to the content in <code>~/.ssh/config</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host AMD</span><br><span class="line">  HostName 192.168.0.2</span><br><span class="line">  Port 22</span><br><span class="line">  User user</span><br><span class="line">  IdentityFile /home/user/.ssh/AMD_Key</span><br></pre></td></tr></table></figure><p>Note: DevPod is a tool based on container technology, so the target machine for SSH needs to have Docker or Podman already installed.</p><p>Additionally, when using Ubuntu, pay special attention to the source of the Docker software. If Docker is installed via Snap on Ubuntu, due to Snap restrictions, it cannot access hidden folders (those starting with <code>.</code>) in the user’s Home directory, causing DevPod to fail when executing any build commands with Docker.</p><h3 id="Creating-Workspace"><a href="#Creating-Workspace" class="headerlink" title="Creating Workspace"></a>Creating Workspace</h3><p>Specify the provider and project path to start the workspace. DevPod will create the necessary development environment based on the configuration files. More importantly, DevPod automatically installs the web version of OpenVSCode in the workspace, starts the service, automatically forwards the service port to the local machine, allowing you to code happily. This truly achieves the goal of development environments as code. At the same time, these configurations only require the server to have SSH port open, which is really quite convenient.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devpod up --provider amd --<span class="built_in">source</span> git https://github.com/your-username/your-repo</span><br></pre></td></tr></table></figure><p>This will create a development environment based on the configuration files in the <code>.devcontainer</code> folder of the repository.</p><h2 id="Introduction-to-DevContainer-Format"><a href="#Introduction-to-DevContainer-Format" class="headerlink" title="Introduction to DevContainer Format"></a>Introduction to DevContainer Format</h2><p>DevContainer is a standard format for development environment configuration. This example includes two main files: <code>devcontainer.json</code> and <code>Dockerfile</code>.</p><h3 id="Dockerfile-Configuration"><a href="#Dockerfile-Configuration" class="headerlink" title="Dockerfile Configuration"></a>Dockerfile Configuration</h3><p>The Dockerfile is essentially the configuration file used during docker build. DevPod uses this file to create the workspace container.</p><p>Note: It’s best to build configuration containers based on containers from mcr.microsoft.com&#x2F;devcontainers, as these containers are built according to specific requirements. Some of DevPod’s features depend on files and configurations within the container. If using other containers, you may need to handle compatibility issues yourself when starting the workspace.</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use MS official base image, which contains vscode user to avoid issues when DevPod starts</span></span><br><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/devcontainers/base:bookworm</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install pixi for vscode</span></span><br><span class="line"><span class="keyword">USER</span> vscode</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install pixi, as my projects all use it for dependency management</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> curl -fsSL https://pixi.sh/install.sh | sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure git user information and inject needed alias content into the environment</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git config --global user.name <span class="string">&quot;Sylens&quot;</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">  git config --global user.email <span class="string">&quot;qiumin14@163.com&quot;</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">  <span class="built_in">echo</span> <span class="string">&#x27;alias aider=&quot;aider --no-check-update --no-show-model-warnings --yes --no-auto-commits --model deepseek/deepseek-reasoner&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PATH=<span class="string">&quot;/home/vscode/.pixi/bin:$&#123;PATH&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>Another important point to note is that DevPod’s operation logic is to first build the container, then mount the project code and perform further configuration according to <code>devcontainer.json</code>. Therefore, any settings that depend on project code cannot be performed during the container build phase.</p><h3 id="devcontainer-json-Configuration"><a href="#devcontainer-json-Configuration" class="headerlink" title="devcontainer.json Configuration"></a>devcontainer.json Configuration</h3><p><code>devcontainer.json</code> defines the metadata and IDE configuration for the development container. Here’s a basic configuration that only sets some environment variables and the minimum required plugins.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;silen_blog&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;dockerfile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dockerfile&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;postCreateCommand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pixi run deploy&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;containerEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AIDER_DARK_MODE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;localEnv:AIDER_DARK_MODE&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;AIDER_CODE_THEME&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;localEnv:AIDER_CODE_THEME&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DEEPSEEK_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;localEnv:DEEPSEEK_API_KEY&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;customizations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;vscode&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;workbench.colorTheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Solarized Dark&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;extensions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;naumovs.color-highlight&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;ms-ceintl.vscode-language-pack-zh-hans&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;tamasfe.even-better-toml&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Note: <code>postCreateCommand</code> can only contain one item. If you need to execute multiple commands, it’s recommended to write them into a shell script, place it in the <code>.devcontainer</code> directory, and then call it with <code>postCreateCommand</code>.</p><h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>Back when I was writing <a href="https://github.com/SilenWang/ReviewGPT">ReviewGPT</a> last year, I realized that everyone has ideas, but what matters is actually building them.</p><p>I was originally modifying the terminal app in ChromeOS, hoping to add port forwarding and automatically install VSCode web on the target machine, then automatically forward the port to the local machine. As I worked on it, I discovered that Google had long abandoned pNaCl (which means native apps can’t access local ports), so I thought about developing a Go application that meets my requirements. Continuing to work on it, I discovered DevPod - except that it’s container-based… it’s already very close to my needs… Well, what else should I write then… Let me first learn how to use DevPod…</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DevPod </tag>
            
            <tag> DevOps </tag>
            
            <tag> Development Environment </tag>
            
            <tag> Docker </tag>
            
            <tag> Podman </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debugging Techniques in TypeScript and JavaScript</title>
      <link href="/en/2025/10/13/TS-JS%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/"/>
      <url>/en/2025/10/13/TS-JS%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>As my classmate said, I’m currently experiencing a situation of “being forced to code”… The several websites I maintain each have their own frontend, backend databases, and some even have test code and migration code, involving languages ranging from Python commonly used in bioinformatics to JS, TS, HTML, C#, which I rarely used before. In actual work, there isn’t much time to systematically learn each language from scratch, so mastering the most basic debugging methods is crucial. Among them, I find the debugging methods for JavaScript and TypeScript particularly worth recording, as they do have some unique aspects compared to other languages.</p><span id="more"></span><h2 id="Debugging-Environment-in-Web-Frontend-Frameworks"><a href="#Debugging-Environment-in-Web-Frontend-Frameworks" class="headerlink" title="Debugging Environment in Web Frontend Frameworks"></a>Debugging Environment in Web Frontend Frameworks</h2><p>It’s more accurate to say it’s debugging in a web frontend framework environment rather than pure JS&#x2F;TS debugging. Modern frontend frameworks (such as Vue, React, Angular) have both similarities and obvious differences compared to traditional HTML file structures. Essentially, these frameworks use various compilation and build tools to convert template, script, and style code into final webpage code, which is then rendered and displayed by the browser.</p><p>This mixed programming model is similar to Snakemake workflow files, where a single file may contain multiple language elements. In actual development, what we mainly need to debug are the template part (HTML-like) and the script part (JavaScript&#x2F;TypeScript).</p><h2 id="Debugging-Techniques-for-Template-Parts"><a href="#Debugging-Techniques-for-Template-Parts" class="headerlink" title="Debugging Techniques for Template Parts"></a>Debugging Techniques for Template Parts</h2><h3 id="1-Directly-Display-Variable-Values"><a href="#1-Directly-Display-Variable-Values" class="headerlink" title="1. Directly Display Variable Values"></a>1. Directly Display Variable Values</h3><p>In Vue templates, you can use double curly brace syntax to directly display variables:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123; value &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>In React, use single curly braces:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;value&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><h3 id="2-Conditional-Debug-Display"><a href="#2-Conditional-Debug-Display" class="headerlink" title="2. Conditional Debug Display"></a>2. Conditional Debug Display</h3><p>Sometimes we only want to display debug information during the development phase:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p v-if=&quot;isDevelopment&quot;&gt;Debug Info: &#123;&#123; debugValue &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;!-- Normal content --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="Debugging-Methods-for-Script-Parts"><a href="#Debugging-Methods-for-Script-Parts" class="headerlink" title="Debugging Methods for Script Parts"></a>Debugging Methods for Script Parts</h2><h3 id="1-Basic-Console-Debugging"><a href="#1-Basic-Console-Debugging" class="headerlink" title="1. Basic Console Debugging"></a>1. Basic Console Debugging</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Variable value:&#x27;</span>, variable);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(arrayData); <span class="comment">// Display arrays or objects in table format</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(<span class="built_in">object</span>); <span class="comment">// Display object properties</span></span><br></pre></td></tr></table></figure><h3 id="2-Grouped-Logs"><a href="#2-Grouped-Logs" class="headerlink" title="2. Grouped Logs"></a>2. Grouped Logs</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">group</span>(<span class="string">&#x27;User Information&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Name:&#x27;</span>, user.<span class="property">name</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Email:&#x27;</span>, user.<span class="property">email</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">groupEnd</span>();</span><br></pre></td></tr></table></figure><h3 id="3-Conditional-Breakpoints-and-Debugger"><a href="#3-Conditional-Breakpoints-and-Debugger" class="headerlink" title="3. Conditional Breakpoints and Debugger"></a>3. Conditional Breakpoints and Debugger</h3><pre><code class="typescript">if (someCondition) &#123;  debugger; // Browser will automatically pause at this line&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Debugging </tag>
            
            <tag> Typescript </tag>
            
            <tag> Javascript </tag>
            
            <tag> Frontend Development </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Monitoring My Websites with Uptime Kuma</title>
      <link href="/en/2025/10/09/%E4%BD%BF%E7%94%A8uptime-kuma%E7%9B%91%E6%8E%A7%E6%88%91%E7%BB%B4%E6%8A%A4%E7%9A%84%E7%BD%91%E7%AB%99/"/>
      <url>/en/2025/10/09/%E4%BD%BF%E7%94%A8uptime-kuma%E7%9B%91%E6%8E%A7%E6%88%91%E7%BB%B4%E6%8A%A4%E7%9A%84%E7%BD%91%E7%AB%99/</url>
      
        <content type="html"><![CDATA[<p>Uptime Kuma is an extremely user-friendly open-source monitoring tool that makes monitoring various network services simple and efficient. It supports multiple protocol monitoring including HTTP(s), TCP, Ping, DNS queries, and even simulates real user access through Chrome engine mode to more accurately monitor service stability. Additionally, it supports dozens of notification methods for alerts and can integrate with various applications we use daily. It also offers a unique Push monitoring method, allowing users to extend monitoring functionality through custom code (such as monitoring SSH service availability).</p><span id="more"></span><h2 id="Introduction-to-Uptime-Kuma"><a href="#Introduction-to-Uptime-Kuma" class="headerlink" title="Introduction to Uptime Kuma"></a>Introduction to Uptime Kuma</h2><p><a href="https://github.com/louislam/uptime-kuma">Uptime Kuma</a> is a service monitoring application developed by Louis Lam. The design philosophy of this project is simplicity and ease of use, making it accessible even for users without technical backgrounds.</p><h2 id="Installing-Uptime-Kuma"><a href="#Installing-Uptime-Kuma" class="headerlink" title="Installing Uptime Kuma"></a>Installing Uptime Kuma</h2><p>The simplest method is to use Docker for installation. In iStoreOS’s app store, there are pre-configured solutions available - just install and start it. The project runs on port <code>3001</code> by default. If you’re also using Gogs, there might be a port conflict, so you’ll need to change the port.</p><h2 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h2><h3 id="1-Initial-Setup"><a href="#1-Initial-Setup" class="headerlink" title="1. Initial Setup"></a>1. Initial Setup</h3><p>When accessing for the first time, you need to set up an administrator account and password. The entire process takes only a few minutes to complete.</p><h3 id="2-Adding-Monitoring-Items"><a href="#2-Adding-Monitoring-Items" class="headerlink" title="2. Adding Monitoring Items"></a>2. Adding Monitoring Items</h3><p>Click the “Add Monitor” button and fill in the following information:</p><ul><li><strong>Monitor Type</strong>: Select the monitoring type (such as HTTP, TCP, Ping, etc.)</li><li><strong>Friendly Name</strong>: Give the monitor an easy-to-remember name</li><li><strong>URL&#x2F;Hostname</strong>: The website address or host to monitor</li><li><strong>Heartbeat Interval</strong>: Check interval (default 60 seconds)</li></ul><p>Particularly worth mentioning is the <strong>Chrome Engine Monitoring Mode</strong>: In the advanced settings of HTTP monitoring. This mode uses the actual Chrome browser kernel to access websites, can execute JavaScript, and detect whether page loading is truly complete. This is especially useful for Single Page Applications (SPA) and websites that require user interaction.</p><h3 id="3-Setting-Up-Notifications"><a href="#3-Setting-Up-Notifications" class="headerlink" title="3. Setting Up Notifications"></a>3. Setting Up Notifications</h3><p>In the “Setup Notification” section, you can add various notification methods. Uptime Kuma supports dozens of notification channels, including:</p><ul><li><strong>Instant Messaging</strong>: Telegram, Discord, Slack, Line, Mattermost, etc.</li><li><strong>Email</strong>: SMTP email notifications</li><li><strong>Mobile Push</strong>: Pushover, Gotify, NTFY, etc.</li><li><strong>Webhook</strong>: Can be configured to directly integrate with domestic office software like WeCom, DingTalk, Feishu, etc.</li></ul><p>Taking WeCom as an example:</p><ol><li>Create a notification bot in a group chat</li><li>Note down the bot’s key</li><li>Select WeCom notification method in Uptime Kuma</li><li>Fill in the key</li></ol><p>This way, when services become unavailable or recover, you’ll receive notifications in WeCom.</p><h3 id="4-Using-Push-Monitoring-Mode"><a href="#4-Using-Push-Monitoring-Mode" class="headerlink" title="4. Using Push Monitoring Mode"></a>4. Using Push Monitoring Mode</h3><p>Push monitoring is a unique feature of Uptime Kuma that allows services to actively report their status to Uptime Kuma. This means even for unsupported services (like SSH), we can write simple scripts to push monitoring results to Uptime Kuma for monitoring. I plan to write a Go service to monitor SSH connectivity when I have time.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Uptime Kuma is an extremely feature-rich and very user-friendly monitoring tool, particularly suitable for individual developers and small teams.</p><p>If you’re also looking for a powerful yet easy-to-use monitoring solution, I highly recommend trying Uptime Kuma - let’s become cyber monitoring room masters together!</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitoring </tag>
            
            <tag> Uptime-Kuma </tag>
            
            <tag> Website Maintenance </tag>
            
            <tag> Service Monitoring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Drawing a Circos Plot for Paired Samples</title>
      <link href="/en/2025/10/06/%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E9%85%8D%E5%AF%B9%E6%A0%B7%E6%9C%AC%E7%9A%84Circos%E5%9B%BE/"/>
      <url>/en/2025/10/06/%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E9%85%8D%E5%AF%B9%E6%A0%B7%E6%9C%AC%E7%9A%84Circos%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<p>In cancer research, comparing genomic features between tumor samples and organoid models is crucial for validating model reliability. Circos plots provide an intuitive way to visualize detected mutations across the genome, making them commonly used for representing overall detection results of representative samples. While reading the circlize documentation, I came across an example demonstrating paired samples, which I found suitable for showcasing paired primary samples and organoids. I’ve adapted it to create a plot for displaying paired samples. The code is primarily based on the official documentation’s <a href="https://jokergoo.github.io/circlize_book/book/initialize-genomic-plot.html#concatenating-two-genomes">9.5 Concatenating two genomes</a></p><span id="more"></span><h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><h3 id="Loading-Necessary-R-Packages"><a href="#Loading-Necessary-R-Packages" class="headerlink" title="Loading Necessary R Packages"></a>Loading Necessary R Packages</h3><p>First, we need to load some essential R packages:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>circlize<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>stringr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>MutationalPatterns<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>BSgenome.Hsapiens.UCSC.hg38<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>Among these, <code>MutationalPatterns</code> is mainly used for loading VCF files to avoid manual processing, while <code>BSgenome.Hsapiens.UCSC.hg38</code> provides the necessary information for drawing basic chromosomal regions.</p><h3 id="Data-Preparation"><a href="#Data-Preparation" class="headerlink" title="Data Preparation"></a>Data Preparation</h3><p>This visualization showcases three types of information:</p><ul><li>Somatic mutation detection results (VCF files)</li><li>CNV detection results (from CNVKit)</li><li>Sequencing coverage data (directly using results from CNV software to avoid duplication)</li></ul><h2 id="Building-Genomic-Framework-Data"><a href="#Building-Genomic-Framework-Data" class="headerlink" title="Building Genomic Framework Data"></a>Building Genomic Framework Data</h2><p>We first construct a combined framework containing both tumor and organoid genomes:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Remove XY chromosomes and build combined genomic data</span></span><br><span class="line">tumor_cytoband <span class="operator">&lt;-</span> read.cytoband<span class="punctuation">(</span>species <span class="operator">=</span> <span class="string">&quot;hg38&quot;</span><span class="punctuation">)</span><span class="operator">$</span>df <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span><span class="operator">!</span><span class="punctuation">(</span>V1 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;chrX&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;chrY&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">organoid_cytoband <span class="operator">&lt;-</span> read.cytoband<span class="punctuation">(</span>species <span class="operator">=</span> <span class="string">&quot;hg38&quot;</span><span class="punctuation">)</span><span class="operator">$</span>df <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span><span class="operator">!</span><span class="punctuation">(</span>V1 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;chrX&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;chrY&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tumor_cytoband<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> tumor_cytoband<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">organoid_cytoband<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> organoid_cytoband<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">cytoband <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>tumor_cytoband<span class="punctuation">,</span> organoid_cytoband<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>This creates a data frame named <code>cytoband</code> that contains basic information about the two genomes to be visualized.</p><h2 id="Processing-Mutation-Data"><a href="#Processing-Mutation-Data" class="headerlink" title="Processing Mutation Data"></a>Processing Mutation Data</h2><p>Using the <code>MutationalPatterns</code> package to read VCF files and convert them to a suitable format for plotting:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vcfs <span class="operator">&lt;-</span> read_vcfs_as_granges<span class="punctuation">(</span></span><br><span class="line">    <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line">        <span class="string">&#x27;tumor.vcf&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;pdo.vcf&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;tumor&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pdo&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;BSgenome.Hsapiens.UCSC.hg38&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mut_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    data.frame<span class="punctuation">(</span>vcfs<span class="punctuation">[[</span>t_sample<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>seqnames <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> seqnames<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>seqnames<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    data.frame<span class="punctuation">(</span>vcfs<span class="punctuation">[[</span>o_sample<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>seqnames <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> seqnames<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>seqnames<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="Processing-CNV-and-Coverage-Data"><a href="#Processing-CNV-and-Coverage-Data" class="headerlink" title="Processing CNV and Coverage Data"></a>Processing CNV and Coverage Data</h2><p>Both CNV and coverage data are obtained from CNVkit:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CNV data</span></span><br><span class="line">cnv_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    read.table<span class="punctuation">(</span></span><br><span class="line">            <span class="string">&quot;tumor.cnvkit.call.cns&quot;</span><span class="punctuation">,</span></span><br><span class="line">            sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span></span><br><span class="line">            col.names <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;chromosome&quot;</span><span class="punctuation">,</span> <span class="string">&quot;start&quot;</span><span class="punctuation">,</span> <span class="string">&quot;end&quot;</span><span class="punctuation">,</span> <span class="string">&quot;cn&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> cn<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    read.table<span class="punctuation">(</span></span><br><span class="line">            <span class="string">&quot;pdo.cnvkit.call.cns&quot;</span><span class="punctuation">,</span></span><br><span class="line">            sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span></span><br><span class="line">            col.names <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;chromosome&quot;</span><span class="punctuation">,</span> <span class="string">&quot;start&quot;</span><span class="punctuation">,</span> <span class="string">&quot;end&quot;</span><span class="punctuation">,</span> <span class="string">&quot;cn&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> cn<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>value <span class="operator">=</span> pmin<span class="punctuation">(</span>value<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># Limit CNV values to maximum of 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Coverage data</span></span><br><span class="line">cov_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    read.table<span class="punctuation">(</span><span class="string">&quot;tumor.cnvkit.cov.cnn&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> log2<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    read.table<span class="punctuation">(</span><span class="string">&quot;pdo.cnvkit.cov.cnn&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> log2<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="Drawing-the-Circos-Plot"><a href="#Drawing-the-Circos-Plot" class="headerlink" title="Drawing the Circos Plot"></a>Drawing the Circos Plot</h2><h3 id="Setting-Colors-and-Initialization"><a href="#Setting-Colors-and-Initialization" class="headerlink" title="Setting Colors and Initialization"></a>Setting Colors and Initialization</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Color settings</span></span><br><span class="line">red <span class="operator">&lt;-</span> <span class="string">&quot;#FFC6D6&quot;</span></span><br><span class="line">blue <span class="operator">&lt;-</span> <span class="string">&quot;#bebcff&quot;</span></span><br><span class="line">green <span class="operator">&lt;-</span> <span class="string">&quot;#9CCF83&quot;</span></span><br><span class="line">orange <span class="operator">&lt;-</span> <span class="string">&quot;#fbd988ff&quot;</span></span><br><span class="line">purpule <span class="operator">&lt;-</span> <span class="string">&quot;#ff726dff&quot;</span></span><br><span class="line">black <span class="operator">&lt;-</span> <span class="string">&quot;#000000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set image size</span></span><br><span class="line">png<span class="punctuation">(</span>filename <span class="operator">=</span> <span class="string">&quot;demo.circos.png&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1200</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1200</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build basic circos framework</span></span><br><span class="line">chromosome.index <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line">    paste0<span class="punctuation">(</span><span class="string">&quot;tumor_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">    rev<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;organoid_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.par<span class="punctuation">(</span>gap.after <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">circos.initializeWithIdeogram<span class="punctuation">(</span></span><br><span class="line">    cytoband<span class="punctuation">,</span></span><br><span class="line">    plotType <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> </span><br><span class="line">    chromosome.index <span class="operator">=</span> chromosome.index</span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h3 id="Adding-Chromosome-Tracks"><a href="#Adding-Chromosome-Tracks" class="headerlink" title="Adding Chromosome Tracks"></a>Adding Chromosome Tracks</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set chromosome track</span></span><br><span class="line">circos.track<span class="punctuation">(</span></span><br><span class="line">    ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        circos.text<span class="punctuation">(</span>CELL_META<span class="operator">$</span>xcenter<span class="punctuation">,</span> CELL_META<span class="operator">$</span>ylim<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">+</span> mm_y<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            gsub<span class="punctuation">(</span><span class="string">&quot;.*chr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> CELL_META<span class="operator">$</span>sector.index<span class="punctuation">)</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    track.height <span class="operator">=</span> mm_h<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    cell.padding <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    bg.border <span class="operator">=</span> <span class="literal">NA</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">highlight.chromosome<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;tumor_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> red<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">highlight.chromosome<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;organoid_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> blue<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">circos.genomicIdeogram<span class="punctuation">(</span>cytoband<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h3 id="Adding-Coverage-CNV-and-Mutation-Density-Tracks"><a href="#Adding-Coverage-CNV-and-Mutation-Density-Tracks" class="headerlink" title="Adding Coverage, CNV, and Mutation Density Tracks"></a>Adding Coverage, CNV, and Mutation Density Tracks</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sequencing coverage</span></span><br><span class="line">circos.genomicDensity<span class="punctuation">(</span>cov_data<span class="punctuation">,</span> col<span class="operator">=</span>orange<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> window.size <span class="operator">=</span> <span class="number">1e7</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CNV track</span></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">    cnv_data<span class="punctuation">,</span> </span><br><span class="line">    ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        cell.xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&quot;cell.xlim&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="keyword">for</span><span class="punctuation">(</span>h <span class="keyword">in</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">            circos.lines<span class="punctuation">(</span>cell.xlim<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>h<span class="punctuation">,</span> h<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> black<span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">        col <span class="operator">=</span> ifelse<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">            ifelse<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">)</span></span><br><span class="line">        i <span class="operator">=</span> getI<span class="punctuation">(</span>...<span class="punctuation">)</span></span><br><span class="line">        circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> ytop <span class="operator">=</span> value <span class="operator">+</span> <span class="number">0.3</span><span class="punctuation">,</span> ybottom <span class="operator">=</span> value <span class="operator">-</span> <span class="number">0.3</span> <span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    track.height <span class="operator">=</span> <span class="number">0.1</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mutation density</span></span><br><span class="line">circos.genomicDensity<span class="punctuation">(</span>mut_data<span class="punctuation">,</span> col<span class="operator">=</span>purpule<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> window.size <span class="operator">=</span> <span class="number">1e7</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h3 id="Adding-Text-and-Legend"><a href="#Adding-Text-and-Legend" class="headerlink" title="Adding Text and Legend"></a>Adding Text and Legend</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set center text</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">,</span> <span class="string">&quot;Demo&quot;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> font <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Set corner text</span></span><br><span class="line">text<span class="punctuation">(</span><span class="operator">-</span><span class="number">0.9</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">0.8</span><span class="punctuation">,</span> <span class="string">&quot;Tumor\nGenome&quot;</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">0.9</span><span class="punctuation">,</span> <span class="number">0.8</span><span class="punctuation">,</span> <span class="string">&quot;Organoid\nGenome&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set legend below center text</span></span><br><span class="line">legend<span class="punctuation">(</span></span><br><span class="line">  x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Coverage&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV gain&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV neutral&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV loss&quot;</span><span class="punctuation">,</span>  <span class="string">&quot;Mutation density&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>orange<span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> purpule<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  pch <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">  pt.cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span></span><br><span class="line">  bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">  xjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.clear<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="Complete-Code"><a href="#Complete-Code" class="headerlink" title="Complete Code"></a>Complete Code</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>circlize<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>stringr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>MutationalPatterns<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>BSgenome.Hsapiens.UCSC.hg38<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tumor_cytoband <span class="operator">&lt;-</span> read.cytoband<span class="punctuation">(</span>species <span class="operator">=</span> <span class="string">&quot;hg38&quot;</span><span class="punctuation">)</span><span class="operator">$</span>df <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span><span class="operator">!</span><span class="punctuation">(</span>V1 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;chrX&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;chrY&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">organoid_cytoband <span class="operator">&lt;-</span> read.cytoband<span class="punctuation">(</span>species <span class="operator">=</span> <span class="string">&quot;hg38&quot;</span><span class="punctuation">)</span><span class="operator">$</span>df <span class="operator">%&gt;%</span> filter<span class="punctuation">(</span><span class="operator">!</span><span class="punctuation">(</span>V1 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;chrX&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;chrY&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tumor_cytoband<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> tumor_cytoband<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">organoid_cytoband<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> organoid_cytoband<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">cytoband <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>tumor_cytoband<span class="punctuation">,</span> organoid_cytoband<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">t_sample <span class="operator">&lt;-</span> <span class="string">&quot;tumor&quot;</span></span><br><span class="line">o_sample <span class="operator">&lt;-</span> <span class="string">&quot;pdo&quot;</span></span><br><span class="line"></span><br><span class="line">vcfs <span class="operator">&lt;-</span> read_vcfs_as_granges<span class="punctuation">(</span></span><br><span class="line">    <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line">        <span class="string">&#x27;tumor.vcf&#x27;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&#x27;pdo.vcf&#x27;</span></span><br><span class="line">    <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="built_in">c</span><span class="punctuation">(</span>t_sample<span class="punctuation">,</span> o_sample<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;BSgenome.Hsapiens.UCSC.hg38&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mut_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    data.frame<span class="punctuation">(</span>vcfs<span class="punctuation">[[</span>t_sample<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>seqnames <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> seqnames<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>seqnames<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    data.frame<span class="punctuation">(</span>vcfs<span class="punctuation">[[</span>o_sample<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>seqnames <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> seqnames<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>seqnames<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cnv_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    read.table<span class="punctuation">(</span></span><br><span class="line">            <span class="string">&quot;tumor.cnvkit.call.cns&quot;</span><span class="punctuation">,</span></span><br><span class="line">            sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span></span><br><span class="line">        <span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> cn<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    read.table<span class="punctuation">(</span></span><br><span class="line">            <span class="string">&quot;pdo.cnvkit.call.cns&quot;</span><span class="punctuation">,</span></span><br><span class="line">            sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span></span><br><span class="line">        <span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> cn<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>value <span class="operator">=</span> pmin<span class="punctuation">(</span>value<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cov_data <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span></span><br><span class="line">    read.table<span class="punctuation">(</span><span class="string">&quot;tumor.cnvkit.cov.cnn&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> log2<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;tumor_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    read.table<span class="punctuation">(</span><span class="string">&quot;pdo.cnvkit.cov.cnn&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>value <span class="operator">=</span> log2<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        mutate<span class="punctuation">(</span>chromosome <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&quot;organoid_&quot;</span><span class="punctuation">,</span> chromosome<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">        select<span class="punctuation">(</span>chromosome<span class="punctuation">,</span> start<span class="punctuation">,</span> end<span class="punctuation">,</span> value<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################### Plotting ###########################################</span></span><br><span class="line"></span><br><span class="line">red <span class="operator">&lt;-</span> <span class="string">&quot;#FFC6D6&quot;</span></span><br><span class="line">blue <span class="operator">&lt;-</span> <span class="string">&quot;#bebcff&quot;</span></span><br><span class="line">green <span class="operator">&lt;-</span> <span class="string">&quot;#9CCF83&quot;</span></span><br><span class="line">orange <span class="operator">&lt;-</span> <span class="string">&quot;#fbd988ff&quot;</span></span><br><span class="line">purpule <span class="operator">&lt;-</span> <span class="string">&quot;#ff726dff&quot;</span></span><br><span class="line">black <span class="operator">&lt;-</span> <span class="string">&quot;#000000&quot;</span></span><br><span class="line"></span><br><span class="line">png<span class="punctuation">(</span>filename <span class="operator">=</span> <span class="string">&quot;demo.circos.png&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1200</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1200</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">chromosome.index <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line">    paste0<span class="punctuation">(</span><span class="string">&quot;tumor_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">    rev<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;organoid_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.par<span class="punctuation">(</span>gap.after <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># Set gaps?</span></span><br><span class="line">circos.initializeWithIdeogram<span class="punctuation">(</span></span><br><span class="line">    cytoband<span class="punctuation">,</span></span><br><span class="line">    plotType <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> </span><br><span class="line">    chromosome.index <span class="operator">=</span> chromosome.index</span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.track<span class="punctuation">(</span></span><br><span class="line">    ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        circos.text<span class="punctuation">(</span>CELL_META<span class="operator">$</span>xcenter<span class="punctuation">,</span> CELL_META<span class="operator">$</span>ylim<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">+</span> mm_y<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            gsub<span class="punctuation">(</span><span class="string">&quot;.*chr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> CELL_META<span class="operator">$</span>sector.index<span class="punctuation">)</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    track.height <span class="operator">=</span> mm_h<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    cell.padding <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    bg.border <span class="operator">=</span> <span class="literal">NA</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">highlight.chromosome<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;tumor_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> red<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">highlight.chromosome<span class="punctuation">(</span>paste0<span class="punctuation">(</span><span class="string">&quot;organoid_chr&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">22</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> blue<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">circos.genomicIdeogram<span class="punctuation">(</span>cytoband<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicDensity<span class="punctuation">(</span>cov_data<span class="punctuation">,</span> col<span class="operator">=</span>orange<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> window.size <span class="operator">=</span> <span class="number">1e7</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">    cnv_data<span class="punctuation">,</span> </span><br><span class="line">    ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        cell.xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&quot;cell.xlim&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="keyword">for</span><span class="punctuation">(</span>h <span class="keyword">in</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span> </span><br><span class="line">            circos.lines<span class="punctuation">(</span>cell.xlim<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>h<span class="punctuation">,</span> h<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> black<span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">        col <span class="operator">=</span> ifelse<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&gt;</span> <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">            ifelse<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">)</span> </span><br><span class="line">        i <span class="operator">=</span> getI<span class="punctuation">(</span>...<span class="punctuation">)</span></span><br><span class="line">        circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> ytop <span class="operator">=</span> value <span class="operator">+</span> <span class="number">0.3</span><span class="punctuation">,</span> ybottom <span class="operator">=</span> value <span class="operator">-</span> <span class="number">0.3</span> <span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    track.height <span class="operator">=</span> <span class="number">0.1</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicDensity<span class="punctuation">(</span>mut_data<span class="punctuation">,</span> col<span class="operator">=</span>purpule<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> window.size <span class="operator">=</span> <span class="number">1e7</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">text<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">,</span> <span class="string">&quot;Demo&quot;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> font <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span><span class="operator">-</span><span class="number">0.9</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">0.8</span><span class="punctuation">,</span> <span class="string">&quot;Tumor\nGenome&quot;</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">0.9</span><span class="punctuation">,</span> <span class="number">0.8</span><span class="punctuation">,</span> <span class="string">&quot;Organoid\nGenome&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">legend<span class="punctuation">(</span></span><br><span class="line">  x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>           </span><br><span class="line">  y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>        </span><br><span class="line">  legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Coverage&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV gain&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV neutral&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CNV loss&quot;</span><span class="punctuation">,</span>  <span class="string">&quot;Mutation density&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>orange<span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> purpule<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  pch <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span>        </span><br><span class="line">  pt.cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span></span><br><span class="line">  bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span>       </span><br><span class="line">  xjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>     </span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.clear<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="Final-Result"><a href="#Final-Result" class="headerlink" title="Final Result"></a>Final Result</h2><p>This uses data generated from one sample to create both the upper and lower circles, so the detection results appear identical on both sides. In reality, if paired results were this consistent, it would be quite remarkable.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/10/upgit_20251007_1759767842.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/10/upgit_20251007_1759767842.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="circos_demo"></p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> circlize </tag>
            
            <tag> Genome </tag>
            
            <tag> Mutation </tag>
            
            <tag> CNV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Compiling ffmpeg-rockchip on FydeOS</title>
      <link href="/en/2025/10/02/FydeOS%E4%B8%8B%E7%BC%96%E8%AF%91ffmpeg-rockchip/"/>
      <url>/en/2025/10/02/FydeOS%E4%B8%8B%E7%BC%96%E8%AF%91ffmpeg-rockchip/</url>
      
        <content type="html"><![CDATA[<p>Last year, I actually used Fydetab Duo to compress videos from my travels. At that time, I found a pre-built library on GitHub, but now I can’t find that repository anymore… So this time, I tried to compile it myself…</p><span id="more"></span><p>The compilation referred to <a href="https://github.com/nyanmisaka/ffmpeg-rockchip/wiki/Compilation">the documentation by library author dnyanmisaka</a>, and the entire process was relatively smooth~</p><h2 id="Preparing-the-compilation-environment-using-pixi"><a href="#Preparing-the-compilation-environment-using-pixi" class="headerlink" title="Preparing the compilation environment using pixi"></a>Preparing the compilation environment using pixi</h2><p>Compared to the <code>git</code>, <code>meson</code>, <code>cmake</code>, <code>pkg-config</code>, <code>gcc</code>, <code>libdrm-dev</code> mentioned in the original documentation, many more things are needed here. After all, FydeOS&#x2F;ChromeOS is not a traditional Linux distribution and lacks many common libraries, so we need to supplement the missing dependencies.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pixi init</span><br><span class="line">pixi add make gxx meson cmake pkg-config gcc libdrm libdrm-devel-conda-aarch64 pthread-stubs binutils diffutils awk</span><br></pre></td></tr></table></figure><p>After creating the pixi environment, you need to enter the virtual environment with <code>pixi shell</code>. Once inside, all subsequent compilation and installation destinations will point to this virtual environment, ensuring that all dependencies installed can be found during the final ffmpeg compilation.</p><h2 id="Compiling-rkmpp"><a href="#Compiling-rkmpp" class="headerlink" title="Compiling rkmpp"></a>Compiling rkmpp</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b jellyfin-mpp --depth=1 https://github.com/nyanmisaka/mpp.git rkmpp</span><br><span class="line"><span class="built_in">mkdir</span> -p rkmpp/rkmpp_build</span><br><span class="line"><span class="built_in">cd</span> rkmpp/rkmpp_build</span><br><span class="line"></span><br><span class="line">cmake \</span><br><span class="line">    -DCMAKE_INSTALL_PREFIX=/usr/local/share/project/ffmpeg/.pixi/envs/default/ \</span><br><span class="line">    -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">    -DBUILD_SHARED_LIBS=ON \</span><br><span class="line">    -DBUILD_TEST=OFF \</span><br><span class="line">    ..</span><br><span class="line">make -j $(<span class="built_in">nproc</span>)</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="Compiling-RGA"><a href="#Compiling-RGA" class="headerlink" title="Compiling RGA"></a>Compiling RGA</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b jellyfin-rga --depth=1 https://github.com/nyanmisaka/rk-mirrors.git rkrga</span><br><span class="line">meson setup rkrga rkrga_build \</span><br><span class="line">    --prefix=/usr/local/share/project/ffmpeg/.pixi/envs/default/ \</span><br><span class="line">    --libdir=lib \</span><br><span class="line">    --buildtype=release \</span><br><span class="line">    --default-library=shared \</span><br><span class="line">    -Dcpp_args=-fpermissive \</span><br><span class="line">    -Dlibdrm=<span class="literal">false</span> \</span><br><span class="line">    -Dlibrga_demo=<span class="literal">false</span></span><br><span class="line">meson configure rkrga_build</span><br><span class="line">ninja -C rkrga_build install</span><br></pre></td></tr></table></figure><h2 id="Compiling-and-installing-ffmpeg"><a href="#Compiling-and-installing-ffmpeg" class="headerlink" title="Compiling and installing ffmpeg"></a>Compiling and installing ffmpeg</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ffmpeg part</span></span><br><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/nyanmisaka/ffmpeg-rockchip.git ffmpeg</span><br><span class="line"><span class="built_in">cd</span> ffmpeg</span><br><span class="line">./configure --prefix=/usr/local/share/project/ffmpeg/.pixi/envs/default \</span><br><span class="line">    --enable-gpl --enable-version3 --enable-libdrm --enable-rkmpp --enable-rkrga</span><br><span class="line">make -j $(<span class="built_in">nproc</span>)</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>After executing all the steps above, the virtual environment will have the ffmpeg specifically optimized for Rockchip chips. The video processing speed is more than 10 times faster than the CPU version~</p><p>I’m considering turning the above content into a Pixi environment with tasks, and also learning how to package and upload packages using pixi.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FydeOS </tag>
            
            <tag> ffmpeg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Developing a Data Dashboard with Taipy and the Pitfalls Encountered</title>
      <link href="/en/2025/10/01/%E4%BD%BF%E7%94%A8taipy%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9D%A2%E6%9D%BF%E4%BB%A5%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
      <url>/en/2025/10/01/%E4%BD%BF%E7%94%A8taipy%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9D%A2%E6%9D%BF%E4%BB%A5%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<p>There are really many modules for rapidly developing data or AI-related applications in Python. I’ve already used Dash, Streamlit, Gradio, NiceGUI, and recently I discovered two more. Just when I needed to develop a simple data dashboard to display company data, I once again recklessly decided to use a new framework - Taipy.</p><span id="more"></span><h2 id="Using-Taipy"><a href="#Using-Taipy" class="headerlink" title="Using Taipy"></a>Using Taipy</h2><h3 id="Page-Layout"><a href="#Page-Layout" class="headerlink" title="Page Layout"></a>Page Layout</h3><p>Taipy designs multiple ways to write layouts. Depending on the language you’re familiar with, you can choose from Markdown, HTML, or Python syntax for page layout settings. However, it seems the official recommendation is Markdown. Yes, it’s quite surprising - a library written in Python primarily promotes using Markdown for layouts…</p><p>I naturally chose Python syntax. Its usage is basically consistent with Gradio, using <code>with</code> statements and objects to control element containment relationships.</p><p>Specifically, through the <code>taipy.gui.builder</code> module, we can use Python syntax to define page structure.</p><p>Main layout components include:</p><ul><li><code>tgb.layout()</code>: Creates a layout container, where you can set the number of columns and gap</li><li><code>tgb.part()</code>: Creates content blocks for organizing related components</li></ul><p>In my data dashboard, I adopted a three-level layout structure:</p><ol><li>Top: Company logo, title, and theme toggle control</li><li>Middle: Data visualization components like maps, pie charts, line charts, bar charts</li><li>Bottom: Key metric card displays</li></ol><p>Layout example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tgb.layout(columns=<span class="string">&quot;1 2 1&quot;</span>, gap=<span class="string">&quot;10px&quot;</span>): <span class="comment"># Three columns with width ratio 1:2:1</span></span><br><span class="line">    <span class="comment"># Left block</span></span><br><span class="line">    <span class="keyword">with</span> tgb.part(class_name=<span class="string">&quot;card&quot;</span>):</span><br><span class="line">        tgb.text(<span class="string">&quot;Milestones&quot;</span>, class_name=<span class="string">&quot;h5&quot;</span>)</span><br><span class="line">        tgb.chart(figure=<span class="string">&quot;&#123;timeline&#125;&quot;</span>, plot_config=&#123;<span class="string">&quot;staticPlot&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line">    <span class="comment"># Middle and right blocks are similar</span></span><br></pre></td></tr></table></figure><h3 id="Style-Configuration"><a href="#Style-Configuration" class="headerlink" title="Style Configuration"></a>Style Configuration</h3><p>Taipy supports custom styling through CSS files and Stylekit.</p><ul><li><strong>CSS Styles</strong>: Using CSS is the same as writing regular web pages. I created a <code>style.css</code> file to define global styles and component styles:<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attr">--element-padding</span>: <span class="number">0.4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.scrollable-part</span> &#123;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto; <span class="comment">/* Vertical scrolling */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>Then when creating the project, specify the additional CSS to load:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gui = Gui(page, css_file=<span class="string">&quot;style.css&quot;</span>)</span><br><span class="line">gui.run()</span><br></pre></td></tr></table></figure><ul><li><strong>Stylekit Themes</strong>: Define theme colors through Python dictionaries, then pass them when starting the GUI:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">STYLEKIT = &#123;</span><br><span class="line">    <span class="string">&quot;color-primary&quot;</span>: <span class="string">&quot;#E72410&quot;</span>,</span><br><span class="line">    <span class="string">&quot;color-secondary&quot;</span>: <span class="string">&quot;#F28E2A&quot;</span>,</span><br><span class="line">    <span class="string">&quot;color-background-light&quot;</span>: <span class="string">&quot;#EDEDED&quot;</span>,</span><br><span class="line">    <span class="string">&quot;color-paper-light&quot;</span>: <span class="string">&quot;#FFFFFF&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gui.run(stylekit=STYLEKIT, dark_mode=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>Note that Stylekit controls far fewer elements than the classic approach of setting classes and adjusting them in CSS files. For what can be adjusted, refer to <a href="https://docs.taipy.io/en/latest/userman/gui/styling/">Taipy’s documentation</a>.</li></ul><p>Besides these two methods, different Taipy controls can also use the <code>class_name</code> parameter to set some module-preset styles. What’s available varies by control, so you need to refer to each control’s documentation.</p><h3 id="Value-Binding"><a href="#Value-Binding" class="headerlink" title="Value Binding"></a>Value Binding</h3><p>Taipy provides a method called <a href="https://docs.taipy.io/en/latest/userman/gui/binding/">Value Binding</a> to make updating interface content simpler.</p><p>Specifically, it uses curly brace <code>&#123;&#125;</code> syntax to bind Python variables to interface components. Taking the simplest text example, I can set text display as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;My Text&#x27;</span></span><br><span class="line">tgb.text(<span class="string">&quot;&#123;text&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>In the above step, first assigning the variable <code>text</code>, then using <code>&quot;&#123;text&#125;&quot;</code> in the text control’s content section to bind the variable to the content might seem redundant, but this is very important in Taipy. In Taipy, all objects&#x2F;variables defined in the namespace are placed in a special object called <code>state</code>. In the code above, <code>state.text</code> is actually created, and any changes to <code>state.text</code> will be reflected in the <code>tgb.text(&quot;&#123;text&#125;&quot;)</code> text control. So if I want to update the displayed text, I just need to modify its content where I can access state, and the text will be modified and displayed on the page, like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state.assign(text, <span class="string">&quot;Changed Text&quot;</span>)</span><br></pre></td></tr></table></figure><p>Compared to commonly used Dash&#x2F;Streamlit&#x2F;Gradio, this saves writing code to update control content, making development faster. Especially for data display apps, often the chart and table drawing code is fixed, and we’re just reorganizing data frames or calculating metrics. Taipy’s design allows developers to focus on updating data rather than spending too much time on display aspects.</p><h3 id="Callback-Functions"><a href="#Callback-Functions" class="headerlink" title="Callback Functions"></a>Callback Functions</h3><p>Like other frameworks, various controls in Taipy can also set callback functions. For example, the most basic button has an <code>on_action</code> callback, which is triggered when the button is pressed. Different controls have different available callbacks, so you need to refer to the official documentation.</p><p>Unlike other frameworks, Taipy can also set global default callback functions. We can directly define a function named <code>on_action</code> and place it in the namespace. Taipy’s logic is that if a control can trigger an <code>on_action</code> callback and there’s a function named <code>on_action</code> in the current namespace, the callback will be directly triggered. Therefore, in Taipy, using this global callback requires good logic judgment to avoid accidental callback triggers.</p><h3 id="Background-Tasks"><a href="#Background-Tasks" class="headerlink" title="Background Tasks"></a>Background Tasks</h3><p>Although Taipy has built-in scheduling methods, they’re placed in the paid version. However, fortunately, in the community version, we can use <code>invoke_long_callback</code> for high-load task callbacks to achieve timed data refresh. I referenced <a href="https://github.com/Avaiga/demo-realtime-pollution">an official example</a>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">countdown</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_value</span>(<span class="params">value</span>):</span><br><span class="line">    value = value + randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_display_value</span>(<span class="params">state</span>):</span><br><span class="line">    state.total_client = update_value(state.total_client)</span><br><span class="line">    state.total_visits = update_value(state.total_visits)</span><br><span class="line">    state.total_reads = update_value(state.total_reads)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_init</span>(<span class="params">state</span>):</span><br><span class="line">    set_icon(state)</span><br><span class="line">    invoke_long_callback(</span><br><span class="line">        state,</span><br><span class="line">        user_function = countdown,</span><br><span class="line">        user_status_function = update_display_value,</span><br><span class="line">        period = <span class="number">3000</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>In the code above, <code>invoke_long_callback</code> is a function provided by Taipy. We use it to set up a high-load task, which is <code>user_function</code>. This function will be executed in a separate thread, then a thread is set up to check the high-load task results, calling the function passed in <code>user_status_function</code> to update the data in state. This way, once the data is updated, it triggers Taipy’s value binding logic, updating the content displayed on the page.</p><h2 id="Pitfall-Records"><a href="#Pitfall-Records" class="headerlink" title="Pitfall Records"></a>Pitfall Records</h2><p>Originally, I thought that since Taipy has a clear commercialization plan, the basic functions of this module should be quite good. However, during actual use, I encountered pitfalls that stumped me for over a day…</p><h3 id="Toggle-Control-in-Version-4-1-0-Doesn’t-Trigger-in-Theme-Mode"><a href="#Toggle-Control-in-Version-4-1-0-Doesn’t-Trigger-in-Theme-Mode" class="headerlink" title="Toggle Control in Version 4.1.0 Doesn’t Trigger in Theme Mode"></a>Toggle Control in Version 4.1.0 Doesn’t Trigger in Theme Mode</h3><p>In version 4.1.0 available through pixi&#x2F;conda, I found that the Toggle control with <code>theme=True</code> (set as theme toggle button) had ineffective value binding and function callbacks… This problem troubled me for a day and a half… I tried having AI give me many solutions, but Taipy doesn’t seem to be that popular a module, so I couldn’t directly inject JavaScript to solve it like with other frameworks. So I eventually went to look at the source code… I found that in version 4.1.0, the theme toggle control defined in <code>ThemeToggle.tsx</code> simply didn’t have value binding and callback logic… Only the latest <code>main</code> branch had it… Finally, I solved this problem by installing Taipy from source code…</p><h3 id="Stylekit-Can’t-Set-All-Colors-at-Once"><a href="#Stylekit-Can’t-Set-All-Colors-at-Once" class="headerlink" title="Stylekit Can’t Set All Colors at Once"></a>Stylekit Can’t Set All Colors at Once</h3><p>Although the official documentation says that using Stylekit design allows developers to flexibly and concisely control theme colors, in practice I found that it can’t control the page’s overall background color, which needs to be solved with additional CSS:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Setting theme color */</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--color-background);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Plotly-Doesn’t-Have-a-Function-for-Drawing-Timeline-Charts"><a href="#Plotly-Doesn’t-Have-a-Function-for-Drawing-Timeline-Charts" class="headerlink" title="Plotly Doesn’t Have a Function for Drawing Timeline Charts"></a>Plotly Doesn’t Have a Function for Drawing Timeline Charts</h3><p>This… is purely a complaint about Plotly. Although Python is widely used in data science, whether it’s Plotly, matplotlib, seaborn, or altair, the richness of their graphics still can’t match the ecosystem under R… Of course, someone has written it in R, but package management is too chaotic, and I can’t use others’ code, which is another matter…</p><p>But fortunately, milestone timeline things are just points, lines, and some text, so I finally managed to create it manually with AI’s help…</p><h3 id="Insufficient-Documentation-on-Plotly-Configuration-Methods"><a href="#Insufficient-Documentation-on-Plotly-Configuration-Methods" class="headerlink" title="Insufficient Documentation on Plotly Configuration Methods"></a>Insufficient Documentation on Plotly Configuration Methods</h3><p>This problem also stumped me for a long time. Taipy’s documentation explains how to not use Taipy’s interface but directly pass Plotly objects to draw graphics on the page. But how to configure Plotly objects, the documentation just says to refer to Plotly documentation. Then I experienced the problem with Plotly’s documentation - it seems very detailed but is actually quite poor in content. In their official documentation, many configuration items can only be passed when using <code>fig.show()</code>… rather than directly configuring the Plotly object… Then after going in circles, I found that Taipy’s <code>chart</code> control has a <code>plot_config</code> parameter… This can pass parameters equivalent to those in <code>fig.show()</code>…</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Taipy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Attempting to Modify the Terminal App in ChromeOS (Part 2)</title>
      <link href="/en/2025/09/05/%E5%B0%9D%E8%AF%95%E4%BF%AE%E6%94%B9chromeos%E4%B8%AD%E7%9A%84%E7%BB%88%E7%AB%AFapp-%E4%B8%AD/"/>
      <url>/en/2025/09/05/%E5%B0%9D%E8%AF%95%E4%BF%AE%E6%94%B9chromeos%E4%B8%AD%E7%9A%84%E7%BB%88%E7%AB%AFapp-%E4%B8%AD/</url>
      
        <content type="html"><![CDATA[<p>Picking up from where we left off, after successfully compiling the code in the libapp project, the next steps are: modifying the libapp code and applying the changes to the image.</p><span id="more"></span><h2 id="How-the-Terminal-App-Works"><a href="#How-the-Terminal-App-Works" class="headerlink" title="How the Terminal App Works"></a>How the Terminal App Works</h2><p>I’ve successfully seen the <code>terminal app</code> in the browser. To modify the code, I first need to understand how this application works.</p><p>After some experimentation, my understanding of the terminal application is as follows:</p><ol><li>The terminal app consists of several pages. The outermost interface is actually the <code>terminal.html</code> page, which calls and loads a series of JS scripts within the project to render the page content</li><li>When establishing an SSH connection, the application actually calls special chrome native APIs (similar to Electron?) available only in ChromeOS, opens a new window, and displays the <code>terminal_ssh.html</code> page. This page calls JS scripts in the nassh directory to perform the actual terminal rendering</li><li>Starting an SSH connection actually passes SSH parameters to the <code>terminal_ssh.html</code> page, where scripts within the page construct the SSH command and hand it off to downstream APIs to establish the SSH connection</li><li>Settings are also on a separate page, corresponding to <code>terminal_settings.html</code></li></ol><h2 id="Modifying-the-libapp-Code"><a href="#Modifying-the-libapp-Code" class="headerlink" title="Modifying the libapp Code"></a>Modifying the libapp Code</h2><p>After understanding how the application works, the next step is to try modifying the code. Although I haven’t specifically studied HTML&#x2F;JS&#x2F;CSS web technology stacks and can roughly understand the code logic, I don’t plan to design and write code from scratch. I mainly refer to existing code and combine it to implement the functionality I need.</p><p>From my own usage experience, the existing SFTP mount to local functionality is somewhat similar to the quick port forwarding feature I want:</p><ol><li>SFTP mounting requires setting up SSH details like port, user information, etc.</li><li>Based on existing login entries, SFTP mounting is performed. Clicking mount opens a new page similar to SSH login, but it’s not interactive—it only displays mount information, and the mount automatically ends when the window is closed</li></ol><p>The functionality I want follows this logic:</p><ol><li>Port forwarding requires setting up SSH details like port, user information, etc.</li><li>Based on existing login entries, port forwarding is performed. Clicking forward opens a window to set which port to forward</li><li>Similar to SSH login, a new page opens but is not interactive—it only displays the forwarded port, and forwarding automatically ends when the window is closed</li></ol><p><a href="https://github.com/SilenWang/libapps/tree/feat/add-port-forward-button">The actual modified files</a> are mainly JavaScript files in the terminal and nassh directories, primarily adding a forward button, and then referencing the SFTP functionality implementation to create a function that can perform port forwarding</p><h2 id="Applying-Modifications-to-the-Image"><a href="#Applying-Modifications-to-the-Image" class="headerlink" title="Applying Modifications to the Image"></a>Applying Modifications to the Image</h2><p>In the ChromeOS source code, libapp is not the package name. After searching the project, I found that the compilation of these contents is actually in <code>crosh-extention.ebuild</code>. I found the directory for this ebuild, used git to generate a patch, and placed it in this directory</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff COMMIT_HASH_1 COMMIT_HASH_2 &gt; patchfile.patch</span><br></pre></td></tr></table></figure><p>I also needed to further modify the ebuild file by adding the following content. During the build, the patch will be automatically applied to modify the code</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PATCHES=(</span><br><span class="line">    &quot;$&#123;FILESDIR&#125;&quot;/0001-forward.patch</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="Recompiling-Packages-and-Images"><a href="#Recompiling-Packages-and-Images" class="headerlink" title="Recompiling Packages and Images"></a>Recompiling Packages and Images</h2><p>Here I encountered a pitfall: if you only modify files and compile directly using the previous method, the changes won’t actually be applied.</p><p>According to <a href="https://www.jianshu.com/p/6d8523b1f771">this content I found</a>, you need to use the <code>cros_workon</code> command in <code>cros_sdk</code> to mark specific packages for modification. This ensures that the compilation uses my modified ebuild file instead of fetching source code from a specific version.</p><p>The compilation process can <a href="/en/2025/01/04/%E7%BC%96%E8%AF%91openfyde/" title="Compile openfyde">[refer to previous steps]</a>. When executing <code>build-packages</code>, the tool automatically identifies changed packages, rebuilds them, and places the updated packages into the chroot environment.</p><h2 id="Flashing-and-Booting"><a href="#Flashing-and-Booting" class="headerlink" title="Flashing and Booting"></a>Flashing and Booting</h2><a href="/en/2025/06/19/%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91openfyde-%E4%B8%8B/" title="Trying to compile openfyde again (Part 2)">[Flashing hasn&#39;t changed much either]</a>. However, after randomly modifying the kernel last time, my test device (the Duo) was bricked. So I referred to the [Fydetab Duo wiki instructions](https://wiki.fydetabduo.com/unbrick_the_fydetab_duo) to enter maskrom mode for flashing.<h2 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging?"></a>Debugging?</h2><p>This actually leaves a question: no matter what development you do, you should theoretically complete testing in a test or virtual environment before conducting real device testing and debugging. Otherwise, you’ll waste a lot of time compiling and flashing back and forth. I think this is also the significance of various SDK and Studio suites.</p><p>However, I currently don’t know… How should I debug such modifications before flashing? According to <a href="https://www.owalle.com/2020/06/03/crosvm-chromevm/">a blog I found</a>, it seems possible to use the virtual machine functionality of cros_sdk, calling QEMU’s KVM virtual machine, which seems to allow debugging of compiled images.</p><p>Next time, I’ll debug the functionality properly and show the results! For now, here’s a preview of the interface changes after flashing!</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/09/upgit_20250907_1757177833.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/09/upgit_20250907_1757177833.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="terminal_in_openfyde.png"></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chromeos </tag>
            
            <tag> terminal </tag>
            
            <tag> libapp </tag>
            
            <tag> terminal app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SteamOS is Indeed Maturing</title>
      <link href="/en/2025/08/25/SteamOS%E7%A1%AE%E5%AE%9E%E6%97%A5%E8%B6%8B%E6%88%90%E7%86%9F/"/>
      <url>/en/2025/08/25/SteamOS%E7%A1%AE%E5%AE%9E%E6%97%A5%E8%B6%8B%E6%88%90%E7%86%9F/</url>
      
        <content type="html"><![CDATA[<p>From last year to this year, I played two PC games: Black Myth and WuChang, both downloaded and played on their release days. This would have been hard to imagine five years ago. Back then, I had just finished Monster Hunter: World’s main story using a Windows KVM virtual machine with GPU passthrough. When the Iceborne expansion was released, Proton could already support quite a few older games, but the latest games were difficult to support at launch. I remember it took two to three months after Iceborne’s official PC release before the game could be launched, and there were still some bugs. Moreover, whenever Proton was updated, the game might become unplayable again…<span id="more"></span></p><p>Later, I recall when Cyberpunk 2077 was released, it still couldn’t run on launch day. It took a few weeks before 2077 could run on the Proton compatibility layer. By then, I had upgraded my graphics card and tested it out. There were no major issues getting in, but Chinese fonts and some in-game videos had problems. This was quite acceptable… I just wasn’t that interested in Cyberpunk 2077’s theme, so I didn’t actually play it.</p><p>For several years after that, I didn’t play PC games anymore. My computer was mainly used for analytical testing, and there wasn’t enough hard drive space for games. I mostly played on my Switch.</p><p>Then came the release of Black Myth in 2024. Coincidentally, I had changed jobs and didn’t need to use my computer for work anymore, so I reinstalled the system and tried Bazzite, as it was the only SteamOS-like distribution that supported Nvidia cards at the time. Honestly, the performance exceeded my expectations—the game could be launched on release day. Although the smoothness wasn’t perfect, as someone who’s played as a “pixel hunter”… 540p at less than 30 FPS wasn’t unfamiliar to me. 1080p at 40-60 FPS was completely acceptable, and the game itself wasn’t too difficult, so I followed along with everyone and finished it.</p><p>This year’s WuChang surprised me even more. I didn’t keep the Bazzite system—I just installed Nvidia’s proprietary drivers on Ubuntu 22.04, and the game could be launched directly. The performance was similar to last year’s Black Myth, and I could even stream it to my iPad (to use my NS controller) without lag…</p><p>This means I should be able to try out domestically produced games as soon as they’re released from now on…</p><p>Thank you, Gabe. I wish you the best in eventually overtaking Windows…</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SteamOS </tag>
            
            <tag> Bazzite </tag>
            
            <tag> Gaming </tag>
            
            <tag> Steam </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trying to Modify the Terminal App in ChromeOS (Part 1)</title>
      <link href="/en/2025/08/21/%E5%B0%9D%E8%AF%95%E4%BF%AE%E6%94%B9chromeos%E4%B8%AD%E7%9A%84%E7%BB%88%E7%AB%AFapp-%E4%B8%8A/"/>
      <url>/en/2025/08/21/%E5%B0%9D%E8%AF%95%E4%BF%AE%E6%94%B9chromeos%E4%B8%AD%E7%9A%84%E7%BB%88%E7%AB%AFapp-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p>I’ve been using FydeOS&#x2F;ChromeOS for about two years now. While the system provides a usable terminal app, it’s honestly not that great. For example, during development, I often need to forward multiple ports. Although I can achieve this by entering SSH commands for port forwarding, this requires manually inputting quite a few parameters. Additionally, during port forwarding, I need to keep the SSH login window open. For someone like me who’s particularly obsessive about minimizing the number of open windows, keeping three or four windows open that won’t be used in the foreground is really uncomfortable… So I thought, can I do it myself, with the help of AI, modify the system’s default terminal client, and add quick forwarding functionality like VSCode has?</p><span id="more"></span><h2 id="Cloning-the-Code"><a href="#Cloning-the-Code" class="headerlink" title="Cloning the Code"></a>Cloning the Code</h2><p>The first step is to find out if the project code can be obtained. DeepSeek, Kimi, and ChatGPT can all give me the correct answer: <code>https://chromium.googlesource.com/apps/libapps</code>. Just clone this project locally.</p><h2 id="Project-Compilation"><a href="#Project-Compilation" class="headerlink" title="Project Compilation"></a>Project Compilation</h2><p>Almost every directory in the project comes with documentation, some detailed and some brief. After reading through it and combining it with AI’s answers, the key folders are roughly as follows:</p><ul><li>hterm: A terminal emulator written in JS. All the content you see in the terminal after logging in is rendered by it</li><li>nassh: The terminal emulator extension in the Chrome Web Store, combining content from <code>hterm</code> and <code>ssh_client</code></li><li>ssh_client: The part that communicates with OpenSSH</li><li>terminal: The frontend of the terminal app we see</li></ul><h2 id="Trying-to-Run-Outside-ChromeOS"><a href="#Trying-to-Run-Outside-ChromeOS" class="headerlink" title="Trying to Run Outside ChromeOS"></a>Trying to Run Outside ChromeOS</h2><p>To develop&#x2F;modify an application, you first need to set up the corresponding development and debugging environment. This was the most challenging part for me. Although the project documentation is quite rich, it’s not rich enough for a beginner like me to easily learn how to build a test version of the app that can be debugged. So with the help of AI, I found at least a solution that can show the interface:</p><ul><li>Use pixi to create a virtual environment (On my machine, this is necessary, otherwise the next step will report file copy permission errors)<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;Sylens Wong &lt;qiumin14@163.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">channels</span> = [<span class="string">&quot;conda-forge&quot;</span>]</span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;fydeos_dev&quot;</span></span><br><span class="line"><span class="attr">platforms</span> = [<span class="string">&quot;linux-64&quot;</span>]</span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[activation.env]</span></span><br><span class="line"><span class="attr">PATH</span> = <span class="string">&quot;$PIXI_PROJECT_ROOT/libapps/libdot/bin:$PATH&quot;</span></span><br></pre></td></tr></table></figure></li><li>Enter the virtual environment with <code>pixi shell</code>, then run the project’s built-in <code>kokoro/build</code> script to complete the build and testing of all sub-projects (Testing must be run completely, as the test part is directly written in)</li><li>Enter the <code>terminal</code> directory, then copy some files needed by this frontend that aren’t in this project<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> ../node_modules/xterm/css/xterm.css css/ <span class="comment"># Missing CSS</span></span><br><span class="line"><span class="built_in">cp</span> ../nassh/js/* js/ <span class="comment"># Missing JS scripts</span></span><br><span class="line"><span class="built_in">cp</span> -r ../nassh/_locales ../ <span class="comment"># Missing international language files</span></span><br></pre></td></tr></table></figure></li><li>Run <code>npm run start</code> in the project root directory to start the HTTP service, then enter the following addresses in the browser to see the terminal’s frontend page:<ul><li><code>http://localhost:8080/terminal/html/terminal.html</code>: Main page</li><li><code>http://localhost:8080/terminal/html/terminal_settings.html</code>: Settings page</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/08/upgit_20250821_1755708797.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/08/upgit_20250821_1755708797.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="terminal"></p><p>Although some content on the page is usable, such as adding SSH configurations, the core functionality like actually making SSH connections doesn’t work because this is just the frontend of the app. The actual connection&#x2F;terminal rendering and other content aren’t here.</p><p>However, this is at least a small step forward~</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chromeos </tag>
            
            <tag> terminal </tag>
            
            <tag> libapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Am I Some Kind of Jinx?</title>
      <link href="/en/2025/07/27/%E6%88%91%E6%98%AF%E4%BB%80%E4%B9%88%E5%A4%A9%E7%85%9E%E5%AD%A4%E6%98%9F%E4%BD%93%E8%B4%A8%E4%B9%88/"/>
      <url>/en/2025/07/27/%E6%88%91%E6%98%AF%E4%BB%80%E4%B9%88%E5%A4%A9%E7%85%9E%E5%AD%A4%E6%98%9F%E4%BD%93%E8%B4%A8%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<p>When people are speechless, they really do laugh - my direct supervisor has resigned again and again and again. Why so many “agains”? Let me draw a timeline to see how many bosses I’ve “jinxed”.</p><span id="more"></span><p>Some time points may not be entirely accurate, possibly off by a month or two, but the jinxing is absolutely real…</p><div class="timeline">  <div class="timenode"><div class="meta"><p><p>2017.07-2018.01</p></p></div><div class="body"><ul><li>Company: A bioinformatics service company in Tianjin</li><li>Story: My first job. Two months after probation, I was assigned to a major project team focused on personalized analysis. Then my team leader resigned and went to Beijing after receiving the year-end bonus. After that, I reported directly to the general manager. I also left in August 2018.</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2018.08-2018.10</p></p></div><div class="body"><ul><li>Company: A gene technology company in Hangzhou</li><li>Story: My second job, moving to Hangzhou. I came all the way from Tianjin for the interview. The team leader and department head were very nice, so I decided to join. But before I even passed probation, my entire department was dissolved…</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2018.10-2019.04</p></p></div><div class="body"><ul><li>Company: Same gene technology company in Hangzhou</li><li>Story: After department dissolution, I was transferred to an algorithm development team in another department. The team leader was a math PhD returnee, very nice. I thought this was a good outcome. Later I learned the department head wasn’t satisfied with the team leader (though the leader never complained). The leader resigned in April to pursue deep learning (in hindsight… such a wise decision). After the leader left, our team wasn’t merged. A colleague and I happily did nothing serious… while getting paid for months. Eventually feeling this wasn’t sustainable, I resigned again…</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2019.07-2019.12</p></p></div><div class="body"><ul><li>Company: A biotech company in Hangzhou</li><li>Story: Then came the company where I stayed the longest. When hired, they said they planned to recruit two people, but after I joined, they never found the second. The team leader said candidates kept getting rejected by management (I wasn’t interviewed by leadership due to special circumstances). At first it was fine - Monster Hunter World had just released on PC and I built a new computer, playing for 100+ hours. Then suddenly the team leader resigned… and I was appointed by the boss to replace him.</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2020.04-2021.04</p></p></div><div class="body"><ul><li>Company: Same biotech company in Hangzhou</li><li>Story: The exact timeline is fuzzy but the events are clear. There were two bioinformatics teams - mine was R&amp;D, the neighboring one was production. After becoming R&amp;D lead with no new hires, as R&amp;D tasks were limited, I ended up covering production too when that team collapsed. First a backup member resigned to get married, then the boss was dissatisfied with progress, leading to resignations and eventually the production lead being fired… The boss even discussed this with me… Of course I suggested finding replacements first, but no… So work for 5 people fell to me, and I got pulled into clinical trial applications…</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2022.01-2023.12</p></p></div><div class="body"><ul><li>Company: Still the same biotech company</li><li>Story: The longer I stayed, the more I jinxed. With clinical applications, workload became unbearable (9:30 AM to midnight). In 2022 I was allowed to hire - at peak we had 5 people. But as applications struggled and funding tightened, layoffs came… down to 3… The boss consulted me on who to keep - I suggested keeping the more stable members, but the boss prioritized ability… Predictably by January 2023 only 2 remained… Thankfully applications eventually succeeded, securing investment so the company survived (or I’d have jinxed the whole company). I resigned after the success.</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2024.04-2025.01</p></p></div><div class="body"><ul><li>Company: A medical technology company in Hangzhou</li><li>Story: Current company, same old story… Peaceful first half year, then the department imploded - first forced resignations, then my department head quit… Slightly different this time - we had both administrative and technical leadership, and it was the administrative head who left.</li></ul></div></div>  <div class="timenode"><div class="meta"><p><p>2025.01-2025.07</p></p></div><div class="body"><ul><li>Company: Same medical technology company</li><li>Story: After another half year, this week the technical leader told me he’s resigning too… I could only laugh speechlessly…</li></ul></div></div></div><p>Looking back at my career, I’ve jinxed bosses, colleagues, and nearly the whole company… What kind of curse is this…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hangzhou </tag>
            
            <tag> career </tag>
            
            <tag> job-hopping </tag>
            
            <tag> bioinformatics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>What AI Can and Cannot Do - Two Failed Attempts</title>
      <link href="/en/2025/07/15/AI%E8%83%BD%E5%81%9A%E5%92%8C%E4%B8%8D%E8%83%BD%E5%81%9A%E7%9A%84-%E4%B8%A4%E6%AC%A1%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
      <url>/en/2025/07/15/AI%E8%83%BD%E5%81%9A%E5%92%8C%E4%B8%8D%E8%83%BD%E5%81%9A%E7%9A%84-%E4%B8%A4%E6%AC%A1%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>Compared to two years ago at my previous company, I now use AI much more frequently. If the limitation back then was the convenience of the tools themselves, the current limitation seems to be my own knowledge and technical skills rather than AI.</p><span id="more"></span><p>Last weekend I made two attempts. The first was trying to use Aider and Openhands to help me modify Theia’s remote module. According to AI’s explanation, Theia’s design is completely frontend-backend separated - the frontend only displays while the backend handles all requests. If this is correct, developing a remote version that works in the browser version of Theia should be feasible. With this, I could permanently solve my pain point when using VSCode on Fydetab Duo - insufficient graphics performance causing VSCode to lag.</p><p>However, although both agents could provide some guidance, without basic knowledge of Node.js&#x2F;Electron, I couldn’t determine whether the code written by the agents was reliable just based on their responses. Since I also didn’t know how to debug a large Node.js project like Theia, I couldn’t identify the issues from error messages. In the end, with my current knowledge and skills, I still couldn’t complete the development under AI’s guidance.</p><p>The second attempt was to solve the same problem but use a different method. Since I couldn’t build my desired IDE, could I improve the graphics performance of Fydetab Duo? Specifically, by updating the kernel to enable Vulkan support on FydeOS running on Duo. With Vulkan, VSCode’s performance might improve significantly.</p><p>This attempt also failed. While AI guided me to find the new kernel source code that might work with RK3588, I couldn’t fully understand the descriptions about modifying&#x2F;replacing content during compilation. So I tried the most brute-force approach - directly replacing the kernel project repo in overlay, forcibly using 6.12 as 6.1. I thought at worst some features wouldn’t work? I underestimated it - it bricked my engineering version Duo…</p><p>Again, the same problem - with my knowledge and skills, I didn’t know whether what I was doing was correct, and it was hard to get effective improvement information from the results. I only knew it didn’t work, but how to make it work? Based on two years of experience, blindly trying AI’s suggestions one by one isn’t reliable, as there might be many solutions that professionals would immediately recognize as wrong. Without any foundation, after endless trials, I couldn’t get any positive feedback.</p><p>Therefore, I think the AI I can currently use is truly just a Copilot. I shouldn’t expect it to implement anything from scratch that I have no concept of. Only after establishing basic knowledge and being able to get effective feedback (at least being able to test and understand error messages) can I maximize its value as a Copilot.</p><p>That is, going from 0 to 1 is still difficult, but after getting started, going from 1 to 10 should be easier than before. As for 10 to 100… I’ve never reached 100, so I really don’t know… But I think… these might be limited by context length.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> aider </tag>
            
            <tag> openfyde </tag>
            
            <tag> theia </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trying to compile openfyde again (Part 2)</title>
      <link href="/en/2025/06/19/%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91openfyde-%E4%B8%8B/"/>
      <url>/en/2025/06/19/%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91openfyde-%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<p>After changing the motherboard and CPU, everything went smoothly… I’m not sure whether it was the motherboard or CPU that was causing the issue before - compilation would fail after tens of minutes, and subsequent attempts would fail at different points. This was actually the first time in my life I encountered real hardware incompatibility issues… Another “first time in my life” experience.</p><p>So here comes the second part of compiling openfyde. Unfortunately, during the time I was struggling with the faulty hardware, the prebuilt image for r132-dev version was already updated… Missed the hot topic…</p><span id="more"></span><p>Actually, I had already reached the final steps last time, but got stuck when compiling the massive Chrome project due to my hardware issues. After completing the compilation, we can generate the image that can be directly flashed to a USB drive.</p><p>This time I actually solved a problem from last time - how to get a flashable image using Rockchip tools after obtaining <code>chromiumos.bin</code>. The tutorial gives us a bin image, while official prebuilt versions are in img format, clearly different. Also, unpacking official openfyde prebuilt images with Rockchip tools seems to yield some content not included in the bin.</p><p>Actually, the official tools are available - it’s <a href="https://github.com/openFyde/rk3588-image-maker">openFyde&#x2F;rk3588-image-maker</a>. But last time as a complete beginner, I couldn’t understand what was happening during compilation, let alone figure out what all the projects under openfyde were for.</p><p>The steps to generate the required image are simple: first clone this project, then go to the root directory and run the following commands as instructed:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mount required content from bin</span></span><br><span class="line">./map_chromiumos_image.sh /PATH/TO/CHROMIUMOS/IMAGE.bin --board fydetab_duo</span><br><span class="line"><span class="comment"># Generate update.img</span></span><br><span class="line">./rk3588-mkupdate.sh</span><br></pre></td></tr></table></figure><p>Note: For the r132 version I compiled this time, the <code>Image/parameter.txt</code> file in the project needs modification - change <code>0xa0006d@0x00b02040(STATE)</code> to <code>0xa0006d@0x00b02040(STATE)</code>.</p><p>Then copy the generated image and flash it using the official Rockchip tool. The compiled image this time has working touchscreen, Bluetooth, and Linux containers - should be problem-free.</p><p>Next step is to try adding stuff to it!</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openfyde </tag>
            
            <tag> fydeos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Compiling ARM version of Theia-IDE using GitHub Actions</title>
      <link href="/en/2025/06/16/%E4%BD%BF%E7%94%A8github-action%E7%BC%96%E8%AF%91arm%E7%89%88%E7%9A%84theia-ide/"/>
      <url>/en/2025/06/16/%E4%BD%BF%E7%94%A8github-action%E7%BC%96%E8%AF%91arm%E7%89%88%E7%9A%84theia-ide/</url>
      
        <content type="html"><![CDATA[<p>Since my first encounter with ChromeOS&#x2F;FydeOS, I’ve been trying various VSCode-like editors. Recently, after learning about Huawei’s CodeArt and its upstream project Theia, I started tinkering again.<br>Unfortunately, my current device is an 8GB FydeOS, not the 16GB Manjaro or PixelBook 2017 I used before. The available memory in the Linux container is very limited - I can’t even compile an ARM version of Theia-IDE browser edition… So… I had to “borrow” GitHub’s resources again.</p><span id="more"></span><p>This combines what I mentioned before about <a href="/en/2023/07/23/%E7%99%BD%E5%AB%96codespace%E7%94%A8%E6%9D%A5%E5%86%99hexo%E5%8D%9A%E5%AE%A2/" title="Using Codespace for Free to Write Hexo Blogs">[Using Codespace to write blogs]</a> and <a href="/en/2025/04/13/github-actions%E4%BD%BF%E7%94%A8/" title="Basic Usage of GitHub Actions">[Using GitHub Actions]</a>.</p><p>First, create a new project on GitHub, then click <code>Code</code> in the upper right corner to create a Codespace for this project, which allows you to use VSCode directly in the browser for coding and saving.<br>I directly referenced my previous <a href="https://github.com/SilenWang/certimate_win7">certimate_win7</a> project to create a GitHub workflow, making sure to use GitHub’s Arm Runner.</p><p><a href="https://github.com/eclipse-theia/theia-ide">The original Theia-IDE project</a> doesn’t have official releases yet, so we can’t download pre-built releases by tags. Instead, we need to use checkout to get specific code versions.</p><p>Then follow the instructions in the project’s <a href="https://github.com/eclipse-theia/theia-ide/blob/master/browser.Dockerfile">browser.Dockerfile</a> to set up the compilation steps. After that, package the entire code directory and upload it to my project’s <a href="https://github.com/SilenWang/theia-ide-browser-build/releases">Releases</a>.</p><p>After downloading the compiled files, install system-level dependencies as per the official instructions, then run <code>yarn browser start</code> to launch it.</p><p>Since I’m using FydeOS, I compiled the browser version directly. If you need the desktop version, just follow the official instructions to generate the ARM version.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> theia </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trying to Compile openfyde Again (Part 1)</title>
      <link href="/en/2025/06/15/%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91openfyde-%E4%B8%8A/"/>
      <url>/en/2025/06/15/%E5%86%8D%E6%AC%A1%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91openfyde-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p>At the beginning of this year, I tried to compile openfyde, hoping to learn about compiling and modifying the openfyde system, and also to make use of my extra engineering machine. However, half a year has passed… and the issues from the last compilation still haven’t been resolved…</p><span id="more"></span><p>Seeing that the latest r132 code is being gradually updated recently, I decided to… try compiling it once again…</p><p>This time I basically followed the <a href="#">INVALID POST SLUG PROVIDED 编译openfyde.md</a>: installing system dependencies, downloading <code>depot_tools</code>, cloning the code, entering the chroot environment and starting compilation. The difference is that the r132 version code hasn’t been fully uploaded yet, so there are still some issues during compilation:</p><ul><li>The clone address for <code>chromeos-kernel-6_1-6.1.115-r1676</code> hasn’t been modified yet, making it impossible to get the source code and compile</li><li>There are still bugs in the <code>libv4lplugins-0.0.1</code> code that require an additional patch to fix:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Index: libv4l-rkmpp/src/libv4l-rkmpp.c</span><br><span class="line">===================================================================</span><br><span class="line">--- libv4l-rkmpp.orig/src/libv4l-rkmpp.c</span><br><span class="line">+++ libv4l-rkmpp/src/libv4l-rkmpp.c</span><br><span class="line"></span><br><span class="line">@@ -1206,5 +1206,4 @@</span><br><span class="line"> .init = &amp;plugin_init,</span><br><span class="line"> .close = &amp;plugin_close,</span><br><span class="line"> .ioctl = &amp;plugin_ioctl,</span><br><span class="line">-.mmap = &amp;plugin_mmap,</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></li></ul><p>Currently my old computer keeps crashing during compilation… I’ll update this post when it’s done…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openfyde </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Playwright for Browser Testing</title>
      <link href="/en/2025/06/09/%E4%BD%BF%E7%94%A8playwright%E6%8E%A7%E5%88%B6%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95/"/>
      <url>/en/2025/06/09/%E4%BD%BF%E7%94%A8playwright%E6%8E%A7%E5%88%B6%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>For websites requiring interactive operations, using pytest for API testing alone is insufficient as it doesn’t cover frontend interactions. Previously I used Selenium for browser control in web scraping tasks, but now I’ve found that Microsoft’s Playwright can also control browsers for automated testing, and it’s even simpler to use than Selenium since it supports automatic test case recording.</p><span id="more"></span><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Using pixi makes Playwright installation quick, but after installation you still need to call Playwright to install browser dependencies. This differs from Selenium which directly uses browsers supported by the system.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install firefox and chromium</span></span><br><span class="line">playwright install --with-deps firefox chromium</span><br></pre></td></tr></table></figure><h2 id="Using-with-Pytest"><a href="#Using-with-Pytest" class="headerlink" title="Using with Pytest"></a>Using with Pytest</h2><p>Playwright supports multiple languages and also works with Python’s Pytest framework. Using the command <code>playwright codegen -b firefox http://127.0.0.1:8000</code> to open the browser, then selecting Pytest in the recording window allows you to record Pytest code. A recorded test would look like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL = <span class="string">&#x27;http://127.0.0.1:8000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_sample</span>(<span class="params">lab_mem_page</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        lab_mem_page.goto(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/page&quot;</span>, wait_until=<span class="string">&quot;load&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> TimeoutError: <span class="comment"># Retry once if failed</span></span><br><span class="line">        lab_mem_page.reload(wait_until=<span class="string">&quot;load&quot;</span>)</span><br><span class="line"></span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;button&quot;</span>, name=<span class="string">&quot;添加/修改样本&quot;</span>).click()</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;menuitem&quot;</span>, name=<span class="string">&quot;添加样本&quot;</span>).click()</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;textbox&quot;</span>, name=<span class="string">&quot;*内部编号&quot;</span>).fill(<span class="string">&quot;CODE&quot;</span>)</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;textbox&quot;</span>, name=<span class="string">&quot;*住院号&quot;</span>).fill(<span class="string">&quot;6666&quot;</span>)</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;textbox&quot;</span>, name=<span class="string">&quot;*姓名&quot;</span>).fill(<span class="string">&quot;2222&quot;</span>)</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;textbox&quot;</span>, name=<span class="string">&quot;*性别&quot;</span>).click()</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;listitem&quot;</span>).<span class="built_in">filter</span>(has_text=<span class="string">&quot;男&quot;</span>).click()</span><br><span class="line">    lab_mem_page.get_by_role(<span class="string">&quot;button&quot;</span>, name=<span class="string">&quot;提交&quot;</span>).click()</span><br><span class="line">    expect(lab_mem_page.get_by_text(<span class="string">&quot;添加成功&quot;</span>)).to_be_visible()</span><br></pre></td></tr></table></figure><p>After creating test cases, you can run tests and see if any content needs trimming or adjustment.</p><h2 id="Leveraging-Pytest-Features"><a href="#Leveraging-Pytest-Features" class="headerlink" title="Leveraging Pytest Features"></a>Leveraging Pytest Features</h2><p>When using Pytest for testing, Pytest’s fixture system and special <code>conftest.py</code> files are all available, allowing information sharing between tests just like regular Pytest testing to make tests more efficient and stable.</p><h2 id="Issues-with-Recording-System"><a href="#Issues-with-Recording-System" class="headerlink" title="Issues with Recording System"></a>Issues with Recording System</h2><p>While the recording feature significantly speeds up test writing, automatic recording doesn’t always perfectly select page elements, especially when interactive elements are dynamically generated. Therefore, to write stable test cases, some frontend knowledge is still needed to uniquely identify target elements in the resource tree.</p>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytest </tag>
            
            <tag> playwright </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Testing Network APIs with pytest</title>
      <link href="/en/2025/06/09/%E4%BD%BF%E7%94%A8pytest%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9CAPI%E6%B5%8B%E8%AF%95/"/>
      <url>/en/2025/06/09/%E4%BD%BF%E7%94%A8pytest%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9CAPI%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>For the past six months, a significant part of my work has been maintaining the company’s website. Since I took over the code midway, there’s always a risk of introducing new bugs during maintenance. Therefore, as required by my supervisor, I learned how to implement automated testing.</p><span id="more"></span><p>The testing framework used is pytest, the most popular testing framework in Python.</p><p>The framework is very simple to use. Create files starting with <code>test_</code>, then write functions starting with <code>test_</code> inside them. Within these functions, write test code and add <code>assert</code> statements to complete the most basic tests:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BASE_URL = <span class="string">&#x27;http://127.0.0.1:4567&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_login_success</span>():</span><br><span class="line">    login_data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;USER&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">    response = requests.post(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/login&quot;</span>, json=login_data)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Assert key results</span></span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;accessToken&quot;</span> <span class="keyword">in</span> response.json().get(<span class="string">&quot;data&quot;</span>)</span><br></pre></td></tr></table></figure><p>In actual testing, we often need to set up some shared information between different tests. For example, all the APIs I need to test require authentication, so it’s perfect to use pytest’s <code>fixture</code> system. We can first obtain a login token before testing begins, then use the same token to access APIs in each test function:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&#x27;session&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prod_admin_auth_header</span>():</span><br><span class="line">    <span class="keyword">return</span> auth_header(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_get_dictionary_id</span>(<span class="params">prod_admin_auth_header</span>):</span><br><span class="line">    response = requests.get(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/GetDictionaryid&quot;</span>, headers=lab_mem_auth_header)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br></pre></td></tr></table></figure><p>Here, functions marked as <code>fixture</code> can be directly passed into test functions as parameters by their function names, without requiring additional operations.</p><p>Additionally, you can create a special file <code>conftest.py</code> in the test folder to store all the <code>fixture</code>s that need to be shared across the entire test suite. This way, in other test files, you can directly use the configured <code>fixture</code>s without manual imports.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pytest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OMG...Our company server got hacked by malware</title>
      <link href="/en/2025/06/07/%E6%B4%BB%E4%B9%85%E8%A7%81%E5%85%AC%E5%8F%B8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%94%BB%E5%87%BB%E4%BA%86/"/>
      <url>/en/2025/06/07/%E6%B4%BB%E4%B9%85%E8%A7%81%E5%85%AC%E5%8F%B8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%94%BB%E5%87%BB%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>Since I started playing with the ancient version of Linux Deepin in my junior year (2011), it’s been 14 years now. During this long period, I’ve used Debian&#x2F;RedHat&#x2F;Arch-based distros, but except for accidentally deleting my graduation thesis in my final year of grad school, I’ve never encountered any malware or viruses on Linux distributions.</p><p>However last week, our company server… actually got infected…</p><span id="more"></span><p>At first when the maintenance vendor told me our server might be infected, I was skeptical, because the technical support staff seemed quite unreliable.</p><p>I watched the whole remote operation process… their command familiarity… was even worse than mine… They just opened TOP and went through process names one by one, didn’t even know how to filter by user or sort by CPU usage. They even asked me about some obviously normal processes… After rebooting, they looked at TOP and said “seems fine now” (while CPU was still at 100%)… After messing around for a while, they just said “probably a mining virus, you need to reinstall the system” and stopped responding…</p><p>Although our data and system are separated, reinstalling would still cost us extra time reconfiguring everything. Moreover, prescribing medicine without diagnosing the problem, <del>doesn’t satisfy my curiosity</del> might not actually solve the problem…</p><p>So I decided to Google first…</p><h2 id="It-really-was-a-mining-virus"><a href="#It-really-was-a-mining-virus" class="headerlink" title="It really was a mining virus"></a>It really was a mining virus</h2><p>Initial Google searches didn’t yield much. Besides CPU being at 100% with no visible process responsible (which matched), <code>netstat</code> didn’t show any connections to mining pools, and <code>systemctl</code> mysteriously stopped working, preventing me from installing some tools mentioned in <a href="https://www.lwohvye.com/2021/02/03/%E6%9F%A5%E6%89%BE%E9%9A%90%E8%97%8F%E8%BF%9B%E7%A8%8B%EF%BC%88%E6%AF%94%E5%A6%82%E6%8C%96%E7%9F%BF%E8%BF%9B%E7%A8%8B%EF%BC%89/">this blog</a>.</p><p>At this point I still wasn’t thinking virus, until I found a blog suggesting using <code>lsattr</code> and <code>chattr</code> to check&#x2F;modify <code>systemctl</code> permissions to fix software installation issues. I found that <code>lsattr</code> was missing from the server, and <code>chattr</code> gave a very strange error. I initially thought maybe these tools weren’t installed?</p><p>Then I remembered - we have another server! After logging into that one… wow, the other server did have <code>lsattr</code> and <code>chattr</code>… I went back to check what <code>chattr</code> was on the infected server… <code>cat</code> revealed it had clearly been replaced!</p><p>Then it hit me - <code>top</code>&#x2F;<code>htop</code>&#x2F;<code>netstat</code> etc. must have all been modified!</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994077.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994077.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="chattr"></p><h2 id="Discovering-malware-modifications-and-countermeasures"><a href="#Discovering-malware-modifications-and-countermeasures" class="headerlink" title="Discovering malware modifications and countermeasures"></a>Discovering malware modifications and countermeasures</h2><ul><li>lsattr: Completely deleted, couldn’t check file attributes. Replaced with file from the other server.</li><li>chattr: Replaced and set with ‘i’ and ‘a’ attributes so even root couldn’t delete it. Couldn’t reinstall chattr to fix. Replaced with file from the other server.</li><li>top&#x2F;htop: Must have been modified to hide malicious processes. Replaced top from the other server, reinstalled htop.</li><li>systemctl&#x2F;service management: Added a service to launch malware. Modified systemctl couldn’t show the malicious service. Removed immutable attributes and reinstalled systemd.<br><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994100.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994100.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="service"></li><li>ls: Replaced to hide malicious executables and service files. Replaced with file from the other server.<br><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994101.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994101.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="lsattr"></li><li>reboot: Modified (SHA didn’t match the other server). Replaced with file from the other server, but still couldn’t reboot properly after fixing.</li><li>netstat: Replaced to hide malicious network connections. Reinstalled net-tools.<br><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994102.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994102.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="netstat"></li></ul><h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>I guess you really do learn from experience. I never imagined malware would evolve to… just modify all the tools you’d use to detect it…<br>Also, I’ve… really become a sysadmin now…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using aider for programming assistance</title>
      <link href="/en/2025/04/25/%E4%BD%BF%E7%94%A8aider%E8%BE%85%E5%8A%A9%E7%BC%96%E7%A8%8B/"/>
      <url>/en/2025/04/25/%E4%BD%BF%E7%94%A8aider%E8%BE%85%E5%8A%A9%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>This year, DeepSeek has made LLMs popular again. Although after ChatGPT, Copilot and Cursor have been advertising everywhere, I never actually tried them… So this year, I… tried <a href="https://cline.bot/">Cline</a>, which is indeed good, but also matches my preconception - not that convenient. Especially since I need something that can be used directly in the command line and quickly integrated into scripts to batch complete some simple coding initialization tasks. That’s how I found <a href="https://aider.chat/">aider</a>…</p><span id="more"></span><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>The installation is quite simple since it’s a Python project, just use pip:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install aider-install</span><br><span class="line">aider-install</span><br></pre></td></tr></table></figure><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>aider is a CUI application, just enter <code>aider</code> to start. Aider supports a series of chat commands starting with <code>/</code> that help you more efficiently manage code editing tasks, switch modes, and interact with the codebase. Here are some commonly used commands and their functions:</p><ul><li>File management commands<ul><li><code>/add</code>: Add files to the chat session so Aider can edit or review them in detail.</li><li><code>/drop</code>: Remove files from the chat session to free up context space.</li><li><code>/ls</code>: List all known files and indicate which ones are included in the chat session.</li></ul></li><li>Editing and code operation commands<ul><li><code>/code</code>: Request code changes, or switch to code mode if no prompt is provided.</li><li><code>/diff</code>: Show the diff of changes since the last message.</li><li><code>/commit</code>: Commit changes made to the codebase outside the chat (optional commit message).</li><li><code>/undo</code>: Undo Aider’s last Git commit.</li></ul></li><li>Mode switching commands<ul><li><code>/chat-mode</code>: Switch to new chat mode.</li><li><code>/architect</code>: Enter architect&#x2F;edit mode, using two different models for code design or editing.</li><li><code>/ask</code>: Ask questions about the codebase without editing any files.</li></ul></li><li>Other utility commands<ul><li><code>/clear</code>: Clear chat history.</li><li><code>/copy</code>: Copy the assistant’s last message to clipboard.</li><li><code>/model</code>: Switch to a new language model.</li><li><code>/help</code>: Get help about using Aider.</li><li><code>/exit</code> or <code>/quit</code>: Exit the Aider application.</li></ul></li></ul><h2 id="Embedding-in-shell-scripts"><a href="#Embedding-in-shell-scripts" class="headerlink" title="Embedding in shell scripts"></a>Embedding in shell scripts</h2><p>As a CUI program, aider can also be run directly from the command line by specifying parameters and writing the prompt directly in the command line (this is quite similar to <code>ssh</code>).</p><h3 id="Use-Case-1-Batch-blog-translation"><a href="#Use-Case-1-Batch-blog-translation" class="headerlink" title="Use Case 1 - Batch blog translation"></a>Use Case 1 - Batch blog translation</h3><p>Since it can be run from the command line, aider can be conveniently embedded in shell scripts to batch complete some not-too-heavy tasks, like translating all past blogs…</p><p>Although when ChatGPT first became popular, I thought about using it for translation, but after actual operation I found there was still significant manual work. Because I already have hundreds of blog files… Each time entering the prompt, then copying content in and out and proofreading was still tedious and boring work.</p><p>Using aider, I can at least be a bit lazier.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -e </span><br><span class="line"></span><br><span class="line">DIR_A=blog_cn/source/_posts</span><br><span class="line">DIR_B=blog_en/source/_posts</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `<span class="built_in">ls</span> <span class="variable">$DIR_A</span>/*`; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Get filename (without path)</span></span><br><span class="line">    filename=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check if file exists in directory B</span></span><br><span class="line">    <span class="keyword">if</span> [[ -e <span class="string">&quot;<span class="variable">$&#123;DIR_B&#125;</span>/<span class="variable">$&#123;filename&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;File <span class="variable">$&#123;filename&#125;</span> exists in <span class="variable">$&#123;DIR_B&#125;</span>, skipping&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;File <span class="variable">$&#123;filename&#125;</span> doesn&#x27;t exist in <span class="variable">$&#123;DIR_B&#125;</span>, starting aider translation...&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Starting document proofreading&quot;</span></span><br><span class="line">        aider \</span><br><span class="line">            --no-show-model-warnings --<span class="built_in">yes</span> --no-auto-commits \</span><br><span class="line">            --message <span class="string">&quot;I have a blog post here, please translate it to English and save it to <span class="variable">$&#123;DIR_B&#125;</span>/<span class="variable">$&#123;filename&#125;</span>&quot;</span> \</span><br><span class="line">            <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="Use-Case-2-Batch-API-test-generation"><a href="#Use-Case-2-Batch-API-test-generation" class="headerlink" title="Use Case 2 - Batch API test generation"></a>Use Case 2 - Batch API test generation</h3><p>Similar to blog generation, theoretically test code for interfaces can be quickly written based on OpenAPI or Swagger documentation, but if there are many interfaces, writing them manually is still troublesome. In such cases, having aider read the code and pre-generate a test code framework can save a lot of effort.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> group <span class="keyword">in</span> group1 group2 group3;<span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Get filename (without path)</span></span><br><span class="line">    pytest=<span class="built_in">test</span>/<span class="variable">$&#123;group&#125;</span>.py</span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$pytest</span></span><br><span class="line">    aider \</span><br><span class="line">        --no-show-model-warnings --<span class="built_in">yes</span> --no-auto-commits \</span><br><span class="line">        --message <span class="string">&quot;Here is an API&#x27;s Swagger description file <span class="variable">$&#123;group&#125;</span>.swagger.json, please write pytest test scripts based on its content and save the test scripts to <span class="variable">$&#123;pytest&#125;</span>.&quot;</span> \</span><br><span class="line">        data/<span class="variable">$&#123;group&#125;</span>.swagger.json <span class="variable">$pytest</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> aider </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Usage of GitHub Actions</title>
      <link href="/en/2025/04/13/github-actions%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2025/04/13/github-actions%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>In modern software development, Continuous Integration (CI) and Continuous Deployment (CD) are key practices for improving development efficiency and quality. <a href="https://github.com/features/actions">GitHub Actions</a> is a powerful automation tool provided by GitHub that helps developers easily implement CI&#x2F;CD and broader automation workflows.</p><!-- Excerpt section --><span id="more"></span><h2 id="The-Role-of-GitHub-Actions"><a href="#The-Role-of-GitHub-Actions" class="headerlink" title="The Role of GitHub Actions"></a>The Role of GitHub Actions</h2><p>GitHub Actions is a powerful automation platform that allows developers to define and run workflows in GitHub repositories. It can automatically execute a series of tasks (such as code building, testing, deployment, etc.) based on specific events (like code pushes, pull requests, tag releases, etc.). Through GitHub Actions, developers can achieve full automation from code submission to deployment, saving time and effort while reducing human errors.</p><h2 id="GitHub-Actions-Workflow-Structure"><a href="#GitHub-Actions-Workflow-Structure" class="headerlink" title="GitHub Actions Workflow Structure"></a>GitHub Actions Workflow Structure</h2><p>GitHub Actions workflows consist of several components, with the most important being jobs and steps.</p><h3 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h3><p>A workflow can contain multiple jobs, each being an independent execution unit that can run in different environments.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span> <span class="comment"># Job name</span></span><br><span class="line">    <span class="attr">runs-on:</span> [<span class="string">ubuntu-latest</span>] <span class="comment"># Runtime environment, here specifying GitHub-hosted runners</span></span><br></pre></td></tr></table></figure><p><code>runs-on</code> specifies the environment for running the job - here we’re using GitHub’s latest Ubuntu environment.</p><h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><p>Each job can contain multiple steps, where each step is an independent task that can execute a series of commands or call predefined actions. Predefined actions can be found in the <a href="https://github.com/marketplace">GitHub Marketplace</a>.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">current</span> <span class="string">tag</span> <span class="comment"># Step name</span></span><br><span class="line">  <span class="attr">id:</span> <span class="string">get_tag</span> <span class="comment"># Step ID</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">zingimmick/github-action-get-current-tag@v1</span> <span class="comment"># Using a specific pre-written step</span></span><br></pre></td></tr></table></figure><h2 id="Variable-Passing"><a href="#Variable-Passing" class="headerlink" title="Variable Passing"></a>Variable Passing</h2><p>Just like in bioinformatics analysis pipelines I’ve written before, different steps often need to pass information to complete a task. As a simple configuration file, YAML can’t implement variable passing directly, so we need to rely on some environment variables set in the GitHub Actions framework.</p><h3 id="Passing-Information-Between-Steps"><a href="#Passing-Information-Between-Steps" class="headerlink" title="Passing Information Between Steps"></a>Passing Information Between Steps</h3><p>When executing code in steps, you can pass information between steps by appending content to the special environment variable <code>$GITHUB_OUTPUT</code>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Save</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">save_info</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;tag=3&quot; &gt;&gt; $GITHUB_OUTPUT</span></span><br><span class="line"><span class="string"></span><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">use_info</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.save_info.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Passing-Information-Between-Jobs"><a href="#Passing-Information-Between-Jobs" class="headerlink" title="Passing Information Between Jobs"></a>Passing Information Between Jobs</h3><p>In jobs, you can specify to pass outputs from specific steps to job inputs as follows:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">    <span class="attr">get_info:</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Save</span> <span class="string">info</span></span><br><span class="line">                <span class="attr">id:</span> <span class="string">save_info</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                    echo &quot;tag=3&quot; &gt;&gt; $GITHUB_OUTPUT</span></span><br><span class="line"><span class="string"></span>    <span class="attr">outputs:</span></span><br><span class="line">      <span class="attr">tag:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.save_info.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">use_info:</span></span><br><span class="line">        <span class="attr">needs:</span> [<span class="string">get_info</span>] <span class="comment"># Set dependencies to get information from other jobs</span></span><br><span class="line">        <span class="attr">steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Save</span> <span class="string">info</span></span><br><span class="line">                <span class="attr">id:</span> <span class="string">save_info</span></span><br><span class="line">                <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">                    <span class="string">echo</span> <span class="string">$&#123;&#123;</span> <span class="string">needs.get_info.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Example-Building-a-Project-and-Publishing"><a href="#Example-Building-a-Project-and-Publishing" class="headerlink" title="Example: Building a Project and Publishing"></a>Example: Building a Project and Publishing</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">BUILD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;v*&quot;</span> <span class="comment"># Triggered by version tags</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> [<span class="string">ubuntu-latest</span>]</span><br><span class="line">    <span class="attr">permissions:</span> <span class="comment"># Need write permission for releases</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span> </span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">current</span> <span class="string">tag</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">get_tag</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">zingimmick/github-action-get-current-tag@v1</span></span><br><span class="line">  </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">code</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">fetch-depth:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.get_tag.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">frontend</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">pixi</span> <span class="string">run</span> <span class="string">front_prod</span></span><br><span class="line">        </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">backend</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">pixi</span> <span class="string">run</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Pack</span> <span class="string">to</span> <span class="string">zip</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">pixi</span> <span class="string">run</span> <span class="string">release</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Release</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ncipollo/release-action@v1.15.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">draft:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">generateReleaseNotes:</span> <span class="literal">true</span>  <span class="comment"># Automatically generate release notes</span></span><br><span class="line">          <span class="attr">artifacts:</span> <span class="string">&#x27;$<span class="template-variable">&#123;&#123; github.workspace &#125;&#125;</span>/release/*.zip&#x27;</span></span><br><span class="line">          <span class="attr">tag:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.get_tag.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">Release</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.get_tag.outputs.tag</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> github actions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Writing Objects in R</title>
      <link href="/en/2025/04/13/%E7%BC%96%E5%86%99R%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1/"/>
      <url>/en/2025/04/13/%E7%BC%96%E5%86%99R%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<p>Object-oriented programming is a common paradigm in programming. In my actual work, using object-oriented programming mainly serves two purposes: reducing duplicate code through inheritance features, and encapsulating frequently used data into objects to avoid excessive, repetitive, and nested parameter passing.</p><!-- Excerpt --><span id="more"></span><h2 id="Different-Object-Systems-in-R"><a href="#Different-Object-Systems-in-R" class="headerlink" title="Different Object Systems in R"></a>Different Object Systems in R</h2><p>Yes… R has different object systems. Besides the previously encountered S3 (like ggplot) and S4 (adopted by many single-cell packages), there’s R6 which we’ll focus on this time.</p><p>S3 is the most basic and widely used object-oriented system in R, implementing method dispatch through <strong>generic functions</strong>. S3 objects essentially feel like extensions of lists, with relatively simple inheritance implemented via generic functions. This differs significantly from the class systems I’m more familiar with in Python.</p><p>S4 provides a more formal object-oriented programming framework suitable for complex applications requiring strict class checking. It’s more complex than S3 with more comprehensive inheritance mechanisms, but its methods are still implemented through generic functions. While still different from Python’s approach, with inheritance and methods available, and the ability to conveniently use the <code>%&gt;%</code> pipe operator, S4 is somewhat usable.</p><p>Originally I wanted to base my development on S4, but unexpectedly, S4 and <code>box</code> have <a href="https://github.com/klmr/box/issues/284">compatibility issues</a>. The author of <code>box</code> stated in 2022 that it wouldn’t be compatible with S4…</p><p>So finally, I used the <code>R6</code> class, which is a third-party package (yet another third-party one…). The objects it provides are very similar to Python objects - with inheritance, methods, and support for <code>box::use</code>. The only drawback is I haven’t found a way to integrate it with <code>%&gt;%</code>.</p><h2 id="Using-R6-Objects"><a href="#Using-R6-Objects" class="headerlink" title="Using R6 Objects"></a>Using R6 Objects</h2><p>Here’s a concrete example of using R6, which indeed closely resembles Python’s approach, though R6 doesn’t require defining an initialization function.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">box<span class="operator">::</span>use<span class="punctuation">(</span></span><br><span class="line">    R6<span class="punctuation">[</span>R6Class<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">Person <span class="operator">&lt;-</span> R6Class<span class="punctuation">(</span></span><br><span class="line">    <span class="string">&quot;Person&quot;</span><span class="punctuation">,</span></span><br><span class="line">    public <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">        name <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">        age <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">        initialize <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>name<span class="punctuation">,</span> age<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">            self<span class="operator">$</span>name <span class="operator">&lt;-</span> name</span><br><span class="line">            self<span class="operator">$</span>age <span class="operator">&lt;-</span> age</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        greet <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">            cat<span class="punctuation">(</span><span class="string">&quot;Hello, my name is&quot;</span><span class="punctuation">,</span> self<span class="operator">$</span>name<span class="punctuation">,</span> <span class="string">&quot;and I am&quot;</span><span class="punctuation">,</span> self<span class="operator">$</span>age<span class="punctuation">,</span> <span class="string">&quot;years old.\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using the object</span></span><br><span class="line">person <span class="operator">&lt;-</span> Person<span class="operator">$</span>new<span class="punctuation">(</span><span class="string">&quot;John&quot;</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span> <span class="comment"># Instantiation</span></span><br><span class="line">person<span class="operator">$</span>greet<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># Calling the method</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rlang </tag>
            
            <tag> object </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Managing R Script Dependencies with the box Package</title>
      <link href="/en/2025/04/13/%E4%BD%BF%E7%94%A8box%E5%8C%85%E7%AE%A1%E7%90%86R%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BE%9D%E8%B5%96/"/>
      <url>/en/2025/04/13/%E4%BD%BF%E7%94%A8box%E5%8C%85%E7%AE%A1%E7%90%86R%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BE%9D%E8%B5%96/</url>
      
        <content type="html"><![CDATA[<p>After getting used to Python, developing scripts in R can feel quite painful. Putting aside the often-discussed issues with unclear error tracing, when scripts become slightly more complex and need to be split into multiple files, I realized R’s import mechanism is also quite frustrating… Fortunately, there’s the <a href="https://klmr.me/box/index.html">box package</a> that allows module imports similar to Python’s logic.</p><!-- Excerpt --><span id="more"></span><h2 id="Default-Import-Methods-in-R"><a href="#Default-Import-Methods-in-R" class="headerlink" title="Default Import Methods in R"></a>Default Import Methods in R</h2><p>R has two built-in import methods: <code>source</code> and <code>library</code>. The former essentially runs all contents of the specified R file, while the latter requires packaging the code into an R package that needs to be installed before use.</p><p>The former works well when writing relatively simple things, but problems arise when the functionality becomes more complex and needs to be split across multiple files:</p><ol><li><p>Namespace pollution: <code>source()</code> loads all objects from the script directly into the current environment, requiring additional configuration to prevent conflicts.</p></li><li><p>Unclear dependencies: If there are dependencies between scripts, incorrect import order can cause errors.</p></li><li><p>Difficult maintenance: From the <code>source()</code> part, it’s hard to see what exactly is being imported. When trying to find source code for modifications, you need to backtrack level by level, which is very troublesome.</p></li></ol><p>Using <code>library</code> is also problematic - besides the hassle of packaging each time, namespace pollution and difficulty tracing function&#x2F;object origins remain issues.</p><p>In summary, while R’s built-in methods work, they’re not very user-friendly…</p><h2 id="Using-Box"><a href="#Using-Box" class="headerlink" title="Using Box"></a>Using Box</h2><p>Python-style modularity: Supports <code>box::use()</code> syntax for module imports similar to Python’s mechanism, used as follows:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">box<span class="operator">::</span>use<span class="punctuation">(</span></span><br><span class="line">  plots <span class="operator">=</span> .<span class="operator">/</span>modules<span class="operator">/</span>plot_functions<span class="punctuation">,</span> <span class="comment"># Import ./modules/plot_functions.R based on path</span></span><br><span class="line">  shiny_utils <span class="operator">=</span> shiny<span class="operator">/</span>utils<span class="punctuation">,</span> <span class="comment"># Import file with object renaming</span></span><br><span class="line">  ggplot2<span class="punctuation">[</span>ggplot<span class="punctuation">,</span> aes<span class="punctuation">]</span> <span class="comment"># Import ggplot and aes from ggplot2</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>What makes this similar to Python is that it can import specific contents from an R file without importing everything. It can also import all contents of a file into an object, then call functions within the object using <code>mod$func()</code>, similar to how methods are used within objects in Python.</p><p>Beyond these advantages, using <code>box</code> also enables relative path resolution, automatically identifying project root directories, avoiding the need to constantly switch directories with <code>setwd()</code>. This approach also considers cross-platform compatibility, automatically handling path format differences between Windows&#x2F;Linux&#x2F;macOS.</p><p>Finally, using <code>box</code> solves the tracing problem during imports. Whether using <code>mod$func()</code> or partial imports like <code>ggplot2[ggplot, aes]</code>, you can immediately see the source of functions&#x2F;objects being used, avoiding the need to search through piles of files.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> box </tag>
            
            <tag> rlang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Compile openfyde</title>
      <link href="/en/2025/01/04/%E7%BC%96%E8%AF%91openfyde/"/>
      <url>/en/2025/01/04/%E7%BC%96%E8%AF%91openfyde/</url>
      
        <content type="html"><![CDATA[<p>Compile the OpenFyde Image for Fydetab Duo by synthesizing official instructions and forum articles, aiming to compile the latest R120 version image. The goal is to compile the latest R120 version image.</p><!-- 摘要部分 --><span id="more"></span><p>Fyde OS originally provided a domestic accelerated mirror, but it seems to be unavailable now. Therefore, a VPN is required to complete the following content.</p><h2 id="System-Preparation"><a href="#System-Preparation" class="headerlink" title="System Preparation"></a>System Preparation</h2><ul><li>System: Ubuntu 22.04, AMD Ryzen 5 1600 Six-Core @ 12x 3.2GHz, 64G</li><li>Install necessary software: <code>sudo apt-get install git gitk git-gui curl xz-utils python3-virtualenv python3-oauth2client lvm2 thin-provisioning-tools repo</code></li><li>Install <code>depot_tools</code>:<ul><li>Clone the project: <code>git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git &amp;&amp; cd depot_tools &amp;&amp; git checkout e121d14b12412e95ac833cfd31602b674499ea25</code></li><li>Set environment variables: <code>export PATH=/mnt/hdd1/chromeos/openfyde/depot_tools:$PATH</code></li><li>You can also set <code>export DEPOT_TOOLS_UPDATE=0</code> to avoid tool updates. If the network is stable, this setting is optional.</li></ul></li></ul><h2 id="Api-Key-Preparation"><a href="#Api-Key-Preparation" class="headerlink" title="Api Key Preparation"></a>Api Key Preparation</h2><ul><li>Since I am still using a Google account under Fydeos, I applied for a Google API key instead of Fydeos’s. The steps are described in the <a href="https://www.chromium.org/developers/how-tos/api-keys/">official documentation</a></li><li>General steps:<ul><li>Join the chromium-dev development group</li><li>Login to <code>https://cloud.google.com/console</code></li><li>Create a new project, e.g., openfyde.</li><li>Select API Services &gt; Library, find the following API projects, and enable them one by one:<ul><li>Cloud Search API</li><li>Google Drive API</li><li>Safe Browsing API</li><li>Time Zone API</li></ul></li><li>Go to API Services &gt; Credentials, configure OAuth information as prompted, then create credentials &gt; Create OAuth client ID. I chose the desktop application type (no Others option as described in the documentation).</li><li>Create credentials &gt; Create API key to obtain the key.</li><li>Save the client ID, client secret, and API key, and store them in the <code>~/.googleapikeys</code> file as follows:  <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;google_api_key&#x27;: &#x27;your api key&#x27;,</span><br><span class="line">&#x27;google_default_client_id&#x27;: &#x27;your client id&#x27;,</span><br><span class="line">&#x27;google_default_client_secret&#x27;: &#x27;your client secret&#x27;,</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Source-Code-Clone"><a href="#Source-Code-Clone" class="headerlink" title="Source Code Clone"></a>Source Code Clone</h2><ul><li>Create a directory: <code>mkdir -p r120/openfyde</code></li><li>Configure Git, otherwise cloning the code will result in errors:  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;sylens&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;silenseek14@gmail.com&quot;</span></span><br></pre></td></tr></table></figure></li><li>Clone the source code: The R126 version of <code>openFyde/manifest.git</code> is not updated, so only R120 can be compiled. <code>repo sync -j8</code> requires downloading a large amount of source code, with chromium being the largest at nearly 40G. If the download fails due to network issues, running it again will restart the download. Ensure your VPN has sufficient bandwidth.  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repo init -u https://chromium.googlesource.com/chromiumos/manifest.git --repo-url https://chromium.googlesource.com/external/repo.git -b release-R120-15662.B</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openFyde/manifest.git openfyde/manifest -b r120-dev</span><br><span class="line"><span class="built_in">ln</span> -snfr openfyde/manifest .repo/local_manifests</span><br><span class="line">repo <span class="built_in">sync</span> -j8</span><br><span class="line"><span class="built_in">cd</span> openfyde/chromium</span><br><span class="line">gclient <span class="built_in">sync</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Entering-the-Chroot-Environment"><a href="#Entering-the-Chroot-Environment" class="headerlink" title="Entering the Chroot Environment"></a>Entering the Chroot Environment</h2><ul><li>Return to the <code>r120</code> directory and run <code>cros_sdk</code> to start downloading the SDK and preparing the environment. This process takes a long time.</li></ul><h2 id="Starting-the-Compilation"><a href="#Starting-the-Compilation" class="headerlink" title="Starting the Compilation"></a>Starting the Compilation</h2><ul><li>Since the current version of archero cannot be used, modifications are needed to avoid errors.</li><li>After entering chroot, you will be in <code>/mnt/host/source/src/scripts</code> by default. The files that need modification are:<ul><li><code>/mnt/host/source/src/overlays/overlay-fydetab_duo-openfyde/metadata/layout.conf</code>: Delete <code>archero</code>、<code>tablet</code>、<code>ai-dev</code> in the first line</li><li><code>/mnt/host/source/openfyde/overlays/overlay-fydetab_duo-openfyde/profiles/base/parent</code>: Delete the second line’s<code>archero:base</code></li></ul></li><li>Note: All compilation commands are executed within chroot.</li><li>Run <code>setup_board --board=fydetab_duo-openfyde</code><ul><li>It appears that the setup work is not fully completed, but the target directory has been generated.</li></ul></li><li>Install <code>capnproto</code>: <code>sudo emerge capnproto</code></li><li>Modify <code>/mnt/host/source/chromite/lib/dlc_allowlist.py</code>: Change line 14 to <code>DLC_FACTORY_INSTALL = (r&quot;termina-dlc&quot;, r&quot;sample-dlc&quot;,)</code>, i.e., add <code>r&quot;termina-dlc&quot;</code></li><li>Run <code>cros build-packages --jobs=4 &#39;--board=fydetab_duo-openfyde&#39; --no-withautotest --autosetgov --no-use-any-chrome</code></li><li>After completion, build the image with <code>cros build-image --board=fydetab_duo-openfyde --noenable_rootfs_verification</code></li></ul><h2 id="Other-Issues-During-Compilation"><a href="#Other-Issues-During-Compilation" class="headerlink" title="Other Issues During Compilation"></a>Other Issues During Compilation</h2><ul><li><p>Compilation interrupted abnormally: Encountered an abnormal interruption once. Re-entering the environment and compiling again caused inexplicable issues. To start over, delete the <code>chroot</code> and <code>out</code> folders, then run <code>cros_sdk</code> again from the beginning.</p></li><li><p>Virtual hard disk settings: As <a href="https://community.fydeos.com/t/topic/48326/14">hinted by a forum expert</a>, an additional setting is required:</p><ul><li>Open <code>/etc/sysctl.conf</code> and add <code>vm.max_map_count=524288</code>.</li><li>Run <code>sudo sysctl -p</code>.</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openfyde </tag>
            
            <tag> chromeos </tag>
            
            <tag> fydeos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Random Thoughts on FydeTab Duo</title>
      <link href="/en/2024/09/24/%E5%9C%A8%E6%90%AD%E8%BD%BDFydeOS%E7%9A%84FydetabDuo%E4%B8%8A%E7%94%A8Pixi%E9%85%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83/"/>
      <url>/en/2024/09/24/%E5%9C%A8%E6%90%AD%E8%BD%BDFydeOS%E7%9A%84FydetabDuo%E4%B8%8A%E7%94%A8Pixi%E9%85%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<!-- Abstract --><span id="more"></span><p>When I initially participated in the crowdfunding on <a href="https://www.indiegogo.com/projects/fydetab-duo--2">Indiegogo</a>, I had already been studying and working on a pure Linux computer for at least six years. My primary systems had changed several times: Ubuntu, Linux Deepin (the ancient version of Deepin OS, which was a downstream of Ubuntu at that time), Linux Mint, Manjaro.</p><p>Manjaro seemed to be the most problem-free and rolling updated distribution. Yet, it was inevitably hit with dependency issues after upgrades, preventing important work software from opening and thus delaying work.</p><p>Therefore, after visiting the FydeOS website, I had the idea of trying again to use a stable, crash-free “netbook” for work. After all, in terms of computational stability and information security, it is a more ideal solution to perform all bioinformatics analysis tasks on servers or in the cloud. The local machine only needs the most basic tools (SSH) to connect to the server and then it should be able to handle documents, spreadsheets, and presentations at the most basic level.</p><p>So, with a little bit of support for the new domestic direction, I joined the crowdfunding for Fydetab Duo, and while waiting, I began to learn about the ChromeOS system, and even later, I tried to work on a Chromebook for a full year.</p><p>After a long wait, in May 2024, I finally received the 2024 version of Fydetab Duo, an open-source tablet using an RK3588s processor, which officially used the FydeOS system (though I had already obtained a second-hand engineering version from goofish.com two months ago).</p><p>To be honest, even without comparing to full Linux distributions, but just comparing to ChromeOS, there are currently some issues that make this open-source tablet’s FydeOS uncomfortable to use.</p><p>Some of these issues come from the Linux subsystem. The biggest problems are twofold: first, there is a probability that the subsystem will lose network connectivity after waking up. Once lost, I need to restart the network service within the subsystem, as well as the virtual machine. I haven’t found a pattern to this problem, and restarting the virtual machine often takes three to five minutes. This is quite annoying because there may be a computational process running in the subsystem, and during the waiting time, I will engage in compilation and environment preparation for various programs, which often require a network connection. If the network suddenly goes haywire… T T</p><p>The other part comes from the hardware. I currently own two versions of FydeTab: a red engineering version and a gray 2024 retail version. The touchpad on the magnetic keyboard cover of both versions is identified as a mouse and cannot use a series of gestures in ChromeOS, which is very unnatural for me after a year of using ChromeOS. At the same time, the sensitivity of the touchpad needs adjustment; it is extremely prone to accidental touches, causing the mouse to move erratically while typing - a problem that was not present on the Chromebook 2017.</p><p>Nevertheless, the fact that the company is still in operation and that I have received the device is already quite an achievement. I only hope that these issues can be slowly resolved in the future.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fydeos </tag>
            
            <tag> pixi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deploying Hexo Blog with Pixi on Fydetab Duo</title>
      <link href="/en/2024/08/04/fydetab-duo-%E4%B8%8B%E4%BD%BF%E7%94%A8-pixi%E9%83%A8%E7%BD%B2hexo%E5%8D%9A%E5%AE%A2/"/>
      <url>/en/2024/08/04/fydetab-duo-%E4%B8%8B%E4%BD%BF%E7%94%A8-pixi%E9%83%A8%E7%BD%B2hexo%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<p>I’ve had the Fydetab Duo for over a month, and I’m still trying to find ways to make the most use of this device. At the very least, I’d like to write some blogs during my downtime with it. Hence the following exploration.</p><span id="more"></span><p>To be honest, as the Chinese version of Chrome OS, Fyde OS, the recommended method for using Linux should be directly through the Linux subsystem. However, within this month, the Linux subsystem seems to still have some issues that affect usage, such as not being able to connect to the internet for no apparent reason after waking up, mouse display anomalies within the subsystem, and relatively slow subsystem startup, which are minor but impactful issues. Plus, compared to Chrome OS, the Fyde OS team still has more lenient restrictions on the host system (at least sudo does not require switching to a different tty), so I tried to deploy the tools I needed on the host system.</p><h2 id="Installing-Pixi"><a href="#Installing-Pixi" class="headerlink" title="Installing Pixi"></a>Installing Pixi</h2><ul><li>To install <code>pixi</code>, additional environment variable configuration is required because under the Chromium OS-based system, not all places can store and run executables. <code>/usr/local/share</code> is the only choice, so you need to add the following content to the environment variable file, and then run <code>curl -fsSL https://pixi.sh/install.sh | bash</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/share/pixi/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PIXI_HOME=/usr/local/share/pixi</span><br></pre></td></tr></table></figure><h2 id="Installing-code-server-and-git"><a href="#Installing-code-server-and-git" class="headerlink" title="Installing code-server and git"></a>Installing code-server and git</h2><p>The original choice was Microsoft’s official <code>vscode-cli</code> tool, but possibly due to the differences in file structure and environment configuration between Fyde OS and general Linux distributions, it keeps getting stuck at the step of downloading the vscode server when connecting to the service, making it unusable in practice. Therefore, I temporarily used pixi to install <code>code-server</code>.</p><h2 id="Special-Configuration-for-ARM-Platforms"><a href="#Special-Configuration-for-ARM-Platforms" class="headerlink" title="Special Configuration for ARM Platforms"></a>Special Configuration for ARM Platforms</h2><ul><li>Fydeos Tab is an ARM architecture device, so the configuration for <code>pixi</code> needs to include the <code>linux-aarch64</code> platform. In practice, installing yarn has resulted in unrecognized sub-environment python issues, so Fydetab Duo does not use yarn and reverts to npm. Also, since Fyde OS does not have <code>make</code>, <code>gcc</code>, <code>gxx</code> by default, these components need to be added to the <code>linux-aarch64</code> dependencies.</li><li>The system information files in Fyde OS have minor differences from conventional Linux, which can cause hexo’s module to incorrectly parse system information, rendering <code>hexo -v</code> and the <code>hexo g</code> that calls it inoperative. Therefore, it is necessary to add a fixing statement in the deployment task.</li></ul><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[target.linux-aarch64.tasks]</span></span><br><span class="line"><span class="attr">build_blog</span> = &#123;cmd = <span class="string">&quot;npm install -g hexo-cli &amp;&amp; npm install --python=$PWD/.pixi/envs/default/bin/python2 &amp;&amp; sed -i &#x27;34s/distro\\[1\\]/distro/&#x27; $PWD/.pixi/envs/default/lib/node_modules/hexo-cli/dist/console/version.js&quot;</span>, cwd = <span class="string">&quot;.&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="Cloning-And-Deploying-the-Blog"><a href="#Cloning-And-Deploying-the-Blog" class="headerlink" title="Cloning And Deploying the Blog"></a>Cloning And Deploying the Blog</h2><p>These are the additional configurations needed. Simply clone the project and deploy it directly, and you can continue writing blogs.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/SilenWang/silen_blog</span><br><span class="line">pixi run build_blog</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fydeos </tag>
            
            <tag> hexo </tag>
            
            <tag> pixi </tag>
            
            <tag> fydetab duo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using a new R Jupyter kernel to solve the issue of monocle3 not being able to select developmental starting points in notebooks</title>
      <link href="/en/2024/06/23/%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84R%E8%AF%AD%E8%A8%80jupyter%E5%86%85%E6%A0%B8%E8%A7%A3%E5%86%B3monocle3%E6%97%A0%E6%B3%95%E5%9C%A8notebook%E4%B8%8A%E9%80%89%E5%8F%91%E8%82%B2%E8%B5%B7%E5%A7%8B%E7%82%B9%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/en/2024/06/23/%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84R%E8%AF%AD%E8%A8%80jupyter%E5%86%85%E6%A0%B8%E8%A7%A3%E5%86%B3monocle3%E6%97%A0%E6%B3%95%E5%9C%A8notebook%E4%B8%8A%E9%80%89%E5%8F%91%E8%82%B2%E8%B5%B7%E5%A7%8B%E7%82%B9%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>Looking at the creation time of this draft, it was actually June 2024… Now it’s June 2025, and I suddenly understand why so many content creators become “pigeons” (procrastinators). Starting projects is fun, but finishing them is painful… This is one of my few pure bioinformatics posts…</p><p>The problem originated last year when I needed to run monocle3 for pseudotime analysis, but encountered an annoying issue at the final stage. In monocle3, the starting point for pseudotime trajectory needs to be manually specified by the analyst. During R code execution, it automatically opens a browser where users need to specify the starting point on a temporary webpage, then close the page for the analysis to continue.</p><p>However, Jupyter’s <code>irkernel</code> doesn’t support this feature. This means I couldn’t complete the analysis directly in Jupyter notebook. This issue was <a href="https://github.com/cole-trapnell-lab/monocle3/issues/179">first reported in 2019</a>, but even by 2024 when I needed to do the analysis - five years later - there was still no solution…</p><span id="more"></span><p>But I did accidentally discover a solution when GitHub recommended me a project called <a href="https://github.com/jupyter-xeus/">jupyter-xeus</a>. This project aims to develop a new series of Jupyter kernels, including a new R kernel called <a href="https://github.com/jupyter-xeus/xeus-r">xeus-r</a>. This new kernel supports interactive mode and can generate a link when running monocle3. Users can click the link to complete point selection, then exit the page to continue analysis.</p><p><code>xeus-r</code> is available on conda and can be quickly installed using conda&#x2F;mamba&#x2F;pixi. After installation, you’ll see the corresponding <code>xr</code> kernel in Jupyter’s interface - just select it to use.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994103.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749994103.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="xeus-r"></p><p>The code to execute is:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>monocle3<span class="punctuation">)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> readRDS<span class="punctuation">(</span><span class="string">&quot;/Your/rds/contain/monocle3/object.RDS&quot;</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span><span class="built_in">browser</span><span class="operator">=</span><span class="string">&quot;firefox&quot;</span><span class="punctuation">)</span></span><br><span class="line">cds <span class="operator">&lt;-</span> order_cells<span class="punctuation">(</span>cds<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>After running, you’ll see the link to open below the cell. Open it, select the starting point, then close it to continue.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749997047.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2025/06/upgit_20250615_1749997047.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="monocle3"></p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jupyter </tag>
            
            <tag> monocle3 </tag>
            
            <tag> singlecell </tag>
            
            <tag> xeus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>New Tools Solve Old Problems - Using Pixi for Bioinformatics Environment Configuration</title>
      <link href="/en/2024/06/22/%E6%96%B0%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E8%80%81%E9%97%AE%E9%A2%98-%E4%BD%BF%E7%94%A8pixi%E8%BF%9B%E8%A1%8C%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
      <url>/en/2024/06/22/%E6%96%B0%E5%B7%A5%E5%85%B7%E8%A7%A3%E5%86%B3%E8%80%81%E9%97%AE%E9%A2%98-%E4%BD%BF%E7%94%A8pixi%E8%BF%9B%E8%A1%8C%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>Bioinformatics is an interdisciplinary field, and the toolkit or technology stack used in bioinformatics is also quite “interdisciplinary”. The level of fragmentation is, in my opinion, absolutely not less than that of Linux distributions… This also brings us a common challenge: the deployment of bioinformatics analysis environments.</p><span id="more"></span><h2 id="Deploying-bioinformatics-environments-is-a-hassle"><a href="#Deploying-bioinformatics-environments-is-a-hassle" class="headerlink" title="Deploying bioinformatics environments is a hassle"></a>Deploying bioinformatics environments is a hassle</h2><p>In the development process, one would initially select a programming language, subsequently install the appropriate development environment, and thereafter utilize existing environment or package management tools to handle library dependencies.<br>However, bioinformatics, like medical statistics I majored in before, was aimed to solve problem first, using whatever is available, and writing codes only if it is needed… Therefore, encountering multiple languages is a highly likely event. Personally, due to the cutting-edge research field of my previous company… I often have to use tools written by university researchers based on the principle of “whatever works, use it”, and I have come into contact with a bunch of languages: C, C++, Java, Scala, Perl, Python, R, Go, Julia, Nim, Js… If you also count database languages, configuration file syntax, and the like… The quantity could double again…</p><p>Such a messy technology stack makes deploying and setting up a bioinformatics development environment or deploying bioinformatics analysis workflows a very cumbersome task. It’s important to know that a significant proportion of tools or software in bioinformatics may no longer be maintained after about a year, which means that the compilers and libraries required by the software will remain outdated, and gradually start to conflict with subsequent versions, causing a more terrifying dependency explosion problem than inter-version upgrades of Linux distributions. Then this dependency is not only going to explode in a single language’s toolkit, but there is also a possibility of explosions in toolkits of all languages, and due to the C foundation in Python, R and other scripting languages, there can also be cross explosions… It can make a person’s mentality explode in minutes.</p><p>However… The problem is far from over, for some adult reasons… Not everyone can get system-level permissions, and when configuring the environment, they can only use the permissions of an ordinary user, so some problems that can be solved by packaging with the distribution’s package manager may have to be solved by recompiling the entire software’s dependencies… This is enough to make a person explode for a month…</p><p>Based on the aforementioned annoying issues, when I first learned about the tool called <a href="https://anaconda.org/">conda</a>, I really felt it was a lifesaver… A large number of bioinformatics software are pre-compiled, packaged, and uploaded, ready to use after download and decompression, and it can automatically calculate if dependencies conflict, ensuring the basic use of tools in different languages, which is simply perfect!</p><p>However, after using it for a about a week, you will find that… due to being based on Python, the speed of conda’s dependency calculation… is really slow. It might take about 20 minutes to calculate dependencies for around 10 tools, which is especially annoying when there are dependency issues… It’s almost like running 20 minutes of calculations, only to find out there’s a problem with the variable names, and no breakpoints are set, so you have to start over… Perhaps this downside is so significant that it affects general usage, which led to the development of the C++ implementation of Conda: <a href="https://mamba.readthedocs.io/en/latest/user_guide/mamba.html">Mamba</a>, and then came <a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html">micromamba</a>, and later today’s main character, <a href="https://pixi.sh/latest/">pixi</a>.</p><h2 id="Introduction-to-Pixi"><a href="#Introduction-to-Pixi" class="headerlink" title="Introduction to Pixi"></a>Introduction to Pixi</h2><p>In simple terms, pixi is a multi-language software package manager designed for developers, aimed at making it easy for developers to create and lock down multi-language development environments, making computational results easier to replicate.</p><p>The simple usage of pixi (via the command line) can be found in its <a href="https://pixi.sh/latest/">official documentation</a>, and I won’t go into detail here because for me, I mainly use it for environment deployment, where a lot of things are installed at once, so I generally use configuration files for this.</p><h2 id="Basic-Usage-of-Pixi"><a href="#Basic-Usage-of-Pixi" class="headerlink" title="Basic Usage of Pixi"></a>Basic Usage of Pixi</h2><p>Pixi uses configuration files in the <code>toml</code> format (and here we have another one), which is somewhat like <code>ini</code>… but with more complex syntax and the ability to support more features.</p><p>If you want to manage with <code>toml</code>, after installing pixi, you can create a managed project by using <code>pixi init</code>. This command will generate a configuration file in the current directory, and the newly generated file will contain the following content.</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;demo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;Add a short description here&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;silenwang &lt;silenseek14@gmail.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">channels</span> = [<span class="string">&quot;conda-forge&quot;</span>]</span><br><span class="line"><span class="attr">platforms</span> = [<span class="string">&quot;linux-aarch64&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[tasks]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></table></figure><p>It already includes the basic information of the project, tasks, and dependencies, which are the most important and main contents. If tasks are not used, they can be left blank. In the dependencies section, you should write down the desired installations (contents will be retrieved from conda). After saving, you can use <code>pixi install</code> to install the required contents. During the installation process, a lock file will also be generated. The role of this file is similar to the lock files generated by npm or yarn in nodejs, which is used to record the versions of installed software. By managing this lock file along with the project, you can ensure that the same dependencies are installed again when deploying, guaranteeing the reproducibility of software operation or calculations.</p><h2 id="Handling-Multiple-Dependencies-at-Once"><a href="#Handling-Multiple-Dependencies-at-Once" class="headerlink" title="Handling Multiple Dependencies at Once"></a>Handling Multiple Dependencies at Once</h2><p>Although pixi’s software is mainly sourced from conda, it also supports fetching Python packages from pypi. If there are packages not available on conda but can be obtained from pypi, you can add a pypi section in the configuration file. The software within this section will be automatically fetched from pypi and installed after the conda dependencies have been processed, and the obtained packages will also be recorded in the lock file.</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[pypi-dependencies]</span></span><br><span class="line"><span class="attr">spats-shape-seq</span> = <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><p>If there are additional packages that need to be compiled and installed separately, or further processed with scripts after downloading, you can use the <code>task</code> feature to set up tasks.</p><p>Tasks set up in the task block can be executed by running <code>pixi run TASK_NAME</code>. Although the official documentation does not currently provide a direct way to run specific tasks after dependency processing, you can achieve the goal of automatically proceeding with subsequent compilation and installation tasks after dependency processing by executing the <code>pixi install -a</code> command through a task, as shown below:</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;demo&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;Add a short description here&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;silenwang &lt;silenseek14@gmail.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">channels</span> = [<span class="string">&quot;conda-forge&quot;</span>, <span class="string">&quot;bioconda&quot;</span>, <span class="string">&quot;milaboratories&quot;</span>, <span class="string">&quot;main&quot;</span>]</span><br><span class="line"><span class="attr">platforms</span> = [<span class="string">&quot;linux-64&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[tasks]</span></span><br><span class="line"><span class="attr">install</span> = &#123;cmd = <span class="string">&#x27;pixi install -a&#x27;</span>&#125;</span><br><span class="line"><span class="attr">deploy</span> = &#123;cmd = <span class="string">&#x27;echo &quot;Deploy done&quot;&#x27;</span>, depends-<span class="literal">on</span> = [<span class="string">&quot;instal&quot;</span>] &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">[feature.python3.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;3.11.*&quot;</span></span><br><span class="line"><span class="attr">pip</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">jupyter</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">ipykernel</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">numpy</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">pandas</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">statsmodels</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">scipy</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">tensorflow</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">keras</span> = <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Deploy-Multiple-Environments-at-Once"><a href="#Deploy-Multiple-Environments-at-Once" class="headerlink" title="Deploy Multiple Environments at Once"></a>Deploy Multiple Environments at Once</h2><p>Pixi also supports the deployment of multiple environments at once, and the general syntax is as follows:</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[feature.python3.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;3.11.*&quot;</span></span><br><span class="line"><span class="attr">pip</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">jupyter</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">ipykernel</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">numpy</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">pandas</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">statsmodels</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">scipy</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">tensorflow</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">keras</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[feature.python2.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;2.7.*&quot;</span></span><br><span class="line"><span class="attr">pip</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">jupyter</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">ipykernel</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[feature.bioinfo.dependencies]</span></span><br><span class="line"><span class="attr">bwa</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">samtools</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">bedtools</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[feature.rlang.dependencies]</span></span><br><span class="line"><span class="attr">r-base</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">r-irkernel</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">r-ggplot2</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">bioconductor-limma</span> = <span class="string">&quot;*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[environments]</span></span><br><span class="line"><span class="attr">python3</span> = [<span class="string">&quot;python3&quot;</span>]</span><br><span class="line"><span class="attr">python2</span> = [<span class="string">&quot;python2&quot;</span>]</span><br><span class="line"><span class="attr">bioinfo</span> = [<span class="string">&quot;bioinfo&quot;</span>]</span><br><span class="line"><span class="attr">rlang</span> = [<span class="string">&quot;rlang&quot;</span>]</span><br></pre></td></tr></table></figure><p>Specify the environment names in <code>environments</code>, and then use blocks like <code>[feature.rlang.dependencies]</code> to manage the dependencies within the environment. Once configured, use <code>pixi install -a</code> to install all environments (using <code>pixi install</code> will only check for dependency issues but will not actually install them).</p><h2 id="Environment-Usage"><a href="#Environment-Usage" class="headerlink" title="Environment Usage"></a>Environment Usage</h2><p>Although pixi uses packages from conda, its environment activation and usage methods follow those of <code>poetry</code> and <code>pipenv</code>. To activate an environment, run <code>pixi shell</code> in the directory; if there are multiple environments, add <code>-e</code> to specify the environment name. At the same time, pixi also supports running software within the environment using <code>pixi run</code> (yes, <code>pixi run</code> is used both for running tasks and for running commands within the environment).</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
            <tag> pixi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Still Alive is Pretty Tiring</title>
      <link href="/en/2023/12/24/%E8%BF%98%E6%B4%BB%E7%9D%80%E5%B0%B1%E6%98%AF%E6%AF%94%E8%BE%83%E7%B4%AF/"/>
      <url>/en/2023/12/24/%E8%BF%98%E6%B4%BB%E7%9D%80%E5%B0%B1%E6%98%AF%E6%AF%94%E8%BE%83%E7%B4%AF/</url>
      
        <content type="html"><![CDATA[<!-- Summary part --><span id="more"></span><p>Time flies… There are not many days left in 2023, but I haven’t written anything from August to December…</p><!-- Summary part --><!-- more --><p>Actually, I’ve learned a lot of new things these months, both at work and outside of it. But I haven’t had time to organize or write about them, and I might forget them soon…</p><p>So when I saw a blogger’s post earlier (I can’t find the source, hhhhh), they were right. Many tech bloggers get caught up in fiddling with various blog frameworks and flashy plugins, and end up neglecting the act of writing itself due to distractions and mistakes.</p><p>I will continue to stick to writing, regardless of how good dual-link notes or other tools are. Continuously writing and organizing is the most important thing. After all, work never ends; it’s just busy and busier. I still need to worry and be anxious, and even more so because life has become busier with more trivial matters, leading to increased anxiety…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Complaining </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chromebook Tinkering Report</title>
      <link href="/en/2023/08/16/chromebook%E6%8A%98%E8%85%BE%E6%8A%A5%E5%91%8A/"/>
      <url>/en/2023/08/16/chromebook%E6%8A%98%E8%85%BE%E6%8A%A5%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>Last year, I suddenly felt unhappy with the old laptop lying on my bed. It was a relatively expensive purchase for me (a big expense six months after graduation), and it had keyboard and touchpad issues that required two repairs costing another 1000 yuan each. Given its high cost, I didn’t want to leave it idle, so I decided to give fydeos another chance. After some research, I found that both deepin and fydeos have evolved significantly in recent years. Fydeos has become more user-friendly, and they now offer Android as well as a Linux subsystem, making daily use much more accessible. Therefore, I decided to buy a <a href="https://www.lenovo.com/us/en/p/laptops/lenovo/lenovo-edu-chromebooks/lenovo-chromebook-duet-10/zziczctct1x?orgRef=https%253A%252F%252Fwww.google.com%252F">Lenovo Chromebook Duet</a>.</p><!-- Abstract part --><span id="more"></span><h2 id="Chip-Architecture-and-Device-Availability"><a href="#Chip-Architecture-and-Device-Availability" class="headerlink" title="Chip Architecture and Device Availability"></a>Chip Architecture and Device Availability</h2><p>Don’t doubt my mental state; although the content above and the title below might seem like I’m drunk, they are actually logical!<br>Firstly, I know that fydeos has become quite different from the original ChromeOS. Buying a Chromebook to run fydeos is not advisable because fydeos is a company that primarily serves enterprise businesses rather than individual consumers. They don’t have many hardware products they design and maintain long-term. At the time I had this idea, the old ITN devices were no longer available for purchase, and the Fydetab Duo crowdfunding campaign hadn’t started yet. The second-hand FYDEOS version was also quite expensive. Therefore, I decided to buy a cheap ChromeOS tablet to try it out. After all, there are so many of them in the seafood market; if it works well, I’ll use it; otherwise, I won’t sell it (and end up losing 200 yuan).</p><p>When choosing the trial device, I also considered for a long time before deciding on an ARM architecture Duet. This was mainly to get a better Android experience. When using fydeos, I found that this type of system’s Android is not completely isolated from the host system; files generated by Android can be easily read from the host system, and files from the host system can also be right-clicked and shared with Android applications. This is much more convenient than I expected. Additionally, all devices on the host, including the camera, are directly callable by Android applications, allowing for full functionality of Android apps to supplement the ecosystem. However, many domestic apps do not support x86 architecture, causing them to crash or fail to open entirely, making them unusable. Therefore, if I buy an ARM architecture device, it might be able to completely replace my daily notebook and be even lighter, which would be great.</p><h2 id="Device-Positioning-and-Old-Love-New-Romance"><a href="#Device-Positioning-and-Old-Love-New-Romance" class="headerlink" title="Device Positioning and Old Love New Romance"></a>Device Positioning and Old Love New Romance</h2><p>However,事实证明我真的很容易在电子产品上上手，过去如此，现在如此，未来估计还是如此。</p><p>In the two days after I started using the Chrome Duet, I immediately felt that it had significant problems. A cheap netbook’s configuration naturally won’t be great, although an ARM architecture CPU allows Android apps to run smoothly and efficiently. However, wanting to use it as a work device while only being able to run one app fluently is clearly not enough… The Chrome Duet can run WeChat and DingTalk well, but when I open the browser, either WeChat or DingTalk will be terminated, requiring them to be restarted each time. Switching tabs in Chrome also takes 30 seconds, which is extremely frustrating even if my boss doesn’t notice me multitasking. A 4G memory for a mobile device might seem adequate, but given the bloatware of domestic apps… it feels like I’ve already failed.</p><p>Apart from obvious application issues, there were hardware problems as well. The Chrome Duet is a two-in-one tablet; if we only consider its main body, its weight and battery life are even better than my previously owned Huawei tablet. However… when adding the keyboard case… the overall weight of the device becomes confusing… So you say it’s light, but it’s not really that light. In terms of typing, since it’s a keyboard case with a stand-up form factor, this device is inconvenient for use on a lap without a table. Therefore, in scenarios where there’s no desk, it’s immediately discarded… It feels like losing the soul of a writing and social office device. The most frustrating thing is its size—10.1 inches means that the accompanying keyboard is much smaller than a regular notebook. I don’t mind the rebound effect, but switching between a 10.1-inch small keyboard and a 14-inch regular-sized keyboard is really annoying, similar to playing塞尔达 on an NS and then switching to an Xbox controller for Monster Hunter on PC—relearning how to use my newly installed ten fingers…</p><p>In summary, from hardware to software, it failed to meet my expectations for the Duet. In the end, I self-sabotaged it, but I didn’t stop being reckless. Even though there were so many problems with the Duet, I gradually discovered a surprising fact during this trial period: most of my work can actually be done using just a browser.</p><h2 id="My-Work-Requirements"><a href="#My-Work-Requirements" class="headerlink" title="My Work Requirements"></a>My Work Requirements</h2><p>I am a bioinformatics professional, and my usual work involves four main tools:</p><ul><li>Writing scripts: VScode &#x2F; Jupyter</li><li>Copying code: Chrome browser</li><li>Logging into terminals: Whatever distribution comes with it</li><li>Writing files: WPS &#x2F; Office全家桶</li></ul><p>During the period when I was fighting against (not falling in love with) the Duet, I gradually realized that in today’s rapidly evolving web technology, all of these can be achieved through a browser. Jupyter and VScode can run in the browser, and VScode has an integrated terminal emulator. WPS&#x2F;Office has also started to layout its web applications.</p><p>Although not all features are available, it is much more complete than when ChromeOS first came out 10 years ago. It’s like when I first used Logo on a green screen back then, which was like a mint imitation of the initial deepin version. Now, many distributions have Chinese support, and software has increased significantly, making configuration easier. Even Manjaro, which can now run Steam comfortably, feels more relaxed…</p><p>So, I decided to continue being reckless. After sending away the Duet, I switched to a Pixelbook 2017—then it went wrong (the touchpad was faulty, and I didn’t want to spend more money on repairs, so I chose one with backlighting to treat my强迫症).</p><h2 id="Pixelbook-2017-Application-Compatibility"><a href="#Pixelbook-2017-Application-Compatibility" class="headerlink" title="Pixelbook 2017 Application Compatibility"></a>Pixelbook 2017 Application Compatibility</h2><p>Unlike the Duet, the Pixelbook 2017 and other high-end Chromebooks use Intel chips (although I don’t understand why, there’s nothing I can do), so I started using this device with its sleek appearance (ignoring the B-side carrier runway and yellow palm rest). However, its battery life didn’t meet expectations.</p><p>As expected, all four main tools could be relatively easily used. However, the problem ultimately fell on communication software… just like the biggest issue faced by Linux distributions when they first came out.</p><p>Although X86 architecture Pixelbooks can install international versions of WeChat and DingTalk through Play, these apps have poor compatibility. They often crash or fail to use many necessary web-based features, requiring Linux applications to save the day. However, this brings new problems with Linux. Small issues include that Linux applications cannot call device cameras or host desktops like Android apps; they are more like running separate apps in a virtual machine. The bigger problem is that if I rely so much on Linux, why don’t I just format ChromeOS and install Manjaro on this device?</p><h2 id="So-Why-Duet"><a href="#So-Why-Duet" class="headerlink" title="So Why Duet"></a>So Why Duet</h2><p>After trying out an experience that was good but not great, I began to question myself: why do I need to hold onto such a device? Is it for showing off? (Then what?)</p><p>Is it because of fewer interfaces, higher heat generation, or lower battery life than expected?</p><p>I thought about this for a long time, holding the 1.1kg laptop and looking at its 12.3-inch 2.5K screen… Well, the high-resolution screen is still good!</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chromeos </tag>
            
            <tag> chromebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build a ChatGLM2 Service Based on the chatglm.cpp Project Using Singularity</title>
      <link href="/en/2023/08/16/%E4%BD%BF%E7%94%A8singularity%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Echatglm-cpp%E9%A1%B9%E7%9B%AE%E7%9A%84ChatGLM2%E6%9C%8D%E5%8A%A1/"/>
      <url>/en/2023/08/16/%E4%BD%BF%E7%94%A8singularity%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Echatglm-cpp%E9%A1%B9%E7%9B%AE%E7%9A%84ChatGLM2%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>Actually, I’ve known about singularity for quite some time. As a container specifically designed for HPC (High Performance Computing), it’s always been something I wanted to try out. However, just like other NGS technologies outside of Illumina, singularity hasn’t gained much traction and it seems even harder to compete with Kubernetes, which is widely adopted by most cloud vendors… Of course, this doesn’t really matter to me right now… We’re still at least three or five years away from going cloud-based, so using it locally makes perfect sense.</p><!-- Abstract section --><span id="more"></span><p>So let’s start with the most basic step of building an image. The Singularity image build file (Definition File) is quite different from Dockerfile; it’s not a script that runs sequentially but rather a configuration file similar to INI files, partitioned into sections for configuration.</p><p>The necessary keywords for building an image include:</p><ul><li><code>Bootstrap</code>: Used to define where the base image comes from. There are several types, such as dockerhub or singularity’s own library.</li><li><code>From</code>: The name of the base image to build from.</li><li><code>%post</code>: A series of commands used to download files, install software, compile software, etc., during the image build process.</li></ul><p>Given that <a href="https://github.com/li-plus/chatglm.cpp">chatglm.cpp</a> has excellent dependency management, as long as you have a C++ compiler ready, you can install it using pip. Therefore, writing the definition file is quite simple:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap: library</span><br><span class="line">From: debian</span><br><span class="line"></span><br><span class="line">%post</span><br><span class="line">    apt-get update -y &amp;&amp; apt-get upgrade -y</span><br><span class="line">    apt-get install -y cmake gcc g++ pip</span><br><span class="line">    pip install &#x27;chatglm-cpp[api]&#x27;</span><br></pre></td></tr></table></figure><p>Besides these necessary parts, there are other useful sections that might be needed in the future:</p><ul><li><code>%files</code>: Used to copy files into the container during the build process.</li><li><code>%environment</code>: Specifies environment variables for the container.</li><li><code>%runscript</code>: Specifies a script to run when using the <code>run</code> subcommand to execute the container.</li><li><code>%startscript</code>: Specifies a script to run when using the <code>instance</code> (seems to be used for starting services on boot) subcommand to execute the container.</li><li><code>%test</code>: Specifies commands to run in the container after it’s built to check if the build was successful.</li><li><code>%labels</code>: Fills in metadata information for the image.</li><li><code>%help</code>: Provides usage instructions for the image.</li></ul><p>With the def file, you can start building by running the command (using fakeroot allows non-root user builds and requires certain settings; see <a href="https://docs.sylabs.io/guides/3.11/user-guide/build_a_container.html#fakeroot-builds">official documentation</a>). The built image won’t be stored locally like Docker images but will generate an sif file.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">singularity build --fakeroot chatglm.cpp.singularity.sif build.def</span><br></pre></td></tr></table></figure><p>To enable the built image, you can use the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">singularity <span class="built_in">exec</span> \</span><br><span class="line">   --<span class="built_in">bind</span> model:/model/ \</span><br><span class="line">   --<span class="built_in">env</span> MODEL=/model/chatglm2-ggml.q4_0.bin \</span><br><span class="line">   chatglm.cpp.singularity.sif \</span><br><span class="line">   uvicorn chatglm_cpp.openai_api:app --host 0.0.0.0 --port 8877</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sinularity </tag>
            
            <tag> container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deploying RStudio with Singularity and a Conda Environment</title>
      <link href="/en/2023/07/26/%E4%BD%BF%E7%94%A8singularity%E9%83%A8%E7%BD%B2Rstudio%E5%B9%B6%E6%8C%87%E5%AE%9Aconda%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84R/"/>
      <url>/en/2023/07/26/%E4%BD%BF%E7%94%A8singularity%E9%83%A8%E7%BD%B2Rstudio%E5%B9%B6%E6%8C%87%E5%AE%9Aconda%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84R/</url>
      
        <content type="html"><![CDATA[<p>Today, I needed to deploy an RStudio server for someone else. Here are the steps and key points of the deployment.</p><!-- Abstract part --><span id="more"></span><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Running RStudio requires root permissions and cannot be installed directly using conda or mamba like Jupyter. Therefore, this deployment used Singularity, which is a container technology I had never used before. While Sigularity differs from Docker or Podman in design, it is primarily designed for HPC environments with different permission management. However, these differences do not significantly affect its use in this case.</p><h2 id="1-Container-Preparation"><a href="#1-Container-Preparation" class="headerlink" title="1. Container Preparation"></a>1. Container Preparation</h2><p>Although Sigularity and Docker are different container technologies, Sigularity provides comprehensive compatibility support for Docker images. Built Docker containers can be easily converted to the <code>sif</code> format used by Singularity. For this deployment, I referenced the instructions from the <a href="https://github.com/grst/rstudio-server-conda/blob/master/README.md">rstudio-server-conda</a> project and pulled the Docker image using <code>singularity pull docker://rocker/rstudio:4.2</code>.</p><h2 id="2-Necessary-File-Preparation"><a href="#2-Necessary-File-Preparation" class="headerlink" title="2. Necessary File Preparation"></a>2. Necessary File Preparation</h2><p>I used the following bash script to generate several directories and configuration files.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p run var-lib-rstudio-server</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;provider=sqlite\ndirectory=/var/lib/rstudio-server\n&#x27;</span> &gt; database.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;auth-minimum-user-id=100&quot;</span> &gt; rserver.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;session-default-working-dir=/home/silen/Rstudio/Workspace&quot;</span> &gt; rsession.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;session-default-new-project-dir=/home/silen/Rstudio/Workspace&quot;</span> &gt;&gt; rsession.conf</span><br></pre></td></tr></table></figure><p>This script generates <code>run</code> and <code>var-lib-rstudio-server</code> directories, as well as <code>database.conf</code>, <code>rserver.conf</code>, and <code>rsession.conf</code> configuration files. The <code>auth-minimum-user-id=100</code> setting in <code>rserver.conf</code> is crucial because the RStudio service runs under the rstudio user with UID 999 in the container. If this user does not exist or if the permissions are not switched to this user, the container will fail to run. I referenced a post on GitHub (<a href="https://github.com/grst/rstudio-server-conda/pull/18">#18</a>) and used the <code>--server-user</code> parameter to specify that the service should be run using the current user.</p><p>However, by coincidence, my current user’s UID is less than 513, while the default <code>auth-minimum-user-id</code> value is 1000, which prevents users with UIDs less than 1000 from running the service (apparently for security reasons). Therefore, I needed to change the parameter value in <code>rserver.conf</code> to allow the service to start normally.</p><h2 id="3-Starting-the-Container-with-Specified-Parameters"><a href="#3-Starting-the-Container-with-Specified-Parameters" class="headerlink" title="3. Starting the Container with Specified Parameters"></a>3. Starting the Container with Specified Parameters</h2><p>I used the following command to start the service. The main commands bind the previously created directories and configuration files to the container so that the service can read them. Additionally, I specified the IP address and port for easy access. Since this is a shared use scenario, I did not set up authentication. I also referenced the <a href="https://github.com/grst/rstudio-server-conda/blob/master/README.md">rstudio-server-conda</a> project to specify the conda environment used by RStudio, so there’s no need to reinstall R packages within the container.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">singularity <span class="built_in">exec</span> \</span><br><span class="line">   --<span class="built_in">bind</span> run:/run \</span><br><span class="line">   --<span class="built_in">bind</span> var-lib-rstudio-server:/var/lib/rstudio-server \</span><br><span class="line">   --<span class="built_in">bind</span> database.conf:/etc/rstudio/database.conf \</span><br><span class="line">   --<span class="built_in">bind</span> rserver.conf:/etc/rstudio/rserver.conf \</span><br><span class="line">   --<span class="built_in">bind</span> rsession.conf:/etc/rstudio/rsession.conf \</span><br><span class="line">   --<span class="built_in">bind</span> /home/silen/R-Plot:/etc/R-Plot \</span><br><span class="line">   --<span class="built_in">env</span> CONDA_PREFIX=/etc/R-Plot  \</span><br><span class="line">        --<span class="built_in">env</span> RSTUDIO_WHICH_R=/etc/R-Plot/bin/R \</span><br><span class="line">   rstudio_4.2.sif \</span><br><span class="line">   /usr/lib/rstudio-server/bin/rserver --www-address=0.0.0.0 --www-port=7788 --server-user=$(<span class="built_in">whoami</span>)</span><br></pre></td></tr></table></figure><p>After starting, the interface looks like this:</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2023/07/upgit_20230727_1690390228.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2023/07/upgit_20230727_1690390228.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ui"></p><h2 id="4-Notes"><a href="#4-Notes" class="headerlink" title="4. Notes"></a>4. Notes</h2><p>Sigularity feels more similar to snap and flathub software packaging projects, where the host and container are not completely isolated from each other. After starting RStudio, it can directly access the user’s Home directory on the host machine. I’m not sure if this is a special behavior of this container or if Sigularity behaves similarly in general. We will need to do more dependency analysis and containerization for our internal analysis processes… It seems we still need to learn more about the principles and usage of Singularity.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
            <tag> rstudio </tag>
            
            <tag> singularity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Codespace for Free to Write Hexo Blogs</title>
      <link href="/en/2023/07/23/%E7%99%BD%E5%AB%96codespace%E7%94%A8%E6%9D%A5%E5%86%99hexo%E5%8D%9A%E5%AE%A2/"/>
      <url>/en/2023/07/23/%E7%99%BD%E5%AB%96codespace%E7%94%A8%E6%9D%A5%E5%86%99hexo%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<p>Recently, out of… well, let’s say a bit of dissatisfaction, I sold my previously purchased Lenovo Chrome Duet2, but then I bought a Pixelbook 2017… Now that I have this device, I still want to tinker with it for a while, trying to find a way to use this Pixelbook 2017 as a replacement for my work computer for general office tasks. In the process of practising, the main issue wasn’t resolved, but I did come up with a few practical by-products… writing Hexo blogs using Codespace is one of them.</p><span id="more"></span><h2 id="Now-I-Can-Write-Blogs-Anywhere"><a href="#Now-I-Can-Write-Blogs-Anywhere" class="headerlink" title="Now I Can Write Blogs Anywhere"></a>Now I Can Write Blogs Anywhere</h2><p>GitHub Codespace is a cloud-based development service launched by GitHub in the era of cloud computing. This service can allocate a container (which can be customized) for users, then directly pull the project code from GitHub into the container, and assign users a VSCode web client that can access the container’s content. This allows users to directly write and debug code on servers provided by GitHub, essentially developing entirely in the cloud. I guess the implementation of the project is similar to <a href="https://github.com/googlecreativelab/coder">coder</a>.</p><p>Such a great tool, of course, is not free. Currently, GitHub offers 15GB of free storage and 120 hours of core time (<a href="https://docs.github.com/zh/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces">see official details</a>). This storage and time may not seem like much, but based on current usage, core time seems not to be counted unless it’s being used, so for very lightweight projects, it’s actually quite sufficient.</p><p>This is just perfect for writing blogs!</p><p>The code for my Hexo blog is not even as much as the themes I’ve used, and the compile step required is just to generate static web pages, which takes only a few seconds. Operating in the cloud can also solve the previous issue of being able to write blogs only on my office computer (I only set up the environment on my office computer and didn’t want to do it again), it’s ready to use upon opening. And I’ve tried, the static web page preview generated by <code>hexo s</code> can even be accessed normally! This way, it’s like those blog platforms where you can write with just a browser. (Although stop blogging did not due to device issue)</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/2023/07/upgit_20230723_1690102891.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/2023/07/upgit_20230723_1690102891.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ui"></p><h2 id="Issues-with-Usage"><a href="#Issues-with-Usage" class="headerlink" title="Issues with Usage"></a>Issues with Usage</h2><p>Currently, the only two issues are network and image management within the blog.</p><h3 id="1-Image-Issues"><a href="#1-Image-Issues" class="headerlink" title="1. Image Issues"></a>1. Image Issues</h3><p>I used to write blogs using <a href="https://picgo.github.io/PicGo-Doc/zh/guide/">picgo</a> and <a href="https://github.com/pluveto/upgit">upgit</a> for image uploading and automatic link acquisition. After testing, the most convenient VSCode-picgo plugin cannot be used, even after installing <code>xclip</code>, it can’t recognize the image content in the clipboard, probably because it’s in a cloud container, while the clipboard with the image is local to me… <code>upgit</code> can be used, by downloading the software into the Linux container of ChromeOS, and configuring it properly.</p><h3 id="2-Network"><a href="#2-Network" class="headerlink" title="2. Network"></a>2. Network</h3><p>This issue needs no elaboration… The same problem arises when trying to access services outside the mainland. Currently, the editor part is actually fine, because it’s not a real-time response, so typing is quite smooth… It’s just that I don’t know if I’ll find out I can’t save while writing.</p><p>However, the command line part does feel noticeably laggy, but there are not many command lines, just <code>hexo g</code> and <code>hexo d</code>, so I can bear with it, and if I can’t publish now, I can do it another day.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> codespace </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>In the Guidance of chatGPT, Write a Tool to Parse Literature Using chatGPT&#39;s API</title>
      <link href="/en/2023/03/27/%E5%9C%A8chatGPT%E7%9A%84%E6%8C%87%E5%AF%BC%E4%B8%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%B0%83%E7%94%A8chatGPT%E7%9A%84API%E8%BF%9B%E8%A1%8C%E6%96%87%E7%8C%AE%E8%A7%A3%E6%9E%90%E7%9A%84%E5%B7%A5%E5%85%B7/"/>
      <url>/en/2023/03/27/%E5%9C%A8chatGPT%E7%9A%84%E6%8C%87%E5%AF%BC%E4%B8%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%B0%83%E7%94%A8chatGPT%E7%9A%84API%E8%BF%9B%E8%A1%8C%E6%96%87%E7%8C%AE%E8%A7%A3%E6%9E%90%E7%9A%84%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>This title is a bit too nested… but the fact is, I suddenly felt capable! I finally have a chance to become a full-stack developer! To showcase my capabilities enhanced by chatGPT, I decided to develop a tool that uses chatGPT to read papers (I’ve also considered using it for meta-analysis).</p><!-- Abstract part --><span id="more"></span><h2 id="Start-Digging"><a href="#Start-Digging" class="headerlink" title="Start Digging"></a>Start Digging</h2><p>About two weeks ago, I had the idea of doing this. Previously, I registered an account and tried using it to assist in writing a static service with token verification. Later, I saw my colleague share <a href="https://www.chatpdf.com/">chatPDF</a> and mentioned that he uses chatGPT to quickly read papers and write reviews. At that time, I recalled the pain of reading papers here over three years and thought about developing a tool to accelerate my reading using chatGPT to assist in my work, which could also serve as a demo for popularity and potentially gain several hundred stars, bringing me closer to becoming an independent full-stack developer who has always wanted. Plus, before, I couldn’t do it because learning everything from scratch was too time-consuming and lacked the ability. With chatGPT’s assistance, it should be much easier.</p><h2 id="Various-Pitfalls"><a href="#Various-Pitfalls" class="headerlink" title="Various Pitfalls"></a>Various Pitfalls</h2><p>Then, let’s get down to business! (Three-minute热度 is most擅长 this), I thought that with such an external aid, developing a simple demo wouldn’t take more than three days? So, over the past two weeks, I’ve been going through various pitfalls…</p><h3 id="Paying-Money-Is-So-Difficult…"><a href="#Paying-Money-Is-So-Difficult…" class="headerlink" title="Paying Money Is So Difficult…"></a>Paying Money Is So Difficult…</h3><p>I didn’t expect the first pit to be paying money… After registering for a new OpenAI account, I received 30 dollars of free API credits for trial use. However, it seems that too many users have registered, and they are reducing or even stopping the free credits… When I registered, my account had no credits at all, so I couldn’t use the core API functionalities. I had to pay out of pocket… But it’s not as simple as that; OpenAI does not provide services for mainland China developers… Therefore, my Visa card couldn’t be registered… I had to apply for a virtual credit card… Then this virtual credit card… I’m not sure if it’s a legitimate virtual currency… The largest Depay requires using a certain type of virtual currency to recharge??? Virtual currencies make me feel scared; I dare not mess with them. In the end, I found a large amount that I could pay directly (I might buy塞尔达 later), and finally solved the problem (it seems it was still resolved by paying money). After topping up, I started developing!</p><p>emmmmmm… Then after half a day…</p><h3 id="Limitations-of-chatGPT"><a href="#Limitations-of-chatGPT" class="headerlink" title="Limitations of chatGPT"></a>Limitations of chatGPT</h3><p>chatGPT can execute various tasks, but this doesn’t change the fact that it is a text generation AI. Its fundamental function is to generate fluent and error-free natural language text. Initially, when using it, I didn’t encounter many problems (perhaps because the questions were simple), but as usage frequency increased, the frequency and severity of encountering issues also rose significantly. In general, I feel that due to asking overly broad questions or asking questions that may not have answers, I receive various irrelevant answers from chatGPT. This leads to two issues:</p><ol><li><p>During actual development, it wasn’t as fast as expected because I adopted a very new development framework (<code>Pynecone</code>). Its introduction is beautiful; once developed, frontend&#x2F;backend&#x2F;API are all included, and multi-platform quick deployment is possible. However, due to its immaturity, chatGPT couldn’t give me any suggestions. I had to learn the documentation and official examples to complete necessary functional implementations. Moreover, it took a lot of time on some very basic functionalities…</p></li><li><p>Making chatGPT execute specific tasks smoothly isn’t easy… And I’m using <code>gpt-3.5-turbo</code> (which didn’t have version 4 at the start; now I can’t queue up), so it’s not as easy to specify the return answer format with gpt4 (I want to use JSON format for easier parsing). Therefore, “programming towards prompts” is no joke… To use it well, debugging prompts is still very necessary.</p></li></ol><p>In summary, chatGPT is strong, but… even gpt4, I believe, isn’t as powerful as the Microsoft promotional video suggests… To use it smoothly, you need to have some usage skills and become shaped like chatGPT (misunderstanding).</p><h3 id="Switching-Development-Frameworks"><a href="#Switching-Development-Frameworks" class="headerlink" title="Switching Development Frameworks"></a>Switching Development Frameworks</h3><p>Continuing from the previous text… <code>Pynecone</code> really isn’t mature enough… After a week and a half, I couldn’t take it anymore and switched to <code>Gradio</code>… How to say it? The tool and framework’s Matthew effect shouldn’t be violated casually… Especially since my intention was to gain popularity, finding the fastest implementation method is more important than overthinking.</p><h3 id="SinGAN-you-sin"><a href="#SinGAN-you-sin" class="headerlink" title="SinGAN you sin!"></a>SinGAN you sin!</h3><p>Although just a joke, I really didn’t expect… I got stuck for an entire afternoon and one night while deploying the demo on HuggingFace. HuggingFace is a great platform (a space provides 8 cores and 16GB, what a charitable oil tycoon), but not allowing a new project to be completely empty really made it difficult for me as a beginner…</p><p>I experienced manual conflict resolution, forced code pushes, and ultimately compromised by separating the original project’s code from HuggingFace. I really couldn’t get any effective help on this issue from chatGPT.</p><h3 id="Not-Enough-Time"><a href="#Not-Enough-Time" class="headerlink" title="Not Enough Time"></a>Not Enough Time</h3><p>Worse still, there was rain on my parade… (The road to becoming a national treasure is irreversible)</p><h2 id="Help-Provided-by-chatGPT"><a href="#Help-Provided-by-chatGPT" class="headerlink" title="Help Provided by chatGPT"></a>Help Provided by chatGPT</h2><p>Although I’ve complained that chatGPT isn’t as good as it seems, the benefits it brings are real. In this project, the help provided by chatGPT includes but is not limited to:</p><ol><li>Helping me understand similar open-source code quickly, allowing me to quickly grasp other implementation methods.</li><li>Answering various usage questions for Gradio (a mature tool can provide many practical suggestions).</li><li>Assisting in generating English README (although no one reads it).</li><li>Increasing my confidence that “I can do it!”</li></ol><h2 id="Feeling-the-Pain-of-Independent-Development"><a href="#Feeling-the-Pain-of-Independent-Development" class="headerlink" title="Feeling the Pain of Independent Development"></a>Feeling the Pain of Independent Development</h2><p>These two weeks also deeply made me feel the pain of independent developers or personal自媒体. Similarly, as a literature reading assistant, the <a href="https://github.com/kaixindelele/ChatPaper">chatPaper</a> project and my content both started disclosing code on GitHub two weeks ago (my case was uploading code incrementally…), but now it has over 4000 stars… I…</p><p>This feeling is probably similar to the anxiety of starting a自媒体, only to find that no one watches your videos.</p><h2 id="Project-Address"><a href="#Project-Address" class="headerlink" title="Project Address"></a>Project Address</h2><p>However, regardless of this, the purpose of my project is to develop something useful that I personally feel good about. If popularity can’t be gained… then it’s fine… My project is called <a href="https://github.com/SilenWang/ReviewGPT">ResearchGPT</a>, and the demo is hosted on Huggingface at <a href="https://huggingface.co/spaces/SilenWang/ReviewGPT">Demo</a>. Those interested can try it out~ Of course, this blog post also embedded the demo.</p><div style="display:flex;justify-content:center;align-items:center;overflow:scroll">   <iframe          src="https://silenwang-reviewgpt.hf.space"          frameborder="0"          width="850"          height="700"   ></iframe></div>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> chatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chatGPT is indeed useful</title>
      <link href="/en/2023/02/23/chatGPT%E7%A1%AE%E5%AE%9E%E5%A5%BD%E7%94%A8/"/>
      <url>/en/2023/02/23/chatGPT%E7%A1%AE%E5%AE%9E%E5%A5%BD%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>chatGPT has been popular for so long, but I only created an account yesterday when I wanted to use it to generate some content. As many people online have said, while it may be unreliable on professional questions, for writing code - since I ultimately need to run and test it myself - practice yields true knowledge. Having a roughly correct direction is already helpful!</p><!-- Excerpt --><span id="more"></span><p>The background of this problem is:</p><ul><li>I used <code>mkdocs</code> to generate a technical documentation for company use (similar to my manual), which is a static webpage that can be viewed directly by adding an HTTP server</li><li>I want to embed this documentation into an existing system using <code>iframe</code></li><li>Since this documentation is important, it has certain confidentiality requirements, so it cannot be accessed directly and needs some verification</li></ul><p>After discussing with IT colleagues, the final solution was that they would give me a token on the first request, I would use this token to verify against their API, and return the content only if the verification passes. I only know basic flask and fastAPI, and flask is simpler to use, so in summary, I need to write a program that:</p><ul><li>Uses flask to build an HTTP server with the same functionality as Python’s simple http.server, allowing users to access the static website created by mkdocs</li><li>This server needs verification functionality - receiving a token from the request to verify whether the user is legitimate</li><li>After the first verification, requests for internal jumps within the static website are handled by this service itself, so to maintain continuous verification, I need to save the token myself and complete the verification</li></ul><p>Although I’ve used flask and dash before, I actually don’t have much concept of web-related technologies. Previous experience testing caddy reverse proxy made me think this program was certainly implementable, but I wasn’t sure exactly how. The colleague’s mention of saving tokens myself made sense conceptually but I didn’t know how to implement it.</p><p>This is where chatGPT came into play. I described my requirements roughly and asked how to write the code I wanted. It didn’t give me a perfect solution matching all my requirements, but provided a code example that let me test and figure out how the program should be written. For parts I didn’t understand, I could ask follow-up questions or request specific explanations. While its answers weren’t completely correct (and sometimes due to my unclear questions), through discussion I gradually found the implementation I wanted.</p><p>In the end, I completed this simple program in one morning. While the program is simple, in the past I would have needed to:</p><ol><li>Find several Chinese web pages to see if there were ready examples</li><li>Guess the English description methods</li><li>Browse about 10 English posts on stackoverflow</li><li>Look for answers to specific parts of my problem</li><li>Try to assemble a workable solution…</li></ol><p>This process wouldn’t be painful - it’s a learning process after all - but certainly not efficient…</p><p>Now, as long as I can basically describe what I want, chatGPT can directly give me a code example to debug and learn from, saving most of the time searching Chinese and English materials and jumping straight to debugging with examples. The efficiency improvement is transformative…</p><p>Suddenly I feel that with its help, learning some frontend tricks… writing my own websites and apps is no longer a dream…</p><h4 id="update20220227"><a href="#update20220227" class="headerlink" title="update20220227"></a>update20220227</h4><p>Today chatGPT has too many requests and is temporarily unavailable (not sure about paid users). Seems like early adoption brings benefits… play with it while you can before free access disappears…</p><div class="note "><p><strong>Appendix: Complete conversation process about this issue</strong></p><h4 id="You"><a href="#You" class="headerlink" title="You:"></a>You:</h4><p>How to use flask to build an HTTP server that uses tokens for verification?</p><h4 id="ChatGPT"><a href="#ChatGPT" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>To use Flask to build an HTTP server that uses tokens for verification, you can use Flask’s <code>Flask-JWT</code> extension. This extension provides JSON Web Token (JWT) authentication mechanism for Flask applications.</p><p>First install required extensions:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install Flask-JWT</span><br></pre></td></tr></table></figure><p>Then write Flask application code as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, request</span><br><span class="line"><span class="keyword">from</span> flask_jwt <span class="keyword">import</span> JWT, jwt_required, current_identity</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> safe_str_cmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">id</span>, username, password</span>):</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">users = [</span><br><span class="line">    User(<span class="number">1</span>, <span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;password1&#x27;</span>),</span><br><span class="line">    User(<span class="number">2</span>, <span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;password2&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authenticate</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span> user.username == username <span class="keyword">and</span> safe_str_cmp(user.password.encode(<span class="string">&#x27;utf-8&#x27;</span>), password.encode(<span class="string">&#x27;utf-8&#x27;</span>)):</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">identity</span>(<span class="params">payload</span>):</span><br><span class="line">    user_id = payload[<span class="string">&#x27;identity&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> users <span class="keyword">if</span> user.<span class="built_in">id</span> == user_id), <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;super-secret&#x27;</span></span><br><span class="line">jwt = JWT(app, authenticate, identity)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/protected&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@jwt_required()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">protected</span>():</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;user_id&#x27;</span>: current_identity.<span class="built_in">id</span>, <span class="string">&#x27;username&#x27;</span>: current_identity.username&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-1"><a href="#You-1" class="headerlink" title="You:"></a>You:</h4><p>This flask server will receive a token when processing requests. I need to use this token to verify against another server, and only return static content after verification passes. How to implement this?</p><h4 id="ChatGPT-1"><a href="#ChatGPT-1" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>To use the received token to verify against another server in Flask, you can use Python’s <code>requests</code> library to conveniently send HTTP requests to other servers and get responses.</p><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token</span>):</span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://example.com/verify-token&#x27;</span>, headers=&#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Bearer &#x27;</span> + token&#125;)</span><br><span class="line">    <span class="keyword">return</span> response.status_code == <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    token = request.headers.get(<span class="string">&#x27;Authorization&#x27;</span>).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, world!&#x27;</span> <span class="keyword">if</span> verify_token(token) <span class="keyword">else</span> <span class="string">&#x27;Invalid token&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-2"><a href="#You-2" class="headerlink" title="You:"></a>You:</h4><p>If I want to return not a simple website but pre-generated static pages like those from mkdocs or gitbook, how to implement?</p><h4 id="ChatGPT-2"><a href="#ChatGPT-2" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>To return pre-generated static pages, use Flask’s <code>send_from_directory</code> method to serve files from a specific directory.</p><p>Example assuming static files are in <code>static/docs</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_from_directory</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/docs/&lt;path:filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_docs</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static/docs&#x27;</span>, filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-3"><a href="#You-3" class="headerlink" title="You:"></a>You:</h4><p>How does flask get parameters from GET requests?</p><h4 id="ChatGPT-3"><a href="#ChatGPT-3" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>In Flask, use <code>request.args</code> to access GET parameters. It’s a dict containing all parameters and their values.</p><p>Example for URL <code>http://localhost:5000/search?q=python&amp;page=1</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/search&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>():</span><br><span class="line">    query = request.args.get(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">    page = request.args.get(<span class="string">&#x27;page&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;Searching for &quot;<span class="subst">&#123;query&#125;</span>&quot; on page <span class="subst">&#123;page&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-4"><a href="#You-4" class="headerlink" title="You:"></a>You:</h4><p>The above code can only access first-level files under static&#x2F;docs&#x2F;. How to access files in subdirectories?</p><h4 id="ChatGPT-4"><a href="#ChatGPT-4" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>To access files in subdirectories, use <code>os.path.join</code> to combine paths:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_from_directory</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;path:filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_docs</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">if</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        filename = <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    path = os.path.join(<span class="string">&#x27;static&#x27;</span>, filename)</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(path, filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-5"><a href="#You-5" class="headerlink" title="You:"></a>You:</h4><p>In flask, how to redirect ‘&#x2F;‘ to ‘&#x2F;index.html’?</p><h4 id="ChatGPT-5"><a href="#ChatGPT-5" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>Use Flask’s <code>redirect</code> function:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirect_to_index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h4 id="You-6"><a href="#You-6" class="headerlink" title="You:"></a>You:</h4><p>How to generate a recommended secret key for flask?</p><h4 id="ChatGPT-6"><a href="#ChatGPT-6" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>Use Python’s <code>secrets</code> module to generate secure random keys:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = secrets.token_hex(<span class="number">16</span>)  <span class="comment"># 16-byte random string</span></span><br></pre></td></tr></table></figure><h4 id="You-7"><a href="#You-7" class="headerlink" title="You:"></a>You:</h4><p>How to implement token expiration in flask?</p><h4 id="ChatGPT-7"><a href="#ChatGPT-7" class="headerlink" title="ChatGPT:"></a>ChatGPT:</h4><p>For token expiration, consider using JWT (JSON Web Tokens) with the <code>cryptography</code> library:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JWT_SECRET_KEY&#x27;</span>] = <span class="string">&#x27;mysecretkey&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>] = datetime.timedelta(seconds=<span class="number">3600</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&#x27;sub&#x27;</span>: <span class="string">&#x27;1234567890&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;exp&#x27;</span>: datetime.datetime.utcnow() + app.config[<span class="string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    token = jwt.encode(payload, app.config[<span class="string">&#x27;JWT_SECRET_KEY&#x27;</span>], algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;access_token&#x27;</span>: token.decode(<span class="string">&#x27;UTF-8&#x27;</span>), <span class="string">&#x27;token_type&#x27;</span>: <span class="string">&#x27;Bearer&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/protected&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@jwt_required()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">protected</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;Protected resource&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> chatGPT </tag>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Update of DingTalk for Linux Is Mixed</title>
      <link href="/en/2023/02/03/%E9%92%89%E9%92%89Linux%E7%89%88%E6%9C%AC%E6%AC%A1%E7%9A%84%E6%9B%B4%E6%96%B0%E5%96%9C%E5%BF%A7%E5%8F%82%E5%8D%8A/"/>
      <url>/en/2023/02/03/%E9%92%89%E9%92%89Linux%E7%89%88%E6%9C%AC%E6%AC%A1%E7%9A%84%E6%9B%B4%E6%96%B0%E5%96%9C%E5%BF%A7%E5%8F%82%E5%8D%8A/</url>
      
        <content type="html"><![CDATA[<p>DingTalk for Linux, although not updated frequently, has been continuously solving problems. However, if it could solve problems without introducing new major issues, it would be better …</p><span id="more"></span><p>Currently, I have updated to the latest version <code>1.6.0.230113-2</code> from AUR. After the update, Chinese input works normally without any environment variable settings (both the program and mini-programs are fine), and there is no jaggedness in the interface when not at 50% integer scaling…</p><p>However, a more serious issue has been introduced… The meeting interface cannot be opened at all, whether initiating a new meeting or entering an existing one. Clicking does nothing, which severely impacts normal use. I hope it can be resolved soon…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> DingTalk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>New Year&#39;s Flag Fell Down</title>
      <link href="/en/2023/02/02/%E6%96%B0%E5%B9%B4%E7%9A%84Flag%E5%80%92%E4%BA%86/"/>
      <url>/en/2023/02/02/%E6%96%B0%E5%B9%B4%E7%9A%84Flag%E5%80%92%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>Last month, I was complaining that things were getting worse year by year, <a href="/en/2023/01/08/%E4%B8%80%E5%B9%B4%E6%AF%94%E4%B8%80%E5%B9%B4%E7%B3%9F%E7%B3%95/" title="null">and hoped this year would be better</a>, but my Flag fell down so quickly, Fxxk… It’s really annoying and never stops…</p><!-- Abstract part --><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sprucing Up My GitHub Profile</title>
      <link href="/en/2023/01/27/%E7%BB%99Github%E9%A6%96%E9%A1%B5%E5%81%9A%E7%82%B9%E9%9D%A2%E5%AD%90%E5%B7%A5%E4%BD%9C/"/>
      <url>/en/2023/01/27/%E7%BB%99Github%E9%A6%96%E9%A1%B5%E5%81%9A%E7%82%B9%E9%9D%A2%E5%AD%90%E5%B7%A5%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>After upgrading my blog, I decided to do some cosmetic work on my GitHub profile…</p><!-- Summary section --><span id="more"></span><p>Currently, you can create a special repository that matches your username, like <code>SilenWang/SilenWang</code>. The <code>README.md</code> in this repository will be displayed on the user’s GitHub homepage, essentially giving them a customizable dashboard.</p><p>I currently have my GitHub statistics and commonly used tool icons displayed there.</p><h2 id="GitHub-Statistics"><a href="#GitHub-Statistics" class="headerlink" title="GitHub Statistics"></a>GitHub Statistics</h2><p>This is quite simple; it uses an API:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;GitHub Stats&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://github-readme-stats.vercel.app/api?username=SilenWang&amp;count_private=true&amp;show_icons=true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Tool-Icons"><a href="#Tool-Icons" class="headerlink" title="Tool Icons"></a>Tool Icons</h2><p>I used <a href="https://shields.io/">Shields.io</a> for this. It allows you to request various labeled icons from the website’s API via a GET request. For example, the Jupyter label is:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;Jupyter&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/-Jupyter-f37524?style=flat-square&amp;logo=Jupyter&amp;logoColor=white&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>I dug out all the icons I could find for tools I use…</p><p>The available icons are quite rich, but not everything is available. You can see the existing ones in <a href="https://github.com/simple-icons/simple-icons/blob/develop/slugs.md">this file</a>.</p><h2 id="Rendering-Effect"><a href="#Rendering-Effect" class="headerlink" title="Rendering Effect"></a>Rendering Effect</h2><div class="img-wrap"><div class="img-bg"><img class="img lazyload" src="https://raw.githubusercontent.com/silenwang/Gallary/master/2023/01/upgit_github_front_20230127_1674830298.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2023/01/upgit_github_front_20230127_1674830298.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image"/></div></div><h2 id="Postscript"><a href="#Postscript" class="headerlink" title="Postscript"></a>Postscript</h2><p>After decorating it, I tried to use the same labels on my “About Me” page. However, Hexo seems to force line breaks when rendering HTML tags, causing all labels to be in a single column, which is <ruby>ugly<rp> (</rp><rt>unattractive</rt><rp>) </rp></ruby>… I spent half an hour trying to find a solution but couldn’t figure it out. So, I just used tables to box each label for now. I’ll look into how to fix this later.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blog Upgrade in 2023</title>
      <link href="/en/2023/01/26/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A22023%E5%B9%B4%E5%8D%87%E7%BA%A7/"/>
      <url>/en/2023/01/26/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A22023%E5%B9%B4%E5%8D%87%E7%BA%A7/</url>
      
        <content type="html"><![CDATA[<p>After… I can’t even remember how many years, my blog has been upgraded again. The theme is still <code>Volantis</code>, which is simple to use but comes with many powerful features!</p><h2 id="Update-Content"><a href="#Update-Content" class="headerlink" title="Update Content"></a>Update Content</h2><ol><li>Upgraded <code>Volantis</code> to the latest stable version <code>5.7.7</code>.</li><li>Updated the “About” page according to the theme upgrade method, and now it can properly display links for two <ruby>friends<rp> (</rp><rt>frenemies</rt><rp>) </rp></ruby>.</li><li>Enabled the comment plugin <code>utterances</code>, which allows users to leave messages after logging into their Github accounts!</li><li>Installed a plugin to enable internal article links.</li><li>Installed a plugin to change Bilibili video link format (from embedded player to card).</li><li>Installed a plugin to change Github Repo display format (card style).</li><li>Updated the “About Me” page, using various theme tags to slightly beautify it.</li><li>Added a pronunciation plugin similar to萌娘百科, just to have some fun and make myself happy~</li></ol><h2 id="New-Plugins-Used"><a href="#New-Plugins-Used" class="headerlink" title="New Plugins Used"></a>New Plugins Used</h2><h3 id="1-Utterances-Comments"><a href="#1-Utterances-Comments" class="headerlink" title="1. Utterances Comments"></a>1. Utterances Comments</h3><p>The <code>Volantis</code> theme provides 14 different comment systems. After configuring according to the <a href="https://volantis.js.org/v6/theme-settings/#%E9%80%89%E6%8B%A9%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F">documentation</a> in <code>_config.volantis.yml</code>, it can be used.</p><p>Originally, I planned to use the localized version of <code>utterances</code> called <code>beaudar</code>, but encountered problems that I couldn’t understand. So, I gave up.</p><p>When configuring for the first time, Github will prompt you to install the <code>utterances</code> Github App to use it. I don’t know if I need to install it once as the owner or if each commenter needs to install it…</p><h3 id="2-Bilibili-Video-Card"><a href="#2-Bilibili-Video-Card" class="headerlink" title="2. Bilibili Video Card"></a>2. Bilibili Video Card</h3><p>I have previously inserted some of my own videos into the blog, but the playback window is very restricted. Clicking a few times will still redirect to Bilibili. It’s better to use links instead. Using <code>hexo-bilibili-card</code> makes the links look nicer and is easier to insert:</p><ul><li>Before:</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;//player.bilibili.com/player.html?aid=91147423&amp;cid=155618081&amp;page=1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;700&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;no&quot;</span> <span class="attr">framespacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">allowfullscreen</span>=<span class="string">&quot;true&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Now:</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bilicard av91147423 %&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Github-Repo-Card"><a href="#3-Github-Repo-Card" class="headerlink" title="3. Github Repo Card"></a>3. Github Repo Card</h3><p>On the “About Me” page… I have very simply displayed a few of my not-so-impressive repos…. So, using the theme’s built-in tags to achieve it:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcard &#x27;SilenWang/silenwang.github.io&#x27; %&#125;</span><br></pre></td></tr></table></figure><details yellow><summary> Additional Plugin Installation </summary>              <div class='content'>              <p>On the “About Me” page… I have very simply displayed a few of my not-so-impressive repos…. So, I found a plugin to make them look slightly better… The plugin name is <code>hexo-github-repo-tag</code>, and the usage method is:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% githubrepo &#x27;SilenWang/silenwang.github.io&#x27; %&#125;</span><br></pre></td></tr></table></figure><p>When deploying, there was a small problem… This plugin uses the API to grab necessary information from the project page to generate corresponding cards. Therefore, when running <code>hexo g</code>, it needs to access Github… If the network is not good at that time, you can only try again multiple times…</p>              </div>            </details>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Games I&#39;ve Played in the Last Three Years</title>
      <link href="/en/2023/01/24/%E6%88%91%E8%BF%993%E5%B9%B4%E7%8E%A9%E8%BF%87%E7%9A%84%E6%B8%B8%E6%88%8F/"/>
      <url>/en/2023/01/24/%E6%88%91%E8%BF%993%E5%B9%B4%E7%8E%A9%E8%BF%87%E7%9A%84%E6%B8%B8%E6%88%8F/</url>
      
        <content type="html"><![CDATA[<p>In 2019, to play Monster Hunter XX, I bought a 3DS. From then on, I started buying various devices to play specific games… I formed a PC group for Dragon’s Dogma, bought a PSV for Persona 4 Golden, and got an NSL for Re:Zero. The most expensive one was the Quest2 for Rhythm Heaven. At the end of 19, I planned to record what games I played each year… But fate is not on my side… The pandemic came, and my work suddenly became much more demanding… Playing games had to rely on late-night spending, so I didn’t have the energy to do much reflection, only expressing a little bit of feeling about some games.</p><!-- Abstract part --><span id="more"></span><p>So, three years passed… Since getting an NSL, I basically stopped playing 3DS, PSV, and PC. For some reason, from being a PC+mobile player, I became a console player… Over the past three years, the games I’ve played are roughly:</p><table><thead><tr><th>Game</th><th>Platform</th><th>Time</th><th>Completion</th></tr></thead><tbody><tr><td>Monster Hunter World: Iceborne</td><td>PC</td><td>2020</td><td>Only released</td></tr><tr><td>Persona 4 Golden</td><td>PSV</td><td>2020</td><td>Yes</td></tr><tr><td>Odin Field</td><td>PSV</td><td>2020</td><td>Yes</td></tr><tr><td>Luminous Village</td><td>PSV</td><td>2020</td><td>Yes</td></tr><tr><td>Dragon’s Crown</td><td>PSV</td><td>2020</td><td>No</td></tr><tr><td>Ys IV: Blazing Tower of Seres</td><td>PSV</td><td>2020</td><td>Yes</td></tr><tr><td>Ys VIII: Dandelion Day</td><td>PSV</td><td>2020</td><td>No</td></tr><tr><td>Courage of Heart</td><td>3DS</td><td>2020</td><td>No</td></tr><tr><td>Rhythm Heaven</td><td>3DS</td><td>2020</td><td>No</td></tr><tr><td>Metroid: Return of the Classic</td><td>3DS</td><td>2020</td><td>Yes</td></tr><tr><td>Limit Break 2: The End of Humanity</td><td>3DS</td><td>2020</td><td>Yes</td></tr><tr><td>Cooking Mama 2</td><td>PC</td><td>2021</td><td>No</td></tr><tr><td>Invisible Guardian</td><td>PC</td><td>2021</td><td>Yes</td></tr><tr><td>Double Dragon</td><td>PC</td><td>2021</td><td>Yes</td></tr><tr><td>Catsuit</td><td>PC</td><td>2021</td><td>Yes</td></tr><tr><td>Limit Break 3: Zero Hour</td><td>3DS</td><td>2021</td><td>Yes</td></tr><tr><td>Re:Zero - Starting Life in Another World 2</td><td>3DS</td><td>2021</td><td>Yes</td></tr><tr><td>The Last of Us Part II</td><td>3DS</td><td>2021</td><td>Yes</td></tr><tr><td>Monster Hunter Rise</td><td>NS</td><td>2021</td><td>Yes</td></tr><tr><td>Xenoblade Chronicles</td><td>NS</td><td>2021</td><td>Yes</td></tr><tr><td>Infinite Space</td><td>NS</td><td>2021</td><td>Yes</td></tr><tr><td>Bloodborne: Night of the Sacrifice</td><td>NS</td><td>2021</td><td>Yes</td></tr><tr><td>AI: Dreamscape</td><td>NS</td><td>2021</td><td>Yes</td></tr><tr><td>The Legend of Zelda: Breath of the Wild</td><td>NS</td><td>2021</td><td>No</td></tr><tr><td>Diablo III</td><td>NS</td><td>2021</td><td>No</td></tr><tr><td>Rhythm Heaven</td><td>Quest2</td><td>2021</td><td>No</td></tr><tr><td>Xuan Zhi Ji Xia Zhuan</td><td>PC</td><td>2022</td><td>No</td></tr><tr><td>Monster Hunter Rise:曙光</td><td>NS</td><td>2022</td><td>Only released</td></tr><tr><td>Metroid: Survival Fear</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>Hades</td><td>NS</td><td>2022</td><td>No</td></tr><tr><td>Splatoon 3</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>Mario Kart 8</td><td>NS</td><td>2022</td><td>None</td></tr><tr><td>Thirteen Machines Defense Circle</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>Kunlun: The Rise of the Emperor</td><td>NS</td><td>2022</td><td>No</td></tr><tr><td>Rainbow Islands 2</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>NieR: Automata</td><td>NS</td><td>2022</td><td>No</td></tr><tr><td>Xenoblade Chronicles 2</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>Xenoblade Chronicles 3</td><td>NS</td><td>2022</td><td>Yes</td></tr><tr><td>Magical Night</td><td>NS</td><td>2022</td><td>No</td></tr><tr><td>Persona 5 Royal</td><td>NS</td><td>2022</td><td>No</td></tr></tbody></table><p>Hmm… It seems that no matter how busy my work is, I don’t seem to play games for too little time (after all, I have to spend late nights playing…</p><p>Among these games, the ones with the most feelings are [Re:Zero - Starting Life in Another World 2](Re:Zero - Starting Life in Another World 2), [Persona](Persona 4 Golden and Persona 5 Royal), and <a href="#">INVALID POST SLUG PROVIDED Metroid</a>. I’ll wait for NieR, Xuan Zhi Ji Xia Zhuan, Xenoblade Chronicles, Xenoblade Chronicles 3, Magical Night, and Persona 5 Royal to be completed or reach a certain level before filling in the blanks.</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Playing games </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Persona 4 and 5</title>
      <link href="/en/2023/01/22/%E5%A5%B3%E7%A5%9E%E5%BC%82%E9%97%BB%E5%BD%954%E5%92%8C5/"/>
      <url>/en/2023/01/22/%E5%A5%B3%E7%A5%9E%E5%BC%82%E9%97%BB%E5%BD%954%E5%92%8C5/</url>
      
        <content type="html"><![CDATA[<p>Persona is probably the second game series that made me buy a gaming console, initially being brainwashed by the “P5 is the best” meme for a year. Later, I watched Lex’s P4 recommendation video and couldn’t resist buying a PS Vita. If not for P4G later landing on PC, leaving a legacy for Persona across platforms (it did land on PC last year), I might have bought a second-hand PS4 for P5 at some point in the future…</p><!-- Summary --><span id="more"></span><p>Last year when I got P5, I also wanted to finish it within the same year, spending my life savings. However… the content is really extensive… By the end of the third semester, I had already spent nearly 80 hours and still haven’t finished it (not because I went off to play Splatoon 3!…)</p><p>Although I didn’t finish it, I can feel that most people have the same feeling: P5 excels in terms of system design, while P4 resonates more with my heart. It’s not that I don’t like the additional storylines in the Royal Edition compared to the Golden Edition; rather, I find the themes or intentions of P5 less appealing.</p><p>Perhaps because I’m already a jaded adult… I can’t fully immerse myself in the protagonists’ perspectives. The protagonists’ abilities awaken from their will to resist oppression, definition, and constraints by society, yearning to express their true selves. However, one of the bigger issues is that the antagonists in P5 are written as extremely stereotypical and polarized figures. A group of corrupt adults resort to any means necessary for their desires, solving problems in a very cool but unrealistic way: directly distorting the minds and thoughts of others. This method, when thought about, isn’t much different from traditional RPGs where power is used to persuade, essentially similar to using violence to achieve justice. Therefore, I think that when Akechi initially expressed his opinion on TV wasn’t wrong (although this character has many problems), the Phantom Thieves can indeed be very dangerous. I feel that this ability is essentially similar to how Death Note was obtained by Ryuk, and if the holder isn’t sufficiently enlightened, they will inevitably be used for evil purposes. Of course, some of these issues are also mentioned in the plot (e.g., Mishima, and Ryuji).</p><p>P4 handles these aspects much better because its theme is acceptance and growth. The protagonists’ abilities awaken from accepting their true selves, while enemies come from characters denying or rejecting themselves (although there are people’s biases). Every time a Shadow is defeated, it deepens the protagonist’s understanding of themselves, as well as the bonds between companions, naturally strengthening their relationships rather than achieving justice through power, as in P5. The protagonists don’t actually grow (growth comes solely from cooperative play).</p><p>However, this is unavoidable. A good story has already been used by P4… It can’t be done again; we can only hope that future works will balance both aspects better.</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Idle Gaming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Registering New Python or R Kernels in Jupyter</title>
      <link href="/en/2023/01/17/%E5%9C%A8Jupyter%E4%B8%AD%E6%B3%A8%E5%86%8C%E6%96%B0%E7%9A%84Python%E6%88%96R%E5%86%85%E6%A0%B8/"/>
      <url>/en/2023/01/17/%E5%9C%A8Jupyter%E4%B8%AD%E6%B3%A8%E5%86%8C%E6%96%B0%E7%9A%84Python%E6%88%96R%E5%86%85%E6%A0%B8/</url>
      
        <content type="html"><![CDATA[<p>When testing, it’s often necessary to create a new conda environment and then install the jupyter kernel within that environment for use with notebooks. Re-registering new kernels each time can be cumbersome, so here is a record of the process…</p><!-- Abstract section --><span id="more"></span><h2 id="Preparing-and-Registering-Python-Kernel"><a href="#Preparing-and-Registering-Python-Kernel" class="headerlink" title="Preparing and Registering Python Kernel"></a>Preparing and Registering Python Kernel</h2><ul><li>Activate the environment you want to register the kernel in.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate YOUR_ENV</span><br><span class="line">conda install jupyter ipykernel</span><br><span class="line">python -m ipykernel install --user --name ENV_NAME</span><br></pre></td></tr></table></figure><h2 id="Preparing-and-Registering-R-Kernel"><a href="#Preparing-and-Registering-R-Kernel" class="headerlink" title="Preparing and Registering R Kernel"></a>Preparing and Registering R Kernel</h2><ul><li>Activate the environment you want to register the kernel in.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda activate YOUR_ENV</span><br><span class="line">conda install jupyter r-irkernel</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IRkernel<span class="operator">::</span>installspec<span class="punctuation">(</span>name <span class="operator">=</span> <span class="string">&#x27;REG_NAME&#x27;</span><span class="punctuation">,</span> displayname <span class="operator">=</span> <span class="string">&#x27;ENV_NAME&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jupyter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Long Live! Tencent Officially Released New Linux QQ?</title>
      <link href="/en/2023/01/15/%E8%85%BE%E8%AE%AF%E5%AE%98%E6%96%B9%E5%81%9A%E6%96%B0LinuxQQ%E4%BA%86/"/>
      <url>/en/2023/01/15/%E8%85%BE%E8%AE%AF%E5%AE%98%E6%96%B9%E5%81%9A%E6%96%B0LinuxQQ%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>At one point, the biggest obstacle to my daily use of Linux distributions was the lack of QQ. Back then, I was a third-year student and QQ was an essential software for both learning and life. Although smartphones had already come into being, transferring files between phones and Linux computers was quite inconvenient at the time, and there wasn’t even a WPS Linux version… So, I eventually switched back to Windows.</p><!-- Abstract part --><span id="more"></span><p>Last year, for some unknown reason, Tencent actually released an official Linux QQ. Although it’s based on Electron, it doesn’t seem to be using an open-source project from the internet; instead, it appears to have used the layout of the Mac version? The current interface is quite appealing:<br><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2023/01/upgit_linuxqq_ui_20230115_1673775364.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2023/01/upgit_linuxqq_ui_20230115_1673775364.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="qq_gui"></p><p>Functionally, basic chat and file transfer work fine,表情包 display is also no problem, spaces and short videos are available, but other fancy features are missing for now. It’s currently quite minimalistic…</p><p>So… When will the one that once claimed to be minimalistic take action?</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> qq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Key Difference Between Pandas in Python and R</title>
      <link href="/en/2023/01/15/Pandas%E4%B8%8BApply%E5%92%8CR%E4%B8%8B%E7%9A%84%E4%B8%80%E9%A1%B9%E9%87%8D%E8%A6%81%E5%8C%BA%E5%88%AB/"/>
      <url>/en/2023/01/15/Pandas%E4%B8%8BApply%E5%92%8CR%E4%B8%8B%E7%9A%84%E4%B8%80%E9%A1%B9%E9%87%8D%E8%A6%81%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>I currently rarely use R for data processing or cleaning because my daily work involves a lot of string extraction&#x2F;processing, which is difficult to do in R. Additionally, the error tracking in R is very demanding on code proficiency and experience, making it almost unbearable for me to write and maintain R code (I tried at a previous company…). However, recently one of my colleagues asked me to use R to complete such tasks because he only knows R. In the process of copying code, I discovered another reason why I don’t need to use R for this type of work…</p><!-- Abstract part --><span id="more"></span><p>The content that needs to be processed is essentially taking a subset of the data frame and then generating new columns based on the row content of the subset, before concatenating these subsets. I have done this countless times with Pandas… Therefore, I gradually mastered the use of <code>apply</code>, <code>group</code>, <code>pivot_table</code>, and <code>melt</code> functions in Pandas, and there is nothing that these functions cannot solve for me, except for my poor coding ability, which makes the code inefficient…</p><p>However, performing the same operation in R is much more difficult… After all, it’s two different languages. Trying to find an equivalent or similar function in R to handle data as I do with Pandas is very challenging, and even when there are equivalents like <code>apply</code>, they still cause problems that I cannot solve, leading me to revert back to using a <code>for</code> loop…</p><p>The processing to be done involves selecting a subset <code>sub</code> from the dataset <code>data</code>. This <code>sub</code> actually contains two parts: <code>A</code> and <code>B</code>. The task is to perform row-wise judgment, returning part <code>A</code> if the content of <code>A</code> is not missing, otherwise returning part <code>B</code>, with each row’s return value forming a new data frame.</p><p>This can be easily achieved in Pandas by applying a function to the subset, then writing a function to judge the row and return the result. After <code>apply</code> completes, you directly get the desired data frame. However, there is a huge problem here: the data types of elements within a vector must be the same. When I collected numerical values into the same vector, non-string elements were automatically converted to strings, so although it could run, the newly generated four columns are all strings.</p><p>To try and solve this issue, I replaced vectors with <code>list</code> in the function, resulting in an intermediate version. Then I thought of another problem: <code>t()</code> transposes data as a matrix because R’s columns are individual vectors. If you don’t do it this way, transposing will result in one column having multiple data types… Therefore, I searched online and copied a piece of code to avoid using <code>t()</code>, resulting in the following version:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Function to return the required content</span></span><br><span class="line">mkSel <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>rec<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  mkA <span class="operator">&lt;-</span> rec<span class="punctuation">[[</span><span class="string">&#x27;MarkerA&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">  mkB <span class="operator">&lt;-</span> rec<span class="punctuation">[[</span><span class="string">&#x27;MarkerB&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.na</span><span class="punctuation">(</span>mkB<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    row <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>mkA<span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColA1&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColA2&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColA3&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    row <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>mkB<span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColB1&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColB2&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> rec<span class="punctuation">[[</span><span class="string">&#x27;ColB3&#x27;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>row<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Marker&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Tag1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Tag2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Tag3&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>row<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">sub<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Marker&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Tag1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Tag2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Tag3&#x27;</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> do.call<span class="punctuation">(</span>rbind.data.frame<span class="punctuation">,</span> apply<span class="punctuation">(</span>sub<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> mkSel<span class="punctuation">,</span> simplify<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>However, after testing, I discovered the biggest problem… <code>apply</code> function… it simply cannot return a data frame; it can only return a matrix, and matrices are inherently of the same type… Even the entire family of functions does not have one that can meet my needs. So no matter how hard I tried, using <code>apply</code> to achieve my goal was impossible.</p><p>In the end, I reverted back to the humble <code>for</code> loop to solve the problem… Generate an empty data frame, specify the types for each column, read each row of the <code>sub</code> data frame to generate a new data frame, and finally merge the two data frames according to their indices…</p><p>So in summary, R’s <code>apply</code> was not designed with this usage in mind; it can only use basic functions… Through a more cumbersome (needing to write several lines at a time, while also seeming less efficient and less reusable) way of achieving what I do with Pandas…</p><p>Of course, objectively speaking, my proficiency in R is far inferior to that of Pandas. I haven’t used many useful R packages (like <code>dplyr</code>), so maybe R can complete these tasks well… But… I couldn’t find any relevant materials?</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>clash_nps self-built inner net penetration using VPN</title>
      <link href="/en/2023/01/08/clash-nps%E8%87%AA%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%94%A8vpn/"/>
      <url>/en/2023/01/08/clash-nps%E8%87%AA%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%94%A8vpn/</url>
      
        <content type="html"><![CDATA[<p>Since the start of the pandemic, I have had some remote work needs. Today, I finally put together a relatively convenient and nearly VPN-like experience for accessing inner networks.</p><!-- Abstract part --><span id="more"></span><h2 id="Past-Used-Schemes"><a href="#Past-Used-Schemes" class="headerlink" title="Past Used Schemes"></a>Past Used Schemes</h2><p>My initial requirement was simply to log in to the target server through SSH. Therefore, I initially bought a VPS as a jumpboard machine. On the target machine, I used SSH or autossh to start reverse proxy services, allowing me to access the 22 port of the target machine via the port on the VPS. The biggest advantage of this scheme is its simplicity; SSH is something that all Linux systems come with by default. Additionally, once connected via SSH, you can use it for reverse proxying, theoretically enabling access to any inner network IP and port. However, its drawbacks are that as more access needs arise, each new IP&#x2F;port requires logging into the target machine again and running a reverse proxy command. This makes it no longer simple or user-friendly… Furthermore, if power is lost and needs to be restarted… All these steps have to be repeated… Extremely troublesome.</p><p>Later, IT started enabling NPS (Network Penetration Server), which is an inner net penetration tool written in Go. Installation and usage are extremely simple. After setting up the server and client, if there are new access requirements, you can create a private link on the NPS management page to set it up. If encountering restarts, restarting the NPS client is sufficient. Additionally, with administrative permissions, the NPS client can also be configured to start automatically. This saves a lot of work. However, when too many things need to be accessed, each port still requires running an NPC process locally. Furthermore, because it maps ports to the local machine, inner network addresses become 127.0.0.1, which can cause some services to have issues (e.g., Gitea’s content).</p><p>Recently, while checking the NPS management interface, I learned that the Socks proxy mode can be used to access various inner net resources and implement VPN functionality. Therefore, I tried it out again and finally achieved accessing inner network resources using the Socks mode and Clash client, without affecting external internet traffic.</p><h2 id="Current-Linux-Scheme"><a href="#Current-Linux-Scheme" class="headerlink" title="Current Linux Scheme"></a>Current Linux Scheme</h2><h3 id="Required-Software-Hardware"><a href="#Required-Software-Hardware" class="headerlink" title="Required Software&#x2F;Hardware"></a>Required Software&#x2F;Hardware</h3><ul><li>A VPS with a public IP, referred to as <code>VPS</code>, which also needs to be able to configure port forwarding permissions on this VPS.</li><li>A host within the target inner net that can access the <code>VPS</code>. This machine is referred to as <code>jumpboard</code>, and the request for accessing the inner net actually originates from this machine.</li><li>NPS server&#x2F;client software, which can be obtained from GitHub <a href="https://github.com/ehang-io/nps">here</a>.</li><li>A Clash client software that can intercept global traffic. For Linux, you can use the Linux version of <a href="https://github.com/Fndroid/clash_for_windows_pkg">Clash For Windows</a> or <a href="https://github.com/zzzgydi/clash-verge">Clash Verge</a>. Note that there was a permission issue with Clash Verge’s Tun mode before, but I’m not sure if it has been fixed.</li></ul><h3 id="Implementation-Steps"><a href="#Implementation-Steps" class="headerlink" title="Implementation Steps"></a>Implementation Steps</h3><ol><li>Set up NPS on the <code>VPS</code> and start the client on the <code>jumpboard</code>. Then configure the Socks proxy settings in the NPS service interface. For specific operations, refer to <a href="https://blog.csdn.net/ha0shenqi/article/details/111194246">this blog</a>. Note down the account and password for the Socks service.</li><li>Install Clash For Windows and follow the <a href="https://docs.cfw.lbyczf.com/contents/tun.html#linux">official documentation</a> to enable Tun mode (global mode, which will create a virtual network card to intercept all traffic on your machine).</li><li>Since I already have a converted configuration file for Clash, open the existing configuration file and manually add the Socks5 service from the <code>VPS</code>. Also, fill in the Clash rules yourself. An example configuration segment is as follows (the rules should be written at the beginning because once a match is found, it won’t continue matching):</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NPS_SOCKS</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">11.11</span><span class="number">.11</span><span class="number">.111</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">2233</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">socks5</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">socks5</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">socks123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SOCKS5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NPS_SOCKS</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DIRECT</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,192.168.0.111/32,NPS_SOCKS</span></span><br></pre></td></tr></table></figure><ul><li>Tip: Additionally, if the rule matches a single address, it should be written as <code>XXX.XXX.XXX.XXX/32</code>. If it matches an entire subnet, it should be written as <code>XXX.XXX.XXX.0/16</code>. Of course, writing a specific address with <code>/16</code> will cause the entire subnet to be proxied.</li></ul><ol start="4"><li>Restart the Clash service to access.</li></ol><h2 id="Current-ChromeOS-ChromiumOS-Android-Scheme"><a href="#Current-ChromeOS-ChromiumOS-Android-Scheme" class="headerlink" title="Current ChromeOS &#x2F; ChromiumOS &#x2F; Android Scheme"></a>Current ChromeOS &#x2F; ChromiumOS &#x2F; Android Scheme</h2><p>For these systems, only the Clash client changes. Use the <code>Clash for Android</code> app from the store. For ChromeOS, you need to first enable the Android subsystem and then install it from the store (before installation, set the system proxy; after installation, close the system proxy and use Clash client to route traffic). Since <a href="https://github.com/Kr328/ClashForAndroid/issues/1647">Android’s VPN inherently intercepts all traffic</a>, you don’t need to configure mode settings. Just configure the rules directly. However, by default, the client does not proxy requests to inner network IPs. Find the <code>Settings &gt; Network &gt; Bypass Private Networks</code> option and disable it.</p><h2 id="Future-Plans"><a href="#Future-Plans" class="headerlink" title="Future Plans"></a>Future Plans</h2><p>Since using Clash for rule-based traffic diversion, this scheme can actually set up simultaneous access to multiple inner net resources, as long as the IP addresses do not conflict. In the future, I will change my home network’s IP segment directly…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nps </tag>
            
            <tag> clash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>One Year Worse Than the Last</title>
      <link href="/en/2023/01/08/%E4%B8%80%E5%B9%B4%E6%AF%94%E4%B8%80%E5%B9%B4%E7%B3%9F%E7%B3%95/"/>
      <url>/en/2023/01/08/%E4%B8%80%E5%B9%B4%E6%AF%94%E4%B8%80%E5%B9%B4%E7%B3%9F%E7%B3%95/</url>
      
        <content type="html"><![CDATA[<p>Recalling 2022, it was basically full of bad things. Work was even more tiring, achievements were fewer, health was worse, spirits were more depressed, free time would be less soon, and even finding a barbecue place several times became difficult… Can’t it get better… I hope the new year won’t be even worse…</p><!-- Summary part --><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2023 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chromebook入坑记?</title>
      <link href="/en/2022/10/16/chromebook%E5%85%A5%E5%9D%91/"/>
      <url>/en/2022/10/16/chromebook%E5%85%A5%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<p>I have always been interested in the status of domestic Linux systems (although I haven’t used any long-term except for an ancient version of Linux Deepin), so when Flint OS was still called FydeOS, I paid attention to this Chromium OS-based special edition. This also led me to understand why Chrome OS, which has a mysterious high share overseas in the past, is popular.</p><!-- 摘要部分 --><span id="more"></span><p>Chrome OS is developed by Google and its features include being lightweight, simple, and heavily relying on cloud services. In other words, it’s an operating system designed for low-performance netbooks, with the idea that most users don’t need strong performance to run a lot of professional local software; they just need a device that can access the required services through the web. Therefore, Chrome OS was originally designed not to run any services locally, and all functions needed to be accessed through website services. The browser Pro Max Plus system (then received a lot of complaints).</p><p>From its development, it seems this idea might not be entirely wrong, but… with the addition of Linux subsystems and Android subsystems, completely cloud-based systems are still too early.</p><p>However, this doesn’t mean it’s too early for my work…</p><p>My work involves handling large amounts of gene sequencing data, which is too huge to process using mobile devices yet. Therefore, there has always been a need in my work to separate actual computational tasks from other work. On the other hand, many important tools I use, such as Jupyter, RStudio, and VSCode, already have mature server versions. After setting up corresponding services, I started thinking about whether it would be possible to complete daily work requirements using a Chromebook or a device similar to Chrome OS (as mentioned earlier).</p><p>So, in the following days, I first tried FydeOS(x86), then bought Lenovo Duet, and finally entered the Chromebook pit… Previously, I had tried setting up self-hosted cloud services to prepare for working on Chromebooks only. However, like the countless pitfalls I’ve encountered over 10 years using Linux distributions and even experiencing life-threatening losses before being able to use them smoothly, there are still many issues with using such a minimalist system for work at this stage… I’ll list these problems one by one later…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chromeos </tag>
            
            <tag> chromebook </tag>
            
            <tag> fydeos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Setting Up a Cloud Development Environment</title>
      <link href="/en/2022/09/24/%E6%90%AD%E5%BB%BA%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
      <url>/en/2022/09/24/%E6%90%AD%E5%BB%BA%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>A long time ago, I was interested in a special operating system made in China called FydeOS. It is based on ChromiumOS and is a Chinese version of ChromeOS. The main idea behind this operating system is that many people do not need high-performance terminal computers for work; they just need an entry-level device that can access essential work services through a browser.</p><!-- summary section --><span id="more"></span><p>This concept is indeed very interesting, making me think about the different philosophies of version control software like Git and SVN. Git follows a distributed model where each developer has a complete copy of the project code with their own branches. On the other hand, SVN uses a centralized model where users access only the parts they need through a service.</p><p>Personally, I believe that neither distributed nor centralized models are inherently better; they have different applications depending on the situation. In my current work, everything is in a completely distributed manner without any backups, with both the working environment and content located on my personal or company computers. If one day my device fails… it would take quite some time to recover. Additionally, if I need to urgently handle something but the device is not nearby or has no power… there’s nothing much I can do except worry.</p><p>So, I also want to try whether my current work can be fully cloud-based. That is, deploying a series of self-hosted services and completing all work through browsers or other development tools that support remote projects, with actual execution happening on the server side.</p><h2 id="All-Software-Needed-for-My-Work"><a href="#All-Software-Needed-for-My-Work" class="headerlink" title="All Software Needed for My Work"></a>All Software Needed for My Work</h2><p>In bioinformatics, it’s essentially about writing scripts, creating statistical graphs, refining graphics, and writing various kinds of documents. The software I actually use includes:</p><ul><li>Code writing&#x2F;testing: VSCode, Jupyter</li><li>Environment deployment: conda, docker</li><li>File organization: System自带的文件管理器</li><li>Document processing: WPS series</li><li>Literature review: Zotero</li><li>Image processing: GIMP</li></ul><h2 id="What-is-Needed-to-Set-Up-a-Cloud-Development-Environment"><a href="#What-is-Needed-to-Set-Up-a-Cloud-Development-Environment" class="headerlink" title="What is Needed to Set Up a Cloud Development Environment"></a>What is Needed to Set Up a Cloud Development Environment</h2><p>To achieve a fully cloud-based work environment, ideally, all the above software should have self-hosted cloud versions that can solve the following issues:</p><ul><li>Code writing&#x2F;testing: code-server, Jupyter is already a service and can be accessed remotely.</li><li>Environment deployment: Remote SSH login or find a web terminal emulator.</li><li>File organization: Nextcloud, firerun</li><li>Document processing: only office server</li><li>Literature review: paperpile (paid)</li></ul><p>In summary, the only thing left is image editing… I haven’t found any self-hosted solutions yet. I’ll continue to keep an eye on this.</p><h2 id="Attempt"><a href="#Attempt" class="headerlink" title="Attempt"></a>Attempt</h2><h3 id="ML-Hub-ML-Workspace-Configuration"><a href="#ML-Hub-ML-Workspace-Configuration" class="headerlink" title="ML-Hub &#x2F; ML-Workspace Configuration"></a>ML-Hub &#x2F; ML-Workspace Configuration</h3><p>ML-Hub &#x2F; ML-Workspace is a container-based multi-network service integration project that includes JupyterHub with many plugins, code-server, and a simple file manager. If not for user permission issues when running Docker, it would instantly solve about 60-70% of the problems…</p><p>Both are relatively easy to use; after installing Docker or Podman, you can start the services directly.</p><h3 id="Intranet-Penetration-nps"><a href="#Intranet-Penetration-nps" class="headerlink" title="Intranet Penetration (nps)"></a>Intranet Penetration (nps)</h3><p>nps is a Go language-based… composite network tool? One of its functions is intranet penetration. nps includes both server and client components. It’s important to note that the nps server acts as an intermediary station, connecting various clients together. Therefore, when setting it up, you first need a host with a public IP address to deploy the nps server. Then, the machines to be accessed need to connect to the nps server using the client npc. Other clients can then use the nps intermediary to connect to the target client.</p><p>In summary… unlike VNC, RDP, and SSH, where the machine being accessed runs a service, this method uses the nps server as an intermediary.</p><h3 id="HTTPS-Proxy-Settings"><a href="#HTTPS-Proxy-Settings" class="headerlink" title="HTTPS Proxy Settings"></a>HTTPS Proxy Settings</h3><p>If you want to host the built services under a domain and access them directly via the domain, for security reasons, HTTPS is still necessary. Domain registration can be done by finding the cheapest available one first, then using Caddy for reverse proxying. After much trial and error, I ended up with this configuration.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  http_port 8888</span><br><span class="line">  https_port 8384</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:8384 &#123;</span><br><span class="line">    reverse_proxy localhost:7788</span><br><span class="line">    tls /etc/caddy/domain.top.cer /etc/caddy/domain.top.key</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">your.domain.top:8384 &#123;</span><br><span class="line">    reverse_proxy localhost:7788</span><br><span class="line">    tls /etc/caddy/domain.top.cer /etc/caddy/domain.top.key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Firewall-Settings-iptables"><a href="#Firewall-Settings-iptables" class="headerlink" title="Firewall Settings (iptables)"></a>Firewall Settings (iptables)</h3><p>As before… for security reasons, a firewall should still be enabled. I also found some tutorials on how to use iptables (<a href="https://iter01.com/616656.html">CENTOS 8开启iptables</a>), but this is quite outdated. Many new systems now use other firewall management programs.</p><p><a href="http://balalals.cn/archives/docker%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%AB%AF%E5%8F%A3">Docker访问宿主机端口方法</a></p><pre><code class="bash">iptables -I INPUT -p tcp --dport 80 -j ACCEPTiptables -I INPUT -p tcp --dport 443 -j ACCEPT iptables -I INPUT -p tcp --dport 7788 -j REJECTiptables -I INPUT -p tcp -s 127.0.0.1 --dport 7788 -j ACCEPT</code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> https </tag>
            
            <tag> jupyter </tag>
            
            <tag> cloud </tag>
            
            <tag> firewall </tag>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thoughts on Tinkering with Graph Databases</title>
      <link href="/en/2022/08/25/%E5%80%92%E8%85%BE%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E6%83%B3%E5%88%B0%E7%9A%84/"/>
      <url>/en/2022/08/25/%E5%80%92%E8%85%BE%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E6%83%B3%E5%88%B0%E7%9A%84/</url>
      
        <content type="html"><![CDATA[<p>Recently, while organizing our materials for using graph databases, I thought of a problem. Actually, from a performance perspective, graph databases may not necessarily achieve better performance. For us, the significance lies in simplifying the requirements for database design.</p><!-- Abstract --><span id="more"></span><p>We have a lot of data with many interrelated aspects. For those of us who are not in the database-related industry, although it takes effort to clarify the actual logical relationships between the information we need to record, this is something that must and can be done. However, designing a suitable library and table to store these things… that’s really a daunting task…</p><p>At this point, graph databases have an absolute advantage. Because… as long as the logic is clear, you can simply store it according to this logical relationship… So… the greatest significance of using this thing… is saving database structure design, and if you find that your logic isn’t quite right, changing nodes is also easier…</p><p>That’s all</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Graph Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Marp</title>
      <link href="/en/2022/06/22/Marp%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2022/06/22/Marp%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>In daily work, there are always times when you need to create a presentation document to show project progress or results. However, creating a PPT is quite time-consuming (my obsessive-compulsive disorder always makes me adjust the font and position). I’ve never used any of the fancy elements and features of PPTs, so I found Marp to save some effort.</p><!-- Summary --><span id="more"></span><p>Marp is a project that generates presentation documents using markdown syntax. With basic markdown syntax, you can quickly create a presentable document (it’s actually quite ugly), supporting generation into pptx, pdf, and web pages. I’ve been using it for about a month, and the experience has been good (the audience might find it eye-straining).</p><h2 id="Basic-Usage-of-Marp-in-VScode"><a href="#Basic-Usage-of-Marp-in-VScode" class="headerlink" title="Basic Usage of Marp in VScode"></a>Basic Usage of Marp in VScode</h2><p>The Marp project has multiple available programs, but the most convenient one is definitely the VScode plugin. No special settings are required; just install and use it.</p><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_20220622_1655884337.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_20220622_1655884337.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>After installation, when you open a markdown file, an additional button will appear in the upper right corner of the editor. You can switch the current file to Marp mode.</p><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Set_20220622_1655884577.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Set_20220622_1655884577.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Then you can start writing… Since it’s all basic markdown syntax, there’s not much to pay attention to except for using <code>---</code> to separate the content of each page. For more details, see the <a href="https://marpit.marp.app/markdown">official documentation</a>.</p><h2 id="Use-Cases-for-Reference"><a href="#Use-Cases-for-Reference" class="headerlink" title="Use Cases for Reference"></a>Use Cases for Reference</h2><h3 id="Inserting-Images-Left-Right"><a href="#Inserting-Images-Left-Right" class="headerlink" title="Inserting Images Left&#x2F;Right"></a>Inserting Images Left&#x2F;Right</h3><p>In my presentations, I often need to include an image and then provide some explanations. This side-by-side arrangement looks more reasonable, but basic markdown syntax doesn’t support this… You can achieve it using Marp’s background image syntax.</p><p>Here, <code>contain</code> automatically adjusts the size of the image; otherwise, it usually exceeds the slide range. The example uses right placement, but you can also use <code>left</code> to place it on the left side. For vertical alignment, <code>contain</code> doesn’t seem to work.</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="section">marp: true</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="section">## A statistics chart is on the right</span></span><br><span class="line"><span class="bullet">-</span> The image is randomly found</span><br><span class="line"></span><br><span class="line">![<span class="string">bg contain right</span>](<span class="link">https://seaborn.pydata.org/_images/grouped_barplot.png</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Slide1_20220622_1655885449.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Slide1_20220622_1655885449.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="Footnotes-and-Page-Numbers"><a href="#Footnotes-and-Page-Numbers" class="headerlink" title="Footnotes and Page Numbers"></a>Footnotes and Page Numbers</h3><p>By adding two settings at the beginning, you can enable footnotes and page numbers. However, the position seems to be unchangeable using markdown syntax.</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">marp: true</span><br><span class="line">footer: 20220610</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="section">## Displaying page numbers</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Slide2_20220622_1655885767.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/06/upgit_Marp_VScode_Slide2_20220622_1655885767.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Marp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>About Reading More Papers Than Thesis in the Last Two Years</title>
      <link href="/en/2022/04/05/%E5%85%B3%E4%BA%8E%E6%88%91%E8%BF%99%E4%B8%A4%E5%B9%B4%E5%B7%A5%E4%BD%9C%E7%9C%8B%E8%AE%BA%E6%96%87%E6%AF%94%E8%AF%BB%E7%A0%94%E8%BF%98%E5%A4%9A%E8%BF%99%E4%BB%B6%E4%BA%8B/"/>
      <url>/en/2022/04/05/%E5%85%B3%E4%BA%8E%E6%88%91%E8%BF%99%E4%B8%A4%E5%B9%B4%E5%B7%A5%E4%BD%9C%E7%9C%8B%E8%AE%BA%E6%96%87%E6%AF%94%E8%AF%BB%E7%A0%94%E8%BF%98%E5%A4%9A%E8%BF%99%E4%BB%B6%E4%BA%8B/</url>
      
        <content type="html"><![CDATA[<p>It was a night when I felt overwhelmed by reading papers (March 29, 2022). As I browsed through the messy directory tree in Zotero… it suddenly occurred to me how many papers I had read over the past few years? Exporting from emails… I was shocked… 561 entries, 419 PDFs downloaded… really… If I had gone straight for a PhD, I probably wouldn’t have read so many papers.</p><!-- Summary --><span id="more"></span><p>So I decided to take a closer look at the information of these papers.</p><h2 id="Steps-Taken"><a href="#Steps-Taken" class="headerlink" title="Steps Taken"></a>Steps Taken</h2><p>It was a night when I felt overwhelmed by reading papers (March 29, 2022). As I browsed through the messy directory tree in Zotero… it suddenly occurred to me how many papers I had read over the past few years? Exporting from emails… I was shocked… 561 entries, 419 PDFs downloaded… really… If I had gone straight for a PhD, I probably wouldn’t have read so many papers.</p><ol><li>Exported the bibliography from Zotero as an <code>ris</code> file</li><li>Used <code>rispy</code> to parse the <code>ris</code> file into a dataframe, retaining the type of literature, authors, year of entry, abstract, and publication journal.</li><li>Retained entries where the type of literature was a journal article.</li><li>Used <code>wordcloud</code> to create word clouds for authors and publishing journals.</li><li>Combined the abstracts into a single string and used <code>wordcloud</code> to self-segment and create a word cloud.</li><li>Created a bar chart for the year of entry.</li></ol><p>The approximate results are shown below:</p><h2 id="Author-Word-Cloud"><a href="#Author-Word-Cloud" class="headerlink" title="Author Word Cloud"></a>Author Word Cloud</h2><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_auth_20220405_1649148811.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_auth_20220405_1649148811.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Author Word Cloud"></p><p>From the graph, we can see a few prominent authors. Let’s take a brief look at them:</p><ul><li><p>Griffith Malachi, Griffith Obi L.: These two Griffiths are twins and come from the <a href="https://griffithlab.org/">Griffith Lab</a>. This lab specializes in applying bioinformatics to various aspects of cancer. They have developed a series of related software&#x2F;databases.</p></li><li><p>Sette Alessandro: From the <a href="https://www.lji.org/labs/sette/">Sette Lab</a>, an expert in immunology. His research mainly focuses on immune studies of pathogens, especially viruses. Since the outbreak of COVID-19, most of his published research seems to be related to COVID.</p></li><li><p>Morten Nielsen: A researcher from the Technical University of Denmark (DTU). His main area of focus is likely algorithm development for immune recognition. The prominent appearance in the graph might be due to my collecting multiple papers related to affinity prediction. His university profile can be found <a href="https://orbit.dtu.dk/en/persons/morten-nielsen-2/fingerprints/">here</a>.</p></li><li><p>Nir Hacohen: A researcher at the Broad Institute, focusing on immunology according to his <a href="https://www.broadinstitute.org/bios/nir-hacohen">profile</a>. I don’t have a particular impression of this author yet.</p></li><li><p>Bjoern Peters: From the <a href="https://www.lji.org/labs/peters/">Peters Lab</a>, focusing on bioinformatics in immunology. He is from the same La Jolla Institute for Immunology as Sette Alessandro.</p></li><li><p>Eilon Barnea: From <a href="https://mlandau.net.technion.ac.il/people/">Meytal Landau’s Lab</a>. His main research seems to be computational and experimental identification of immune peptides?</p></li><li><p>Arie Admon: From the <a href="https://admon.net.technion.ac.il/">Arie Admon Lab</a>, mainly researching proteomics. I think I collected some papers related to mass spectrometry identification.</p></li><li><p>Michal Bassani-Sternberg: An expert in tumor biology and tumor immunology. According to her <a href="https://www.ludwigcancerresearch.org/scientist/michal-bassani-sternberg/">profile</a>, she mainly uses mass spectrometry as a research tool.</p></li><li><p>Anthony Purcell: From the <a href="https://research.monash.edu/en/persons/anthony-purcell">Monash University Research Profile</a>. His research direction is bioinformatics applications in tumor immunity and autoimmune diseases.</p></li><li><p>Anne Searls De Groot: Co-founder of EpiVax. Such a big name… I think it was because there were many papers from their company that I read at the time…</p></li><li><p>Ugur Sahin: CEO of BioNTech… hmm, also brought in when reading company literature.</p></li><li><p>Catherine J Wu: Researcher focusing on neoantigens. Recently, several research results led by her have been included… Additionally, she has assisted the Broad Institute in tumor immunity-related research.</p></li></ul><h2 id="Journal-Word-Cloud"><a href="#Journal-Word-Cloud" class="headerlink" title="Journal Word Cloud"></a>Journal Word Cloud</h2><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_jour_20220405_1649148783.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_jour_20220405_1649148783.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Journal Word Cloud"></p><p>In terms of journals… it’s still dominated by bioinformatics, with a lot from biotechnology and immunology due to the application direction.</p><h2 id="Abstract-Word-Cloud"><a href="#Abstract-Word-Cloud" class="headerlink" title="Abstract Word Cloud"></a>Abstract Word Cloud</h2><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_abs_20220405_1649148797.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_abs_20220405_1649148797.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Abstract Word Cloud"></p><p>The abstract word cloud clearly shows the directions of my recent work… peptides, neoantigens, T cells…</p><h2 id="Year-of-Entry-Statistics"><a href="#Year-of-Entry-Statistics" class="headerlink" title="Year of Entry Statistics"></a>Year of Entry Statistics</h2><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_year.bar_20220405_1649148769.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/04/upgit_year.bar_20220405_1649148769.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Year of Entry Statistics"></p><p>As for the statistics on the year of entry… it’s clear why I feel overwhelmed by reading papers recently…</p><p>That’s all.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> papers </tag>
            
            <tag> zotero </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R Plotting Issues Record</title>
      <link href="/en/2022/03/13/%E4%BD%BF%E7%94%A8ggpubr%E5%81%9A%E5%9B%BE%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/en/2022/03/13/%E4%BD%BF%E7%94%A8ggpubr%E5%81%9A%E5%9B%BE%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>Recently, while helping a colleague create plots, I uncovered some new issues and solutions related to <code>ggpubr</code> and survival analysis packages. Here are the records.</p><!-- Abstract section --><span id="more"></span><h2 id="survminer-Plot-Saving-Issue"><a href="#survminer-Plot-Saving-Issue" class="headerlink" title="survminer Plot Saving Issue"></a>survminer Plot Saving Issue</h2><p>The <code>survminer</code> package includes a convenient function called <code>ggsurvplot</code>, which allows for easy creation of survival curves with group significance tests, as well as frequency tables below the plot. However, this function returns a <code>ggsurvplot</code> object rather than a <code>ggplot()</code> object. This object contains <code>survObj$plot</code> for the survival curve and <code>survObj$table</code> for the frequency table. Therefore, if you need to adjust or modify the plot using <code>ggplot</code> syntax, you should operate on the objects within these two components.</p><h2 id="ggpubr-Still-Has-Bug-with-Significance-Test-Annotations-in-Faceted-Plots"><a href="#ggpubr-Still-Has-Bug-with-Significance-Test-Annotations-in-Faceted-Plots" class="headerlink" title="ggpubr Still Has Bug with Significance Test Annotations in Faceted Plots"></a>ggpubr Still Has Bug with Significance Test Annotations in Faceted Plots</h2><p>As of December last year, there is still a bug in <code>ggpubr</code> where box plots (other facets may also have this issue) append significance test annotations incorrectly after faceting. The data and annotation positions are incorrect. You need to manually draw individual plots and then combine them.</p><h2 id="Table-Annotations-Inside-the-Plot"><a href="#Table-Annotations-Inside-the-Plot" class="headerlink" title="Table Annotations Inside the Plot"></a>Table Annotations Inside the Plot</h2><p>To be filled in later.</p><h2 id="Multiple-Ways-to-Implement-Significance-Annotations"><a href="#Multiple-Ways-to-Implement-Significance-Annotations" class="headerlink" title="Multiple Ways to Implement Significance Annotations"></a>Multiple Ways to Implement Significance Annotations</h2><p>Due to a complex requirement from a client, where significance tests should be based on a reference group with two groups instead of one, <code>ggpubr</code>‘s built-in functions cannot meet this need. I spent considerable time researching how to manually implement it, and different methods for various requirements are recorded here:</p><p>To be filled in later.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ggplot </tag>
            
            <tag> ggpubr </tag>
            
            <tag> survminer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dash Implementation for Interactive Data Point Selection and Calculation</title>
      <link href="/en/2022/03/13/Dash%E4%BA%A4%E4%BA%92%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/"/>
      <url>/en/2022/03/13/Dash%E4%BA%A4%E4%BA%92%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<p>A while ago, I implemented an interesting interactive data processing case using Dash. Here, I’ll record it.</p><!-- Abstract part --><span id="more"></span><p>The problem was that there were many data entries, and the client wanted to perform metric calculations based on these data entries. However, they didn’t want to use all the data; instead, they needed to draw the data points on a scatter plot and then select a subset of these points from the graph to perform metric calculations using the corresponding data entries.</p><p>My first reaction was to check if Dash had any relevant features. To my surprise, it does! <a href="https://plotly.com/python/interactive-graphing-with-dash/">See this official documentation</a></p><p>The implementation turned out to be quite simple. I just needed to add feedback for selection events:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Drawing the graph</span></span><br><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line">data_b1_p1 = pd.read_csv(<span class="string">&#x27;1st.part1.fmt.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fig_b1_p1 = px.scatter(data_b1_p1, x=<span class="string">&#x27;FFPE_X&#x27;</span>, y=<span class="string">&#x27;FFPE_Y&#x27;</span>, color=<span class="string">&#x27;Pos&#x27;</span>, opacity=<span class="number">0.5</span>)</span><br><span class="line">fig_b1_p1 = fig_b1_p1.update_layout(</span><br><span class="line">    width=<span class="number">600</span>,</span><br><span class="line">    height=<span class="number">600</span></span><br><span class="line">).update_traces(</span><br><span class="line">    mode=<span class="string">&#x27;markers&#x27;</span>, marker_size=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setting up the framework structure for Dash app components; here, I only place a div to hold the graph</span></span><br><span class="line">app.layout = html.Div([</span><br><span class="line">    html.Div([</span><br><span class="line">        dcc.Markdown(<span class="string">&quot;demo title&quot;</span>),</span><br><span class="line">        dcc.Graph(</span><br><span class="line">            <span class="built_in">id</span>=<span class="string">&#x27;fig_b1_p1&#x27;</span>,</span><br><span class="line">            figure=fig_b1_p1</span><br><span class="line">        ),</span><br><span class="line">        html.Pre(<span class="built_in">id</span>=<span class="string">&#x27;sel_b1_p1&#x27;</span>)</span><br><span class="line">    ],</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Defining the data processing function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_mean</span>(<span class="params">selectedData, base</span>):</span><br><span class="line">    <span class="keyword">if</span> selectedData:</span><br><span class="line">        selData = pd.DataFrame(selectedData[<span class="string">&#x27;points&#x27;</span>]).rename(columns=&#123;<span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;FFPE_X&#x27;</span>, <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;FFPE_Y&#x27;</span>&#125;)</span><br><span class="line">        selData = selData.merge(base, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;FFPE_X&#x27;</span>, <span class="string">&#x27;FFPE_Y&#x27;</span>]).drop(</span><br><span class="line">            columns=[<span class="string">&#x27;curveNumber&#x27;</span>, <span class="string">&#x27;pointNumber&#x27;</span>, <span class="string">&#x27;pointIndex&#x27;</span>, <span class="string">&#x27;FFPE_X&#x27;</span>, <span class="string">&#x27;FFPE_Y&#x27;</span>, <span class="string">&#x27;Pos&#x27;</span>, <span class="string">&#x27;OID&#x27;</span>, <span class="string">&#x27;Marker&#x27;</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        mean = nanmean(selData[<span class="string">&#x27;col1&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;mean&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Waiting for selection&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Defining the callback function</span></span><br><span class="line"><span class="meta">@app.callback(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    Output(<span class="params"><span class="string">&#x27;sel_b1_p1&#x27;</span>, <span class="string">&#x27;children&#x27;</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    [Input(<span class="params"><span class="string">&#x27;fig_b1_p1&#x27;</span>, <span class="string">&#x27;selectedData&#x27;</span></span>)]</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse1</span>(<span class="params">selectedData</span>):</span><br><span class="line">    <span class="keyword">return</span> show_mean(selectedData, data_b1_p1)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>In summary, using a Plotly interactive graph, which has built-in region select and lasso select functionalities, the selected data points are stored in the <code>selectedData</code> attribute of the graph. Using Dash’s decorator, you can pass this data to your function.</p><p>However, it’s important to note that the returned data is only for drawing the graph; for example, if it’s a scatter plot, you’ll get the x and y coordinates in list-of-dictionaries format. You need to convert these into a DataFrame and merge them with the original data based on the coordinates to know which data entries correspond to the selected points, after which you can perform the calculations and return the results.</p><p>The original data is too large to write here; I’ll update this blog with an example using another dataset later.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ploty </tag>
            
            <tag> dash </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Usage of Scrapy</title>
      <link href="/en/2022/03/13/Scrapy%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2022/03/13/Scrapy%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>I previously tried to use Scrapy to crawl information from a drug website, but I didn’t make any records at the time. This time, I helped a classmate crawl some data, so I decided to record it this time.</p><!-- Abstract part --><span id="more"></span><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Scrapy is a Python framework specifically designed for web crawling. Compared to manually sending requests and parsing information using libraries like <code>requests</code>, Scrapy provides built-in functionalities such as request handling, response parsing, exception handling, task queue management, etc., allowing us to perform data crawling tasks in a more professional manner.</p><p>Of course, the cost is… the learning curve has increased slightly because we need to understand some basic concepts and working principles of this framework. I initially tried to follow the tutorial on Coder’s Tutorial website… but I was completely confused by the diagrams:</p><p><img src="https://www.runoob.com/wp-content/uploads/2018/10/8c591d54457bb033812a2b0364011e9c_articlex.png" class="lazyload" data-srcset="https://www.runoob.com/wp-content/uploads/2018/10/8c591d54457bb033812a2b0364011e9c_articlex.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Tutorial Introduction Diagram"></p><h2 id="Case-Study"><a href="#Case-Study" class="headerlink" title="Case Study"></a>Case Study</h2><p>To simplify things… I only recorded the parts of the actual operation that needed to be understood.</p><h3 id="1-Create-a-New-Project"><a href="#1-Create-a-New-Project" class="headerlink" title="1. Create a New Project"></a>1. Create a New Project</h3><p>First, Scrapy as a framework does not require users to write code line by line from scratch; instead, it allows us to write operation-related methods within an existing template. When starting a new project, use <code>scrapy startproject demo</code> to create a new project.</p><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/03/upgit_20220326_1648289689.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/03/upgit_20220326_1648289689.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Create Project"></p><p>After creation, the project directory contains many files. You don’t need to understand all of them; just be familiar with the following:</p><p><img src="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/03/upgit_spider_proj_20220326_1648293754.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/silenwang/Gallary/master/2022/03/upgit_spider_proj_20220326_1648293754.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Project Content"></p><ul><li><code>demo/spiders</code>: The directory where spider files are stored. Initially, if no spiders have been created, this directory will only contain <code>__init__.py</code>. The specific content of the spiders will be introduced later.</li><li><code>demo/settings.py</code>: The configuration file for the crawler, including request headers, anti-crawling protocols, task intervals, cookie settings, etc. Most settings can be understood by reading the comments in the file; just set them accordingly.</li><li><code>demo/pipelines.py</code>: Corresponds to the Item Pipeline shown in the example diagram. This is where we define how items are processed. When using the built-in <code>item</code> object to collect target information, this needs to be set up.</li><li><code>demo/items.py</code>: The file where items are defined. Similar to above, when using items, they need to be defined in this file (mainly defining what should be stored in an item).</li></ul><h3 id="2-Create-a-Spider"><a href="#2-Create-a-Spider" class="headerlink" title="2. Create a Spider"></a>2. Create a Spider</h3><p>Spider files need further generation using <code>scrapy genspider</code>. For example, running <code>scrapy genspider dSpider www.sample.com</code> will generate a spider file named <code>dSpider.py</code> in the <code>demo/spiders/</code> directory. The content of this file is roughly as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DspiderSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;dSpider&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;www.sample.com&#x27;</span>]</span><br><span class="line">    start_urls = [<span class="string">&#x27;http://www.sample.com/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Using the spider essentially involves rewriting methods within this generated spider file. For instance, here is what I wrote:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> JsDemo.items <span class="keyword">import</span> JsdemoItem</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DemoSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;demo&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;www.cssn.net.cn&#x27;</span>]</span><br><span class="line">    start_urls = [<span class="string">f&#x27;http://www.cssn.net.cn:8000/standards/?a104=IX-ISO&amp;orderby=&amp;post_publicyear=<span class="subst">&#123;year&#125;</span>&#x27;</span> <span class="keyword">for</span> year <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1960</span>, <span class="number">2021</span>)]</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        pMax = ceil(json.loads(response.text)[<span class="string">&#x27;count&#x27;</span>] / <span class="number">20</span>)</span><br><span class="line">        <span class="keyword">for</span> pNum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, pMax+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(<span class="string">f&#x27;<span class="subst">&#123;response.request.url&#125;</span>&amp;page=<span class="subst">&#123;pNum&#125;</span>&#x27;</span>, callback=self.parse_next)        </span><br><span class="line">           </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_next</span>(<span class="params">self, response</span>):</span><br><span class="line">        obj = json.loads(response.text)</span><br><span class="line">        item = JsdemoItem()</span><br><span class="line">        item[<span class="string">&#x27;raw&#x27;</span>] = obj[<span class="string">&#x27;results&#x27;</span>]</span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure><p>The <code>parse</code> method defines how the spider processes the response content after visiting a URL. There are multiple ways to handle this. If you want to follow Scrapy’s recommended approach, you can extract the necessary information from the response content and store it in an item, which will then be processed by the Item Pipeline. This way, the collected items will be packaged as items and enter the Item Pipeline for further processing and saving.</p><p>If you prefer not to use the Item Pipeline, you can directly handle the data within the <code>parse</code> method, such as creating a DataFrame and writing the content directly to a file. In this case, there is no need to go through the pipeline.</p><p>The choice of which approach to take depends on your specific task requirements.</p><h3 id="3-Process-Items"><a href="#3-Process-Items" class="headerlink" title="3. Process Items"></a>3. Process Items</h3><p>If you choose to use items, you also need to write processing logic in <code>demo/pipelines.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># useful for handling different item types with a single interface</span></span><br><span class="line"><span class="keyword">from</span> itemadapter <span class="keyword">import</span> ItemAdapter</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JsdemoPipeline</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.full = []</span><br><span class="line">        self.col_map = &#123;</span><br><span class="line">            <span class="string">&#x27;yf001&#x27;</span>: <span class="string">&#x27;Identification Number&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a000&#x27;</span>: <span class="string">&#x27;Status&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a104&#x27;</span>: <span class="string">&#x27;Publishing Unit&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a104name&#x27;</span>: <span class="string">&#x27;Publishing Unit Name&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a100&#x27;</span>: <span class="string">&#x27;Standard Number&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;yf100&#x27;</span>: <span class="string">&#x27;Other Standard Numbers&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a298&#x27;</span>: <span class="string">&#x27;Chinese Title (For Reference)&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a301&#x27;</span>: <span class="string">&#x27;Original Title&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a826&#x27;</span>: <span class="string">&#x27;ICS Classification Number&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;a101&#x27;</span>: <span class="string">&#x27;Publication Date&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        self.file = <span class="built_in">open</span>(<span class="string">&#x27;items.jl&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        self.full.extend(item[<span class="string">&#x27;raw&#x27;</span>])</span><br><span class="line">        line = json.dumps(item[<span class="string">&#x27;raw&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">        self.file.write(line)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;#########run##########&quot;</span>)</span><br><span class="line">        df = DataFrame(self.full)[self.col_map.keys()].rename(columns=self.col_map)</span><br><span class="line">        df.to_csv(<span class="string">&#x27;full.data.csv&#x27;</span>, index=<span class="number">0</span>)</span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>The <code>open_spider</code> method is executed when the spider starts. It typically opens a file for writing or connects to a database for initialization.</li><li>The <code>process_item</code> part defines how each item returned by the spider should be processed. In this case, I store the original JSON string in a file and replace keys to create a dictionary.</li><li>The <code>close_spider</code> method is executed when the spider has finished collecting all information. Here, I convert the dictionary into a DataFrame and write it to a file, closing the file handle.</li></ul><h3 id="4-Other-Settings"><a href="#4-Other-Settings" class="headerlink" title="4. Other Settings"></a>4. Other Settings</h3><p>If you need to change request headers, set up proxies, or configure access intervals to prevent IP bans, you can modify the <code>demo/settings.py</code> file accordingly.</p><h3 id="5-Run-the-Spider"><a href="#5-Run-the-Spider" class="headerlink" title="5. Run the Spider"></a>5. Run the Spider</h3><p>This is the simplest part. Navigate to the project directory and run <code>scrapy crawl demo</code>. You can then observe the running status; logs will be printed directly on the screen, allowing for debugging based on the logs.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>That’s it for the basic usage. In summary, we need to define what website the spider should crawl, and in the <code>parse</code> method, we specify how to parse the content of the request response.</p><h2 id="Extension"><a href="#Extension" class="headerlink" title="Extension"></a>Extension</h2><p>The case study I recorded has a prerequisite that the responses obtained through simple GET or POST requests contain the data we want to retrieve. However, with the development of web technologies, more and more websites are no longer static HTML sites; most websites now have some content loaded via JavaScript, or even entire pages rendered by frameworks like React or Vue. In such cases, simple requests cannot fetch the desired data.</p><p>I will record this in a future post.</p><p>That’s it~</p>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scrapy </tag>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DingTalk for Linux Just Works Now</title>
      <link href="/en/2022/02/22/%E9%92%89%E9%92%89Linux%E7%89%88%E8%83%BD%E6%AD%A3%E5%B8%B8%E7%94%A8%E4%BA%86/"/>
      <url>/en/2022/02/22/%E9%92%89%E9%92%89Linux%E7%89%88%E8%83%BD%E6%AD%A3%E5%B8%B8%E7%94%A8%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>Although DingTalk is somewhat of a tool that exploits people, it’s still necessary for work. It’s already better to have one less annoyance choice (speaking of which, Tencent). After all, being exploited is bad enough, but being both exploited and annoyed… being able to eliminate one annoyance is already an improvement.</p><span id="more"></span><p>Thanks to <a href="https://aur.archlinux.org/packages/dingtalk-bin">FlyInWind</a> on AUR providing the solution, the Linux version of DingTalk can now be used normally on Arch-based systems. Currently, all components I need are working fine (chat, approval in the workbench, documents, project management, online document analysis). Video conferencing should be tried this week; if it also works… then everything will be perfect.</p><p>Currently, the developers have likely incorporated FlyInWind’s solution directly into the build files. The DingTalk installed via AUR automatically deletes <code>libgtk-x11-2.0.so</code> and other two files. As long as you add the following code to the startup script according to dbh625’s instructions, it will work perfectly.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> XMODIFIERS=<span class="string">&quot;@im=fcitx&quot;</span></span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=<span class="string">&quot;fcitx&quot;</span></span><br><span class="line"><span class="built_in">export</span> QT_QPA_PLATFORM=xcb</span><br></pre></td></tr></table></figure><p>Looking forward to the day when all commonly used software has a fully functional Linux version.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DingTalk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Graphviz配合draw.io使用</title>
      <link href="/en/2021/10/20/Graphviz%E9%85%8D%E5%90%88draw-io%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2021/10/20/Graphviz%E9%85%8D%E5%90%88draw-io%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Since I learned Graphviz, I often use it to create flowcharts or simple diagrams. Most of the time, using it is quite convenient because the flowcharts are small and only used for illustration, not for display. However, when the flowchart is complex and there’s a need for both beautification and presentation, it becomes more troublesome.</p><p>Therefore, I found an alternative approach: first use Graphviz to create the rough sketch, then use <a href="https://github.com/hbmartin/graphviz2drawio">graphviz2drawio</a> to convert the written Graphviz into a format that can be imported into <a href="https://github.com/jgraph/drawio">drawio</a> for manual arrangement.</p><p>In practice, this solution isn’t particularly convenient either… The flowchart framework is there after import, but the original shapes from Graphviz (like circles and squares) are not retained. Additionally, some objects in Graphviz do not exist in drawio, so using Graphviz to create sketches can only retain basic skeletons; a lot of adjustments are still needed. Therefore, in the future, either learn another language for using drawio or find another similar tool that can import Graphviz and further edit it.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> graphviz </tag>
            
            <tag> drawio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Metroid</title>
      <link href="/en/2021/10/18/%E5%AF%86%E7%89%B9%E7%BD%97%E5%BE%B7/"/>
      <url>/en/2021/10/18/%E5%AF%86%E7%89%B9%E7%BD%97%E5%BE%B7/</url>
      
        <content type="html"><![CDATA[<p>For me, Metroid is a very magical game. Although I know it’s one of the pioneers of the Metroidvania genre, I only played Castlevania when I was young and didn’t have much interest in this series…</p><p><img src="https://image.gcores.com/f3d38742-2986-468a-af44-5956200993f7.jpg?x-oss-process=image/resize,limit_1,m_lfit,w_1250/quality,q_90" class="lazyload" data-srcset="https://image.gcores.com/f3d38742-2986-468a-af44-5956200993f7.jpg?x-oss-process=image/resize,limit_1,m_lfit,w_1250/quality,q_90" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><!-- Summary part --><span id="more"></span><p>Until the early 2020s when I was in Guangzhou for two weeks due to the COVID-19 pandemic. My laptop had no games to play, so I only brought my 3DS home and didn’t know what to play. That’s when I tried Samus Returns on the 3DS. At first, I didn’t find it particularly interesting because I’ve played this type of game before, and playing action games on the 3DS is quite tiring…</p><p>But what makes Metroid so magical is that even though I don’t think it’s very fun, I couldn’t help but… beat it all the way through… This is similar to The Legend of Zelda: A Link Between Worlds on 3DS. Both are not games I particularly want to continue playing, but once I start playing them, I… just beat them all the way through…</p><p>What made me re-evaluate this series again was when I started playing Bloodstained… Bloodstained is a classic combination of Castlevania: Symphony of the Night and Aria of Sorrow, and everyone called it a spiritual sequel to Castlevania. But after actually playing it, I realized that I didn’t like Bloodstained as much as I liked Aria of Sorrow. Apart from its poor disk reading performance on the Switch, I clearly felt that Bloodstained had heavier RPG elements and more combat compared to other games in the series. At the same time, I also found that compared to combat… I actually prefer the exploration part of these games…</p><p>So I bought Metroid Dread (生存恐惧) at the original price… After spending a week beating it, I felt that its experience was much better for me than Bloodstained…</p><p>I hope there will be a sequel to Metroid in the future…</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gaming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Great Ace Attorney 2, Exciting but Leaving You Speechless</title>
      <link href="/en/2021/10/17/%E5%A4%A7%E9%80%86%E8%BD%AC%E8%A3%81%E5%88%A42/"/>
      <url>/en/2021/10/17/%E5%A4%A7%E9%80%86%E8%BD%AC%E8%A3%81%E5%88%A42/</url>
      
        <content type="html"><![CDATA[<p>During the Mid-Autumn Festival, I didn’t want to work overtime and finished the last two cases of The Great Ace Attorney 2 in one go. The script is not inferior to the Phoenix Wright trilogy, and the second-to-last case, “Future Science and the Return of Souls,” left a deeper impression on me…</p><img src="http://static.dianwannan.com/static/allimg/191130/7-191130144042624.jpg" class="lazyload" data-srcset="http://static.dianwannan.com/static/allimg/191130/7-191130144042624.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" width="50%" height="50%"><!-- Summary --><span id="more"></span><p>This case involves two researchers. One of them, during his student days, stole corpses to sell to the university’s medical school for survival and research funding… The other researcher firmly believed in his theory but lacked funding to verify it, and was exploited by a businessman with ulterior motives to defraud government research grants.</p><p>What impressed me were two points:</p><ul><li>Students stealing corpses for medical research, even being instructed by teachers to do so, is indeed something that occurred in the history of medicine. The production team researched this and incorporated it into the story, which was quite thoughtful.</li><li>The experiences of the two researchers were completely different, but they both reflected a problem: young researchers need not only talent but also resources or large amounts of money for scientific research. This contradiction still exists today… I wonder where the production team got their inspiration to write such a story with some social commentary.</li></ul><p>Although I personally think that The Great Ace Attorney’s script is as brilliant as the Phoenix Wright trilogy, when considering its deeper meaning… The Great Ace Attorney seems more profound and darker. The Phoenix Wright trilogy contains many unrealistic elements, such as trials involving parrots and telephones, along with various exaggerated characters, making it fun to play without any issues.</p><p>The Great Ace Attorney is very different. While I think the last case’s plot was somewhat disconnected… the rest of the cases felt more like solving real mysteries: the diplomatic dilemma in the case related to the British Assassin, the challenges faced by international students like Natsume Soseki, the difficulties faced by young researchers, and the emphasis on evidence, especially physical evidence, in court. All these elements make The Great Ace Attorney feel more like solving real cases rather than a carefully designed courtroom debate game.</p><p>I hope there will be a sequel!</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gaming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh no longer supports rsa by default</title>
      <link href="/en/2021/10/11/ssh%E9%BB%98%E8%AE%A4%E4%B8%8D%E6%94%AF%E6%8C%81rsa%E4%BA%86/"/>
      <url>/en/2021/10/11/ssh%E9%BB%98%E8%AE%A4%E4%B8%8D%E6%94%AF%E6%8C%81rsa%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>Today, after upgrading Manjaro, the most basic ssh login suddenly had issues, and the prompts were as follows:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unable to negotiate with UNKNOWN port 65535: no matching host key <span class="built_in">type</span> found. Their offer: ssh-rsa,ssh-dss</span><br><span class="line">lost connection</span><br><span class="line"></span><br><span class="line">sign_and_send_pubkey: no mutual signature supported</span><br></pre></td></tr></table></figure><p>Upon investigation, I found out…well, <a href="https://www.openssh.com/releasenotes.html">OpenSSH deems the ssh-rsa encryption method insecure and has directly disabled this key type for logins by default starting from 8.8</a>…</p><!-- 摘要部分 --><span id="more"></span><p>I initially thought that Manjaro lags behind Arch by several versions, so I went to the Archwiki for a solution, but it wasn’t mentioned yet… After searching for half an hour, I founded that I could add the following lines in ~&#x2F;.ssh&#x2F;config to resolve the issue:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    PubkeyAcceptedKeyTypes +ssh-rsa</span><br><span class="line">    HostKeyAlgorithms +ssh-rsa</span><br></pre></td></tr></table></figure><p>The first line means it applies to all hosts, the second line adds <code>ssh-rsa</code> back into the allowed use range, and the third line specifies that all hosts should use the <code>ssh-rsa</code> algorithm’s key.<br>Through actual testing, both lines are required; without the second line, it prompts that there is no <code>ssh-rsa</code> type, and without the third line, it prompts <code>sign_and_send_pubkey: no mutual signature supported</code>.</p><p>That’s all~</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> openssh </tag>
            
            <tag> manjaro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Building a Task Monitoring Web App with Dash and Flask</title>
      <link href="/en/2021/06/21/%E5%9F%BA%E4%BA%8Edash%E4%B8%8Eflask%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E7%9B%91%E6%8E%A7web-app/"/>
      <url>/en/2021/06/21/%E5%9F%BA%E4%BA%8Edash%E4%B8%8Eflask%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E4%BB%BB%E5%8A%A1%E7%9B%91%E6%8E%A7web-app/</url>
      
        <content type="html"><![CDATA[<p>I’ve been extremely busy lately, with too much work to finish… so I haven’t had much motivation to write. However, this time I’ve applied what I’ve learned in the past six months to build my first web app with database operations, which is worth commemorating. Although I’m short on time, I’ll start with the text and add images later.</p><!-- Summary --><span id="more"></span><p>This app implements functionality similar to NCBI Blast, allowing users to submit analysis tasks through a web interface and monitor their status from a task list. The app provides a very basic analysis interface where users can select necessary input files and configuration files (previously logged into the database) to start the analysis task and track its progress from the monitoring bar. Although this web interface is not intended for end-users, it serves as a demo for front-end IT communication and will be used by me for testing in the future. The real utility lies in the built-in Web API, which responds to frontend requests to perform actual business tasks.</p><h2 id="Module-Introduction"><a href="#Module-Introduction" class="headerlink" title="Module Introduction"></a>Module Introduction</h2><p>Although the app’s functionality is basic, it involves several components and took considerable time to implement. This post focuses on problem-solving during the implementation process and will cover basic operations of new modules (like Dash and Python MongoDB operations) in future posts.</p><h3 id="Web-API"><a href="#Web-API" class="headerlink" title="Web API"></a>Web API</h3><p>The API is built using Flask because it is described as lightweight and simple compared to Django. Since we are not building a large, high-concurrency, high-computation API, I believe Flask is simpler for our needs.</p><h3 id="Web-Interface"><a href="#Web-Interface" class="headerlink" title="Web Interface"></a>Web Interface</h3><p>The web interface is built using Dash, which is similar to Shiny in R. However, there seems to be little presence of Dash in the Chinese bioinformatics community, with most materials being English machine translations. While English materials are also limited, they mainly rely on official documentation and Q&amp;A. Since I am now primarily using Python, using a Python-based tool like Dash is simpler than mixing it with R. Additionally, although my app is simple, it is several orders of magnitude more complex than the bioinformatics scripts I used to write. Therefore, Python’s error tracking is incredibly helpful, saving me a lot of time during debugging.</p><p>Another point worth mentioning is that Dash evolved from the Plotly plotting package and provides web apps built on Flask. This makes Dash + Flask an excellent combination for my current application scenario because I can write both Dash functions and Flask functions in one main program file, reducing redundancy while ensuring consistency between what I test and demonstrate and what colleagues obtain through the API.</p><h3 id="Task-Control"><a href="#Task-Control" class="headerlink" title="Task Control"></a>Task Control</h3><p>Task control is based on Snakemake. While I won’t go into detail here, after using it for a long time, I have a better understanding of the statement “Snakemake is Python code” in its documentation. This feature allows me to implement custom functionalities not currently available in Snakemake by writing my own functions within Snakemake. For example, automatic task status updates in this application.</p><h3 id="File-and-Task-Records-Database"><a href="#File-and-Task-Records-Database" class="headerlink" title="File and Task Records (Database)"></a>File and Task Records (Database)</h3><p>Task and file records are stored using MongoDB for data storage. If we were only building this app, we wouldn’t need any database; simple files or structured directories could suffice. Using a database was purely for practice, as I have other tasks that will require it later.</p><p>Choosing MongoDB over SQLite was also due to future work considerations, so I took the opportunity to practice with MongoDB now.</p><h3 id="API-Documentation"><a href="#API-Documentation" class="headerlink" title="API Documentation"></a>API Documentation</h3><p>API documentation was not initially part of the app’s planning. Recently, I’ve built many simple web services for internal analysis systems, and maintaining separate documents for each API is inconvenient. Additionally, different APIs might be assigned to different people, making a single comprehensive document difficult to maintain. Therefore, I considered whether there was a way to generate API documentation directly within a single Web-App. After some research, I chose <code>flasgger</code>, which introduces a series of APIs into Flask, allowing authors to write API documentation directly in Python code. The generated documentation can be accessed via Swagger UI directly from the app path.</p><h2 id="App-Overview"><a href="#App-Overview" class="headerlink" title="App Overview"></a>App Overview</h2><p>This app’s logic is quite simple: it accepts requests from the frontend, forwards them to the backend to start analysis processes, and updates task statuses in the database during process execution. The frontend then retrieves the program run status either periodically or based on requests. A rough information flow diagram is shown below.</p><p><img src="/en/" class="lazyload" data-srcset="/en/" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Here I&#39;ve skipped a picture"></p><h2 id="Implementation-Highlights"><a href="#Implementation-Highlights" class="headerlink" title="Implementation Highlights"></a>Implementation Highlights</h2><p>Although this app is simple, there are issues that need additional solutions during implementation:</p><ol><li>Ensuring consistency between Dash-App and Flask-API processing, meaning that after testing with Dash-App, no additional changes are needed for the Flask-API part.</li><li>Mixing Dash-App&#x2F;Flask-App&#x2F;API documentation within a single App, rather than building multiple Web-Apps and redirecting between them.</li><li>Utilizing Snakemake to control processes and update their status in the database without setting up a separate monitoring process.</li></ol><h3 id="Consistency-Between-Dash-App-and-Flask-API-Processing"><a href="#Consistency-Between-Dash-App-and-Flask-API-Processing" class="headerlink" title="Consistency Between Dash-App and Flask-API Processing"></a>Consistency Between Dash-App and Flask-API Processing</h3><p>This is relatively easy to implement… by separating actual business processing functions from Dash and Flask functions, meaning that both Dash and Flask response functions format data into a unified format before passing it to an actual business function. The processed data is then reformatted for Dash or API-specified formats:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.callback(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    Output(<span class="params"><span class="string">&#x27;info-div&#x27;</span>, <span class="string">&#x27;children&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ],</span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    Input(<span class="params"><span class="string">&#x27;upload-info&#x27;</span>, <span class="string">&#x27;contents&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ],</span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    State(<span class="params"><span class="string">&#x27;upload-info&#x27;</span>, <span class="string">&#x27;filename&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ]</span></span></span><br><span class="line"><span class="params"><span class="meta">            </span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2_dash</span>(<span class="params">content, filename</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Dash response function</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># Need to parse target path from file</span></span><br><span class="line">    <span class="keyword">if</span> content:</span><br><span class="line">        _, content_stream = content.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        info_data = step2(content_stream, filename)</span><br><span class="line">        json_fmt = dumps(info_data, sort_keys=<span class="literal">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;:&quot;</span>), ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> [html.Pre(<span class="string">f&#x27;Parsing successful, extracted information from the information table:\n<span class="subst">&#123;json_fmt&#125;</span>&#x27;</span>)]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> [html.Pre(<span class="string">&#x27;No parsing result&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.server.route(<span class="params"><span class="string">&#x27;/step2&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2_flask</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Flask response function</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">     data = loads(flask.request.form.get(<span class="string">&#x27;data&#x27;</span>))</span><br><span class="line">     fileUrl = <span class="string">f&#x27;<span class="subst">&#123;data[<span class="string">&quot;dowloadFileUrl&quot;</span>]&#125;</span>?type=<span class="subst">&#123;data[<span class="string">&quot;type&quot;</span>]&#125;</span>&amp;fileName=<span class="subst">&#123;data[<span class="string">&quot;fileName&quot;</span>]&#125;</span>&#x27;</span></span><br><span class="line">     filename = re.findall(<span class="string">r&#x27;fileName=(.+)&#x27;</span>, fileUrl)[<span class="number">0</span>]</span><br><span class="line">     r = requests.get(fileUrl)</span><br><span class="line">     info_data = step2(r.content, filename, decode=<span class="literal">False</span>)</span><br><span class="line">     res_data = &#123;<span class="string">&#x27;errCode&#x27;</span>:<span class="number">0</span>, <span class="string">&#x27;data&#x27;</span>: info_data, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">    json_fmt = dumps(res_data, sort_keys=<span class="literal">True</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> json_fmt.encode(encoding=<span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2</span>(<span class="params">content_stream, filename, decode=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Actual processing part of step2, split to receive different requests</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> decode:</span><br><span class="line">        decoded = base64.b64decode(content_stream)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        decoded = content_stream</span><br><span class="line">    info_data = data_format(decoded, filename)</span><br><span class="line">    <span class="keyword">return</span> info_data</span><br></pre></td></tr></table></figure><h3 id="Mixing-Dash-App-Flask-App-API-Documentation"><a href="#Mixing-Dash-App-Flask-App-API-Documentation" class="headerlink" title="Mixing Dash-App&#x2F;Flask-App&#x2F;API Documentation"></a>Mixing Dash-App&#x2F;Flask-App&#x2F;API Documentation</h3><p>Mixing Flask and API documentation is relatively simple because Flasgger is essentially a Flask + API documentation combination. Mixing Dash with Flask is also not difficult; the Dash object has a <code>server</code> attribute that stores the Flask App object, so any part that needs to use this object can directly use <code>app.server</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dash</span><br><span class="line"></span><br><span class="line">app = dash.Dash(<span class="string">&quot;Demo&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.server.config[<span class="string">&#x27;SWAGGER&#x27;</span>] = &#123;</span><br><span class="line">    <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Mass Spectrometry Information Entry/Report Generation Service Documentation&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;uiversion&#x27;</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">swagger = Swagger(app.server)</span><br><span class="line"></span><br><span class="line">app.layout = html.Div(</span><br><span class="line">    [</span><br><span class="line">        html.H1(<span class="string">&#x27;Demo&#x27;</span>),</span><br><span class="line">        html.Div([</span><br><span class="line">            dcc.Upload(</span><br><span class="line">                <span class="built_in">id</span>=<span class="string">&#x27;upload-info&#x27;</span>,</span><br><span class="line">                children=html.Div([</span><br><span class="line">                    <span class="string">&#x27;Upload here&#x27;</span>,</span><br><span class="line">                ]),</span><br><span class="line">            ),</span><br><span class="line">            html.Div([</span><br><span class="line">                html.Pre(<span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            ], <span class="built_in">id</span>=<span class="string">&#x27;info-div&#x27;</span>)</span><br><span class="line">        ])</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.callback(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    Output(<span class="params"><span class="string">&#x27;info-div&#x27;</span>, <span class="string">&#x27;children&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ],</span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    Input(<span class="params"><span class="string">&#x27;upload-info&#x27;</span>, <span class="string">&#x27;contents&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ],</span></span></span><br><span class="line"><span class="params"><span class="meta">                [</span></span></span><br><span class="line"><span class="params"><span class="meta">                    State(<span class="params"><span class="string">&#x27;upload-info&#x27;</span>, <span class="string">&#x27;filename&#x27;</span></span>)</span></span></span><br><span class="line"><span class="params"><span class="meta">                ]</span></span></span><br><span class="line"><span class="params"><span class="meta">            </span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2_dash</span>(<span class="params">content, filename</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Dash response function</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> [html.Pre(<span class="string">&#x27;parsed&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.server.route(<span class="params"><span class="string">&#x27;/step2&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2_flask</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Flask response function</span></span><br><span class="line"><span class="string">    ---</span></span><br><span class="line"><span class="string">    tags:</span></span><br><span class="line"><span class="string">        - Step2</span></span><br><span class="line"><span class="string">    parameters:</span></span><br><span class="line"><span class="string">        - name: dowloadFileUrl</span></span><br><span class="line"><span class="string">          in: query</span></span><br><span class="line"><span class="string">          type: string</span></span><br><span class="line"><span class="string">          required: true</span></span><br><span class="line"><span class="string">          description: File download URL</span></span><br><span class="line"><span class="string">    responses:</span></span><br><span class="line"><span class="string">        200:</span></span><br><span class="line"><span class="string">            description: Returns parsed data</span></span><br><span class="line"><span class="string">            schema:</span></span><br><span class="line"><span class="string">                properties:</span></span><br><span class="line"><span class="string">                    errorCode:</span></span><br><span class="line"><span class="string">                        type: number</span></span><br><span class="line"><span class="string">                        description: Status code</span></span><br><span class="line"><span class="string">                        default: 0</span></span><br><span class="line"><span class="string">                    data:</span></span><br><span class="line"><span class="string">                        type: string</span></span><br><span class="line"><span class="string">                        description: Task submission key</span></span><br><span class="line"><span class="string">                        default: parsed</span></span><br><span class="line"><span class="string">                    msg:</span></span><br><span class="line"><span class="string">                        type: string</span></span><br><span class="line"><span class="string">                        description: Empty string when normal, error message if status code is not 0</span></span><br><span class="line"><span class="string">                        default: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;parsed&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Utilizing-Snakemake-to-Control-Processes-and-Update-Status"><a href="#Utilizing-Snakemake-to-Control-Processes-and-Update-Status" class="headerlink" title="Utilizing Snakemake to Control Processes and Update Status"></a>Utilizing Snakemake to Control Processes and Update Status</h3><p>Initially, I considered using Snakemake’s built-in <code>onstart</code> and <code>onerror</code> features to implement this, as I essentially needed task start and end information submitted to the database. However, after actual implementation, I found that these features are effective for the entire Snakefile, executing once at the start of the total task and once when it fails, without providing responses for individual tasks. Therefore, I had to do it myself…</p><p>At this point, we can leverage the “Snakemake is Python code” feature. When specifying the <code>shell</code> keyword in a rule, it actually calls Snakemake’s internal API <code>shell</code> function to execute system-level commands, so writing <code>run: shell(&#39;BASH_SCRIPT&#39;)</code> is essentially the same (there are some minor differences in program behavior that we can ignore). However, by using this approach, we can add additional Python code before and after the system command to implement our desired functionality, such as updating task status before and after execution:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rule step1:</span><br><span class="line">    input:</span><br><span class="line">        done = &#x27;&#123;rid&#125;/analysis.done&#x27;</span><br><span class="line">    output:</span><br><span class="line">        txt = &#x27;&#123;rid&#125;/done.txt&#x27;,</span><br><span class="line">    run:</span><br><span class="line">        # update_status is the function to update status, rid is the task ID</span><br><span class="line">        update_status(rid, &#x27;step1&#x27;, &#x27;running&#x27;)</span><br><span class="line">        shell(</span><br><span class="line">            &#x27;&#x27;&#x27;</span><br><span class="line">            cp &#123;input.done&#125; &#123;output.txt&#125;</span><br><span class="line">            &#x27;&#x27;&#x27;</span><br><span class="line">        )</span><br><span class="line">        update_status(rid, &#x27;step1&#x27;, &#x27;done&#x27;)</span><br></pre></td></tr></table></figure><p>This conveniently achieves our goal. Additionally, for error handling, we don’t need to do this because the error status in this application does not require granularity down to individual rules; <code>onerror</code> is sufficient.</p><p>However, one thing to note is that Snakemake actually supports a service called papernote, which specifically collects task statuses from the main control flow. This means Snakemake has something similar built-in, but we would need to read the relevant code to understand how it works and whether there are better internal APIs available.</p><h2 id="Follow-up"><a href="#Follow-up" class="headerlink" title="Follow-up"></a>Follow-up</h2><p>Last year, I interviewed a bioinformatics engineer who was unable to return to the company during the pandemic. He learned coding at home and built an analysis submission&#x2F;monitoring service. Now that I’ve also done it… looking back, it’s not difficult, but it requires time and external motivation to push me to learn. Additionally, practice is important; only through practice can we discover actual problems and solve them, thereby improving our skills. I need to keep working hard…</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dash </tag>
            
            <tag> python </tag>
            
            <tag> flask </tag>
            
            <tag> mongoDB </tag>
            
            <tag> pymongo </tag>
            
            <tag> flasgger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flashing Mokee ROM on My Nuts Pro</title>
      <link href="/en/2021/02/12/%E5%88%B7%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9CPro%E9%AD%94%E8%B6%A3/"/>
      <url>/en/2021/02/12/%E5%88%B7%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9CPro%E9%AD%94%E8%B6%A3/</url>
      
        <content type="html"><![CDATA[<p>I’ve been using my Nuts Pro for over three years, and everything is slow, and the storage is always running out. It’s time to make a final effort… Desperate times call for desperate measures, so I’m going to try flashing it. If it works well, I can keep using it for another year and a half. If not, I’ll have to buy a new one with my end-of-year bonus.</p><!-- Summary --><span id="more"></span><h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>Talking about the last time I flashed my phone, that was a long time ago… Back then, Android phones were just starting to become popular, and people liked playing with different custom ROMs. Now, unless you have a special need or can’t stand your original system anymore, most people probably don’t flash their phones anymore. Flashing has also become more complicated now… At least my phone needs a specific cable. Of course, I’m grateful to those who are compiling and maintaining the ROM for this device. So, here’s what you’ll need:</p><ol><li>A 9008 flashing cable (available on Taobao for 10 yuan)</li><li><a href="#">INVALID POST SLUG PROVIDED </a></li><li>Tool for flashing TWRP (<code>QPST</code> for Windows, <code>qdl</code> for Linux, install with <code>yay -S qdl</code>, it’s an AUR package)</li><li>The corresponding <a href="https://download.mokeedev.com/odin.html">base package</a> and <a href="https://download.mokeedev.com/odin.html">system package</a> for Nuts Pro (<code>RADIO-odin*</code> and <code>MK90.0-odin*</code>)</li></ol><h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><p>The steps are basically following the developer’s <a href="https://bbs.mokeedev.com/t/topic/14503">tutorial</a>, but since I’m not a Windows user, the flashing tool is different (although I tried both, and the Windows tool didn’t work for me, it only confirmed that my phone was in 9008 mode). Also, because of the inconsistency between the cable I bought and what’s mentioned in the tutorial, the actual way to enter 9008 mode is not consistent with the tutorial (the button on my cable stays pressed when you press it once, and then pops back when you press it again).</p><p>As for backing up files before flashing… I only backed up my WeChat chat records. The rest can be ignored… After all, I haven’t been making phone calls or sending text messages in a long time… Also, my phone was updated to the latest official system before flashing, and there had never been any previous flashing.</p><h3 id="Put-base-package-and-system-package-on-SD-card"><a href="#Put-base-package-and-system-package-on-SD-card" class="headerlink" title="Put base package and system package on SD card"></a>Put base package and system package on SD card</h3><p>My phone has a 32GB SD card. I put both the base package and the system package directly on the SD card. It should be possible to put them in internal storage as well, since I saw an option during the flashing process. However, since I haven’t tried it yet, I’m not sure.</p><h3 id="Run-qdl-on-your-computer-and-wait-for-the-phone-to-connect"><a href="#Run-qdl-on-your-computer-and-wait-for-the-phone-to-connect" class="headerlink" title="Run qdl on your computer and wait for the phone to connect"></a>Run qdl on your computer and wait for the phone to connect</h3><p>Download TWRP, install <code>qdl</code>, unzip it, enter the unzipped directory, and run the following command until you see <code>Waiting for QDL tty...</code>. If it fails, try running it again.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qdl prog_emmc_firehose_8953_ddr.mbn rawprogram_unsparse.xml</span><br></pre></td></tr></table></figure><h3 id="Put-phone-in-9008-mode-and-start-flashing"><a href="#Put-phone-in-9008-mode-and-start-flashing" class="headerlink" title="Put phone in 9008 mode and start flashing"></a>Put phone in 9008 mode and start flashing</h3><ol><li>Long press the power button to shut down.</li><li>Connect the 9008 cable to your computer’s USB port.</li><li>Press the volume + and - buttons simultaneously.</li><li>Keep the 9008 cable button in an unpressed state, then insert it into the phone. The red light on the front left corner will briefly flash. When you see the red light, press the button immediately. After that, the phone’s light will keep flashing red, indicating that it has entered 9008 mode. You can release the volume key at this point.</li><li>If everything goes smoothly, you should see TWRP being flashed on your computer terminal. Wait for it to finish.</li></ol><h3 id="Flash-Mokee-ROM"><a href="#Flash-Mokee-ROM" class="headerlink" title="Flash Mokee ROM"></a>Flash Mokee ROM</h3><p>Follow the <a href="https://bbs.mokeedev.com/t/topic/14503">tutorial</a> completely. I did exactly what was written without doing anything extra… It took about 5-10 minutes. After that, restart and set up the system as needed.</p><h2 id="Short-term-experience-problems"><a href="#Short-term-experience-problems" class="headerlink" title="Short-term experience&#x2F;problems"></a>Short-term experience&#x2F;problems</h2><p>After using it for two days, I feel that it’s much smoother than the original system most of the time, but not as good as expected… It seems that the CPU can’t keep up with the performance demands of domestic apps. However, since apps can be moved to the SD card, it should be fine for another year. The problems I’ve encountered so far:</p><ol><li>When deleting fingerprints, you need to rename them first before deleting.</li><li>Processes are killed very aggressively. If you don’t operate for a while, non-background processes will definitely hang. Of course, this is what many comments say… It’s the result of domestic vendors not following Google’s requirements when developing apps… A common problem with Android-like systems using domestic apps.</li><li>Small lags still exist, especially when there are many Bilibili danmu.</li></ol><h2 id="Postscript"><a href="#Postscript" class="headerlink" title="Postscript"></a>Postscript</h2><p>After flashing, the system level is very smooth, but occasionally there are problems within commonly used apps… Then I suddenly thought about WeChat’s “evolution”… Hmm…</p><p>So I tried replacing old versions of the app… Well, that would be great. Watching videos on Bilibili no longer lags, and the startup speed of Alipay has visibly increased.</p><p>What can I say… I’ll write a list of historical app versions later…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> android </tag>
            
            <tag> phone </tag>
            
            <tag> Mokee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flashing Mokee on My Nutro Pro</title>
      <link href="/en/2021/02/12/%E7%BB%99%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9CPro%E5%88%B7%E9%AD%94%E8%B6%A3/"/>
      <url>/en/2021/02/12/%E7%BB%99%E6%88%91%E7%9A%84%E5%9D%9A%E6%9E%9CPro%E5%88%B7%E9%AD%94%E8%B6%A3/</url>
      
        <content type="html"><![CDATA[<p>I’ve had my Nutro Pro for over three years now, and it’s been slowing down significantly. The storage space is also running low, making it hard to use comfortably. So, I decided to give it one last shot by flashing a new ROM. If it works out well, I’ll continue using it for another year or so. Otherwise, I’ll have no choice but to buy a new phone with my end-of-year bonus.</p><h2 id="Tools-Needed"><a href="#Tools-Needed" class="headerlink" title="Tools Needed"></a>Tools Needed</h2><p>Speaking of the last time I flashed my phone, it was quite some time ago. Back then, custom ROMs were all the rage as people not only enjoyed their phones but also played around with different operating systems. Nowadays, unless you have a specific need or your original system is really slow and unresponsive, most people probably won’t consider flashing their phones. Flashing has become more complicated than it used to be; in fact, I needed a special cable for this task. Fortunately, there are people who compile and maintain ROMs for this device. Here’s what you’ll need:</p><ol><li>A 9008 flash cable (about 10 RMB on Taobao, with a button that stays pressed when clicked and releases when clicked again)</li><li><a href="https://download.mokeedev.com/odin.html">TWRP for Nutro Pro</a></li><li>Flashing tools (<code>QPST</code> for Windows, <code>qdl</code> for Linux; you can install <code>qdl</code> using <code>yay -S qdl</code>, which is an AUR package)</li><li>The base and system packages for Nutro Pro (you can find them at <a href="https://download.mokeedev.com/odin.html">MokeeDev</a>)</li></ol><h2 id="Flashing-Steps"><a href="#Flashing-Steps" class="headerlink" title="Flashing Steps"></a>Flashing Steps</h2><p>The flashing process follows the instructions provided by the developer, but since I’m not a Windows user, I used different tools than what was recommended. Additionally, due to inconsistencies between the cable I bought and the one mentioned in the tutorial, the actual method of entering 9008 mode was slightly different (the button on my cable stays pressed for a moment before releasing).</p><p>As for backing up files before flashing… I only backed up my WeChat chat records using the official WeChat backup feature. Other data can be left as is since I don’t use phone calls or SMS messages much anymore. My phone was already running the latest official system at the time of flashing, and I hadn’t performed any previous flashes.</p><h3 id="Place-Base-and-System-Packages-on-SD-Card"><a href="#Place-Base-and-System-Packages-on-SD-Card" class="headerlink" title="Place Base and System Packages on SD Card"></a>Place Base and System Packages on SD Card</h3><p>I have a 32GB SD card in my phone, so I placed both the base and system packages directly on it. It should be possible to place them on the internal storage as well since there’s an option during flashing, but I haven’t tried it yet.</p><h3 id="Run-qdl-on-Computer-and-Wait-for-Phone-Insertion"><a href="#Run-qdl-on-Computer-and-Wait-for-Phone-Insertion" class="headerlink" title="Run qdl on Computer and Wait for Phone Insertion"></a>Run qdl on Computer and Wait for Phone Insertion</h3><p>Download TWRP and install <code>qdl</code>. Extract the TWRP files and navigate to the extracted directory. Run the following command to see “Waiting for QDL tty…”:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qdl prog_emmc_firehose_8953_ddr.mbn rawprogram_unsparse.xml</span><br></pre></td></tr></table></figure><h3 id="Enter-9008-Mode-on-Phone-and-Start-Flashing"><a href="#Enter-9008-Mode-on-Phone-and-Start-Flashing" class="headerlink" title="Enter 9008 Mode on Phone and Start Flashing"></a>Enter 9008 Mode on Phone and Start Flashing</h3><ol><li>Long-press the power button to turn off the phone.</li><li>Connect the 9008 cable to the USB port of your computer.</li><li>Simultaneously press the volume up and down keys.</li><li>Keep the 9008 cable button unpressed while inserting it into the phone. The top-left indicator light on the front will briefly flash red; once you see this, immediately press the button. After that, the indicator light will keep flashing red, indicating that the phone is in 9008 mode. You can release your fingers from the volume keys at this point.</li><li>If everything goes smoothly, you should see the TWRP being flashed on your computer terminal. Wait for it to finish.</li></ol><h3 id="Flashing-Mokee"><a href="#Flashing-Mokee" class="headerlink" title="Flashing Mokee"></a>Flashing Mokee</h3><p>Follow the instructions provided by <a href="https://bbs.mokeedev.com/t/topic/14503">MokeeDev</a> as closely as possible. It took me about 5-10 minutes to complete the flashing process. After rebooting into the system and making necessary settings, you can start using it.</p><h2 id="Short-term-Usage-Experience-Minor-Issues"><a href="#Short-term-Usage-Experience-Minor-Issues" class="headerlink" title="Short-term Usage Experience&#x2F;Minor Issues"></a>Short-term Usage Experience&#x2F;Minor Issues</h2><p>I’ve been using it for two days so far, and I feel that it’s significantly more responsive than the original system, though not as good as expected. The system-level performance is excellent, but app performance still has some issues. It seems that the CPU can’t keep up with the performance demands of domestic apps. However, since apps can be moved to the SD card, it should last me another year without issues. The current problems I’ve encountered are:</p><ol><li>Deleting fingerprints requires renaming the fingerprint first before deletion.</li><li>Force stopping processes is very aggressive; if you don’t interact with the phone for a while, non-background processes will crash. Some comments suggest that this is due to domestic vendors not following Google’s requirements when developing apps, which is a common issue for apps similar to the original Android system.</li><li>Occasional small lags, especially when Bilibili has many弹幕.</li></ol><h2 id="Afterword"><a href="#Afterword" class="headerlink" title="Afterword"></a>Afterword</h2><p>The system-level performance after flashing is excellent, but there are still occasional issues within commonly used apps. Then I remembered the “evolution” process of WeChat…</p><p>So, I tried replacing it with an older version… It worked! Bilibili no longer lags, and the startup speed of Alipay is noticeably faster.</p><p>After realizing that newer versions of apps might be causing performance issues, I tried replacing them with older versions… It worked! Bilibili no longer lags, and the startup speed of Alipay is noticeably faster. This makes me think about how apps have evolved over time, often becoming more resource-intensive.</p><p>Well… what can I say… Here’s a list of historical versions of the app that might help others facing similar performance issues…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> android </tag>
            
            <tag> phone </tag>
            
            <tag> Mokee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Theme Upgrade</title>
      <link href="/en/2021/02/12/%E4%B8%BB%E9%A2%98%E5%8D%87%E7%BA%A7/"/>
      <url>/en/2021/02/12/%E4%B8%BB%E9%A2%98%E5%8D%87%E7%BA%A7/</url>
      
        <content type="html"><![CDATA[<p>2020 was too busy… In the middle of the year, I discovered that the material-x theme had been significantly upgraded, but I didn’t have time to update it. By the time 2021 arrived, I gave up on upgrading from the original theme and decided to start a new project based on the documentation.</p><h2 id="Hexo-Installation-and-Setup"><a href="#Hexo-Installation-and-Setup" class="headerlink" title="Hexo Installation and Setup"></a>Hexo Installation and Setup</h2><p>Turns out my new computer didn’t even have hexo installed… This was a good opportunity to test whether <code>hexo-cli</code> or <code>hexo</code> is necessary. After testing, I found that <code>hexo-cli</code> is sufficient:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S npm</span><br><span class="line">sudo npm install -g hexo-cli</span><br><span class="line"><span class="built_in">mkdir</span> neo_blog</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure><h2 id="Volantis-Theme-and-Other-Plugin-Installation"><a href="#Volantis-Theme-and-Other-Plugin-Installation" class="headerlink" title="Volantis Theme and Other Plugin Installation"></a>Volantis Theme and Other Plugin Installation</h2><p>The installation method for themes has also changed according to the official documentation. Now, it’s done using <code>npm</code>, rather than cloning the project into the <code>themes</code> directory of the blog project.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-theme-volantis</span><br><span class="line">npm i hexo-generator-search hexo-generator-json-content</span><br></pre></td></tr></table></figure><h2 id="Editing-Configuration-Files"><a href="#Editing-Configuration-Files" class="headerlink" title="Editing Configuration Files"></a>Editing Configuration Files</h2><p>The configuration files have also changed (apparently due to changes in hexo). The main change is that theme configurations are no longer recommended to be directly modified in <code>themes/yourTheme/_config.yml</code> or <code>node_modules/yourTheme/_config.yml</code>. Instead, create a <code>_config.yourTheme.yml</code> file at the same level as <code>_config.yml</code>, and write the configuration changes you need into this file. This way, the content of your file will overwrite the content in the theme configuration file (it feels like the JSON configuration files in VSCode). The documentation says that this approach has the benefit that when updating the theme, any configuration changes you make won’t be lost.</p><p>Of course, during actual use, I found that the color settings for the Volantis theme didn’t take effect after modifying <code>_config.yourTheme.yml</code> locally. In the end, I had to change the theme’s configuration file for it to work.</p><p>After making the necessary changes to the theme content, copy over the original <code>_config.yml</code>, and replace the entire directory with the new blog directory to deploy as usual.</p><h2 id="Adding-Documentation"><a href="#Adding-Documentation" class="headerlink" title="Adding Documentation"></a>Adding Documentation</h2><p>Additionally, this time I added documentation. The content hasn’t been updated… It was just a test to see if soft links could be used directly to upload generated documentation. After testing, it didn’t work. For now, I’m temporarily too lazy to learn how to update the blog while updating the documentation. I’ll do it manually for now and figure it out later…</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Installation and Usage of mSINGS</title>
      <link href="/en/2020/09/06/mSINGS%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2020/09/06/mSINGS%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>mSINGS is a software tool used to detect MSI (Microsatellite Instability). Its advantage seems to be that it can be used for tumor-only samples.</p><!-- Abstract section --><span id="more"></span><p><a href="https://bitbucket.org/uwlabmed/msings/src/master/">mSINGS</a> project is hosted on Bitbucket instead of GitHub, and the project has been continuously updated… However, the installation guide written by the author seems a bit too technical… And it also does not have an all-in-one installer, so following the documentation for installation can be a bit confusing…</p><p>The core of this project is written in Python, and its core functionality involves reading mpileup files generated by samtools for analysis. Therefore, the essential dependencies should be <code>Python3.6</code> and <code>samtools</code>. (The git is probably used to clone the project.) Since the author specifies the Python version, he recommends using a Python virtual environment (to prevent future explosions). However, since I am not familiar with <code>virtualenv</code>, I will use <code>miniconda</code> instead, which is easier to get started. In summary: creating an environment&#x2F;installing necessary dependencies -&gt; installing the module -&gt; testing.</p><ol><li>Creating an Environment&#x2F;Installing Necessary Dependencies</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -p /path/to/soft/mSINGS/conda python=3.6 git samtools</span><br></pre></td></tr></table></figure><ol start="2"><li>Installing the Module</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda activate /path/to/soft/mSINGS/conda           <span class="comment"># Enter the environment to install the module itself</span></span><br><span class="line">git <span class="built_in">clone</span> https://bitbucket.org/uwlabmed/msings.git <span class="comment"># Clone the project as recommended by the author</span></span><br><span class="line"><span class="built_in">cd</span> msings                                           <span class="comment"># Enter the directory</span></span><br><span class="line">python setup.py install                             <span class="comment"># Install the software itself</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Testing</li></ol><p>The author mentioned how to create a baseline (which should determine which MSI loci need scanning based on existing data). However, since I am just testing, I will use the files prepared by the project (<code>doc/</code> directory). Additionally, it’s important to note that the author clearly stated that the input BAM file needs to be aligned to a reference genome without <code>chr</code> strings (provided by GATK), so I found an FQ data for alignment. If the BAM file already meets the requirements, you can skip this step.</p><p>Another thing to note is that the author specifies in the script <code>run_msings.sh</code> that it activates the virtual environment. Since I did not follow his instructions, the line <code># source msings-env/bin/activate</code> in the script needs to be commented out.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not do sort, because mSINGS&#x27; analysis process includes sorting...</span></span><br><span class="line">/path/to/apps/bwa-0.7.12/bwa mem \</span><br><span class="line">    -R <span class="string">&#x27;@RG\tID:group1\tSM:TUMOR\tPL:illumina\tLB:lib1\tPU:unit1&#x27;</span> \</span><br><span class="line">    -M -t 16 \</span><br><span class="line">    /path/to/Human_Genome_GRCh37_FASTA/human_g1k_v37.fasta \</span><br><span class="line">    /path/to/soft/mSINGS/run_test/test.fq.R1.gz \</span><br><span class="line">    /path/to/soft/mSINGS/run_test/test.fq.R2.gz \</span><br><span class="line">| /usr/local/bin/samtools view \</span><br><span class="line">    -Sb - \</span><br><span class="line">&gt; test.bam</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test.bam&quot;</span> &gt; bam_list <span class="comment"># Because the script specified that a file with written BAM paths is required, I can only specify it like this</span></span><br><span class="line">sh /path/to/mSINGS/msings/scripts/run_msings.sh \</span><br><span class="line">    bam_list \</span><br><span class="line">    /path/to/mSINGS/msings/doc/mSINGS_TCGA.bed \</span><br><span class="line">    /path/to/mSINGS/msings/doc/mSINGS_TCGA.baseline \</span><br><span class="line">    /path/to/Human_Genome_GRCh37_FASTA/human_g1k_v37.fasta</span><br></pre></td></tr></table></figure><p>The final result will be in the <code>Combined_MSI.txt</code> file, which should contain the results of each BAM file combined together. Of course, I only tested with one BAM file, so I’m not sure what the structure of the merged results will look like…</p><p>I tested this sample with 1,166 target MSI loci, and 27 were detected as unstable, representing 2% instability, resulting in a MSS (Microsatellite Stable) status.</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Position        test</span><br><span class="line">unstable_loci   27</span><br><span class="line">passing_loci    1166</span><br><span class="line">msing_score     0.0232</span><br><span class="line">msi status      NEG</span><br></pre></td></tr></table></figure><p>Finally, let’s take a look at the author’s script <code>run_msings.sh</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="comment"># source msings-env/bin/activate</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BAM_LIST is a file of absolute paths to each bam file</span></span><br><span class="line">BAM_LIST=<span class="variable">$1</span>;</span><br><span class="line">BEDFILE=<span class="variable">$2</span>;</span><br><span class="line">MSI_BASELINE=<span class="variable">$3</span>;</span><br><span class="line">REF_GENOME=<span class="variable">$4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check for required variables:</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$BAM_LIST</span>&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;BAM_LIST is unset&quot;</span> &amp;&amp; <span class="built_in">exit</span> ; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;BAM_LIST is set to &#x27;<span class="variable">$BAM_LIST</span>&#x27;&quot;</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$BEDFILE</span>&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;BEDFILE is unset&quot;</span> &amp;&amp; <span class="built_in">exit</span> ; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;BEDFILE is set to &#x27;<span class="variable">$BEDFILE</span>&#x27;&quot;</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$MSI_BASELINE</span>&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;MSI_BASELINE is unset&quot;</span> &amp;&amp; <span class="built_in">exit</span> ; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;MSI_BASELINE is set to &#x27;<span class="variable">$MSI_BASELINE</span>&#x27;&quot;</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$REF_GENOME</span>&quot;</span> ]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;REF_GENOME is unset&quot;</span> &amp;&amp; <span class="built_in">exit</span> ; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">&quot;REF_GENOME is set to &#x27;<span class="variable">$REF_GENOME</span>&#x27;&quot;</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;multiplier&quot; is the number of standard deviations from the baseline required to call instability</span></span><br><span class="line">multiplier=2.0 </span><br><span class="line"><span class="comment"># &quot;msi_min_threshold&quot; is the maximum fraction of unstable sites allowed to call a specimen MSI negative     </span></span><br><span class="line">msi_min_threshold=0.2</span><br><span class="line"><span class="comment"># &quot;msi_max_threshold&quot; is the minimum fraction of unstable sites allowed to call a specimen MSI positive</span></span><br><span class="line">msi_max_threshold=0.2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> BAM <span class="keyword">in</span> `sed <span class="string">&#x27;/^$/d&#x27;</span> <span class="variable">$BAM_LIST</span>`; <span class="keyword">do</span></span><br><span class="line">    SAVEPATH=$(<span class="built_in">dirname</span> <span class="variable">$BAM</span>)</span><br><span class="line">    BAMNAME=$(<span class="built_in">basename</span> <span class="variable">$BAM</span>)</span><br><span class="line">    PFX=<span class="variable">$&#123;BAMNAME%.*&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> “Starting Analysis of <span class="variable">$PFX</span>” &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;sorting bam of <span class="variable">$PFX</span>&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    samtools <span class="built_in">sort</span> -o <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.sorted.bam <span class="variable">$BAM</span>  &amp;&amp; samtools index <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.sorted.bam</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Making mpileups&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    samtools mpileup -f <span class="variable">$REF_GENOME</span> -d 100000 -A -E  -l <span class="variable">$BEDFILE</span> <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.sorted.bam | awk <span class="string">&#x27;&#123;if($4 &gt;= 6) print $0&#125;&#x27;</span> &gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.mpileup </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MSI Analyzer start&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    </span><br><span class="line">    msi analyzer <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.mpileup <span class="variable">$BEDFILE</span> -o <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.msi.txt</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MSI calls start&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">     </span><br><span class="line">    msi count_msi_samples <span class="variable">$MSI_BASELINE</span> <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span> -m <span class="variable">$multiplier</span> -t <span class="variable">$msi_min_threshold</span> <span class="variable">$msi_max_threshold</span> -o <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/<span class="variable">$PFX</span>.MSI_Analysis.txt</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> “Completed Analysis of <span class="variable">$PFX</span>” &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line">    <span class="built_in">date</span> +<span class="string">&quot;%D %H:%M&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/<span class="variable">$PFX</span>/msi_run_log.txt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Creating summary analysis file for all samples&quot;</span> &gt;&gt; <span class="variable">$SAVEPATH</span>/msi_run_log.txt;</span><br><span class="line">msi count_msi_samples <span class="variable">$MSI_BASELINE</span> <span class="variable">$SAVEPATH</span> -m <span class="variable">$multiplier</span> -t <span class="variable">$msi_min_threshold</span> <span class="variable">$msi_max_threshold</span> -o <span class="variable">$SAVEPATH</span>/Combined_MSI.txt</span><br></pre></td></tr></table></figure><p>It looks a bit long, but the content is actually quite simple. The author also provided some basic comments. Essentially, it involves sorting each input BAM file and generating mpileup files, then using the <code>msi</code> program (which was installed by <code>python setup.py install</code>) for analysis and data aggregation.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mSINGS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flask Usage Record</title>
      <link href="/en/2020/08/09/Flask%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2020/08/09/Flask%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>Due to project requirements, I finally took the time to actually look into how to use Flask. Here’s a record of what I learned.</p><!-- Abstract part --><span id="more"></span><p>Since my task this time was relatively simple - just create a Flask server that can accept requests and call Python code to compute results - I only dealt with the most basic usage. Of course, since I’m not familiar with HTML and JavaScript, my understanding here is purely based on my own experience… it may contain many inaccuracies and misleading descriptions…</p><h2 id="Creating-a-Flask-Service-App"><a href="#Creating-a-Flask-Service-App" class="headerlink" title="Creating a Flask Service (App)"></a>Creating a Flask Service (App)</h2><p>All operations start with creating a Flask App. It’s quite simple - just instantiate the <code>Flask</code> object.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Save this as a Python file, and then run <code>python app.py</code> to start the service. Setting the <code>host</code> parameter to <code>&#39;0.0.0.0&#39;</code> allows all IPs to access this service.</p><h2 id="Binding-Requests-to-Functions"><a href="#Binding-Requests-to-Functions" class="headerlink" title="Binding Requests to Functions"></a>Binding Requests to Functions</h2><p>Flask can convert requests for pages into calls to Python functions. Specifically, use the <code>@app.route</code> decorator before the corresponding function. For <code>&#39;/&#39;</code>, it corresponds to <code>index.html</code>, and for something like <code>&#39;/login&#39;</code>, it corresponds to <code>login.html</code>. Of course, I found that the HTML files don’t necessarily need to exist; you can directly return HTML strings in the response.</p><p>I prepared a page explaining how to use the API, which I read in and returned as is.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br></pre></td></tr></table></figure><h2 id="Handling-POST-Requests"><a href="#Handling-POST-Requests" class="headerlink" title="Handling POST Requests"></a>Handling POST Requests</h2><p>For my program, I needed to receive some parameters and uploaded file contents for further processing. Since the file content can’t be sent via <code>GET</code>, I only handled <code>POST</code>.</p><p>Flask’s built-in <code>request</code> object makes it convenient to get all information from the request.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> iNeo_MS <span class="keyword">import</span> sheet_parse</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/parse&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>():</span><br><span class="line">    args = request.args</span><br><span class="line">    method = args[<span class="string">&#x27;method&#x27;</span>]</span><br><span class="line">    byteData = request.files.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    data = sheet_parse(BytesIO(byteData.read()), method)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(data.to_dict(<span class="string">&#x27;records&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="Testing-the-API-with-Python"><a href="#Testing-the-API-with-Python" class="headerlink" title="Testing the API with Python"></a>Testing the API with Python</h2><p>Testing a <code>POST</code> service can’t be done directly through a browser, so you need to install specialized plugins… but my home network is unstable… so I still rely on Python.</p><p>The specific method is using the <code>post</code> method from the <code>requests</code> module. Place the parameters in the <code>params</code> parameter and read the file content before sending it via the <code>files</code> parameter.</p><pre><code class="python">import requestsparams = &#123;    &#39;method&#39;: &#39;pNovo&#39;,&#125;with open(&quot;data/results.res&quot;, &quot;rb&quot;) as f:    content = f.read()files = &#123;    &quot;file&quot; :(&#39;result.res&#39;, content),&#125;response = requests.post(    &#39;http://127.0.0.1:5000/parse&#39;,    params=params,    files=files</code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo One-Time Multi-Repository Deployment</title>
      <link href="/en/2020/08/02/hexo%E4%B8%80%E6%AC%A1%E6%80%A7%E5%A4%9A%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/"/>
      <url>/en/2020/08/02/hexo%E4%B8%80%E6%AC%A1%E6%80%A7%E5%A4%9A%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>Recently, GitHub’s access has been increasingly problematic. Sometimes it’s even difficult to check my blog posts… So I also have a copy hosted on the domestic Git hosting service Gitee. However, this raises a question: how can I update multiple places at once?</p><p>Firstly, set up the repository on Gitee. The basic method is similar to GitHub. The only thing you need to note is that Gitee’s default project display is different from GitHub. GitHub uses <code>USERNAME.github.io</code>, while Gitee uses <code>USERNAME</code>.</p><p>Since Gitee has a feature to fork GitHub projects, when creating the project, choose to fork the original GitHub blog repository and then change the repository name to <code>USERNAME</code> (as shown in the example after migration… so it displays that the project has been created).</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/gitee_proj.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/gitee_proj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitee_proj"></p><p>Then, on the project page, select the service menu to set up access from <code>USERNAME.gitee.io</code> to view the blog.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/gitee_pages.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/gitee_pages.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitee_pages"></p><p>Next, set up SSH access to Gitee. This is similar to GitHub and won’t be expanded here.</p><p>Then, configure the <code>_config.yaml</code> file in the project. In the deployment section, add the following configuration so that you can deploy twice at once.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span></span><br><span class="line">      <span class="string">git@github.com:SilenWang/silenwang.github.io.git</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span></span><br><span class="line">      <span class="string">git@gitee.com:silenwang/silenwang.git</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>Originally, this should have been it… but when testing, another issue arose. My home network can no longer directly connect to GitHub, so the deployment to GitHub fails…</p><p>Therefore, I searched for ways to add a proxy to Git.</p><p>Since my configuration uses SSH protocol to connect to GitHub, after checking, it’s necessary to add a <code>ProxyCommand</code> setting in the SSH configuration file as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">    User git</span><br><span class="line">    HostName github.com</span><br><span class="line">    ProxyCommand nc -x 127.0.0.1:1080 %h %p</span><br></pre></td></tr></table></figure><p>After adding this, I tried <code>hexo d</code> again and it successfully deployed.</p><p>That’s all for now~</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> gitee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pandas Common Operations Record</title>
      <link href="/en/2020/07/26/pandas%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2020/07/26/pandas%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<!-- Abstract part --><span id="more"></span><p>As my current work requires a lot of data statistics and processing, and considering the convenience in error handling and third-party extensibility, Python is much more convenient than R. Therefore, I have started moving my data processing from R to Pandas. In this post, I will record some common operations used in actual work and note down any issues encountered.</p><h2 id="1-apply-Related"><a href="#1-apply-Related" class="headerlink" title="1. apply Related"></a>1. apply Related</h2><h3 id="1-1-Basic-Usage"><a href="#1-1-Basic-Usage" class="headerlink" title="1.1. Basic Usage"></a>1.1. Basic Usage</h3><p>Similar to Pandas and R, there is only one <code>apply</code> function, no <code>apply</code> family. The <code>apply</code> function essentially loops through the table row by row. Using <code>apply</code> instead of directly <code>itterrow</code> is mainly for parallel considerations. There are many third-party modules that can parallelize <code>apply</code> operations, so initially writing code in this way saves the trouble of rewriting functions later when parallelizing.</p><p>Of course, another point is to separate the main processing logic from detailed execution content, which to some extent improves code readability. However, personally, it’s more of a habit issue… If the person reading the code never writes like this… Then using <code>apply</code> actually increases the difficulty of reading the code for others…</p><p>Currently, my approach is generally to write the actual calculation part as a general function and then use an anonymous function to pass parameters when calling <code>apply</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">plus</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;applyed&#x27;</span>] = data[<span class="string">&#x27;2apply&#x27;</span>].apply(<span class="keyword">lambda</span> x: plus(x[<span class="string">&#x27;x&#x27;</span>], x[<span class="string">&#x27;y&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>Of course, if you need to perform many row-wise operations at the same time, it’s better to write a separate <code>func_apply()</code> function to prevent repeated traversal of the data.</p><h3 id="1-2-Returning-Multiple-Columns"><a href="#1-2-Returning-Multiple-Columns" class="headerlink" title="1.2. Returning Multiple Columns"></a>1.2. Returning Multiple Columns</h3><p>The conventional usage of <code>apply</code> is to return a numerical value to form one column of data. However, in actual applications, I often need to return multiple columns. Therefore, I found a solution online:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">plus</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y, x - y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;x+y&#x27;</span>], data[<span class="string">&#x27;x-y&#x27;</span>] = <span class="built_in">zip</span>(*data[<span class="string">&#x27;2apply&#x27;</span>].apply(<span class="keyword">lambda</span> x: plus(x[<span class="string">&#x27;x&#x27;</span>], x[<span class="string">&#x27;y&#x27;</span>])))</span><br></pre></td></tr></table></figure><h2 id="2-Groupby-Related"><a href="#2-Groupby-Related" class="headerlink" title="2. Groupby Related"></a>2. Groupby Related</h2><h3 id="2-1-Merging-Multiple-Rows-into-a-Single-Row-of-Data"><a href="#2-1-Merging-Multiple-Rows-into-a-Single-Row-of-Data" class="headerlink" title="2.1. Merging Multiple Rows into a Single Row of Data"></a>2.1. Merging Multiple Rows into a Single Row of Data</h3><p>This operation is mainly used to aggregate multiple rows of data into a single row result. I remember that R has a specific way to handle this, and Pandas should have it too… However, I couldn’t find it at the time, so I came up with my own solution. This method essentially retrieves data subsets based on the unit to be processed, performs statistics on these subsets, and generates new rows of data to fill in a new table. This approach currently seems inefficient, and because it uses a for loop, parallelization is not as simple as <code>apply</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, sub_data <span class="keyword">in</span> data.groupby(by=[<span class="string">&#x27;Grp1&#x27;</span>, <span class="string">&#x27;Grp2&#x27;</span>]):</span><br><span class="line">    grp1, grp2 = k</span><br><span class="line">    result_list.append(&#123;</span><br><span class="line">        <span class="string">&#x27;Stat1&#x27;</span>: <span class="built_in">sum</span>(sub_data[<span class="string">&#x27;Var1&#x27;</span>]),</span><br><span class="line">        <span class="string">&#x27;Stat2&#x27;</span>: <span class="built_in">min</span>(sub_data[<span class="string">&#x27;Var1&#x27;</span>]),</span><br><span class="line">    &#125;)</span><br><span class="line">result = pd.DataFrame(result_list)</span><br></pre></td></tr></table></figure><h2 id="3-Missing-Value-Handling-Related"><a href="#3-Missing-Value-Handling-Related" class="headerlink" title="3. Missing Value Handling Related"></a>3. Missing Value Handling Related</h2><h3 id="3-1-Missing-Values-on-Read"><a href="#3-1-Missing-Values-on-Read" class="headerlink" title="3.1. Missing Values on Read"></a>3.1. Missing Values on Read</h3><p>You can replace multiple values with missing ones using the <code>na_values</code> parameter:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_table(FILE, sep=<span class="string">&quot;\t&quot;</span>, header=<span class="number">0</span>, na_values=[<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="3-2-Missing-Values-on-Output"><a href="#3-2-Missing-Values-on-Output" class="headerlink" title="3.2. Missing Values on Output"></a>3.2. Missing Values on Output</h3><p>When outputting, you can specify what to fill in for missing values through parameters:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_csv(FILE, sep=<span class="string">&quot;\t&quot;</span>, header=<span class="number">0</span>, na_values=[<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="3-3-Determining-if-a-Value-is-Missing"><a href="#3-3-Determining-if-a-Value-is-Missing" class="headerlink" title="3.3. Determining if a Value is Missing"></a>3.3. Determining if a Value is Missing</h3><p>In Pandas, if a missing value is generated, it uses the <code>nan</code> object from NumPy, which is different from R’s <code>NA</code>, <code>NULL</code>, and Python’s built-in <code>None</code>. The type of <code>nan</code> is actually <code>float</code>… Therefore, using logical judgment like <code>A == nan</code> will not get <code>True</code> results… I haven’t found a reason for this. However, to determine if a value is missing, it’s best to use the <code>isnull</code> method provided by Pandas. Other modules like <code>math</code>, <code>numpy</code> have built-in missing value judgment functions, but these functions have a fatal flaw… They only accept parameters of type <code>float</code>… So if I use them, I still need to add an additional type judgment layer, which is quite troublesome. Therefore, using the <code>isnull</code> method provided by Pandas is the most convenient.</p><h2 id="4-Most-Common-Output-Parameters"><a href="#4-Most-Common-Output-Parameters" class="headerlink" title="4. Most Common Output Parameters"></a>4. Most Common Output Parameters</h2><p>Because I habitually output TSV files, when using Pandas to output files, I usually write it like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_csv(FILE_PATH, sep=<span class="string">&quot;\t&quot;</span>, index=<span class="number">0</span>, na_rep=<span class="string">&quot;.&quot;</span>)</span><br></pre></td></tr></table></figure><p>It’s worth noting that if the result table is a pivot table, there is a high probability of needing to output the <code>index</code>. In such cases, <code>index=0</code> should be removed.</p><h2 id="5-Other-Possible-Operations"><a href="#5-Other-Possible-Operations" class="headerlink" title="5. Other Possible Operations"></a>5. Other Possible Operations</h2><h3 id="5-1-Column-Type-Conversion"><a href="#5-1-Column-Type-Conversion" class="headerlink" title="5.1 Column Type Conversion"></a>5.1 Column Type Conversion</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.astype(&#123;<span class="string">&#x27;col1&#x27;</span>: <span class="string">&#x27;int32&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Monster Hunter World: Iceborne Completion Diary</title>
      <link href="/en/2020/02/23/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E5%86%B0%E5%8E%9F%E5%BC%80%E8%8D%92%E5%AE%8C%E7%BB%93%E7%BA%AA%E5%BF%B5/"/>
      <url>/en/2020/02/23/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E5%86%B0%E5%8E%9F%E5%BC%80%E8%8D%92%E5%AE%8C%E7%BB%93%E7%BA%AA%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<p>Originally planned to grind hard during the Spring Festival… but ended up working overtime most of the time, just finished the expansion now… And foreseeable busy work is coming… Taking advantage of not officially returning to work yet, leaving some memories here…</p><div class="bvideo"><a href="//www.bilibili.com/video/av91147423" target="_blank">        <div class="bvideo-box">            <div class="bvideo-cover">                <div class="cover-default"></div>                <div class="bvideo-cover-layer" style="background-image:url(https://images.weserv.nl/?url=http://i2.hdslb.com/bfs/archive/75098d6f5f4d2a82a795db645c54dabcbe5deb12.jpg)">                    <i class="icon-video"></i>                </div>                <span class="duration">01:14:04</span>            </div>            <div class="bvideo-info">                <p class="title">猛汉王狩猎日记-冰原开荒纪念-引导之歌</p>                <p class="card-status">                    <span class="play-num">                        <i class="fa fa-youtube-play"></i>                        <span>114</span></span>                    <span>                        <i class="fa fa-list-alt"></i>                        <span>0</span></span></p>                <div class="partition">                    <label class="card-label">视频</label>                    <label class="up-label"></label>                    <label class="up-name">SilenWang</label>                </div>                <div class="actions hide"></div>            </div>        </div>    </a></div><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gaming </tag>
            
            <tag> Monster Hunter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cracked an APK</title>
      <link href="/en/2020/02/02/%E7%A0%B4%E8%A7%A3%E4%BA%86%E4%B8%80%E4%B8%AAapk/"/>
      <url>/en/2020/02/02/%E7%A0%B4%E8%A7%A3%E4%BA%86%E4%B8%80%E4%B8%AAapk/</url>
      
        <content type="html"><![CDATA[<p>From childhood to adulthood, my biggest motivation has always been playing games and looking cool… Today I wanted to play Monster Hunter 4G but couldn’t get back to Guangzhou, so I played it on my 5-year-old 3DS. Since it’s an old game that wasn’t very popular in the Chinese community at the time (Ping’s Dex was inconvenient due to system issues), it’s hard to find Chinese resources. To play the game better… I turned to an app that requires watching ads to earn points, which can then be used to exchange for specific equipment functions.</p><!-- Abstract part --><span id="more"></span><p>This app’s monetization is based on watching ads to earn points, which are then used to exchange for specific equipment functions. My original goal was to make the points infinite or make the usage of exchanged functions unlimited. I thought there should be a variable in the program code that decreases each time a function is used. By removing this line of code, I could achieve unlimited usage.</p><p>So let’s move on to the operation.</p><h2 id="Unpacking-and-Parsing-APK"><a href="#Unpacking-and-Parsing-APK" class="headerlink" title="Unpacking and Parsing APK"></a>Unpacking and Parsing APK</h2><p>Actually, an APK file is just a compressed package. You can directly <code>unzip</code> it. The software package after extraction should include many parts, with the actual executable file being <code>*.dex</code>, which is the compiled execution file. To parse it, you need to convert this file into <code>jar</code>. I used <code>enjarify</code>, which comes from GitHub; you can clone it and use it.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip your.apk</span><br><span class="line">/path/tool/enjarify.sh classes.dex</span><br></pre></td></tr></table></figure><p>Next, you need to view the Java code. I used <code>jd-gui</code>, which is available in the Arch User Repository (<code>aur/jd-gui-bin</code>). Drag the file into it. This is purely reading the code. Since the code wasn’t written by me and the author might have added some obfuscation to protect themselves, it may be difficult to locate. So I thought of using log tracking:</p><ol><li>First, use <code>adb shell</code> to connect to the phone terminal and run <code>pm list packages</code> to view the name of the target app.</li><li>According to the name, capture logs for the specified app with <code>adb logcat device_id|grep you.app.name</code>.</li><li>On the phone, operate this app, such as entering the paid page of the app, so you can see in the logs which class was called.</li></ol><p>After locating it, it’s quite tedious… Guess the logic of the code in the specified file (since I don’t understand Java), and then try to find a solution,</p><h2 id="De-compiling-APK-and-Modifying-Code"><a href="#De-compiling-APK-and-Modifying-Code" class="headerlink" title="De-compiling APK and Modifying Code"></a>De-compiling APK and Modifying Code</h2><p>I used <code>apktools</code>, which you can install via <code>sudo pacman -S android-apktool</code> after adding the Arch Linux China source. After installation, use <code>apktool d your.apk</code> to decompile it.</p><p>After decompilation, enter the folder generated by the file, where there will be a <code>smali</code> folder with the same directory structure as the Java project but in <code>smali</code> assembly language code instead of <code>java</code>. Although the languages are different (and some implementation logic is quite different), achieving the same thing, so according to the Java code I read earlier, you can find the corresponding part in the file and modify it accordingly using <code>smali</code> syntax.</p><h2 id="Re-packaging-and-Signing"><a href="#Re-packaging-and-Signing" class="headerlink" title="Re-packaging and Signing"></a>Re-packaging and Signing</h2><p>After modifying the code files, you can re-generate the APK file with the modified folder: <code>apktool b -o your.mod.apk your_path</code>.</p><p>However, the newly packaged APK cannot be used directly. It needs to be signed… The signing process involves generating a key for information first, then signing it. I found this process too complicated and instead found a quick-signing project on GitHub called <a href="https://github.com/patrickfav/uber-apk-signer">uber-apk-signer</a>, which will use an internal test signature to quickly sign the unregistered APK file, allowing you to install it.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar  uber-apk-signer-1.1.0.jar --apks your.mod.apk</span><br></pre></td></tr></table></figure><p>After that, test the modified app. If it doesn’t achieve the desired effect, you can modify it again. Actually, I didn’t achieve my initial goal because I couldn’t find where the value decreases in the code (since I really don’t understand Java), but I found a conditional check for whether points are sufficient when making purchases. So I directly bypassed this check and let the point exchange complete, achieving my goal in a different way… The only drawback is that… I still have to enter the purchase page and make many exchanges…</p><p>Well, since doing it this way isn’t very good for the original author… So I won’t give the app name or the actual code.</p><p>I wonder if this skill will be effective in strange places again…</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Apktools </tag>
            
            <tag> crack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Extracting Outliers from ggplot Boxplots and Removing Them</title>
      <link href="/en/2020/01/05/%E4%BB%8Eggplot%E5%9B%BE%E5%BD%A2%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/"/>
      <url>/en/2020/01/05/%E4%BB%8Eggplot%E5%9B%BE%E5%BD%A2%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<p>Today I encountered a plotting problem and learned a new small trick, so I’ll record it here.</p><!-- Summary --><span id="more"></span><p>ggplot provides many commonly used plotting functions that are very convenient, and the plots can be drawn with various groupings. However, sometimes I have some special requirements that ggplot cannot satisfy, so I need to perform some operations manually.</p><p>For example, today I needed to draw a grouped boxplot where each group has its own outliers. These outliers would make the plot crowded on one side, making it difficult to observe, so they need to be removed. Although <code>geom_boxplot</code> has parameters for outlier handling, unfortunately these parameters don’t actually remove the outlier points from the data - they just don’t display them on the plot. This means the plot remains crowded in the same way, failing to achieve the desired effect.</p><p>The most common solution I found online is to use the <code>$out</code> content from the built-in <code>boxplot</code> function to extract outlier values and remove them. Unfortunately, this method doesn’t seem to provide grouped outlier results - it gives overall outliers instead. If you need to remove outliers by group, you would have to manually split the dataset and process each group individually.</p><p>Is there a lazier way?</p><p>I actually discovered one…</p><p>Just like built-in functions, ggplot’s plots can extract the actual plotting data:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>data<span class="punctuation">,</span>mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>data<span class="operator">$</span>label<span class="punctuation">,</span> y<span class="operator">=</span>data<span class="punctuation">[</span><span class="punctuation">,</span>tag<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">plot_data <span class="operator">&lt;-</span> layer_data<span class="punctuation">(</span>plot<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>The <code>layer_data</code> function is one way to extract the data (using <code>build_plot(plot)$data</code> has the same effect).</p><p><code>plot_data</code> stores all the data that ggplot uses for plotting. The part we need is stored in the <code>outliers</code> column, and it’s arranged in the same order as shown on the plot. Therefore, as long as we manually specify the factor levels for grouping during the initial plotting, we can get the outliers for specific groups directly from the plot.</p><p>Then, utilizing ggplot’s automatic handling of <code>NA</code> values, we can replace the outlier values in the corresponding column with <code>NA</code>, creating a dataset without outliers. Then, we can redraw the plot to solve the problem!</p><p>Complete plotting code and plot comparison:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;ggplot2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;plot_data.tsv&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span> stringsAsFactors<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">,</span> na.strings <span class="operator">=</span> <span class="string">&#x27;.&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Custom levels for grouped data; this must be done subsequently</span></span><br><span class="line">data<span class="operator">$</span>grp <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>data<span class="operator">$</span>grp<span class="punctuation">,</span> levels<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Grp1&quot;</span><span class="punctuation">,</span><span class="string">&quot;Grp2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Prepare a vector for mapping</span></span><br><span class="line">classV <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>classV<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Grp1&quot;</span><span class="punctuation">,</span><span class="string">&quot;Grp2&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># First round: use ggplot to get outliers</span></span><br><span class="line">plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>data<span class="punctuation">,</span>mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>data<span class="operator">$</span>grp<span class="punctuation">,</span> y<span class="operator">=</span>data<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&#x27;value&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>layer_data<span class="punctuation">(</span>plot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">outlier_data <span class="operator">&lt;-</span> layer_data<span class="punctuation">(</span>plot<span class="punctuation">)</span><span class="punctuation">[</span><span class="string">&#x27;outliers&#x27;</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment"># Use the obtained values to change outlier values in the original dataset to NA</span></span><br><span class="line">pdata<span class="operator">&lt;-</span>data</span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>grp <span class="keyword">in</span> <span class="built_in">names</span><span class="punctuation">(</span>classV<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    pdata<span class="punctuation">[</span>pdata<span class="operator">$</span>grp<span class="operator">==</span>grp<span class="punctuation">,</span>  <span class="string">&#x27;value&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> replace<span class="punctuation">(</span>pdata<span class="punctuation">[</span>pdata<span class="operator">$</span>grp<span class="operator">==</span>grp<span class="punctuation">,</span> <span class="string">&#x27;value&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> pdata<span class="punctuation">[</span>pdata<span class="operator">$</span>grp<span class="operator">==</span>grp<span class="punctuation">,</span>  <span class="string">&#x27;value&#x27;</span><span class="punctuation">]</span> <span class="operator">%in%</span> outlier_data<span class="punctuation">[</span>classV<span class="punctuation">[</span>grp<span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment"># Prepare a comparison vector; use the changed data to plot</span></span><br><span class="line">comb_list <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">comb <span class="operator">&lt;-</span> combn<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Negative&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Unkown&quot;</span><span class="punctuation">,</span><span class="string">&quot;Weak&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Medium&quot;</span><span class="punctuation">,</span><span class="string">&quot;Strong&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>id <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="built_in">dim</span><span class="punctuation">(</span>comb<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    comb_list<span class="punctuation">[[</span>id<span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> comb<span class="punctuation">[</span><span class="punctuation">,</span> id<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">pplot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>pdata<span class="punctuation">,</span>mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>pdata<span class="operator">$</span>grp<span class="punctuation">,</span> y<span class="operator">=</span>pdata<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&#x27;value&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_boxplot<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/display_boxplot.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/display_boxplot.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="display_boxplot.png"></p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> ggplot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Crawler Learning Notes</title>
      <link href="/en/2019/12/18/%E7%88%AC%E8%99%AB%E5%86%85%E5%AE%B9%E5%AD%A6%E4%B9%A0/"/>
      <url>/en/2019/12/18/%E7%88%AC%E8%99%AB%E5%86%85%E5%AE%B9%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>I have not systematically studied web scraping before, so I am making notes while watching <a href="https://www.bilibili.com/video/av18202461/?p=7">this video</a>.</p><span id="more"></span><h1 id="Request-Response"><a href="#Request-Response" class="headerlink" title="Request &#x2F; Response"></a>Request &#x2F; Response</h1><p>A request is information sent by a browser or program to the server to request content for display. The response is the server’s reply to the received request.</p><ul><li><p>Request content</p><ul><li>Request method: GET &#x2F; POST (most commonly used)<ul><li>POST has additional form data compared to GET</li><li>Parameters in GET are directly included in the URL, while parameters in POST requests are included in the form</li></ul></li><li>Request URL: A Uniform Resource Locator (URL) is a link to a file or object</li><li>Request headers: Important configuration information stored as key-value pairs</li><li>Request body: Generally no information for GET, but required for POST</li></ul></li><li><p>Response content</p><ul><li>Response status code: A numeric code used to indicate the status of the request</li><li>Response headers</li><li>Response body: The result of the request</li></ul></li></ul><h1 id="Python-requests-module-usage"><a href="#Python-requests-module-usage" class="headerlink" title="Python requests module usage"></a>Python requests module usage</h1><p>requests is based on urllib3 and provides a more convenient and feature-rich interface</p><h2 id="GET-Request-Related"><a href="#GET-Request-Related" class="headerlink" title="GET Request Related"></a>GET Request Related</h2><h3 id="Adding-request-parameters"><a href="#Adding-request-parameters" class="headerlink" title="Adding request parameters"></a>Adding request parameters</h3><ul><li>The <code>params</code> parameter can conveniently add parameters to the request, avoiding manual URL construction</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;arg1&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;arg2&#x27;</span>: <span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, params=data)</span><br></pre></td></tr></table></figure><h3 id="JSON-parsing"><a href="#JSON-parsing" class="headerlink" title="JSON parsing"></a>JSON parsing</h3><ul><li>Provides a <code>json</code> method that directly converts the returned JSON string into a JSON object</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, params=data)</span><br><span class="line">response.json()</span><br></pre></td></tr></table></figure><h3 id="Binary-data-retrieval"><a href="#Binary-data-retrieval" class="headerlink" title="Binary data retrieval"></a>Binary data retrieval</h3><ul><li>Use GET to request images directly, then write them to a file in ‘wb’ mode</li></ul><h3 id="Adding-headers"><a href="#Adding-headers" class="headerlink" title="Adding headers"></a>Adding headers</h3><ul><li>Mainly for successful retrieval; some websites identify User-Agent to prevent machine scraping</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;XXXX&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, headers=headers)</span><br></pre></td></tr></table></figure><h2 id="POST-Request-Related"><a href="#POST-Request-Related" class="headerlink" title="POST Request Related"></a>POST Request Related</h2><h3 id="Adding-request-parameters-headers"><a href="#Adding-request-parameters-headers" class="headerlink" title="Adding request parameters &#x2F; headers"></a>Adding request parameters &#x2F; headers</h3><ul><li>Similar to GET (see above)</li></ul><h3 id="Response-attributes"><a href="#Response-attributes" class="headerlink" title="Response attributes"></a>Response attributes</h3><ul><li>Common attributes include:<ul><li>status_code</li><li>headers</li><li>cookies</li><li>url</li><li>history</li></ul></li></ul><h3 id="Status-code-analysis"><a href="#Status-code-analysis" class="headerlink" title="Status code analysis"></a>Status code analysis</h3><ul><li>The requests library itself categorizes status codes, so you can quickly determine if the request was successful by calling built-in information. For example, <code>response.status_code == requests.codes.ok</code> is equivalent to <code>200</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">exit() <span class="keyword">if</span> response.status_code != requests.codes.ok <span class="keyword">else</span> <span class="built_in">print</span>(<span class="string">&#x27;All Right&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Proxy-settings"><a href="#Proxy-settings" class="headerlink" title="Proxy settings"></a>Proxy settings</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:9743&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://user:passwd@127.0.0.1:9743&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, proxies=proxy)</span><br></pre></td></tr></table></figure><p>If using ss, you need to install additional plugins.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install <span class="string">&#x27;requests[socks]&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxy = &#123;</span><br><span class="line">    <span class="string">&#x27;socks5&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:9743&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, proxies=proxy)</span><br></pre></td></tr></table></figure><h3 id="Timeout-settings"><a href="#Timeout-settings" class="headerlink" title="Timeout settings"></a>Timeout settings</h3><p>Can be combined with <code>try</code> for exception handling.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(<span class="string">&#x27;url&#x27;</span>, timeout=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="Selenium-Section"><a href="#Selenium-Section" class="headerlink" title="Selenium Section"></a>Selenium Section</h1><p>For content obtained through JavaScript and rendered on the page, some elements may not be found when analyzing page requests. At this time, Selenium can control the browser to perform operations. Although this is less efficient, it is very suitable for someone like me who is not familiar with web-related things.</p><h2 id="Element-Location"><a href="#Element-Location" class="headerlink" title="Element Location"></a>Element Location</h2><p>To simulate webpage operations, you first need to find the location of the element to be operated on. Selenium provides multiple ways to locate elements; using <code>find_element</code> will return the first matching element, while using <code>find_elements</code> will return a list of all objects.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">browser = webdriver.Firefox()</span><br><span class="line">browser.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">browser.find_element_by_id(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_name(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_xpath(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_link_text(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_partial_link_text(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_tag_name(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_class_name(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">browser.find_element_by_css_selector(<span class="string">&#x27;123&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="iframe-Location"><a href="#iframe-Location" class="headerlink" title="iframe Location"></a>iframe Location</h2><p>A webpage may be divided into several parts, with a large frame containing one or more <code>iframes</code>. When located within the main frame, it is impossible to search for or locate content within the small frames, and thus cannot perform corresponding operations. Therefore, you need to switch frames before performing operations.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">browser = webdriver.Firefox()</span><br><span class="line">browser.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="comment"># Switch to iframe by name</span></span><br><span class="line">browser.switch_to.frame(<span class="string">&#x27;analyzeFrame&#x27;</span>)</span><br><span class="line"><span class="comment"># Switch back to main frame</span></span><br><span class="line">browser.switch_to.default_content()</span><br><span class="line"><span class="comment"># Untested if switching between iframes within an iframe is possible</span></span><br></pre></td></tr></table></figure><h2 id="Pop-up-Window-Operation"><a href="#Pop-up-Window-Operation" class="headerlink" title="Pop-up Window Operation"></a>Pop-up Window Operation</h2><p>Sometimes certain operations will pop up a warning box, requiring you to switch to this window for corresponding operations before continuing subsequent steps.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Switch to the alert window</span></span><br><span class="line">al = browser.switch_to_alert()</span><br><span class="line"><span class="comment"># Click on the accept button in the window</span></span><br><span class="line">al.accept()</span><br></pre></td></tr></table></figure><h2 id="Browser-Settings-Change"><a href="#Browser-Settings-Change" class="headerlink" title="Browser Settings Change"></a>Browser Settings Change</h2><p>Sometimes special settings need to be made to the browser to complete the required operation. For example, I once needed to obtain data by clicking a download button, but normally when clicking the download button, the browser would pop up a download window.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">options = Options()</span><br><span class="line"><span class="comment"># The first item is the setting name, and the second is the corresponding value; available settings can be viewed by entering &#x27;about:config&#x27; in the browser.</span></span><br><span class="line">options.set_preference(<span class="string">&quot;browser.download.folderList&quot;</span>, <span class="number">2</span>)</span><br><span class="line">browser = webdriver.Firefox(firefox_options=options)</span><br><span class="line"><span class="comment"># The following sets up socks proxy</span></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--proxy-server=socks5://localhost:1080&#x27;</span>)</span><br><span class="line">browser = webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure><h2 id="Waiting-Settings"><a href="#Waiting-Settings" class="headerlink" title="Waiting Settings"></a>Waiting Settings</h2><p>All Selenium operations are performed after the page has finished loading, but due to network issues, if you wait until it is fully loaded before executing, it significantly affects efficiency (Selenium is already less efficient than purely sending requests via code). Therefore, some settings can be made to execute related operations immediately when a specific condition is met. For example, below waits for a specific search button to become clickable before entering the search content and clicking the search.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">button = wait.until(EC.element_to_be_clickable((By.CLASS_NAME, <span class="string">&#x27;search-bar-btn&#x27;</span>)))</span><br><span class="line">browser.find_element_by_class_name(<span class="string">&#x27;search-input&#x27;</span>).send_keys(tar)</span><br><span class="line">button.click()</span><br></pre></td></tr></table></figure><h2 id="Download-File-Checking"><a href="#Download-File-Checking" class="headerlink" title="Download File Checking"></a>Download File Checking</h2><p>Selenium itself cannot manage download files, so it can only be done through other means. For example:</p><ul><li>If the download link can be parsed out from the webpage code, you can call other tools to download.</li><li>If the download link cannot be parsed out, you can use <code>os</code> module related content to monitor the downloaded file and rename it after downloading.</li></ul><p>I used the following two parts of code together at that time:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># Copied code; this function checks the file size every 5 seconds. If the size has not changed since the last check, it is determined that the download is complete, and the browser object will be closed.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wait_download</span>(<span class="params">file_path, browser, rep_name</span>):</span><br><span class="line">    current_size = getSize(file_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; Downloading&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(current_size)))</span><br><span class="line">    <span class="keyword">while</span> current_size != getSize(file_path) <span class="keyword">or</span> getSize(file_path)==<span class="number">0</span>:</span><br><span class="line">        current_size =getSize(file_path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;current_size:&quot;</span>+<span class="built_in">str</span>(current_size))</span><br><span class="line">        time.sleep(<span class="number">5</span>)<span class="comment"># wait download</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Downloaded&quot;</span>)</span><br><span class="line">    os.rename(file_path, rep_name)</span><br><span class="line">    browser.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Because the download starts itself takes time, the target file appears after starting the above function.</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;waiting for download to start...&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">wait_download(file_path, browser, rep_name)</span><br></pre></td></tr></table></figure><h2 id="About-the-Pitfall-of-Simulating-Clicks"><a href="#About-the-Pitfall-of-Simulating-Clicks" class="headerlink" title="About the Pitfall of Simulating Clicks"></a>About the Pitfall of Simulating Clicks</h2><p>Selenium can simulate clicks on buttons, links, checkboxes, etc., but the click must be performed when these elements are within the visible range; otherwise, the click will be ineffective or an exception will be thrown. Therefore, in actual operation, you need to test whether scrolling is required and how much to scroll to ensure that the element can be clicked.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Switch out of iframe</span></span><br><span class="line">browser.switch_to.default_content()</span><br><span class="line"><span class="comment"># Scroll browser to bottom</span></span><br><span class="line">browser.execute_script(<span class="string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span>)</span><br><span class="line"><span class="comment"># Switch back to iframe</span></span><br><span class="line">browser.switch_to.frame(<span class="string">&#x27;analyzeFrame&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h1><ul><li>Generally, the first GET request gets the framework of the webpage, and then new requests are sent to fill in the content needed.</li><li>If you need to obtain corresponding information, you need to analyze AJAX requests.<ul><li>Selenium&#x2F;WebDriver</li><li>Splash</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Web Crawler </tag>
            
            <tag> requests </tag>
            
            <tag> selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Some Magic Methods in Python</title>
      <link href="/en/2019/11/25/Python%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/"/>
      <url>/en/2019/11/25/Python%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>I previously used <code>__enter__</code> and <code>__exit__</code>, which I had heard of before. This time, my program development is mainly object-oriented, so I needed to use more methods to achieve some useful features in Python. Here’s a small note.</p><h3 id="len"><a href="#len" class="headerlink" title="__len__"></a><code>__len__</code></h3><p>After defining it, you can use the <code>len()</code> function on an instance.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Define length</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(self.Seq)</span><br></pre></td></tr></table></figure><h3 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__"></a><code>__getitem__</code></h3><p>After defining it, you can perform indexing and slicing operations on an instance using <code>[]</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, key</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Add slice index</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> self.d[key]</span><br></pre></td></tr></table></figure><h3 id="str"><a href="#str" class="headerlink" title="__str__"></a><code>__str__</code></h3><p>After defining it, when you print an instance using <code>print()</code>, it will print the content returned by this method.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(self.__dict__)</span><br></pre></td></tr></table></figure><h3 id="iter"><a href="#iter" class="headerlink" title="__iter__"></a><code>__iter__</code></h3><p>After defining it, you can iterate over an object, such as <code>for i in object</code>. Note that this method must return an iterator (not just an iterable).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> (mut <span class="keyword">for</span> mut <span class="keyword">in</span> self.muts)</span><br></pre></td></tr></table></figure><h3 id="eq-and-hash"><a href="#eq-and-hash" class="headerlink" title="__eq__ and __hash__"></a><code>__eq__</code> and <code>__hash__</code></h3><p>These two are together because if you want to automatically remove duplicates when placing instances in a <code>set()</code>, both methods need to be defined. Otherwise, the purpose will not be achieved. The <code>__eq__</code> method makes objects comparable (<code>==</code> and <code>!=</code>, <code>is</code> cannot be used). Note that the <code>other</code> parameter is fixed here; do not change it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Ensure automatic removal of duplicates using set characteristics</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> self.muts == other.muts</span><br></pre></td></tr></table></figure><p><code>__hash__</code> then essentially makes objects hashable. The hash value used for hashing will be the one provided by this method.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__hash__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Ensure automatic removal of duplicates using set characteristics</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hash</span>(self.muts)</span><br></pre></td></tr></table></figure><p>That’s it for now. I’ll continue to add more as needed.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Snakemake&#39;s Dynamic Parsing Feature</title>
      <link href="/en/2019/11/24/Snakemake%E7%9A%84%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/"/>
      <url>/en/2019/11/24/Snakemake%E7%9A%84%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>Damn, I finally successfully used this feature… I’m really stupid…</p><!-- Abstract part --><span id="more"></span><p>In actual workflows, our processes may have some “dynamic” requirements. For example, aligning fastq files or performing variant detection, the corresponding alignment&#x2F;detection software may not have a well-developed multi-threading mechanism. Additionally, original data files are too large, making direct computation very time-consuming. In such cases, using <code>source file splitting -&gt; parallel processing across multiple processes -&gt; result file merging</code> is a very practical strategy. How do you split them? You can split the files in a fixed way, such as splitting bam files by chromosome during variant detection. However, this fixed splitting pattern may not always be efficient. For example, different chromosomes have vastly different data volumes, and parallel processing by chromosome will inevitably be limited by the largest chromosome’s data volume. But if you don’t follow a fixed strategy for splitting, the number of generated split files may be unpredictable, which conflicts with <code>snakemake</code>‘s logic of parsing what to do before allocating resources. Therefore, developers introduced a dynamic parsing mechanism (<code>Data-dependent conditional execution</code>) in newer versions.</p><p>The core of this dynamic mechanism is <code>checkpoint</code>, which is a special type of <code>rule</code>. While running, it behaves similarly to a regular <code>rule</code>, but when the workflow reaches a checkpoint, the entire dependency graph (<code>DAG</code>) will be re-parsed. The designer’s intention was clear: set rules that produce unpredictable results as checkpoints, and then re-decide the necessary steps based on the actually generated files.</p><p>Due to this special dynamic mechanism, using checkpoints is also more troublesome than regular <code>rules</code>. Checkpoints must be used in conjunction with <code>function input</code>, because although a new mechanism has been added, the program’s execution logic still relies on deciding what to do first. And deciding what to do cannot be determined by the program itself; it requires manual design, so we need to use a function to get the files generated by the checkpoint and then pass these files to downstream <code>rules</code> for parsing.</p><p>I have an example that is slightly easier to understand than the official one:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">rule <span class="built_in">all</span>:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.all.stat&quot;</span>.<span class="built_in">format</span>(sample=<span class="string">&quot;NL180614-2_S12_L001_R1_001&quot;</span>)</span><br><span class="line"></span><br><span class="line">checkpoint split:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.fastq.gz&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        touch(<span class="string">&quot;&#123;sample&#125;.splt.done&quot;</span>)</span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;split -l 1000000 &#123;input&#125; &#123;wildcards.sample&#125;.split. &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rule wc:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.split.&#123;split&#125;&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.split.&#123;split&#125;.stat&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;wc -l &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_split_files</span>(<span class="params">wildcards</span>):</span><br><span class="line">    split_output = checkpoints.split.get(**wildcards).output[<span class="number">0</span>]</span><br><span class="line">    split_dir = path.split(split_output)[<span class="number">0</span>]</span><br><span class="line">    split_files = glob(<span class="string">f&quot;*.split.*&quot;</span>)</span><br><span class="line">    tar_files = [<span class="string">f&quot;<span class="subst">&#123;f&#125;</span>.stat&quot;</span> <span class="keyword">for</span> f <span class="keyword">in</span> split_files]</span><br><span class="line">    <span class="keyword">return</span> tar_files</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rule cat:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        get_split_files</span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.all.stat&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        cat &#123;input&#125; &gt; &#123;output&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>This example implements splitting fastq files into multiple sub-files, counting the number of lines for each split file, and then merging the results into a single file. The <code>checkpoint</code> part is responsible for splitting, while this <code>rule</code> generates an output that does not depend on downstream rules. The truly useful part is the <code>checkpoint</code> itself. The <code>get_split_files()</code> function uses the <code>checkpoints</code> object and accesses the content of the <code>split</code> checkpoint, so it uses this function as input for the <code>cat</code> rule, which has a dependency on the <code>checkpoint split</code>. At the same time, it does not perform actual dependency parsing but waits for its <code>checkpoint split</code> to complete before parsing (i.e., dynamic parsing).</p><p>The official documentation example is basically the same principle, although its <code>checkpoint</code> generates directory results to facilitate re-parsing of dynamically generated files.</p><p>Finally, I’ll add another BWA example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">wildcard_constraints:</span><br><span class="line">    sample=<span class="string">r&quot;[A-Z,a-z,0-9,-]+&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rule <span class="built_in">all</span>:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.srt.bam&quot;</span>.<span class="built_in">format</span>(sample=<span class="string">&quot;NL180614-2&quot;</span>)</span><br><span class="line"></span><br><span class="line">checkpoint split:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        fq1=<span class="string">&quot;&#123;sample&#125;_S12_L001_R1_001.fastq.gz&quot;</span>,</span><br><span class="line">        fq2=<span class="string">&quot;&#123;sample&#125;_S12_L001_R2_001.fastq.gz&quot;</span>,</span><br><span class="line">    output:</span><br><span class="line">        directory(<span class="string">&quot;&#123;sample&#125;_tmp&quot;</span>)</span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        mkdir -p &#123;output&#125;/R1</span></span><br><span class="line"><span class="string">        mkdir -p &#123;output&#125;/R2</span></span><br><span class="line"><span class="string">        zcat &#123;input.fq1&#125; | split -l 1000000 /dev/stdin &#123;output&#125;/R1/split.</span></span><br><span class="line"><span class="string">        zcat &#123;input.fq2&#125; | split -l 1000000 /dev/stdin &#123;output&#125;/R2/split.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rule bwa:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        r1=<span class="string">&quot;&#123;sample&#125;_tmp/R1/split.&#123;split&#125;&quot;</span>,</span><br><span class="line">        r2=<span class="string">&quot;&#123;sample&#125;_tmp/R2/split.&#123;split&#125;&quot;</span>,</span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;_tmp/split.&#123;split&#125;.srt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        bwa mem -t 4 -M \\</span></span><br><span class="line"><span class="string">            -R &quot;@RG\\tID:&#123;wildcards.sample&#125;\\tPL:Illumina\\tPU:&#123;wildcards.sample&#125;\\tSM:&#123;wildcards.sample&#125;&quot; \\</span></span><br><span class="line"><span class="string">            /home/silen/git/Bio_Test/hg38-bwa/hg38.fa \\</span></span><br><span class="line"><span class="string">            &#123;input.r1&#125; \\</span></span><br><span class="line"><span class="string">            &#123;input.r2&#125; \\</span></span><br><span class="line"><span class="string">        | samtools view -Sb -@ 4  \\</span></span><br><span class="line"><span class="string">        | samtools sort -@ 4  \\</span></span><br><span class="line"><span class="string">        &gt; &#123;output&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_split_files</span>(<span class="params">wildcards</span>):</span><br><span class="line">    split_dir = checkpoints.split.get(**wildcards).output[<span class="number">0</span>]</span><br><span class="line">    split_files_r1 = glob(<span class="string">f&quot;<span class="subst">&#123;split_dir&#125;</span>/R1/split.*&quot;</span>)</span><br><span class="line">    split_tag = [s.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>] <span class="keyword">for</span> s <span class="keyword">in</span> split_files_r1]</span><br><span class="line">    split_bams = [path.join(split_dir,<span class="string">f&quot;split.<span class="subst">&#123;tag&#125;</span>.srt.bam&quot;</span>) <span class="keyword">for</span> tag <span class="keyword">in</span> split_tag]</span><br><span class="line">    <span class="keyword">return</span> split_bams</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rule cat:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        get_split_files</span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sample&#125;.srt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        samtools merge -f &#123;output&#125; &#123;input&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>I have been using this feature in some of my projects, and the actual experience is that it seems simple and general-purpose, but there are still different issues to consider depending on the software situation…</p><p>For example, in the above BWA example, there is still one problem to solve: here, the generated directories are actually temporary directories, and I hope to delete them after use. However, <code>temp</code> and <code>directory</code> keywords conflict, and the files in the temporary folder are dynamic and cannot be specified directly, so it’s currently not possible to utilize snakemake’s own features to automatically delete them.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> snakemake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Let Custom Objects Use the &#39;with&#39; Statement</title>
      <link href="/en/2019/11/14/%E8%AE%A9%E8%87%AA%E5%86%99%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%B8%8Awith/"/>
      <url>/en/2019/11/14/%E8%AE%A9%E8%87%AA%E5%86%99%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%B8%8Awith/</url>
      
        <content type="html"><![CDATA[<p>The <code>with open</code> statement is a particularly convenient feature in Python, allowing for automatic closure of objects when operations are completed. For custom objects, it’s also possible to support the <code>with</code> syntax.</p><!-- 摘要部分 --><span id="more"></span><p>To achieve this, define the <code>__enter__</code> and <code>__exit__</code> methods in your class:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Start&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;End&quot;</span>)</span><br></pre></td></tr></table></figure><p>With this setup, when using the <code>with</code> statement, it will first execute the content within <code>__enter__</code>, and automatically execute the content within <code>__exit__</code> at the end of the code block.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; with MyClass() as tClass:</span><br><span class="line">...     print(&quot;test&quot;)</span><br><span class="line">...</span><br><span class="line">Start</span><br><span class="line">test</span><br><span class="line">End</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Chronicles of Monster Hunter - Tempered Bazelgeuse</title>
      <link href="/en/2019/10/30/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E5%8E%86%E6%88%98%E7%88%86%E9%B3%9E%E9%BE%99/"/>
      <url>/en/2019/10/30/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E5%8E%86%E6%88%98%E7%88%86%E9%B3%9E%E9%BE%99/</url>
      
        <content type="html"><![CDATA[<p>The romance of a hunter is not just about explosions… but also about damage output!</p><p>Obsessed with hunting… neglecting my career…</p><iframe src="//player.bilibili.com/player.html?aid=73777571&cid=126193394&page=1" width="700" height="500" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><!-- Summary part --><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gaming </tag>
            
            <tag> Monster Hunter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Monster Hunter Diary - Cherry Fire Dragon</title>
      <link href="/en/2019/10/06/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E6%A8%B1%E7%81%AB%E9%BE%99/"/>
      <url>/en/2019/10/06/%E7%8C%9B%E6%B1%89%E7%8E%8B%E7%8B%A9%E7%8C%8E%E6%97%A5%E8%AE%B0-%E6%A8%B1%E7%81%AB%E9%BE%99/</url>
      
        <content type="html"><![CDATA[<p>As expected, just like I bought a tablet and spent two days reading books before starting to play PSP emulators… this time after buying a computer, I didn’t use it for software testing for long either… I immediately started playing Monster Hunter. I even fiddled with how to record video from the client machine on the host… After struggling all day, I finally chose dual-streaming of video and audio… separately through the Looking-Glass and Scream projects to stream video and audio back to the host, and then recorded using OBS on the host. As for why I didn’t record directly on the client machine… that wouldn’t reflect the essence of being a masochist, right!</p><p>Here’s a test video of me playing Cherry Fire Dragon without any technical skill:</p><iframe src="//player.bilibili.com/player.html?aid=70256357&cid=118237953&page=1" width="700" height="500" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><!-- Summary part --><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gaming </tag>
            
            <tag> Monster Hunter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Great Ace Attorney, Clearing the Case &#92;(￣▽￣)/</title>
      <link href="/en/2019/10/05/%E5%A4%A7%E9%80%86%E8%BD%AC%E8%A3%81%E5%88%A4/"/>
      <url>/en/2019/10/05/%E5%A4%A7%E9%80%86%E8%BD%AC%E8%A3%81%E5%88%A4/</url>
      
        <content type="html"><![CDATA[<p>I have cleared the case in “The Great Ace Attorney”. Personally, I feel that this game is even better than the Phoenix Wright trilogy. Compared to them, this game does not have any supernatural elements, and the part about evidence in the story seems more reasonable (not just moving an item&#x2F;person out can be used as evidence). Of course, in a game centered on reasoning… I might be overthinking something~</p><img src="https://gss1.bdstatic.com/-vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike220%2C5%2C5%2C220%2C73/sign=60bda97249166d222c7a1dc6274a6292/c8ea15ce36d3d5398346217a3087e950352ab00b.jpg" class="lazyload" data-srcset="https://gss1.bdstatic.com/-vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike220%2C5%2C5%2C220%2C73/sign=60bda97249166d222c7a1dc6274a6292/c8ea15ce36d3d5398346217a3087e950352ab00b.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" width="50%" height="50%"><!-- Summary part --><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Playing Games </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Writing Dockerfile to Build Docker Image</title>
      <link href="/en/2019/10/05/%E7%BC%96%E5%86%99Dockerfile%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/"/>
      <url>/en/2019/10/05/%E7%BC%96%E5%86%99Dockerfile%E6%9E%84%E5%BB%BAdocker%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<p>From past experiences… I have gained many skills as a byproduct… Today, this is also the case. My original intention was to use the source code provided by NetEase to compile an improved version of VirtualBox, but in the end… I learned several Docker-related skills…</p><span id="more"></span><p>The construction of images is basic to Docker. Although it is possible to manually build images after creating the base image each time, or directly pull them from platforms like Docker Hub, the former is time-consuming and lacks repeatability, while the latter has certain network requirements and limited customizability. Therefore, it is still essential to master the use of Dockerfile, which serves as the blueprint for building images. In fact… this thing is quite simple.</p><p>The keywords I might use most frequently in a Dockerfile are:</p><ul><li><code>FROM</code>: Specifies the base image for building. Before starting the build, it will pull the specified image as the base.</li><li><code>COPY</code>: Copies files from the external (host) to the image’s internal path. The first parameter is the external path, and the second parameter is the internal path. The usage is similar to <code>cp</code>, but I haven’t tried using wildcards (not sure if they work).</li><li><code>ADD</code>: Similar to <code>COPY</code>, but <code>ADD</code> can fetch files from the network, which is very useful when deploying containers elsewhere.</li><li><code>RUN</code>: Commands that need to be executed.</li><li><code>WORKDIR</code>: The directory where the built image will start when it runs.</li><li><code>CMD</code>: The command that the built image will run by default when it starts.</li></ul><p>Here are some special notes about the <code>COPY</code> and <code>RUN</code> commands:</p><ul><li>When using <code>COPY</code>, you can only fetch files from the build path specified by <code>docker build</code> and its subdirectories. This is due to the <strong>context</strong> restriction during Docker runtime.</li><li>Each time the <code>RUN</code> command runs, it generates a new layer in the image. If not necessary, try to minimize the number of commands and combine them with <code>&amp;&amp;</code> in a single <code>RUN</code> command to prevent the image from becoming large and slow.</li></ul><p>Here is an example of a Dockerfile I used for deploying an R package <code>sscClust</code>:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># sscClust Dockerfile</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://github.com/dockerfile/fpm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pull base image.</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install dep-packages</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y epel-release wget \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">mv</span> /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; yum clean all \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; yum makecache -y \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; yum install -y R openssl-devel libcurl-devel libxml2-devel gsl-devel \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">mkdir</span> -p /install_script</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install R packages</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> install.r /install_script/install.r</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> Rscript /install_script/install.r</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define working directory.</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define default command.</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure><p>The corresponding R script is:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span><span class="string">&quot;repos&quot;</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>CRAN<span class="operator">=</span><span class="string">&quot;https://mirrors.ustc.edu.cn/CRAN/&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>BioC_mirror<span class="operator">=</span><span class="string">&quot;http://mirrors.ustc.edu.cn/bioc/&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">,</span> <span class="string">&quot;devtools&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;SingleCellExperiment&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;scran&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;SC3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;zinbwave&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;BiocParallel&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;Japrin/sscClust&quot;</span><span class="punctuation">)</span>   </span><br></pre></td></tr></table></figure><p>Execute <code>docker build -t=test_docker .</code> to build the image using the above file.</p><p>Of course, this example may no longer be able to build successfully because software is constantly updating, and my build process does not specify any specific version of software. As time progresses, various dependency issues may arise… However, as a usage record, it’s still quite useful.</p>]]></content>
      
      
      <categories>
          
          <category> Script </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Adding Custom Services in Linux Distributions</title>
      <link href="/en/2019/10/05/%E5%9C%A8Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1/"/>
      <url>/en/2019/10/05/%E5%9C%A8Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>When using a Linux system, it’s often necessary to set up things that start automatically at boot. For distributions that use systemd, writing your own service files and enabling them is a great choice.</p><!-- 摘要部分 --><span id="more"></span><p>Service files are written in a configuration file format similar to ini. A basic service configuration file includes the following content:</p><ul><li><code>Unit</code>: The defined section, such as what the service does</li><li><code>Service</code>: The actual execution content, including what type of service it is, what to do when starting, what to do when stopping, and what to do when restarting</li><li><code>Install</code>: It’s mostly about dependencies, such as when the service should start or before or after XX starts</li></ul><p>Here is an example of a v2ray service:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Daemon to start V2ray</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/v2ray -config /home/silen/script/v2ray/v2ray.json</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">Alias</span>=v2ray</span><br><span class="line"><span class="attr">WantedBy</span>=default.target</span><br></pre></td></tr></table></figure><p>If this service is enabled, it will start automatically by default(<code>WantedBy=default.target</code>), executing the command<code>/usr/bin/v2ray -config /home/silen/script/v2ray/v2ray.json</code>, when booting, which means activating the v2ray proxy. Other actions for the service, such as restarting and stopping, are not defined.</p><p>After writing the above file, you can name the file<code>v2ray.service</code>and place it in the specified location (<code>/etc/systemd/system</code> or <code>/usr/lib/systemd/system</code>), then use <code>systemctl enable v2ray.service</code>with root privileges to activate the service (it will start according to the configuration after boot), and use <code>systemctl start v2ray.service</code> to start the service immediately.</p><p>It should be noted that when calling root privileges to start the service, the executing user is naturally root, which is not always a good choice. Therefore, my previous synchronization service and this v2ray service are actually both started with personal user permissions. In other words, put the above service file in <code>/home/&lt;user&gt;/.config/systemd/user</code>, and then directly <code>systemctl start --uesr v2ray.service</code> to start the service.</p><p>In this case, the service will only start after my current user logs in, and there is no need for root privileges (whether the user needs to be in the root group or not, I am not sure).</p><p>The v2ray program used in the example belongs to the type that occupies the foreground, so it can be directly used with the <code>sample</code> and <code>oneshot</code> type. In addition to this type, there are: <code>simple</code>, <code>forking</code>, <code>oneshot</code>, <code>notify</code>, <code>dbus</code>, <code>idle</code>.</p><p>Of course, my custom services are generally quite simple, <code>simple</code> and <code>oneshot</code> should be enough.</p><p>As for <code>ExecStart</code>, <code>ExecStop</code>, and <code>ExecReload</code>, the former is required, while the latter two can be written or not depending on the start command situation.</p><p>Finally, <code>WantedBy=default.target</code> in <code>Install</code> is a must according to my test, because the service will not start automatically without it… It’s not clear whether this is only for services at the user level.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Desktop Setup Plan (Part 2)</title>
      <link href="/en/2019/09/08/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E7%BD%AE%E5%A4%87%E8%AE%A1%E5%88%92-2/"/>
      <url>/en/2019/09/08/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E7%BD%AE%E5%A4%87%E8%AE%A1%E5%88%92-2/</url>
      
        <content type="html"><![CDATA[<p>After putting in a lot of effort to get the hardware sorted out, it’s time for the software.</p><!-- Abstract part --><span id="more"></span><p>Following my previous plan, I wanted my machine to be multi-functional: the host Linux system for computation and a virtual Windows system for gaming.</p><p>Anyone who has used virtual machines knows… the performance is always an issue. Even with top-tier products like VMware and Mac-specific Parallel, their graphical performance still falls short of native hardware. That’s why PCI Passthrough technology came into play. It allows PCI slot devices to be isolated from the host and directly allocated to the virtual machine, achieving almost-native performance without any middlemen. This is also the reason I bought a motherboard with two PCI slots; if I ever wanted to run two gaming PCs in virtual machines, each would need its own dedicated graphics card, and the host needs an integrated graphics card as well.</p><p>This virtualization setup uses Manjaro as the host system. References for this configuration include:</p><ul><li><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">ArchWiki GPU Passthrough Tutorial</a></li><li><a href="https://www.bilibili.com/video/av54526748">Linus Tech Tips Video on Virtual macOS</a></li><li><a href="#">INVALID POST SLUG PROVIDED </a></li></ul><p>Since this configuration is based on an Arch-based distribution, the specific commands and components used will differ from materials found in Chinese websites (which are mostly based on Ubuntu).</p><h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><h3 id="1-Prepare-the-System-Disk"><a href="#1-Prepare-the-System-Disk" class="headerlink" title="1. Prepare the System Disk"></a>1. Prepare the System Disk</h3><ul><li>Host System: manjaro-architect-18.0.4-stable, a derivative of Arch Linux known for its simplicity and ease of use. Despite being considered heretical by the Arch community, it has gained significant popularity (even I saw Manjaro’s community open a company similar to Ubuntu). Using Architect instead of a pre-installed desktop live CD is mainly because the image is small, with all software packages downloaded over the network.</li><li>Subsystem: Different from the host system, the subsystem needs to prepare an installation disk for Windows and possibly an <strong>EFI-bootable ISO image</strong>. The ArchWiki tutorial uses OVMF (which simplifies PCI passthrough by reducing the need for configuring virtual BIOS), which means the virtual machine will use EFI (only) instead of BIOS. This requires the installation system’s ISO image to support EFI boot. However, I downloaded many installation images that don’t support it… so I had to find a PE image that supports UEFI and used this image to boot and install another installation image on top.</li></ul><h3 id="2-Install-the-Host-System"><a href="#2-Install-the-Host-System" class="headerlink" title="2. Install the Host System"></a>2. Install the Host System</h3><p>Install Manjaro using the host system disk on your computer. Detailed steps can be found elsewhere, so I’ll skip them for now (I’ll add screenshots later when I have time).</p><h3 id="3-Set-Up-GPU-Isolation"><a href="#3-Set-Up-GPU-Isolation" class="headerlink" title="3. Set Up GPU Isolation"></a>3. Set Up GPU Isolation</h3><p>To achieve PCI passthrough, we need to prevent the host from accessing the hardware. The specific settings are as follows:</p><ul><li>Enable IOMMU<ul><li>Edit the configuration file (<code>/etc/default/grub</code>) to change kernel parameters and enable IOMMU:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet udev.log_priority=3 audit=0 amd_iommu=on iommu=pt&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX=&quot;&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li>After making the above changes, regenerate <code>grub.cfg</code>:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure></li></ul></li><li>Edit the configuration file to use vcfio to block the PCI devices to be isolated<ul><li>Use the <code>lspci -nnk</code> command to view all PCI hardware information, find the device IDs of the hardware you want to passthrough, and record them:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin [Radeon RX 460/560D / Pro 450/455/460/555/555X/560/560X] [1002:67ef] (rev e5)</span><br><span class="line">    Subsystem: Tul Corporation / PowerColor Baffin [Radeon RX 460/560D / Pro 450/455/460/555/555X/560/560X] [148c:2385]</span><br><span class="line">    Kernel driver in use: vfio-pci</span><br><span class="line">    Kernel modules: amdgpu</span><br><span class="line">01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X] [1002:aae0]</span><br><span class="line">    Subsystem: Tul Corporation / PowerColor Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X] [148c:aae0]</span><br><span class="line">    Kernel driver in use: vfio-pci</span><br><span class="line">    Kernel modules: snd_hda_intel</span><br></pre></td></tr></table></figure></li><li>The above information shows that the drivers for both devices are now <code>vfio-pci</code>, indicating successful isolation. Record the IDs in brackets, which are <code>[148c:2385]</code> and <code>[1002:aae0]</code> for the display device and audio device, respectively.</li><li>Create <code>/etc/modprobe.d/vfio.conf</code> and add <code>options vfio-pci ids=&lt;id to block&gt;</code> in it.</li><li>Edit <code>/etc/mkinitcpio.conf</code>, find the relevant project and add the corresponding content:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">MODULES=(... vfio_pci vfio vfio_iommu_type1 vfio_virqfd ...)</span><br><span class="line">...</span><br><span class="line">HOOKS=(... modconf ...)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li>After editing, changes won’t take effect until you regenerate <code>initramfs</code>:<ul><li><strong>Note:</strong> I don’t fully understand what this is about, and the ArchWiki content is also unclear to me. Here’s the actual operation I performed, which may not be the most correct method.</li><li>Execute the command to regenerate <code>/boot</code>‘s boot image: <code>sudo mkinitcpio -g /boot/initramfs-4.19-x86_64.img</code>(it’s recommended to back up the original)</li><li>After overwriting, restart the host system. If the settings are successful, the corresponding device drivers should be <code>vfio-pci</code>.</li><li>After overwriting, the host system cannot access the isolated hardware; if you need access, select <code>initramfs-4.19-x86_64-fallback.img</code> to start from the unmodified version.</li></ul></li></ul></li></ul><h3 id="4-Install-and-Configure-Virtual-Machine"><a href="#4-Install-and-Configure-Virtual-Machine" class="headerlink" title="4. Install and Configure Virtual Machine"></a>4. Install and Configure Virtual Machine</h3><p>After setting up the hardware, it’s time for software configuration.</p><ul><li>Install virtual machine management software<ul><li>tip: Here I installed QEMU and VirtManager, which simplify QEMU settings, along with libvirt. KVM is a module in the Linux kernel that can be used as long as virtualization is enabled on the motherboard; no additional installation is required.  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S qemu libvirt virt-manager ovmf</span><br></pre></td></tr></table></figure></li></ul></li><li>Create a virtual machine<ul><li>Open VirtManager, click “Create a new VM”<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/add_vm.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/add_vm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="add_vm.jpg"></li><li>Select the installation image (not for booting), since the downloaded image is not official, it cannot automatically recognize the system type. Remove automatic detection and manually select <code>Win10</code> then proceed to the next step<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/select_iso.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/select_iso.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="select_iso.jpg"></li><li>CPU and memory allocation<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/cpu_mem.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/cpu_mem.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="cpu_mem.jpg"></li><li>Choose to create a new image (skipping detailed steps…)</li><li>Confirm information, select network as bridge, and further edit</li><li>Allocate the PCI devices needed for passthrough<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/pci_device.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/pci_device.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="pci_device.jpg"></li><li>Since my installation image does not support UEFI boot, I found another one that supports but lacks installation files. I need to make some small adjustments to the boot order to ensure it mounts and starts from the bootable image.<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/boot.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/boot.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="boot.jpg"></li><li>Edit CPU information, mainly check “Copy host CPU configuration” (equivalent to <code>host-model</code>)<br>  <img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/set_cpu.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/set_cpu.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="set_cpu.jpg"></li><li>Set the BIOS to OVMF (refer to ArchWiki for details; I forgot to take a screenshot…)</li><li>Click the top-left “Start installation” and proceed with the normal system installation.</li></ul></li></ul><h3 id="5-Audio-Device-Bug-Fix-and-Other-Issues"><a href="#5-Audio-Device-Bug-Fix-and-Other-Issues" class="headerlink" title="5. Audio Device Bug Fix and Other Issues"></a>5. Audio Device Bug Fix and Other Issues</h3><p>After completing the above steps and installing the system, a physical GPU virtual machine is set up, and connecting the display interface of the graphics card to any display device allows you to enjoy gaming happily. However, there’s still an issue: although the graphics card has built-in audio devices, theoretically, one HDMI cable should be able to transmit audio to my monitor’s speakers. But in fact, no audio devices from the graphics card are found in the virtual machine. This problem puzzled me for a week until I saw a similar issue on the Proxmox forum, which said this was a bug in Q35 4.0 and could be resolved by downgrading to version 3.1 in the virtual machine configuration file. Therefore, we need to manually edit the virtual machine’s XML configuration file (open it directly for editing), find the relevant entry, and change it to the following configuration:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;type arch=&quot;x86_64&quot; machine=&quot;pc-q35-3.1&quot;&gt;hvm&lt;/type&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/game_xml_config.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/game_xml_config.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="game_xml_config.jpg"></p><p>Finally… I can sit down and enjoy gaming properly~~~~~</p><p>Postscript: A 9.8 post that started writing was pigeonholed until almost 10.8…… The charm of猛汉王 is truly irresistible….&#96;&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GPU Passthrough </tag>
            
            <tag> Manjaro </tag>
            
            <tag> kvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Desktop Setup Plan (Part 1)</title>
      <link href="/en/2019/09/02/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E7%BD%AE%E5%A4%87%E8%AE%A1%E5%88%92_1/"/>
      <url>/en/2019/09/02/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E7%BD%AE%E5%A4%87%E8%AE%A1%E5%88%92_1/</url>
      
        <content type="html"><![CDATA[<p>At the beginning of the year, I saved 2000 yuan to buy a second-hand server for testing software and playing games. However, after looking around, I found that servers were too troublesome… they consume a lot of electricity and make noise. If you want to add a graphics card, you need to modify the case… since I have no experience with hardware… so I decided to buy a desktop computer that is both affordable and sufficient for my needs. Originally, I was going to buy something on 618… but due to work changes, I didn’t have time or energy to mess around, so I gave up… recently, I saw a motherboard on JD at a discount, so I couldn’t resist buying it… but when I checked, I found that the CPU I wanted was hard to find new… (probably sold out during 618)… after several weeks of effort, I finally got everything and assembled my first self-built desktop computer!</p><!-- Abstract part --><span id="more"></span><h2 id="Component-List"><a href="#Component-List" class="headerlink" title="Component List"></a>Component List</h2><p>My configuration idea was a bit special because I had specific expectations for this machine. I hoped it could meet all the following requirements:</p><ol><li>Personal bioinformatics computation testing (multi-core + large memory + Linux)</li><li>Basic gaming needs on Windows</li><li>Virtualize into multiple machines with my girlfriend playing games together (two entry-level graphics cards + Linux + GPU passthrough + Windows virtual machines)</li><li>A small and beautiful case</li></ol><p>Based on these requirements, I chose a motherboard with 4 memory slots and 2 graphics card slots for M-ATX to support future upgrades to 32G or even 64G memory (some research institutions’ prototype software has huge memory consumption), and also to support dual GPUs for virtualizing two Windows machines. The CPU was difficult because the host needed an integrated graphics card, and I wanted AMD… so there wasn’t much choice, and the only model available at the moment was the 2400G…</p><p>Complete component list as follows:</p><table><thead><tr><th>Component</th><th>Model</th><th>Platform</th><th>Price</th><th>Notes</th></tr></thead><tbody><tr><td>Processor</td><td>AMD Ryzen 2400G</td><td>Taobao</td><td>760</td><td>Second-hand散片</td></tr><tr><td>Graphics Card</td><td>Dianlan Hengjin RX560d 4G</td><td>Taobao</td><td>245</td><td>Miner card</td></tr><tr><td>Motherboard</td><td>Gigabyte B450M DS3H</td><td>JD</td><td>499</td><td>Bought at a discount of 50…</td></tr><tr><td>Memory</td><td>Kingston Firebird DDR4 3000 8GB x 2</td><td>JD</td><td>498</td><td></td></tr><tr><td>Case</td><td>Thermaltake Challenger S3</td><td>JD</td><td>129</td><td></td></tr><tr><td>Power Supply</td><td>Thermaltake Smart RGB 600W</td><td>JD</td><td>278</td><td>Didn’t see… bought a non-modular…</td></tr><tr><td>Cooler</td><td>Thermaltake Rainbow D400P</td><td>JD</td><td>85</td><td>Didn’t see… 65W CPU with a 150W cooler…</td></tr><tr><td>Total</td><td></td><td></td><td>2494</td><td>Pretty cheap…</td></tr></tbody></table><p>Buying desktop components is really more complicated than buying laptops… I encountered:</p><ul><li>The CPU was out of stock, so I had to buy second-hand散片, but the second-hand散片 were also hard to find, and after looking at three places, I finally bought it, and even got 30 yuan in compensation for the appeal (out of stock but not taken off the shelf)…</li><li>Although I knew it was a miner card… but I didn’t notice that the one I bought had only DVI interfaces… so I had to buy an adapter later</li><li>Although the motherboard has two graphics card slots, you can’t directly plug in two GPUs because the lower graphics card slot would block the PIN lines and USB3.0 cables, needing additional adapters</li><li>The power supply I wanted was out of stock, so when buying a replacement, I didn’t notice that it was a non-modular power supply… subsequent cable management was a headache</li><li>The cooler size exceeded my expectations… fortunately, the case I bought was relatively large…</li><li>The case turned out to be much larger than expected… and ended up being a hit with the cooler…</li></ul><p>Buying components is already complicated enough… subsequent installation issues were one after another:</p><ul><li>Installed the cooler fan backwards, which made it difficult to take off later…</li><li>The non-modular power supply cable management was a headache</li><li>Installed the hard drive bracket backwards, almost couldn’t pull out</li><li>Didn’t notice the instructions in the wind cooler manual, spent two and a half hours installing</li></ul><p>After nearly two weeks of fiddling around, I finally got everything set up… as a buffer, I first installed Windows 10 to test playing Madoka Magica. It was quite surprising that the 2400G could run at 720p low quality smoothly… and since I was using my landlord’s TV… there wasn’t much difference between 720p and 1080p on this TV… which means if I just bought a machine to play Madoka Magica, cutting down 8GB of memory (250), buying a 2200G plus A320M set (1000元左右), using a 100 yuan power supply that came with the case, or even 1500 yuan could play Madoka Magica… so dependent… Madoka Magica is really affordable…</p><p>This is the hardware part of my desktop setup plan. I’ll update the software part later~</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Daily </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Syncthing for File Synchronization</title>
      <link href="/en/2019/08/18/%E4%BD%BF%E7%94%A8Syncthing%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5/"/>
      <url>/en/2019/08/18/%E4%BD%BF%E7%94%A8Syncthing%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<p>As long as you use multiple devices for work, you will inevitably encounter the problem of mutual synchronization between different devices. Now that it’s not the era when cloud services just started to rise and were cheap and generous, there probably isn’t a reliable and user-friendly service provider that won’t suddenly run away or change its terms of service. So, we still have to rely on ourselves to set up our own…</p><!-- Abstract part --><span id="more"></span><p>Syncthing is introduced in <a href="https://www.appinn.com/syncthing/">Little Known Software</a> and <a href="https://www.iplaysoft.com/syncthing.html">Anycard Software</a>, a simple yet open-source synchronization software.</p><p>Since the official version already provides pre-packaged executable files, Syncthing can be run directly on three major platforms without needing to download any additional packages. Therefore, I won’t repeat that part here. This post mainly records how to set up Syncthing as a service on my computer and VPS.</p><p>Both CentOS7 and Manjaro use systemd, and the command for managing services is <code>systemctl</code>, so the operations are the same.</p><p>First, find the Syncthing executable file package. Inside the <code>Syncthing/etc/</code> directory, there are sample service configuration files. I used the <code>Syncthing/etc/linux-systemd/user/syncthing.service</code> file. Open this file and change the program path in the <code>[Service]</code> section of <code>ExecStart</code>. Since I am setting up this service as a user-level service rather than a system-wide service, I copied this file to <code>~/.config/systemd/user/</code>, then started the service using the following commands:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl --user <span class="built_in">enable</span> syncthing.service</span><br><span class="line">systemctl --user start syncthing.service</span><br></pre></td></tr></table></figure><p>After starting, you can use <code>systemctl</code> like other services to check the status of the Syncthing service.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/Syncthing.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/Syncthing.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Syncthing"><br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Syncthing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Hooks Usage</title>
      <link href="/en/2019/08/17/Git%E9%92%A9%E5%AD%90%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2019/08/17/Git%E9%92%A9%E5%AD%90%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Although I also use Git for some project code management, I actually don’t know many of Git’s features and haven’t used them. Today, I tried using Git hooks.</p><!-- Abstract part --><span id="more"></span><p>Hook, directly translated as a hook, refers to a series of predefined scripts. These scripts are automatically executed when we use specific Git commands to perform some code management operations, with the purpose of reducing repetitive operations and improving efficiency.</p><p>For example, my blog source code is managed by Git. The steps I take to write a blog post and publish it are:</p><ol><li><code>hexo new post</code> creates a markdown draft for a new blog post.</li><li>Open the newly created markdown file and write content.</li><li>After writing, run <code>hexo g</code> and <code>hexo d</code> to generate and push the blog content to the Gitpages source.</li><li>Run <code>git commit</code> to submit changes to the blog source code, then <code>git push</code> to the source repository.</li></ol><p>Among these steps, there may be some variable operations during the writing process, but the last two steps are always repeated and not very changeable each time I write a blog post. These steps can be executed using hooks.</p><p>First, we need to determine when these things should be executed: My blog source code is checked before <code>commit</code>. Therefore, theoretically, any hook triggered by <code>git commit</code> can be used. The actual selected hook is <code>post-commit</code>, which executes after <code>commit</code>, so I wrote the following content into the <code>.git/hooks/post-commit</code> file of the project (the name should not be changed; specific names are required to be executed).</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /home/silen/git_proj/silen_blog/</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>Then, give this file executable permissions. This way, every time I complete a commit for this project, the script will automatically generate and push the blog.</p><p>Of course, the example here may not be very attractive because these two steps are actually not many… saving a lot of effort. But now, in addition to my main site, I have set up a personal quick reference manual on a sub-site using mkdocs, which is another independent project. If I want to achieve that one update synchronizes the other, hooks would be very useful.</p><p>Finally, it’s worth noting that Git hooks are divided into client-side and server-side. I am currently using a client-side hook. One drawback of client-side hooks is that they cannot synchronize across different copies of the project (different copies are different clients), which is a problem I will need to solve later…</p><p>That’s all.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> githook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Decorators</title>
      <link href="/en/2019/08/15/%E8%A3%85%E9%A5%B0%E5%99%A8%E5%85%A5%E9%97%A8/"/>
      <url>/en/2019/08/15/%E8%A3%85%E9%A5%B0%E5%99%A8%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>A long time ago, a Python expert from my previous company taught us about decorators. However, due to my愚钝ness, I never fully understood this concept and didn’t use it in actual coding. Therefore, I’m recording this example that comes up at work.</p><p>Firstly, the role of a decorator in Python is to attach new functionality to an existing function without modifying its code. This requires defining a function that takes another function as an argument and returns a function.</p><p>This week, I encountered a problem where I wrote a function to calculate some metrics for UMI sequences in a <code>Bam</code> file. However, the <code>Bam</code> files have two types of UMIs:</p><ul><li>Double-end with N bp UMIs</li><li>Single-end with N bp UMIs</li></ul><p>The way to read UMIs from these files is different: single-end requires reading the full length of the UMI, while double-end only reads half the length. The original single-end code looks like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">single_count</span>(<span class="params">file, tag, mode</span>):</span><br><span class="line">    umi_count = &#123;</span><br><span class="line">        <span class="string">&#x27;R1&#x27;</span>: [],</span><br><span class="line">    &#125;</span><br><span class="line">    infos = load_single(file)</span><br><span class="line">    <span class="keyword">for</span> info <span class="keyword">in</span> infos:</span><br><span class="line">        <span class="keyword">if</span> info[<span class="string">&#x27;strand&#x27;</span>] == <span class="string">&#x27;R1&#x27;</span>:</span><br><span class="line">            umi_count[<span class="string">&#x27;R1&#x27;</span>].append(info[<span class="string">&#x27;umi&#x27;</span>])</span><br><span class="line">    umi_count[<span class="string">&#x27;R1&#x27;</span>] = Counter(umi_count[<span class="string">&#x27;R1&#x27;</span>])</span><br><span class="line">    total_umi = <span class="number">0</span></span><br><span class="line">    read_with_umi = <span class="number">0</span></span><br><span class="line">    max_grp_size = <span class="number">0</span></span><br><span class="line">    max_umi = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    size_stat = Counter([<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>])</span><br><span class="line">    <span class="keyword">for</span> umi <span class="keyword">in</span> umi_count[<span class="string">&#x27;R1&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> umi_count[<span class="string">&#x27;R1&#x27;</span>][umi] &gt; max_grp_size:</span><br><span class="line">            max_grp_size = umi_count[<span class="string">&#x27;R1&#x27;</span>][umi]</span><br><span class="line">            max_umi = umi</span><br><span class="line">        <span class="keyword">for</span> size <span class="keyword">in</span> size_stat: <span class="comment"># 注意初始化的时候, 全都是1, 不是0, 所以最后要处理(-1)</span></span><br><span class="line">            <span class="keyword">if</span> umi_count[<span class="string">&#x27;R1&#x27;</span>][umi] &lt;= size:</span><br><span class="line">                size_stat[size] += <span class="number">1</span></span><br><span class="line">        total_umi += <span class="number">1</span></span><br><span class="line">        read_with_umi += umi_count[<span class="string">&#x27;R1&#x27;</span>][umi]</span><br><span class="line">    size_stat = OrderedDict(<span class="built_in">list</span>([(<span class="string">&quot;%%Group_Size_below_%s(%s)&quot;</span> % (size, tag), <span class="built_in">str</span>((size_stat[size] - <span class="number">1</span>) / total_umi )) \</span><br><span class="line">        <span class="keyword">for</span> size <span class="keyword">in</span> size_stat])) <span class="comment"># python所以要先list化</span></span><br><span class="line">    <span class="keyword">return</span> total_umi, read_with_umi, max_grp_size, max_umi, size_stat</span><br></pre></td></tr></table></figure><p>The only difference between the double-end and single-end code is that <code>infos = load_single(file)</code> needs to be replaced with <code>infos = load_duplex(file)</code>. To achieve this, there is a straightforward way: add a parameter to the function and decide whether to call <code>load_duplex</code> or <code>load_single</code> based on the parameter. However, this would require modifying the function code as well as the code that calls this function. If there are many such places, it’s easy to introduce new bugs. Therefore, I tried using decorators to solve this problem:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_mod</span>(<span class="params">func</span>):</span><br><span class="line">    load_single = load_duplex</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line"><span class="meta">@load_mod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">duplex_count</span>(<span class="params">file, tag, mode</span>):</span><br><span class="line">    <span class="keyword">return</span> single_count(file, tag, mode)</span><br></pre></td></tr></table></figure><p>Here, I defined two functions: <code>duplex_count</code> aims to repeat all the steps in <code>single_count</code> except for <code>infos = load_single(file)</code>, and only change the function called to <code>load_duplex</code>. Therefore, you can see that this function’s content is essentially returning the result of <code>single_count</code>.</p><p>However, this alone doesn’t complete the replacement of the two load functions. That’s where <code>load_mod</code> comes into play: it replaces the content in the local namespace with <code>load_duplex</code>. By decorating <code>duplex_count</code> with <code>load_mod</code>, it’s equivalent to replacing the function call before executing it, so that the function executes differently.</p><p>Of course, I use it more like the ‘closure’ usage in common decorator tutorials rather than ‘adding new functionality to a function’.</p><p>Other applications will be discussed later.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Decorators </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dark History Project, Start!</title>
      <link href="/en/2019/07/27/%E9%BB%91%E5%8E%86%E5%8F%B2%E8%AE%A1%E5%88%92-%E5%90%AF%E5%8A%A8/"/>
      <url>/en/2019/07/27/%E9%BB%91%E5%8E%86%E5%8F%B2%E8%AE%A1%E5%88%92-%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<p>As a former <del>and still</del> chuunibyou <del>uncle</del> teenager, how could I not have any dark history?</p><!-- Summary part --><span id="more"></span><p>The other day when I was searching for my Google ID, I suddenly remembered that I used to post blogs on NetEase LOFTER and Ant Notes… <del>I’ll let the love-hate stories with my ex-girlfriend stay on NetEase Blog</del>. I took a quick look and found quite a bit of content. It turns out that I wasn’t as asocial back then hhhhhhhh. Since it’s just my personal gitpage, why not follow the trend and repurpose the old content? Let’s see how past me was… so idle… <del>With hundreds of posts on LOFTER, my mentor is truly generous</del>.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/lofter.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/lofter.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Since most of the old content is about daily life, I’ll put them all under <code>Daily</code>. Because it’s a repost, I’ll keep the original dates, so these posts won’t appear on the homepage. Also, since some short posts don’t have much value in republishing, I’ll skip those.</p><p>That’s it.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MultiQC Simple Usage</title>
      <link href="/en/2019/07/27/MultiQC%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2019/07/27/MultiQC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>MultiQC is a tool for NGS data quality control. Unlike many other tools, it does not directly obtain and calculate metrics; instead, it reads results files from various common quality control tools and provides comprehensive reporting.</p><!-- Abstract section --><span id="more"></span><p>Currently, MultiQC supports 75 types of tools, with the ability to add more information (although I haven’t tried it yet). It covers the entire process from base calling to mutation detection, and the reports generated are very aesthetically pleasing, making them ideal for final data quality summaries.</p><p>MultiQC’s usage is quite simple. First, place the result files from other tools in a unified directory. Then run <code>MultiQC /path/to/file</code>, and MultiQC will search for various quality control results in the folder and generate the final summary report. For example, I have a report generated by MultiQC using FastQC results:</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>You can see that the entire report is very beautiful. At the top of the report, there is a table summarizing various metrics. On the left side is a navigation bar showing calculated metrics for different software. Depending on the software used, specific content may be displayed as charts or tables. In the top summary table, by default, only some metrics are shown. If you want to change the selected metrics, click <code>configure columns</code> to adjust which metrics need to be displayed.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report_config.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report_config.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Another convenient feature is that you can click the <code>plot</code> button to select two metrics from the summary table for a scatter plot. This feature will be particularly useful when checking for anomalies later.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report_plot.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/multiqc_report_plot.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>That’s all for a simple introduction. For more advanced usage, such as customizing new metrics and changing sample name matching rules to consolidate results from the same samples, I will continue to update this post with new findings.</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qc </tag>
            
            <tag> multiqc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Common Machine Learning Methods</title>
      <link href="/en/2019/07/09/%E5%B8%B8%E8%A7%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/"/>
      <url>/en/2019/07/09/%E5%B8%B8%E8%A7%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>Recently, my work requires me to understand some common machine learning methods. I’ll just write a post about it…</p><span id="more"></span><ul><li>Decision Trees: Build multi-level recursive binary classification paths based on attributes, and finally arrange the input object in an appropriate position according to this series of binary classification results.<ul><li>Pro: Easy to understand and explain</li><li>Con: Sensitive to missing data; prone to overfitting; does not consider the correlation between attributes (treats them as independent?)</li></ul></li><li>Random Forest Algorithm: Based on decision trees. First, split the training data into multiple subsets, generate a decision tree for each subset, then input the classification information to be classified into each decision tree, and finally decide the final result by minority obeys the majority.<ul><li>Pro: Not prone to overfitting, has good noise resistance, insensitive to outliers</li><li>Con: Poor interpretability, easily affected by multi-class attributes</li></ul></li><li>Lasso regression: An improvement on general linear regression, it reduces model complexity by penalizing coefficients.<ul><li>Pro: Strong interpretability, solves overfitting</li><li>Con: Penalization can cause underfitting</li></ul></li><li>Logistic Regression: Uses logistic regression to get the relationship between the probability ratio of the dependent variable classification result and the input independent variables.<ul><li>Pro: Highly interpretable</li><li>Con: Essentially a generalized linear model, not suitable for some complex situations</li></ul></li><li>Support Vector Machine (SVM): Separates points on a plane with a straight line. The distance between the two classes of points closest to the line is maximized. Extending this problem to multidimensional space results in support vector machines.<ul><li>Pro: Suitable for small sample sizes, has good universality</li><li>Con: Poor interpretability, sensitive to missing data</li></ul></li><li>K-Nearest Neighbors (KNN): Places new data in a multidimensional space with known classified points. If the majority of the K nearest points belong to a certain class, this point belongs to that class.<ul><li>Pro: Simple theory and easy implementation</li><li>Con: Large computational load, recalculates every time for classification, significantly affected by imbalanced classification</li></ul></li><li>Naive Bayes: Uses Bayes’ formula to calculate the probability of being in a certain category.<ul><li>Pro: Simple implementation and only requires a small amount of training data. Fast during large-scale calculations.</li><li>Con: When applying the Naive Bayes classifier, it must satisfy the condition that all attributes are conditionally independent.</li></ul></li><li>K-Means Algorithm: A clustering algorithm in unsupervised learning; first select K initial points from a set of data, calculate the distance between all points and these K points, then assign each point to the nearest one among the K. After the first round of classification is completed, calculate an average center point (K) for each category of points, then recalculate the distance from all points to these K center points, and assign them to the nearest category. Repeat this process. When repeated a certain number of times, the grouping will stabilize, at which point it stops.<ul><li>Pro: Not sensitive to outliers</li><li>Con: Large computational load when dealing with large amounts of data, poor effect with small amounts of data; easily affected by imbalanced classification</li></ul></li><li>Adaboost Algorithm: Combines multiple classifiers (multiple models) to achieve better classification results.<ul><li>Pro: Combines multiple basic algorithms and considers the weights of different classifiers</li><li>Con: Training time-consuming</li></ul></li><li>Neural Network (NN): A relatively complex deep learning (DL) method. Personally, I understand that the neurons in a neural network are similar to decision trees, which will get a classification result based on input data, then pass this result to downstream neurons. The downstream neuron accepts upstream information and derives results before passing them on, finally summarizing the last layer’s results to give a classification result.<ul><li>Pro: High classification accuracy, strong robustness and fault tolerance</li><li>Con: Deep learning, large computational load, poor interpretability</li></ul></li><li>Markov Chain (Markov Model): I didn’t understand…</li></ul><p>Main content excerpted from:<br><a href="https://cloud.tencent.com/developer/article/1006091">轻松看懂机器学习十大常用算法</a><br><a href="https://blog.csdn.net/mach_learn/article/details/39501849">机器学习算法优缺点及其应用领域</a></p><p>Of course… my explanations are not as simple and clear as those in the video. It seems that now learning requires Bilibili…</p><iframe src="//player.bilibili.com/player.html?aid=20922906&cid=34291885&page=1" width="700" height="500" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><p><a href="https://www.bilibili.com/video/av20922906?t=585">Video Source</a>, if you like it, please go follow the up and give it a triple like!</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> machine learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Gitbook and mkdocs for Documentation</title>
      <link href="/en/2019/07/07/%E4%BD%BF%E7%94%A8Gitbook%E5%92%8Cmkdocs%E5%86%99%E6%96%87%E6%A1%A3/"/>
      <url>/en/2019/07/07/%E4%BD%BF%E7%94%A8Gitbook%E5%92%8Cmkdocs%E5%86%99%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<p>My blog is generated using Hexo, a static blog framework based on Node.js. It helps people like me who know nothing about frontend development to quickly set up a decent-looking blog, while I only need to know how to write posts in Markdown. Similarly, during development there’s always a need to write technical documentation, hence tools like Gitbook and mkdocs exist.</p><span id="more"></span><p>Gitbook and mkdocs actually have different positioning. Gitbook was originally designed for quickly writing books (including documentation) using Markdown, while mkdocs helps technical personnel quickly write and maintain easily modifiable documentation. But in the hands of beginners like me…their basic functionalities are quite similar, so there’s not much difference…</p><h2 id="Gitbook"><a href="#Gitbook" class="headerlink" title="Gitbook"></a>Gitbook</h2><p><code>gitbook-cli</code> is a Node.js-based tool that can be installed via npm: <code>npm install gitbook-cli</code>. Note that due to changes in the Gitbook project’s direction, this CLI tool is no longer being updated. However, the basic features are sufficient and it still works fine…</p><p>After installation, you can use the <code>gitbook</code> command to create and write documentation. The creation command is <code>gitbook init</code>, which generates <code>README.md</code> and <code>SUMMARY.md</code> files in the directory. <code>SUMMARY.md</code> serves as both the table of contents and structure file - <code>gitbook-cli</code> uses this file to generate the final documentation. <code>SUMMARY.md</code> itself is also a Markdown file:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Chapter 1</span></span><br><span class="line"><span class="bullet">*</span> [<span class="string">Documentation</span>](<span class="link">README.md</span>)</span><br><span class="line"><span class="bullet">*</span> [<span class="string">Part 1</span>](<span class="link">Part1/README.md</span>)</span><br><span class="line"><span class="bullet">    *</span> [<span class="string">Content 1</span>](<span class="link">Part1/content1.md</span>)</span><br><span class="line"><span class="bullet">        *</span> [<span class="string">Sub-content</span>](<span class="link">Part1/content1.md</span>)</span><br><span class="line"><span class="section"># Chapter 2</span></span><br><span class="line"><span class="bullet">*</span> [<span class="string">XXXX</span>](<span class="link">NNNN.md</span>)</span><br></pre></td></tr></table></figure><p>Book chapters are controlled by first-level heading syntax (<code>#</code>). Different chapters are separated by dividers in the table of contents tree. If auto-numbering is enabled, the numbering will differ between chapters.</p><p>Chapter contents are stored as unordered lists, with each list item using link syntax (<code>[]()</code>) to point to specific Markdown files. Within these Markdown files, first-level headings serve as anchors. Currently only first-level headings work as anchors - if you need to anchor to second-level headings or other content, you’ll need to manually add HTML tags as anchors.</p><p>Gitbook supports all basic Markdown syntax as well as HTML, so if you need to include complex tables, you can write them in HTML format and paste them directly.</p><p>With this knowledge, you can basically start writing books. If you need to customize the appearance or use plugins, you can create a <code>book.json</code> configuration file and fill in the settings accordingly.</p><p>After writing, you can use <code>gitbook serve</code> to preview the book locally (default port 8000). The preview service can remain running, and modifications to Markdown source files will be reflected in real-time (may require refresh). When you’re satisfied with the book, use <code>gitbook build</code> to generate HTML files in the <code>_book/</code> directory.</p><h2 id="mkdocs"><a href="#mkdocs" class="headerlink" title="mkdocs"></a>mkdocs</h2><p><code>mkdocs</code> is a Python-based tool that can be easily installed via <code>pip</code> or <code>conda</code>. After installation, the <code>mkdocs</code> command becomes available. To create documentation, use <code>mkdocs new proj_name</code>, which creates an <code>mkdocs.yml</code> file and <code>docs/</code> folder in the <code>proj_name/</code> directory. <code>mkdocs.yml</code> serves as both configuration and table of contents file, using YAML format:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">site_name:</span> <span class="string">&quot;My Documentation&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pages:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Table of Contents:</span> <span class="string">index.md</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Chapter 1:</span> <span class="string">chapter1.md</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">Chapter 2:</span> <span class="string">chapter2.md</span></span><br><span class="line"></span><br><span class="line"><span class="attr">theme:</span> <span class="string">readthedocs</span></span><br></pre></td></tr></table></figure><p>mkdocs generates a table of contents similar to common Markdown TOCs, without needing additional anchor settings like Gitbook. Since my use case was relatively simple, I didn’t explore more advanced features.</p><p>Completed documentation can be previewed using <code>mkdocs serve</code>, which also updates in real-time. Alternatively, use <code>mkdocs build</code> to generate static files in the <code>site/</code> directory.</p><h2 id="Comparison-of-the-Two-Tools"><a href="#Comparison-of-the-Two-Tools" class="headerlink" title="Comparison of the Two Tools"></a>Comparison of the Two Tools</h2><p>I’ve used both tools while preparing handover documentation and have some comparative observations.</p><p>In terms of basic functionality, there’s almost no difference for my needs - both use Markdown for writing documentation, have simple commands, and support local preview. However, since gitbook-cli is no longer updated, there might be future compatibility issues.</p><p>Regarding extensibility…they’re also quite similar, with many plugins available for both. One notable difference is that Gitbook seems to lack third-party themes? I searched many times but couldn’t find ready-to-use themes, while mkdocs comes with several built-in ones.</p><p>Also, since this was handover documentation for work, my colleagues weren’t accustomed to reading HTML, so I tried PDF export plugins for both tools…they work…but not very elegantly…compared to the HTML output, both PDFs look rather crude…though if I had to choose, mkdocs’ PDF output is slightly better.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> documentation </tag>
            
            <tag> gitbook </tag>
            
            <tag> mkdocs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Two Bash Tricks</title>
      <link href="/en/2019/06/05/Bash%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B8%A4%E5%88%99/"/>
      <url>/en/2019/06/05/Bash%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B8%A4%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p>While chaining various programs using Bash, you often discover some amazing and useful tricks. Here are two I recently found.</p><!-- Abstract part --><span id="more"></span><p>The first trick is something I discovered when trying to replace <code>samtools</code> with <code>sambamba</code>. <code>sambamba</code> is a tool designed to replace <code>samtools</code> for handling BAM files, and many of its commands are similar to those in <code>samtools</code>. However, one subcommand did not support standard output, which meant that you had to generate an intermediate file before reading it for the next step. This was very wasteful of I&#x2F;O resources. After searching online, I found out that there are three special files in Linux: <code>/dev/stdin</code>, <code>/dev/stdout</code>, and <code>/dev/null</code>. These correspond to standard input, standard output, and discarding, respectively. For programs that do not explicitly support standard input&#x2F;output, you can try replacing the input&#x2F;output files with these special files to achieve reading content from standard input or writing output to standard output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sambamba merge -t 4 /dev/stdout input1.bam input2.bam \</span><br><span class="line">| sambamba <span class="built_in">sort</span> -o /dev/stdout /dev/stdin \</span><br><span class="line">| samtools view -Sb -f 30 \</span><br><span class="line">&gt; output.srt.flt.bam</span><br></pre></td></tr></table></figure><p><code>/dev/null</code> is also very useful. For example, <code>samblaster</code> only supports the <code>-o</code> option by default, which outputs the main result to standard output. However, I actually need the <code>-s</code> or <code>-u</code> options and want to process these results further. So, I can use <code>/dev/null</code> to discard the main result and then output the needed results to <code>/dev/stdout</code> for subsequent operations:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">samtools view -h \</span><br><span class="line">| samblaster \</span><br><span class="line">    --ignoreUnmated \</span><br><span class="line">    -o /dev/null \</span><br><span class="line">    -d /dev/null \</span><br><span class="line">    -s /dev/null \</span><br><span class="line">    -u /dev/stdout \</span><br><span class="line">| sed <span class="string">&quot;s/_[0-9]//g&quot;</span> \</span><br><span class="line">| /soft/bwa-0.7.15/bin/bwa mem \</span><br><span class="line">    -t 30 -k 32 -M -R <span class="string">&quot;@RG\tID:<span class="variable">$&#123;sam_id&#125;</span>\tLB:<span class="variable">$&#123;sam_id&#125;</span>\tSM:<span class="variable">$&#123;sam_id&#125;</span>\tPL:ILLUMINA&quot;</span> \</span><br><span class="line">    /resource/GV/ref_genome/hg38/bwa-0.7.15/hg38.fa /dev/stdin \</span><br><span class="line">| samtools view -Sb -f 256 \</span><br><span class="line">| samtools merge -f output.bam input.bam /dev/stdin</span><br></pre></td></tr></table></figure><p>Another trick is to mask command results as files for input. For example, if I have multiple two-column files where one column is a data title and the other is a data value, and I want to merge them into one while retaining the first column’s titles, I can do:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">paste</span> file1 \</span><br><span class="line">    &lt;(<span class="built_in">cut</span> -f 2 file2) \</span><br><span class="line">    &lt;(<span class="built_in">cut</span> -f 2 file3) \</span><br><span class="line">    &lt;(<span class="built_in">cut</span> -f 2 file4) \</span><br><span class="line">    &gt; pasted_file</span><br></pre></td></tr></table></figure><p>In the above operation, the data from <code>file&#123;2..4&#125;</code> is intercepted using <code>cut -f 2</code> and then masked as files to be input into the <code>paste</code> command. This avoids using intermediate files and makes the process more efficient.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rewriting My Project in Go Language</title>
      <link href="/en/2019/06/02/%E7%94%A8Go%E8%AF%AD%E8%A8%80%E9%87%8D%E5%86%99%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/"/>
      <url>/en/2019/06/02/%E7%94%A8Go%E8%AF%AD%E8%A8%80%E9%87%8D%E5%86%99%E6%88%91%E7%9A%84%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>To learn Go language, I rewrote a script that was used frequently in my previous work. Compared to Python, which is simple, quick, easy to understand and has many useful third-party modules with abundant learning materials in both Chinese and English, if it wasn’t for performance reasons, I really wouldn’t want to switch…</p><!-- Abstract part --><span id="more"></span><h2 id="A-Go-Language-Beginner’s-View"><a href="#A-Go-Language-Beginner’s-View" class="headerlink" title="A Go Language Beginner’s View"></a>A Go Language Beginner’s View</h2><p>Since most of my larger programs were written in Python and R, which are not strong-typed languages, the difficulty mainly lies in using third-party modules and handling logical bugs designed by myself.</p><p>Go is different… it is a strongly typed language. Variables must be declared before use, and once declared, their type cannot be changed later. This made me feel uncomfortable for a long time when I first started learning Go…</p><p>Although Go provides interfaces to some extent to increase usability, as a beginner who didn’t have similar concepts in Python, R, or Bash, it took me quite some time to understand what an interface actually is.</p><p>After solving the basic variable usage issues, there were differences in error handling methods, fewer third-party modules, and lack of Magic writing techniques, among other things. These problems had to be solved one by one… ultimately leading to this rewrite taking two whole weeks to initially complete…</p><p>Although it was difficult, once you experience its speed, many people would be as excited as me (although during this rewrite, I also optimized the algorithm, but that optimization is absolutely not enough to bring a 200-fold difference).</p><p>Well, the world changes so fast, learning something new is never wrong~</p><p>Here’s the address of the rewritten project: <a href="https://github.com/SilenWang/FUEX">FUEX</a></p><h2 id="Quickly-Mastering-Go-with-Python-as-Reference"><a href="#Quickly-Mastering-Go-with-Python-as-Reference" class="headerlink" title="Quickly Mastering Go with Python as Reference"></a>Quickly Mastering Go with Python as Reference</h2><p>Just like how I always found it hard to think in English when learning it from Chinese, writing this practice project was inevitably influenced by my way of thinking in Python. However, Python and Go are two very different languages, some things that are used in Python have similar or even no equivalents in Go, so here’s a summary of the alternative implementation schemes I encountered during this development.</p><h3 id="Variables-Data-Types"><a href="#Variables-Data-Types" class="headerlink" title="Variables&#x2F;Data Types"></a>Variables&#x2F;Data Types</h3><h4 id="Variable-Declaration-and-Initialization"><a href="#Variable-Declaration-and-Initialization" class="headerlink" title="Variable Declaration and Initialization"></a>Variable Declaration and Initialization</h4><p>In Python, there is no separate step for variable declaration and initialization. You can directly use <code>var=value</code> to use it, and the type of the variable can be changed later when processing. For example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var1 = <span class="literal">True</span></span><br><span class="line">var2 = <span class="number">1</span></span><br><span class="line">var1 = var2 <span class="keyword">if</span> var2 <span class="keyword">else</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>In the above code, <code>var1</code> and <code>var2</code> are automatically assigned types (boolean, int), and although their types are different, you can pass the value of <code>var2</code> to <code>var1</code>, and after passing, <code>var1</code> will change from boolean to int.</p><p>While all variables need to be declared like this, Go provides a simple way: <code>var1 := 1</code>. This allows you to declare and assign a variable at the same time, with the type of the variable automatically specified. However, since it’s automatically specified, if there are special requirements for the type, it might still be better to declare it manually.</p><h4 id="Go-is-a-Strongly-Typed-Language"><a href="#Go-is-a-Strongly-Typed-Language" class="headerlink" title="Go is a Strongly Typed Language"></a>Go is a Strongly Typed Language</h4><p>The term “strongly typed” refers to the detailed classification of variables in the language and the strict restrictions on passing and using variables of different types during program execution (personal understanding). In Python, the variable types are numbers, strings, logic, and empty (<code>None</code>), with complex ones being numbers further divided into floating-point and integers. Even Python has gotten rid of constants, only having variables, but it recommends using all uppercase letters to indicate constants in language writing suggestions (actually, the value can still be changed).</p><p>In Go, there are constants (<code>Const</code>) and variables (<code>Var</code>). While variables have integer, float, logic types among others, integers and floats are further divided into different lengths such as <code>int16</code>, <code>int32</code>, <code>int64</code>. Even the <code>uint</code> I’m not quite clear about… These variable types cannot be automatically converted during use. For example, if a function gives you an <code>int16</code>, and the next function needs an <code>int64</code>, you still need to manually convert it once… These type conversions are really very uncomfortable for me who is used to Python.</p><p>Another thing to note is that in Go, <code>byte</code> and <code>string</code> are two different types. Characters use single quotes (‘), while strings use double quotes (“).</p><h4 id="Complex-Data-Types—-Arrays-Slices-Collections-Structures"><a href="#Complex-Data-Types—-Arrays-Slices-Collections-Structures" class="headerlink" title="Complex Data Types—-Arrays&#x2F;Slices&#x2F;Collections&#x2F;Structures"></a>Complex Data Types—-Arrays&#x2F;Slices&#x2F;Collections&#x2F;Structures</h4><p>Just like Python has Tuple, List, Dict, Set for storing multiple elements or mapping data, Go also has data types that meet the needs of data storage and processing:</p><p>Array: Arrays are similar to Lists or Tuples. First, the length of an array in Go is fixed and cannot be changed once declared. At the same time, although the contents stored in an array can be mutable, the type of the stored elements must be fixed.</p><p>Slice: Similar to arrays, but its length is variable.</p><p>Map: Equivalent to Dict, similarly, both the Key and Value types are fixed and unchangeable. The Keys used by Map can be any type that supports logical comparison <code>==</code>.</p><p>Finally, what I needed most in my project was structures. It’s similar to R’s list or Python’s nested Dict, where it can store various kinds of information.</p><h4 id="Strong-Typing-with-Flexible-Handling—-Interface-interface"><a href="#Strong-Typing-with-Flexible-Handling—-Interface-interface" class="headerlink" title="Strong Typing with Flexible Handling—-Interface(interface)"></a>Strong Typing with Flexible Handling—-Interface(interface)</h4><p>Interfaces are a new concept I encountered when接触Go. It is quite different from the API I’ve heard before. I spent quite some time trying to understand it… here’s a record.</p><p>First, according to the previous section, we know that Go is strongly typed. This strong typing runs through the entire language system and can sometimes cause unnecessary troubles. For example, when writing functions, you need to define the types of the receiving and returning variables, input and return variables must be given types. Once the type is determined, the function can only receive&#x2F;this type of variable, it cannot change. This is very annoying. We write programs, there are many times when we have some functions that need to receive some objects with unclear situations, then according to the situation of the object for further processing. But under the rules of strong typing, receiving things must be a determined type. Then you have to write two duplicate functions to receive different types of objects and do similar processing.</p><p>Take an actual example from <code>vcfgo</code>‘s <code>Info().Get()</code> function. This function’s purpose is to take out corresponding information in the INFO column of a vcf file and return it. Each INFO item may have multiple values, if there is only one value, then return the corresponding string, if there are multiple, then put them into a list with strings as elements and return it. This looks very simple, but under the rules of strong typing, it cannot be directly implemented. Because when defining functions, you must define the type of the returned variable. A variable’s type defined as a string cannot store a list of strings, vice versa. Then to achieve the target function, do we have to let the function have multiple return values? This is when <code>interface</code> comes into play. The definition of an interface is that as long as an object implements the methods defined in the interface, it has implemented this interface and can be passed in the form of this type. Returning back to the previous problem, just define an interface, then let the things you want to return implement this interface, so they can be returned in the form of interfaces.</p><p>Finally, note that since the return is an interface, their types are all <code>interface</code>. If you need to pass them further, you may still need to use assertion to take them out from the interface as the original type. For example, there’s a line in my project:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> annObj, ok := anns.(<span class="type">string</span>); ok &#123; <span class="comment">// Single annotation, directly parse</span></span><br><span class="line">annTarget = annObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This line of code where <code>ann</code> is the return value of the <code>Info().Get()</code> function. This interface may be a string or a list of strings, and I use <code>anns.(string)</code> to try to assert that it’s a string inside. If the assertion is correct, then directly assign the parsed string, if incorrect, then perform another processing.</p><h3 id="File-Operations"><a href="#File-Operations" class="headerlink" title="File Operations"></a>File Operations</h3><p>Python’s file reading and writing are very simple. Just one line of code opens a file, and the obtained object is iterable. You can directly use <code>for</code> loop to process file content line by line. Writing files is similar, it can be done with just a few lines of code too. At the same time, Python has a <code>with</code> statement that automatically closes the file handle after operations are completed, which is very convenient.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;file&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br></pre></td></tr></table></figure><p>Compared to Go, file reading and writing are much more troublesome. For example, if I want to read file content line by line and print it:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(vcfFile)</span><br><span class="line"><span class="keyword">defer</span> file.Close() <span class="comment">// Automatically close the file handle, similar to using &#x27;with&#x27; in Python</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">reader := bufio.NewReader(file)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">str, err := reader.ReadString(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The main steps are first opening a file, then specifying with another function to read one line of content using <code>&#39;\n&#39;</code> as the delimiter. Then print the read content to the screen. Actually, the core part is similar to Python, but some things have become self-handled, so the code naturally becomes longer. For example, after opening the file, error handling in Go has to be done manually. If Python can’t find a file when reading, it will automatically throw an exception and tell you that the file doesn’t exist, then exit. In contrast, writing Go requires manual <code>panic</code> and displaying the error message from <code>err</code>. In Python, using <code>for</code> to iterate over the opened file object allows you to read file content line by line, and it will automatically terminate when reaching the end of the file. In Go, this process has to be written manually, even specifying that files are separated by <code>&#39;\n&#39;</code>.</p><p>Writing files is similar to reading, but slightly more complex in Go. Here’s a pit I’ll fill later.</p><h3 id="Nested-Data-Structures"><a href="#Nested-Data-Structures" class="headerlink" title="Nested Data Structures"></a>Nested Data Structures</h3><p>Python commonly used data structures can be nested to form complex data structures to meet actual data processing needs. This kind of nested data structure is very flexible because dict&#x2F;list&#x2F;tuple&#x2F;set have no special restrictions on what they store, so we can easily compose a series of different things into one organized structure. This is one reason why I prefer Python over R for certain data processing tasks (R has some internal structures that only store similar types of elements). For example, in the refGene file information stored in my project, my program needs to read out a gene’s transcript number, exon start and end positions, transcription direction, gene name, etc. series of information. Among them, the transcript number is a string, the exon start and end positions store a list of integers, the transcription direction is a single character, and the gene name is also a string. This series of information can be stored in a large dictionary with <code>Key: Value</code> form, and you can get the corresponding value according to the Key when needed.</p><p>This is impossible in Go, because <code>list</code> corresponds to arrays, <code>dict</code> corresponds to maps, in Go they can only store things declared beforehand:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">outStrList := []<span class="type">string</span>&#123;<span class="string">&quot;out1&quot;</span>, <span class="string">&quot;out2&quot;</span>&#125; <span class="comment">// Can only store strings</span></span><br><span class="line">gene2tran := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>) <span class="comment">// Key and Value must be strings</span></span><br></pre></td></tr></table></figure><p>Therefore, to achieve similar nested data structures as Python, you have to use the structure <code>struct</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Structure I defined in my project to store transcript information</span></span><br><span class="line"><span class="keyword">type</span> geneRecord <span class="keyword">struct</span> &#123;</span><br><span class="line">exon        [][]<span class="type">int64</span></span><br><span class="line">intron      [][]<span class="type">int64</span></span><br><span class="line">transRegion [<span class="number">2</span>]<span class="type">int64</span></span><br><span class="line">cdsRegion   [<span class="number">2</span>]<span class="type">int64</span></span><br><span class="line">chr         <span class="type">string</span></span><br><span class="line">strand      <span class="type">string</span></span><br><span class="line">geneSymbol  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line">tran2info := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]geneRecord) <span class="comment">// map of structures</span></span><br></pre></td></tr></table></figure><h3 id="Control-Structures"><a href="#Control-Structures" class="headerlink" title="Control Structures"></a>Control Structures</h3><p>Go’s control structures are even simpler than Python… judgment uses <code>if/else</code>, loop uses <code>for</code>, multi-branch structure uses <code>switch</code>——only these.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else and for examples</span></span><br><span class="line"><span class="keyword">if</span> cols[<span class="number">3</span>] == <span class="string">&quot;+&quot;</span> &#123;</span><br><span class="line"><span class="keyword">for</span> idx, _ := <span class="keyword">range</span> exonStarts &#123;</span><br><span class="line">exons = <span class="built_in">append</span>(exons, []<span class="type">int64</span>&#123;exonStarts[idx], exonEnds[idx], exonFrames[idx]&#125;)</span><br><span class="line"><span class="keyword">if</span> idx != <span class="built_in">len</span>(exonStarts)<span class="number">-1</span> &#123;</span><br><span class="line">introns = <span class="built_in">append</span>(introns, []<span class="type">int64</span>&#123;exonEnds[idx], exonStarts[idx+<span class="number">1</span>]&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> idx, _ := <span class="keyword">range</span> exonStarts &#123;</span><br><span class="line">exons = reverSlice(<span class="built_in">append</span>(exons, []<span class="type">int64</span>&#123;exonStarts[idx], exonEnds[idx], exonFrames[idx]&#125;))</span><br><span class="line"><span class="keyword">if</span> idx != <span class="built_in">len</span>(exonStarts)<span class="number">-1</span> &#123;</span><br><span class="line">introns = reverSlice(<span class="built_in">append</span>(introns, []<span class="type">int64</span>&#123;exonEnds[idx], exonStarts[idx+<span class="number">1</span>]&#125;))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// switch example</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> AinA &amp;&amp; BinB: <span class="comment">// Target fusion, corresponding correct</span></span><br><span class="line">locates[<span class="string">&quot;breakA&quot;</span>] = locAinA</span><br><span class="line">locates[<span class="string">&quot;breakB&quot;</span>] = locBinB</span><br><span class="line"><span class="keyword">return</span> locates, <span class="string">&quot;right&quot;</span>, <span class="literal">nil</span></span><br><span class="line"><span class="keyword">case</span> AinB &amp;&amp; BinA: <span class="comment">// Target fusion, corresponding reversed</span></span><br><span class="line">locates[<span class="string">&quot;breakA&quot;</span>] = locAinB</span><br><span class="line">locates[<span class="string">&quot;breakB&quot;</span>] = locBinA</span><br><span class="line"><span class="keyword">return</span> locates, <span class="string">&quot;wrong&quot;</span>, <span class="literal">nil</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">err := errors.New(<span class="string">&quot;Not Fusion&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Although there are fewer things, they are enough…</p><p>Another thing to note is that Go provides <code>goto</code> as a jumping control statement besides <code>break</code> and <code>continue</code>. However, I haven’t used it yet…</p><h3 id="Building-Functions"><a href="#Building-Functions" class="headerlink" title="Building Functions"></a>Building Functions</h3><p>Creating functions in Go is not special… just pay attention to declaring the types of input parameters and return values first (in the example below, <code>reverSlice</code> follows with the passed-in parameter, outside the parentheses are the declarations of the returned value). Once declared, they cannot be changed. If you need flexible inputs and outputs, you can rely on <code>interface</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverSlice</span><span class="params">(a [][]<span class="type">int64</span>)</span></span> [][]<span class="type">int64</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="built_in">len</span>(a)/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">opp := <span class="built_in">len</span>(a) - <span class="number">1</span> - i</span><br><span class="line">a[i], a[opp] = a[opp], a[i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h3><p>Essentially, Go does not have Python’s specialized error handling or exception throwing operation. However, when using Go, you will find that many functions return two values, for example, the file opening function:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file, err := os.Open(yourFile)</span><br></pre></td></tr></table></figure><p>The above file opening function returns not only the opened file object but also another variable. Personally, I understand this as something similar to the status code returned by executing a Shell command. Generally speaking, if the program execution within the function is normal, this variable will be <code>nil</code>. If there is an error during the function’s part of execution, it will return an <code>error</code> class object containing the error description string. Processing this variable is equivalent to using <code>Try: Except:</code> in Python.</p><h3 id="String-Handling"><a href="#String-Handling" class="headerlink" title="String Handling"></a>String Handling</h3><p>Go’s string handling mainly relies on the <code>strings</code> package, which includes basic operations such as connection, splitting, replacement, and trimming of whitespace… the actual usage experience is similar to R’s <code>stringr</code>… there are many things… but it feels not so convenient.</p><p>Another thing to note is that Python’s formatted strings in Go do not have an equivalent. So you cannot create a large text template in Go and fill in the content.</p><h3 id="JSON-Handling"><a href="#JSON-Handling" class="headerlink" title="JSON Handling"></a>JSON Handling</h3><p>Go also has a specialized <code>json</code> package to read JSON file contents into Go data structures, and convert Go objects into JSON strings. However, due to type restrictions, it may be slightly more complex than Python…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tarTranFile := <span class="string">&quot;RXA_gene_trans.json&quot;</span></span><br><span class="line">data, err := ioutil.ReadFile(tarTranFile)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> targetTransFile <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">err = json.Unmarshal(data, &amp;targetTransFile)</span><br><span class="line">targetTrans := targetTransFile.(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br></pre></td></tr></table></figure><p>You can see that to read the written JSON file, I executed opening the file, loading the content, using a specific function to process it, and then because the return is <code>interface</code>, so finally did type assertion.</p><p>Similar operations… in Python, 1~2 lines can be completed…</p><h3 id="Program-Compilation"><a href="#Program-Compilation" class="headerlink" title="Program Compilation"></a>Program Compilation</h3><p>Unlike Python which translates and executes code line by line, Go language needs to be compiled before use (although there’s also <code>go run</code>), so you need to study how to compile executable files.<br>(Placeholder for digging a hole)</p><h3 id="Unique-Features-of-Python-and-Go"><a href="#Unique-Features-of-Python-and-Go" class="headerlink" title="Unique Features of Python and Go"></a>Unique Features of Python and Go</h3><p>This section records some unique features of Python and Go respectively (digging a hole placeholder).</p><h4 id="Python-Part"><a href="#Python-Part" class="headerlink" title="Python Part"></a>Python Part</h4><ul><li>List&#x2F;Dictionary Comprehensions: In Python, list&#x2F;dictionary comprehensions are very convenient iterable object generation&#x2F;handling methods that can effectively simplify code (whether there’s an efficiency boost isn’t clear), but in Go, you have to write loops obediently.</li><li>String Formatting: The benefit of Python’s string formatting is that it allows you to fill in a large amount of text one by one. This writing method makes the final appearance of the string very clear and easy to understand. In contrast, Go can only concatenate strings.</li></ul><h4 id="Go-Part"><a href="#Go-Part" class="headerlink" title="Go Part"></a>Go Part</h4><ul><li>Interface (see above)</li><li><code>switch</code> control structure</li><li>Convenient parallelization: Although Python has multi-threading, multi-processing, coroutines… but they are not as efficient or convenient as Go. This is one of the reasons why I decided to learn Go.</li></ul><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Setting up HTTPS using Caddy</title>
      <link href="/en/2019/05/07/https%E9%85%8D%E7%BD%AE/"/>
      <url>/en/2019/05/07/https%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>Previously, I set up a Gogs server but didn’t configure HTTPS; it was directly using HTTP. Last time, I tried and found that intercepting passwords was too easy… So I thought about getting a domain name and setting up HTTPS…</p><!-- Abstract part --><span id="more"></span><p>Firstly, to use HTTPS, you need an SSL certificate. To get a certificate, it seems that free SSL certificates basically require a domain name. So I got the cheapest one from <a href="#">INVALID POST SLUG PROVIDED www.namesilo.com/‎</a>. Domain registration and binding IP can be found in this blog post: <a href="https://zhuanlan.zhihu.com/p/33921436">this article</a>.</p><p>After getting the domain, the next step is to set up a reverse proxy server. I chose Caddy because I read that it’s simple and easy to use, with automatic application and renewal of SSL certificates. Maybe my luck wasn’t good… Although setting it up was very simple, I couldn’t get the SSL certificate to work. In the end, I found a project on GitHub called <a href="https://github.com/Neilpang/acme.sh">acme.sh</a> to apply for SSL certificates. This script is very easy to use, and the author’s usage instructions are detailed; following them should be fine. Of course, there’s also a more user-friendly tutorial: <a href="https://www.lizi.tw/soft/5049.html">this guide</a>.</p><p>Using <code>acme.sh</code> will generate four files, among which <code>fullchain.cer</code>, <code>your.domain.key</code> are the certificate and key.</p><p>Since I deployed Gogs and Caddy using Docker, to make things convenient, I wrote both in a single compose file:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;2&quot;</span><br><span class="line">services:</span><br><span class="line">    gogs:</span><br><span class="line">        image: 08fa8ee955da</span><br><span class="line">        container_name: gogs</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;3022:22&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - /var/gogs:/data</span><br><span class="line">    caddy:</span><br><span class="line">        container_name: caddy</span><br><span class="line">        image: abiosoft/caddy</span><br><span class="line">        environment:</span><br><span class="line">          - ACME_AGREE=true</span><br><span class="line">        volumes:</span><br><span class="line">          - &quot;~/gogs/Caddyfile:/etc/Caddyfile&quot;</span><br><span class="line">          - &quot;/root/.acme.sh/your.domain/fullchain.cer:/root/fullchain.cer&quot;</span><br><span class="line">          - &quot;/root/.acme.sh/your.domain/your.domain.key:/root/your.domain.key&quot;</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;8080:2015&quot;</span><br><span class="line">          - &quot;80:80&quot;</span><br><span class="line">          - &quot;443:443&quot;</span><br><span class="line">        restart: always</span><br></pre></td></tr></table></figure><p>In the above file, two containers are configured. Gogs only exposes port 22 for SSH service; HTTP ports are not exposed. Caddy can set access directly in its configuration (although I don’t know how to do it).<br>For the Caddy container, note that setting the <code>ACME_AGREE=true</code> environment variable is necessary; otherwise, acme will prompt you that you cannot use it… Also, specify the Caddy configuration file <code>Caddyfile</code> and the certificates and keys generated above. The port exposure in the Caddy container’s configuration seems to be incorrect; I’ll look into how to fix it later.</p><p>The specific content of the Caddyfile is as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">your.domain &#123;</span><br><span class="line">    proxy / gogs:3000 &#123;</span><br><span class="line">        header_upstream Host &#123;host&#125;</span><br><span class="line">        header_upstream X-Real-IP &#123;remote&#125;</span><br><span class="line">        header_upstream X-Forwarded-For &#123;remote&#125;</span><br><span class="line">        header_upstream X-Forwarded-Proto &#123;scheme&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    log /var/log/caddy.log</span><br><span class="line">    gzip</span><br><span class="line">    tls /root/fullchain.cer /root/your.domain.key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> caddy </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Graphviz Usage</title>
      <link href="/en/2019/04/25/Graphviz%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2019/04/25/Graphviz%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>When developing software, whether for presentation or to organize thoughts, using flowcharts is often necessary. Instead of using a drawing board or Word, which can be time-consuming when the diagram becomes complex and needs frequent updates, a tool like Markdown that allows you to focus on content rather than form is very important.</p><!-- Abstract part --><span id="more"></span><p>Graphviz is a script-based graph visualization tool that can create many types of graphs. Currently, I only use flowcharts. To create a flowchart, you need to write a <code>.dot</code> formatted file, which looks like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">digraph workflow&#123;</span><br><span class="line">    // Default definition section for the entire graph</span><br><span class="line">    label = &quot;Workflow For Mutation Call&quot;</span><br><span class="line">    node[shape = box]</span><br><span class="line"></span><br><span class="line">    // Definition section for nodes in the graph</span><br><span class="line">    raw [label=&quot;Raw Bam&quot;];</span><br><span class="line">    clean [label=&quot;UMI Dedup Bam&quot;];</span><br><span class="line">    align [label=&quot;Split Bam&quot;];</span><br><span class="line">    vcf [label=&quot;Disc Bam(Prototype)&quot;];</span><br><span class="line"></span><br><span class="line">    // Relationship section for the flowchart</span><br><span class="line">    raw -&gt; clean [label=&quot;fastp&quot;];</span><br><span class="line">    clean -&gt; align [label=&quot;bwa&quot;];</span><br><span class="line">    align -&gt; vcf [label=&quot;GATK Mutect2&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I divided the above code into three parts:</p><ul><li>The first part sets default properties for elements in the graph, such as <code>label</code> which is the title of the graph, and <code>node</code> which defines the nodes in the flowchart. I set the default node shape to a box (the default is a circle).</li><li>The second part defines the nodes in the graph by specifying what nodes there are and then customizing them in the brackets, such as <code>label</code> to specify the displayed text.</li><li>The third part defines the order of relationships in the flowchart, such as <code>raw -&gt; clean</code> which draws an arrow from <code>raw</code> to <code>clean</code>. Similarly, you can customize it with brackets.</li></ul><p>After writing the above code, you can generate images by calling the <code>dot</code> command of Graphviz:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dot -Tpng workflow.dot &gt; workflow.png</span><br></pre></td></tr></table></figure><ul><li><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/workflow.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/workflow.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Completed graph"></li></ul><p>There is a corresponding plugin for VSCode, and on Linux, after installing the plugin, you can preview flowcharts as you write, which is very convenient.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> graphviz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux发行版的易用性越来越高了</title>
      <link href="/en/2019/04/06/Linux%E4%B8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E8%B6%8A%E6%9D%A5%E8%B6%8A%E4%B8%B0%E5%AF%8C%E4%BA%86/"/>
      <url>/en/2019/04/06/Linux%E4%B8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E8%B6%8A%E6%9D%A5%E8%B6%8A%E4%B8%B0%E5%AF%8C%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p>Recently, while helping my senior sister with sequence alignment, I discovered that the software I used to use frequently, MEGA X (10), now has a Linux GUI version. This made me feel that the world is indeed changing.</p><!-- 摘要部分 --><span id="more"></span><p>I remember installing my first Linux distribution for fun in my third year of university. At that time, I chose Ubuntu. The interface and effects were very cool, and it was much smoother on my old computer compared to Windows. However, after a while, the interface became boring, and various problems started popping up: poor Chinese support, lack of commonly used software, frequent system updates (involving kernel or major version changes), and little documentation for beginners. I can’t even remember all the small issues I encountered. At that time, Deepin was based on Ubuntu and focused on optimizing the user experience for Chinese users. So, within half a month, I switched from Ubuntu to Deepin. Although it improved Chinese support and system updates compared to the original Ubuntu, the lack of commonly used software (such as office and communication tools) made it almost impossible to use this system in an environment where everyone uses Windows. After about two months, I gave up because of assignments and gaming (essentially gaming…).</p><p>Later, when I installed a Linux distribution again during my second semester of graduate school, my initial intention was to reduce gaming time and focus on studying. At that time, smartphones had already become widely available, so basic communication could be done using phones, and there were even Linux versions of WPS for writing documents and presentations (although the playback format still needed adjustment). For academic purposes, I used R for statistics and Ugene for sequence analysis. Writing scripts was much easier on Linux than on Windows (one command in Linux versus multiple installations and configurations in Windows), so I smoothly transitioned to a pure Linux environment.</p><p>Then, I switched to Manjaro based on Arch due to some incorrect installation methods, but I never gave up. G胖’s efforts to promote the Linux gaming ecosystem made me feel like being dominated… From then on, I could use Linux as my primary operating system for daily life without major issues.</p><p>Of course, this is partly because of the development of Linux GUIs and other factors that have resolved past problems. For example, communication software still hasn’t been fully resolved (WeChat, QQ, Taobao旺旺 don’t have native clients), but due to the rise of smartphones, we often no longer need to use computers for instant messaging. Another example is Flash and HTML5; although Linux support for Flash was poor, many websites required it, making them unusable without a virtual machine. However, Flash eventually fell out of favor and was replaced by HTML5…</p><p>I hope one day in my lifetime, the market share of Windows will really decrease, allowing us to be free from being limited to a single system platform.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using GNU Parallel in Bash for Parallel Execution</title>
      <link href="/en/2019/03/31/%E4%BD%BF%E7%94%A8GNU-Parallel%E5%9C%A8Bash%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%B9%B6%E8%A1%8C/"/>
      <url>/en/2019/03/31/%E4%BD%BF%E7%94%A8GNU-Parallel%E5%9C%A8Bash%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%B9%B6%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>I recently discovered GNU Parallel, a simple and useful parallel program implemented in Perl, which can easily execute various commands in Bash in parallel. This is particularly useful for tasks that can be divided into independent subtasks.</p><!-- Abstract part --><span id="more"></span><p>GNU Parallel allows you to replace loops with parallel execution by specifying the command to be executed in parallel. For example, consider a script that filters VCF files based on chromosomes:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chr <span class="keyword">in</span> &#123;&#123;1..22&#125;,X,Y&#125;;<span class="keyword">do</span></span><br><span class="line">    bcftools view -f PASS -r chr<span class="variable">$&#123;chr&#125;</span> sample.vcf &gt; sample.chr<span class="variable">$&#123;chr&#125;</span>.flt.vcf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">bcftools merge sample.chr&#123;&#123;1..22&#125;,X,Y&#125;.vcf &gt; sample.flt.vcf</span><br></pre></td></tr></table></figure><p>Using GNU Parallel, you can rewrite it as follows:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &#123;&#123;1..22&#125;,X,Y&#125; | <span class="built_in">tr</span> <span class="string">&quot; &quot;</span> <span class="string">&quot;\n&quot;</span> | parallel <span class="string">&#x27;bcftools view -f PASS -r chr&#123;&#125; sample.vcf &gt; sample.chr&#123;&#125;.flt.vcf&#x27;</span></span><br><span class="line">bcftools merge sample.chr&#123;&#123;1..22&#125;,X,Y&#125;.vcf &gt; sample.flt.vcf</span><br></pre></td></tr></table></figure><p>In the first example, the script loops through each chromosome and filters the VCF file. In the second example, the filtering is done in parallel, followed by merging. Of course, this example doesn’t make sense because both methods essentially do the same thing.</p><p>By default, GNU Parallel uses all available cores, so you can specify a maximum number of cores using <code>-j</code> or set a load threshold with <code>--load 80%</code>.</p><p>With this tool, any command that supports positional parameter analysis for regions can be quickly converted to parallel execution, significantly speeding up the analysis process. This makes writing Snakemake workflows more convenient…</p><p>I will continue to explore other uses of this program in future posts…</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> parallel computing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lumpy&#39;s Algorithm Interpretation</title>
      <link href="/en/2019/03/31/Lumpy%E7%9A%84%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB/"/>
      <url>/en/2019/03/31/Lumpy%E7%9A%84%E7%AE%97%E6%B3%95%E8%A7%A3%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<p>Lumpy’s author positioned this project more as building a general structural variant signal generation scheme rather than creating an excellent tool. It was implemented as a basic version of the scheme. Compared to other tools, Lumpy spent more time in its article explaining the evidence concepts and methods for obtaining information. Interpreting this tool has made me understand better how to obtain structural variant signals from NGS sequencing data.</p><!-- Abstract section --><span id="more"></span><h2 id="Tool-Basics"><a href="#Tool-Basics" class="headerlink" title="Tool Basics"></a>Tool Basics</h2><p>Lumpy is written in C++ and all its functionalities seem to be implemented independently without referencing any existing modules. The software can be obtained via conda, and the program itself hasn’t been updated for several years, so there’s no need to worry about compiling from source code.</p><p>The output format of Lumpy results can be selected between VCF and BEDPE. However, it’s worth noting that these two formats contain different information; VCF is more detailed. Additionally, this tool relies entirely on the alignment records in BAM files. Therefore, if the alignment itself is not ideal, it will inevitably affect downstream results. Furthermore, the tool does not contain any random components; with the same input files, the detection results will be identical.</p><h2 id="Lumpy’s-Structural-Variant-Model"><a href="#Lumpy’s-Structural-Variant-Model" class="headerlink" title="Lumpy’s Structural Variant Model"></a>Lumpy’s Structural Variant Model</h2><p>Lumpy first created a structural variant breakpoint model: $b &#x3D; (E,l,r,v)$</p><p>In this model, breakpoints are defined as pairs of genes that are adjacent in the target genome but not in the reference genome. These pairs of breakpoints are described by four indicators:</p><ul><li>$E$: A set of evidence supporting the breakpoint</li><li>$l$: The left breakpoint interval (interval), containing a vector p representing the relative probability of each point being the true breakpoint position</li><li>$r$: Consistent with $l$, containing all information about the right breakpoint</li><li>$v$: Information about the complexity of the breakpoint, mainly containing direction information from different evidence. This indicator is included to retain more original information because when results are detected, they will only be labeled as one type of structural variant (e.g., deletion), but the original signal may contain support for other types of evidence.</li></ul><p>Lumpy uses both SR and RP signals, each parsing out an instance of a breakpoint. After reading all breakpoint instances, it needs to infer whether the same breakpoint exists based on the information contained and then merge breakpoints. The conditions for merging are:</p><ol><li>Both sides of the breakpoints have overlapping regions (threshold unspecified)</li><li>Consistent complexity</li></ol><p>If these conditions are met, the two breakpoints can be merged. $E$ will contain the original signals from both breakpoints, $v$ remains unchanged (since it is consistent), and $l$ and $r$ are combined by taking the arithmetic mean. That is, the start of $l$ is the average of the starts of $l1$ and $l2$, and the end is also the average of the ends of $l1$ and $l2$, $r$ is similar (but when there are multiple, how it executes specifically is unknown; taking averages two by two results in different outcomes):</p><p>$$merge.start &#x3D; \frac{l1.start + l2.start}{2}\ \ merge.end &#x3D; \frac{l1.end + l2.end}{2}$$</p><p>According to the author’s description, this method is used to reduce the impact of outlier evidence on the breakpoint interval. After merging the evidence, breakpoints with more than a preset threshold will be detected as structural variants. To determine detected structural variants, information from the breakpoint instances needs to be considered. Here are the default calculation schemes:</p><ol><li>The possible <strong>interval</strong> of the variant</li><li>The <strong>probability</strong> that each point in the interval is the true breakpoint</li></ol><p>First, the variant’s possible interval (interval) takes the maximum value of the left breakpoints and the minimum value of the right breakpoints (i.e., the smallest possible interval).</p><p>While the probability for each point in the interval can be calculated as follows (taking the left breakpoint as an example):</p><p>$$l.p[i] &#x3D; \prod_{e{\in}E}e.l.p[i-o]$$</p><ul><li>$i$ is a certain gene coordinate position</li><li>$l.p$ is the vector of probabilities that a single point is the true breakpoint, with the prefix $l.$ representing the left breakpoint</li><li>$E$ is the set of all evidence</li><li>$e$ is each piece of evidence in the evidence set</li><li>$e.l.p$ is the probability vector for the left breakpoint in a single piece of evidence</li><li>$o$ is the offset value, $o &#x3D; e.l.s - s.l.s$, i.e., the difference between the start position of the current evidence’s left breakpoint and the predicted start position of the structural variant.</li></ul><p>$e.l.p[i-o]$ might seem a bit confusing, but in essence, it’s similar to coverage. The final probability for each point in the interval is the product of the probabilities from all pieces of evidence that have this point. So, theoretically, the closer a point is to having more overlapping regions with original evidence intervals, the smaller its p-value will be, indicating a higher likelihood of being the true breakpoint position.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/BND_Prob.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/BND_Prob.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="BND_Prob"></p><p>During evidence merging, since the start and end points are continuously averaged to determine the merged interval’s start and end points, it is possible that there will be no interval between the final start and end points (equal or reversed? No instances have been verified). In such cases, the author identifies the maximum point among all sum distributions in $b.E$, removes any distribution not intersecting this point, and processes the resulting subset normally.</p><p>Thus, a final result entry is formed. The final result entry’s breakpoint interval can also be reduced according to a preset percentage, for example, taking only the top 99.9%.</p><p>Besides the above scheme, there is a <em>Summation</em> scheme used for low-quality data, which will not be interpreted here.</p><p>From the above schemes, it is clear that Lumpy essentially reads information-containing alignment records from BAM files, extracts necessary information, and then interprets structural variants based on this information. A crucial point is extracting which information from the signals. To define the required information, Lumpy designed a called <code>Breakpoint evidence</code> interface or commonly used evidence class:</p><p>This interface requires three pieces of information:</p><ol><li>is_bp: Whether it contains breakpoint position information</li><li>get_v: Structural variant type information</li><li>get_bpi: Breakpoint possible interval information</li></ol><p>That is, for each signal&#x2F;evidence, the above three pieces of information are interpreted and then added as a separate evidence $e$ to the evidence set $E$ for further interpretation.</p><p>So, how does one interpret the above information from signals&#x2F;evidences? The article explains this with examples from SR, RP, and <code>general breakpoint interface</code>:</p><h2 id="RP-Evidence-Interpretation"><a href="#RP-Evidence-Interpretation" class="headerlink" title="RP Evidence Interpretation"></a>RP Evidence Interpretation</h2><p>In paired-end sequencing, the insert fragment length of Reads Pair has a normal range, and the directions of Read1 and Read2 should be +&#x2F;-. Any abnormal alignment indicates the presence of a breakpoint. Therefore, the interpreted information is as follows:</p><ul><li>is_bp: Yes, it can determine that a breakpoint exists</li><li>get_v: When two reads are on the same chromosome, based on the actual alignment direction of Read1 and Read2, the mutation type (DEL&#x2F;INV&#x2F;DUP) can be inferred. Otherwise, it will be uniformly labeled as <code>inter-chromosomal</code></li><li>get_bpi: The final breakpoint interval and the p values for each point are obtained through the alignment information of two reads. It is somewhat complex; see below.</li></ul><p>Obtaining the breakpoint interval essentially involves mapping the left (l) and right (r) breakpoints from one read’s alignment information to determine the l (containing the interval and the midpoint p value) and r. For example, for l:</p><ol><li><p>Determine whether the breakpoint is upstream or downstream based on the alignment direction of the read.</p></li><li><p>Before making a judgment, the program estimates the distribution of insert fragment lengths from BAM files without alignment issues to get the average length $l$ and standard deviation $s$ (note that it’s the standard deviation Standard Deviation, not standard deviation). Additionally, a user-specified variable $v$ is required, with $l + vs$ as the expected value for normal insert fragment lengths. Since breaks are unlikely to result in fragments exceeding this expected length, it can be inferred that the breakpoint should be within the range of $l + vs$ (bp) upstream or downstream of the alignment position. This determines the interval range.</p></li><li><p>For each point $i$ in the above interval, its probability of being a true breakpoint is calculated as $P(S(y).e-S(x).s &gt; i - R(x).s)$ (the original text does not clearly explain what $S()$ represents; I infer it’s a sample abbreviation, with $R()$ representing actual fragment information).</p><ul><li>$y$ represents Read2, and $x$ corresponds to Read1.</li><li>$S(y).e$ is the end position of Read2 in the actual fragment, and $S(x).s$ is the start position of Read1 in the actual fragment.</li><li>$S(y).e-S(x).s$ is the length of the actual fragment.</li><li>$i-R(x).s$ is the distance from point $i$ to the start position of Read1’s alignment.</li><li>$P()$ should be a function that gets the p value from the distribution of normal alignment read fragment lengths. For example, $P(Z&gt;2.94)$ in a standard normal distribution gives the area under the curve, allowing you to evaluate the probability that point $i$ is the true breakpoint.</li></ul></li></ol><h2 id="SR-Evidence-Interpretation"><a href="#SR-Evidence-Interpretation" class="headerlink" title="SR Evidence Interpretation"></a>SR Evidence Interpretation</h2><p>In SR evidence, one read’s adjacent parts align to non-adjacent genomic positions. In Lumpy, if a read has more than two small fragments, these small fragments are split into pairs of smaller segments for consideration (e.g., three fragments are divided into $x_1,x_2$ and $x_2,x_3$ groups). The information parsed from each pair of small fragments is as follows:</p><ul><li>is_bp: Yes, it can determine that a breakpoint exists</li><li>get_v: When two fragments have the same alignment direction, the structural variant might be DEL or DUP (depending on whether the alignment directions are +&#x2F;-. If the alignment directions are different but on the same chromosome, it’s INV. If they align to different chromosomes, it’s <code>inter-chromosomal</code>.</li><li>get_bpi: The interval position of the breakpoint is related to the inferred structural variant type. Considering potential sequencing errors, the SR evidence gives a range for the breakpoint position. This range size depends on the input parameter $v$, sample quality (?), and the algorithm used for alignment (?). Since the description in the literature about this part is not as detailed as that of RP, here are some personal speculations; further testing may be needed to confirm:<ul><li>About interval acquisition: Ideally, the two parts of a Split-Read断裂 should be non-overlapping. However, in practice, there might be overlapping between the two parts. From Lumpy’s own SR Read extraction script, it indeed allows for some overlap between the two parts. So, the statement that the interval range of SR evidence is related to sample quality and alignment algorithm may refer to this.</li><li>About p value determination within the interval: The author only mentioned that the midpoint p value is the smallest, with p values increasing closer to the edges. It might be a proportional distribution… This would need further testing by creating evidence BAM files.</li></ul></li></ul><h2 id="general-breakpoint-interface-Interpretation"><a href="#general-breakpoint-interface-Interpretation" class="headerlink" title="general breakpoint interface Interpretation"></a><code>general breakpoint interface</code> Interpretation</h2><p>This type of evidence essentially records structural variant information in BEDPE files. Since BEDPE files originally record both sides of the breakpoint interval and the structural variant type, these can be directly mapped to get_v and get_bpi. The description of the BEDPE format will be discussed later; for now, it’s omitted.</p><p>The existence of this class of evidence serves two purposes: first, in genetic analysis, it makes it easier to detect variants that are known to exist in a population. Second, when using multiple tools simultaneously, it allows reliable variants detected by other tools to be merged with Lumpy results.</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Structural Variants </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Concepts in Structural Variation Detection Using NGS</title>
      <link href="/en/2019/03/16/%E7%BB%93%E6%9E%84%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B%E5%9F%BA%E6%9C%AC/"/>
      <url>/en/2019/03/16/%E7%BB%93%E6%9E%84%E5%8F%98%E5%BC%82%E6%A3%80%E6%B5%8B%E5%9F%BA%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>“I know a lot about structural variation information,” but the content of this blog post is too much, and it’s not convenient for me to look back. So I decided to split it into smaller parts and write a comprehensive one using GitBook later.</p><!-- Summary --><span id="more"></span><h2 id="Structural-Variations-Copy-Number-Variations-Gene-Fusions"><a href="#Structural-Variations-Copy-Number-Variations-Gene-Fusions" class="headerlink" title="Structural Variations&#x2F;Copy Number Variations&#x2F;Gene Fusions"></a>Structural Variations&#x2F;Copy Number Variations&#x2F;Gene Fusions</h2><p>Structural variations are different from small-scale gene mutations like SNPs&#x2F;InDels, referring to all relatively large-scale gene mutations (the exact size threshold is not clearly defined). Most literature refers to these variations as structural variations (Structural Variation), which are believed to originate from chromosomal reorganization or rearrangement. These variations come in various sizes and styles, ranging from whole chromosome exchanges mentioned in biology class to simple segment deletions, which are just relatively larger segments.</p><p>Currently, structural variations are mainly classified into the following types:</p><ul><li>Insertion&#x2F;Deletion (Insertion&#x2F;Deletion, INS&#x2F;DEL): Essentially the same as InDel but with larger fragments.</li><li>Duplication (Duplication, DUP): Represents the continuous repetition of a certain region. Additionally, there is ‘tandem duplication’, which requires further investigation.</li><li>Inversion (Inversion, INV): The 5’ and 3’ ends of a chromosomal segment are reversed.</li><li>Translocation (Translocation, ITX, CTX): Refers to the transfer of a segment, which could be within the same chromosome or between different chromosomes. Translocations themselves are complex structural variations. For example, if a segment from position A on a chromosome is moved entirely to position B, then there will be a deletion at position A and an insertion at position B. If the inserted segment is not inserted in its original direction, then inversion also occurs.</li></ul><p>The following image is taken from <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwjMy7vFzojhAhWwct8KHe9mCM4QFjAAegQIARAC&url=https://theses.lib.sfu.ca/file/thesis/4696&usg=AOvVaw3e8XVzVestWLRfPy1qnkYE">Gawroński’s doctoral thesis</a> and vividly illustrates the types of structural variations.<br><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/type_of_sv.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/type_of_sv.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="type_of_sv"></p><p>Based on structural variations, we can further explore copy number variations (Copy Number Variation) and gene fusions (Gene Fusion).</p><p>The key to copy number variation is ‘copy’. For example, ‘ATGCGGTAGCCGTAT’ represents a complete gene sequence, which we call one copy. Since humans are diploid, normally there should be two copies of this gene in a person. Therefore, when detecting genes, if the number of copies of this gene in the genome is not 2, we say that a copy number variation has been detected.</p><p>From the above concept, we can see that copy number variation is essentially a structural variation or more precisely, a result of structural variation. If there is a deletion in the genome, then the number of gene copies must decrease. Duplication obviously leads to an increase in copy numbers. Why are copy number variations singled out? I personally think this may be related to when the concept was proposed or its underlying significance. Assuming each different copy of the gene has the same expression capacity, then an increase in gene copy numbers will inevitably lead to increased gene expression, while a decrease in copy numbers will result in decreased gene expression or even disappearance of related expression products. In short, compared to structural variations that focus on figuring out what kind of changes occurred in a gene segment (such as where the deleted segment starts and ends, whether it has moved to another location in the genome, etc.), copy number variations focus more on whether the copy number of a certain gene&#x2F;segment has changed. Due to different focuses, copy number variations can be detected together with structural variations or separately. In fact, most of the time they are detected separately using different strategies. This article mainly focuses on structural variations, so there will not be specific content about copy number variations.</p><p>Similarly, gene fusions (Gene Fusion) are also results of structural variations. For example, if a segment of a gene is completely deleted, then the upstream and downstream segments will inevitably connect. If the breakpoints before and after the missing segment happen to be in the expression regions of two genes, then these two genes will be connected together, which is gene fusion. Therefore, we can see that all structural variations may lead to gene fusions, but the final way they fuse is different. Gene fusions are of particular interest because they are involved in confirming some disease causes. For example, EML4-ALK fusion in cancer and BCR-ABL fusion in chronic myeloid leukemia. Since gene fusions focus on whether there are genes connected together and how they connect (which affects whether gene expression increases or decreases), they have specific strategies and tools for detection, which will be detailed later.</p><h2 id="Using-NGS-Data-to-Detect-Structural-Variations-Gene-Fusions"><a href="#Using-NGS-Data-to-Detect-Structural-Variations-Gene-Fusions" class="headerlink" title="Using NGS Data to Detect Structural Variations&#x2F;Gene Fusions"></a>Using NGS Data to Detect Structural Variations&#x2F;Gene Fusions</h2><p>The basic principle of second-generation genome resequencing is to break the complete gene sequence into fragments, then sequence these fragmented sequences and align them back to the reference genome to reconstruct the original sequence. During this alignment process, some “abnormal” alignment results will be produced. Among these results, some can indicate that the test genome has undergone structural variations relative to the reference genome, and our detection is based on these alignment results, which we call structural variation signals&#x2F;evidence.</p><h3 id="Structural-Variation-Detection-Strategies"><a href="#Structural-Variation-Detection-Strategies" class="headerlink" title="Structural Variation Detection Strategies"></a>Structural Variation Detection Strategies</h3><p>The basic strategies for detecting structural variations are generally classified into four categories:</p><h4 id="1-Split-Reads"><a href="#1-Split-Reads" class="headerlink" title="1. Split-Reads"></a>1. Split-Reads</h4><p>If you have ever worked with NGS sequence alignment files (SAM&#x2F;BAM), you must have seen Clip-Reads in the file. Simply put, these sequences cannot be fully aligned to a specific location on the genome during alignment and instead align partially to one place and partially to another. These sequences may come from fragments containing structural variation breakpoints, thus resulting in this abnormal “<a href="https://github.com/samtools/hts-specs/blob/master/SAMv1.pdf">chimeric alignment</a>“. By extracting these sequences and tracing back the alignment of the two clipped sequences, we can infer the type of structural variation to some extent. The strategy for detecting structural variations based on this information is called SR strategy.</p><h4 id="2-Discordant-Read-Pairs"><a href="#2-Discordant-Read-Pairs" class="headerlink" title="2. Discordant Read Pairs"></a>2. Discordant Read Pairs</h4><p>If paired-end sequencing (Pair-End Sequencing) was used, then the sequencing results will appear in pairs. According to the sequencing principle, paired-end sequencing yields a single DNA strand’s 5’ and 3’ sequences. Since the DNA library preparation breaks DNA into a fixed range, under normal circumstances, the distance between Read1 and Read2 on the genome should be within a fixed range, and one should align positively with the reference genome while the other should align negatively (complementary). However, in actual alignment results, there will always be some sequence pairs that do not meet these conditions, such as a large distance or even different chromosomes, or both Read1 and Read2 aligning positively on the genome. In this case, these sequences are called “Discordant Read Pairs”. Since this signal comes from a pair of sequences, it is directly referred to as “Pair-End Evidence, PE” in Lumpy, but based on this signal, detection strategies seem to be more frequently called RP (Read Pair) strategy (this needs further confirmation by reading more evaluation articles). Such read pairs may also come from fragments containing structural variation breakpoints. The difference lies in the position of the breakpoint. For Split-Reads, the breakpoint is at one end of the sequence, so it is detected directly. For Discordant Read Pairs, the breakpoint should be within the insert fragment range, meaning it is not directly reflected in the sequenced fragments.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/PE_SR_BND_POS.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/PE_SR_BND_POS.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PE_SR_BND_POS"></p><h4 id="3-Read-Count-or-Depth"><a href="#3-Read-Count-or-Depth" class="headerlink" title="3. Read Count or Depth"></a>3. Read Count or Depth</h4><p>This strategy is based on the sequencing depth of specific segments. Clearly, this is used to detect copy number variations. Regardless of what kind of structural variation occurs, if it ultimately results in a decrease in the number of copies of a gene, it should be intuitively reflected in the alignment results of that gene—i.e., the sequencing depth of that gene region will clearly decrease. Conversely, if there is an increase in copy numbers, the sequencing depth should also correspondingly increase. This strategy is theoretically simple from a principle standpoint, but it is not necessarily much simpler than the previous two strategies in actual application. The main issue it faces is a seemingly simple but very troublesome problem: how high does the depth need to be considered significantly high, and how low does it need to be considered significantly low? This problem becomes more complex when using targeted or exome sequencing for copy number variation detection.</p><h4 id="4-De-novo-Assembly"><a href="#4-De-novo-Assembly" class="headerlink" title="4. De novo Assembly"></a>4. De novo Assembly</h4><p>Here, de novo assembly refers to assembling the genome from scratch without relying on a reference sequence, which is essentially the same as second-generation sequencing. Applied in structural variation detection, it involves assembling the obtained sequences before looking for SR or PE signals. Since assembled sequences yield longer fragments, these fragments can be used for better alignment results. It can be seen that this AS strategy will not be used alone because its purpose is to obtain longer fragments and then re-align them before detecting using SR.</p><h3 id="Personal-Thoughts-on-Detection-Strategies"><a href="#Personal-Thoughts-on-Detection-Strategies" class="headerlink" title="Personal Thoughts on Detection Strategies"></a>Personal Thoughts on Detection Strategies</h3><h4 id="1-Theoretical-and-Practical-Aspects-of-Sequencing-Methods"><a href="#1-Theoretical-and-Practical-Aspects-of-Sequencing-Methods" class="headerlink" title="1. Theoretical and Practical Aspects of Sequencing Methods"></a>1. Theoretical and Practical Aspects of Sequencing Methods</h4><p>As mentioned in <a href="http://www.huangshujia.me/2018/07/22/2018-07-22-Introduction-the-detection-of-structure-variants.html">Professor Huang Shujia’s blog post</a>, to obtain more reliable structural variation detection results, increasing fragment length and performing whole-genome sequencing is the simplest direct method. However, both methods mean increased single-test costs. Until sequencing becomes truly affordable, using as little data as possible to achieve more reliable results will be a necessary problem in applying structural variation detection in clinical settings.</p><h4 id="2-Difficulty-of-Obtaining-PE-and-SR-Signals"><a href="#2-Difficulty-of-Obtaining-PE-and-SR-Signals" class="headerlink" title="2. Difficulty of Obtaining PE and SR Signals"></a>2. Difficulty of Obtaining PE and SR Signals</h4><p>Assuming that the possibility of a structural variation breakpoint being sequenced is equal, then obtaining PE signals should be greater than obtaining SR signals because the length of insert fragments is usually longer than the reads themselves, so more breakpoints will fall within the insert fragment range. Additionally, since most detection methods still rely on alignment, some SR signals may also lose due to poor breakpoint positions (too close to read ends), making correct alignment difficult and causing signal loss. Therefore, under the same sequencing depth, applying PE signals theoretically can improve detection sensitivity.</p><h4 id="3-Detection-Bottlenecks-Caused-by-Alignment"><a href="#3-Detection-Bottlenecks-Caused-by-Alignment" class="headerlink" title="3. Detection Bottlenecks Caused by Alignment"></a>3. Detection Bottlenecks Caused by Alignment</h4><p>Since most tools still rely on sequence alignment situations, if real variation signals exist but are difficult to align (sequences too short for alignment), some signals will inevitably be lost and affect detection accuracy. This has also led to attempts at non-alignment-based detection methods.</p><h3 id="Gene-Fusion-Specific-Detection-Strategies"><a href="#Gene-Fusion-Specific-Detection-Strategies" class="headerlink" title="Gene Fusion-Specific Detection Strategies"></a>Gene Fusion-Specific Detection Strategies</h3><p>As mentioned earlier, gene fusion is a result of structural variation. Some gene fusions are of interest because they lead to abnormal gene expression, resulting in diseases. Therefore, in gene fusion detection, the focus is on detecting whether genes have fused together and how they have fused. Due to this different focus, besides using structural variation detection strategies to detect structural variations from the genome and then interpret possible fusions, specialized fusion detection methods have also been developed: RNA-Seq fusion detection. This method directly detects fusions in the transcriptome. If sequences from different gene transcripts are detected, it indicates a gene fusion event. Additionally, since detecting is done with RNA, there’s no need to speculate whether fusion will occur because detecting it proves its effectiveness.</p><p>Of course, I don’t think this method is perfect either. Some potential drawbacks include:</p><ul><li>Higher detection difficulty compared to DNA, as RNA is easily degraded…</li><li>As an applied clinical testing method, using RNA testing should have sample limitations and cost constraints.</li></ul><p>Since I haven’t used such tools in my actual work yet and don’t plan to use them, I’ll come back to fill this pit later.</p><p>Additionally, most current structural variation&#x2F;fusion detection methods require alignment to a reference genome, which is currently time-consuming (except for using FPGA chips for specialized optimization). However, gene fusion essentially only needs to know whether there are sequences showing two genes fused together. Therefore, some commercial companies have developed non-alignment-based detection schemes based on fastq data (such as [GeneFuse by Shenzhen Haplos]), which indeed significantly speeds up the detection process.</p><p>Finally, one thing to note is that due to different focuses, some specialized gene fusion detection software only reports fused genes and specific exons in their results, in various forms, making it difficult to directly compare with structural variation detection tools.</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Structural Variation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Logistic Regression in R</title>
      <link href="/en/2019/03/16/R%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/"/>
      <url>/en/2019/03/16/R%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/</url>
      
        <content type="html"><![CDATA[<p>I didn’t expect to do regression again after four years… this time using R instead of SPSS. Previously, I was doing statistical analysis, but now… it’s machine learning.</p><!-- Abstract part --><span id="more"></span><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Logistic (logit) regression is a type of generalized linear model that has the characteristic of converting a categorical dependent variable into a continuous variable by comparing all categories to one reference category. In logistic regression, the coefficients of the variables are taken as <code>exp(x)</code> after which they represent the OR value for this variable, meaning that for every unit increase in this variable, the probability of being classified as 1 increases by <code>exp(x)</code>.</p><h2 id="Model-Construction"><a href="#Model-Construction" class="headerlink" title="Model Construction"></a>Model Construction</h2><p>This time, my dependent variable is binary, so I can use the basic package’s <code>glm()</code> function. The specific model construction uses:</p><ul><li><code>family=binomial(link=&#39;logit&#39;)</code> to specify calling a binary logistic regression model</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>y <span class="operator">~</span> x1 <span class="operator">+</span> x2<span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">(</span>link<span class="operator">=</span><span class="string">&#x27;logit&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> data<span class="operator">=</span>fit_data<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>model<span class="punctuation">)</span> <span class="comment"># Display model information</span></span><br></pre></td></tr></table></figure><p>When performing regression, it’s difficult to guarantee that the first regression will yield the best results. Among the included covariates, there may be variables with coefficients too small (meaning they have little effect), or statistical tests are not significant (which may not have an effect in a resampling). Therefore, we need to change variables multiple times for regression.</p><p>In R, <code>step()</code> can help automatically perform regression and remove variables that contribute little and are not significant:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.step <span class="operator">&lt;-</span> step<span class="punctuation">(</span>model<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>model.step<span class="punctuation">)</span> </span><br></pre></td></tr></table></figure><p>Of course, this is just an automated reference. Ultimately, how the model is determined still depends on specific judgment by a person based on actual circumstances.</p><h2 id="Model-Prediction-Situation-Estimation"><a href="#Model-Prediction-Situation-Estimation" class="headerlink" title="Model Prediction Situation Estimation"></a>Model Prediction Situation Estimation</h2><p>After building the model, you can use <code>predict()</code> to predict test datasets and evaluate the model. Then, use some third-party packages through ROC curves to determine fitting situations and select final classification thresholds.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">test_data<span class="operator">$</span>prob <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>model.step<span class="punctuation">,</span> test_data<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;response&quot;</span><span class="punctuation">)</span> <span class="comment"># response means getting a probability between 0~1, not a constant</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the pROC package</span></span><br><span class="line">library<span class="punctuation">(</span>pROC<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">obj_roc <span class="operator">&lt;-</span> roc<span class="punctuation">(</span>test_data<span class="operator">$</span>Real<span class="punctuation">,</span> test_data<span class="operator">$</span>prob<span class="punctuation">)</span> <span class="comment"># Real is the correct answer, prob is the predicted probability</span></span><br><span class="line">plot<span class="punctuation">(</span>obj_roc<span class="punctuation">,</span> print.auc<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> auc.polygon<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> grid<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># Make a plot</span></span><br><span class="line">     grid.col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> max.auc.polygon<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">     auc.polygon.col<span class="operator">=</span><span class="string">&quot;skyblue&quot;</span><span class="punctuation">,</span> print.thres<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># The pROC package gives an ROC curve graph with sensitivity (true positive) on the y-axis and specificity (true negative) on the x-axis, not the more common false positive rate, so the x-axis is 1-&gt;0 instead of 0-1</span></span><br></pre></td></tr></table></figure><h2 id="Small-Tips"><a href="#Small-Tips" class="headerlink" title="Small Tips"></a>Small Tips</h2><p>The model object itself contains detailed model information, but directly taking information from the model does not match what <code>summary()</code> sees. For example, the coefficient table, <code>summary()</code> gives a table that includes coefficient values, standard errors, and statistical test P-values, but directly taking it from the model will only have coefficient values.</p><p>To take <code>summary()</code> information, you need to take it from the generated object or assign it first:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># First assignment</span></span><br><span class="line">model_info <span class="operator">&lt;-</span> summary<span class="punctuation">(</span>model<span class="punctuation">)</span></span><br><span class="line">model_info<span class="operator">$</span>coefficients</span><br><span class="line"><span class="comment"># Directly take</span></span><br><span class="line">summary<span class="punctuation">(</span>model<span class="punctuation">)</span><span class="operator">$</span>coefficients</span><br></pre></td></tr></table></figure><h2 id="Blog-Article-Learning"><a href="#Blog-Article-Learning" class="headerlink" title="Blog Article Learning"></a>Blog Article Learning</h2><p>I found a few blog posts on using R for logistic regression to supplement model evaluation methods.</p><h3 id="Logistic-Regression"><a href="#Logistic-Regression" class="headerlink" title="Logistic Regression"></a><a href="http://r-statistics.co/Logistic-Regression-With-R.html">Logistic Regression</a></h3><ul><li>Balance of binary variables: In logistic regression, if the two categories of the dependent variable are balanced, the classification results will be ideal. Therefore, before performing regression, you should check the situation of the two categories: <code>table(your_data$val)</code>. If they are not balanced, theoretically, you should sample the larger category to match the number of the smaller category.</li><li>Multicollinearity detection: Logistic regression and linear regression require routine detection of multicollinearity issues. The blog recommends <code>VIF&lt;4</code>.</li></ul><h3 id="How-to-perform-a-Logistic-Regression-in-R"><a href="#How-to-perform-a-Logistic-Regression-in-R" class="headerlink" title="How to perform a Logistic Regression in R"></a><a href="https://www.r-bloggers.com/how-to-perform-a-logistic-regression-in-r/">How to perform a Logistic Regression in R</a></h3><ul><li>$R^2$ calculation: Logistic regression cannot calculate $R^2$. The article suggests calculating the <em>McFadden $R^2$ index</em> as an alternative. More information about this metric can be found at <a href="http://thestatsgeek.com/2014/02/08/r-squared-in-logistic-regression/">R squared in logistic regression</a>.</li></ul><h3 id="Logistic-regression-on-biased-data"><a href="#Logistic-regression-on-biased-data" class="headerlink" title="Logistic regression on biased data"></a><a href="https://datascience.stackexchange.com/questions/12234/logistic-regression-on-biased-data">Logistic regression on biased data</a></h3><ul><li>Evaluation metrics selection in imbalanced classification: When the categories are imbalanced, <code>accuracy</code> is not a good evaluation metric. It is recommended to use <code>F1-score</code>.</li><li>Solutions for imbalanced classification include two types: <a href="https://www.marcoaltini.com/blog/dealing-with-imbalanced-data-undersampling-oversampling-and-proper-cross-validation">oversampling the minority class</a> and fixing the model by altering the <a href="#">INVALID POST SLUG PROVIDED </a> or <a href="#">INVALID POST SLUG PROVIDED </a>.</li><li>According to the article, oversampling the minority class and undersampling the majority class can improve detection results to some extent, but they are not good enough for testing data.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>pscl<span class="punctuation">)</span></span><br><span class="line">pR2<span class="punctuation">(</span>model<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h3 id="Other-Materials"><a href="#Other-Materials" class="headerlink" title="Other Materials"></a>Other Materials</h3><ul><li><a href="https://blog.mythsman.com/2016/01/28/1/">Logistic Regression Algorithm</a></li><li><a href="https://blog.mythsman.com/2016/02/02/1/">Cross-validation idea in machine learning</a></li><li><a href="https://www.r-bloggers.com/dealing-with-unbalanced-data-in-machine-learning/">Dealing with unbalanced data in machine learning</a></li></ul><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Statistic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Switching Themes &amp; Hexo Framework Blog Setup Notes</title>
      <link href="/en/2019/03/12/%E6%8D%A2%E6%96%B0%E4%B8%BB%E9%A2%98-Hexo%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2019/03/12/%E6%8D%A2%E6%96%B0%E4%B8%BB%E9%A2%98-Hexo%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>Yesterday, due to some unparsable symbols in my markdown post, I thought Hexo had crashed, so I took the opportunity to switch to a new theme…and reviewed the setup process again.</p><span id="more"></span><h2 id="General-Setup-Process"><a href="#General-Setup-Process" class="headerlink" title="General Setup Process"></a>General Setup Process</h2><p>Hexo is based on Node.js. On Arch-based systems, simply run <code>sudo pacman -S nodejs npm</code></p><p>After installation, use npm to install hexo and hexo-cli globally (hexo-cli is essential, whether hexo itself is necessary will be tested next time)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -g stands for global module, after installation you can use hexo command line tools</span></span><br><span class="line">sudo npm install -g hexo</span><br><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>Next, use hexo to create a new blog project with just <code>hexo init</code>. Note that this needs to be done in an empty directory, otherwise it will prompt that the directory is not empty and cannot proceed.</p><p>The blog created by hexo comes with a default theme, but generally we don’t use it…Search online for a theme you like, then clone it to the project’s theme directory using git.</p><p>After that, modify the <code>_config.yml</code> file in the project to change blog settings. After modifications, <code>hexo g &amp; hexo s</code> can generate and preview the blog locally. <code>hexo d</code> can publish&#x2F;update the blog website, but this requires specifying the publishing method in the configuration file (I use git), and installing the corresponding publishing module as prompted (just <code>npm install</code>, this doesn’t need to be installed globally)</p><h2 id="Blog-Project-Backup"><a href="#Blog-Project-Backup" class="headerlink" title="Blog Project Backup"></a>Blog Project Backup</h2><p>In many cases, you may need to edit blog content in multiple locations. This is quite simple…just git the entire project. The only thing to note is that if you use git to install themes, each folder under theme is originally a git project. Personally, I think it’s better to set all files in the theme folder to be ignored in <code>.gitignore</code> when establishing git for the entire project, and then separately backup the theme’s <code>_config.yml</code>.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/new_blog.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/new_blog.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="new_blog"></p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Some Useful Features of Snakemake</title>
      <link href="/en/2019/03/06/Snakemake%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%89%B9%E6%80%A7/"/>
      <url>/en/2019/03/06/Snakemake%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>After using snakemake for some time, I found that it has many practical features to facilitate daily analysis. Here is a record and整理.</p><span id="more"></span><h2 id="Resource-Limits"><a href="#Resource-Limits" class="headerlink" title="Resource Limits"></a>Resource Limits</h2><p>In the <code>rule</code>, you can use the <code>resources</code> keyword to limit resources. This is very useful when you need to use a GPU (only one GPU) or have limited disk performance (cannot perform too many high IO operations at the same time). For example, the following setting:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">rule <span class="built_in">all</span>:</span><br><span class="line">    expand(<span class="string">&quot;&#123;sam&#125;.vcf&quot;</span>, sam=[<span class="string">&quot;sam1&quot;</span>, <span class="string">&quot;sam2&quot;</span>, <span class="string">&quot;sam3&quot;</span>, <span class="string">&quot;sam4&quot;</span>])</span><br><span class="line"></span><br><span class="line">rule samtools_sort:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        rules.samtools_flt.output</span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sam&#125;.flt.srt.bam&quot;</span></span><br><span class="line">    resources:</span><br><span class="line">        IO=<span class="number">8</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort -@ 8 &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">rule samtools_call:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        <span class="string">&quot;&#123;sam&#125;.bam&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;sam&#125;.vcf&quot;</span></span><br><span class="line">    resources:</span><br><span class="line">        IO=<span class="number">1</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        bcftools mpileup -Ou -f reference.fa &#123;input&#125; \\</span></span><br><span class="line"><span class="string">            | bcftools call -mv -O -o &#123;output&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>In the above workflow, the sort process uses 8 threads simultaneously and consumes a lot of IO. Therefore, its IO usage is set to 8, while the call operation sets <code>IO=1</code>. When running, you can control the number of high IO tasks by setting the maximum IO value: <code>snakemake --resources IO=16</code>.</p><h2 id="Task-Groups"><a href="#Task-Groups" class="headerlink" title="Task Groups"></a>Task Groups</h2><p>When using a cluster, in certain situations, grouping related tasks to be submitted to the same node can save on IO (prevent来回 transmission of intermediate files between nodes, roughly speaking…), and the keyword used is <code>group</code>. Tasks within the same group will be submitted to the same node for execution at once (the node will start another snakemake instance to control them).</p><p>The actual usage is very simple, so I won’t write an example. However, there is one thing to note: after tasks are submitted to a node using this feature to utilize the local disk of the node, although there is a snakemake controlling them, when the task submission ends, the local snakemake process will once again check if the input and output meet the requirements. This point needs to be noted. For example, I used this function to take advantage of the local disk of the compute node, but these disks are limited to the compute nodes and cannot be accessed from the login node. This will cause the login node’s process to fail when checking if the tasks are completed because some intermediate results cannot be found.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> snakemake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python中的itertools</title>
      <link href="/en/2019/02/13/python%E4%B8%AD%E7%9A%84itertools/"/>
      <url>/en/2019/02/13/python%E4%B8%AD%E7%9A%84itertools/</url>
      
        <content type="html"><![CDATA[<p>I’ve never used many useful functions when writing scripts before, so I decided to learn a bit about <code>itertools</code> and make some notes.</p><p>This time, I was dealing with large files, but most of the time, we handle them line by line. So, I thought about using <code>itertools</code> to create generators. This way, I might be able to split the generator into smaller parts and apply it to parallel operations.</p><p>The three functions from <code>itertools</code> that I used this time are:</p><ol><li>groupby</li><li>tee</li><li>chain</li></ol><ul><li><code>groupby</code> is used to cluster items in an iterable object. For example, when dealing with UMI grouping, you need to compare reads that are close in position and group them together for further UMI analysis.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Here&#x27;s a function that takes a single object from iter_obj as input and returns the value to be used for comparison</span></span><br><span class="line">grp_generator = groupby(iter_obj, <span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># Note that groupby only groups adjacent objects, so you might need to sort them yourself.</span></span><br></pre></td></tr></table></figure><ul><li><code>tee</code> is simple. If the iterable object is a generator, since generators can only be used once, you can use the <code>tee</code> function to create a copy of it for multiple uses.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iterable_fork_1, iterable_fork_2 = tee(iterable, <span class="number">2</span>) <span class="comment"># The number 2 is optional and defaults to 2.</span></span><br></pre></td></tr></table></figure><ul><li><code>chain</code> concatenates multiple iterable objects into one. I used it to flatten nested results:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flat_iter = chain.from_iterable(ori_iter)</span><br><span class="line"><span class="comment"># [[1,2],3] -&gt; [1,2,3] Of course, the actual result is a generator, so you need to use list(flat_iter) to get the complete result.</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> itertools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Multiprocessing in Python</title>
      <link href="/en/2019/02/12/python%E4%B8%AD%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B/"/>
      <url>/en/2019/02/12/python%E4%B8%AD%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>R provides convenient multiprocessing capabilities, and Python has similar functionality.</p><!-- Excerpt --><span id="more"></span><p>First, let’s quote from <a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319272686365ec7ceaeca33428c914edf8f70cca383000">Liao Xuefeng’s Python Tutorial</a> to explain processes and threads:</p><blockquote><p>For an operating system, a task is a Process. For example, opening a browser starts a browser process, opening Notepad starts a Notepad process, opening two Notepads starts two Notepad processes, and opening Word starts a Word process.</p><p>Some processes do more than one thing at the same time. For example, Word can perform typing, spell checking, and printing simultaneously. Within a process, to perform multiple “subtasks” at the same time, we call these “subtasks” Threads.</p><p>Since each process must do at least one thing, a process has at least one thread. Of course, complex processes like Word can have multiple threads that execute simultaneously. The execution of multiple threads is similar to multiple processes - the operating system quickly switches between threads, making each thread run alternately for short periods, appearing to execute simultaneously. True simultaneous execution of multiple threads requires a multi-core CPU.</p><p>All the Python programs we’ve written before are single-task processes with only one thread. How do we execute multiple tasks simultaneously?<br>There are two solutions:<br>One is to start multiple processes, where each process has only one thread, but multiple processes can execute multiple tasks together.</p><p>Another method is to start one process and multiple threads within that process, so multiple threads can execute multiple tasks together.</p><p>There’s also a third method - start multiple processes, each with multiple threads - but this model is more complex and rarely used in practice.</p></blockquote><p>The tasks I need to execute don’t involve long IO waits, so I didn’t choose Python’s multithreading or coroutines, but instead tried multiprocessing.</p><p>The main code is as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_to_process</span>(<span class="params">args</span>):</span><br><span class="line">    do someting</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sub_procs = Pool(<span class="number">10</span>)  <span class="comment"># 10 is the number of child processes to use</span></span><br><span class="line">    results = [] <span class="comment"># To store results</span></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> iterable:</span><br><span class="line">        result = sub_procs.apply_async(func_to_process, (args))</span><br><span class="line">        <span class="comment"># Submit task to process pool, apply_async means submit and continue</span></span><br><span class="line">        <span class="comment"># Will block when pool is full</span></span><br><span class="line">        results.append(result)</span><br><span class="line">    sub_procs.close() <span class="comment"># Close pool, no new tasks can be submitted</span></span><br><span class="line">    sub_procs.join() <span class="comment"># Wait for all processes to complete</span></span><br><span class="line">    results = [result.get() <span class="keyword">for</span> result <span class="keyword">in</span> results] <span class="comment"># Use get() to retrieve all results</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>There are two issues with this code:</p><ol><li>This approach splits the file by lines with each line as a process, which is too fragmented. Especially when the task has lengthy preparation steps, this actually reduces efficiency (single process prepares once, while multiprocess prepares many times)</li><li>The results may be out of order. If the task requires maintaining order, the results need to be sorted again</li></ol><p>For issue 1, after some research, it might be possible to use some functions from <code>itertools</code> to implement quantitative splitting of the original file. Will update tomorrow.</p><p>For issue 2, we could use the corresponding map method instead of apply. This requires further testing.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Parallel Computing </tag>
            
            <tag> Multiprocessing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using the parallel package in R</title>
      <link href="/en/2019/01/01/R%E4%B8%ADparellel%E5%8C%85%E7%9A%84%E4%BD%BF/"/>
      <url>/en/2019/01/01/R%E4%B8%ADparellel%E5%8C%85%E7%9A%84%E4%BD%BF/</url>
      
        <content type="html"><![CDATA[<p>Recently, I wrote a script to draw many images using ggplot. Although all the places where loops are needed have already been replaced with <code>apply</code>, it still can’t keep up when drawing hundreds of images at once. So, I fiddled around with <code>parallel</code> and managed to parallelize the plotting part to speed things up.</p><!-- Abstract section --><span id="more"></span><p>Before using Python, I was familiar with multithreading and multiprocessing. However, in R… it doesn’t seem to emphasize threads and processes as much; instead, it focuses on parallel computing. The only relevant resources I found in Chinese were <code>parallel</code> and <code>foreach</code>. Of course, I used <code>parallel</code>, but I haven’t studied the differences between the two…</p><p>Using it is actually quite simple. First, you register a cluster, then you throw your tasks at the cluster to run (in function form), and finally, you stop the cluster. The “cluster” here doesn’t refer to a cluster server; it’s just what English calls ‘cluster’, which I don’t know how to translate well… I’ll just call it that for now. Here is the specific implementation code:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prepare the plotting function</span></span><br><span class="line">plot_process <span class="operator">&lt;-</span> <span class="keyword">function</span> <span class="punctuation">(</span>data_list<span class="punctuation">,</span> args<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">    plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_line<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">    ggsave<span class="punctuation">(</span><span class="string">&quot;plot.png&quot;</span><span class="punctuation">,</span> plot<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">cl <span class="operator">&lt;-</span> makeCluster<span class="punctuation">(</span>core_num<span class="punctuation">)</span> <span class="comment"># Register</span></span><br><span class="line">parLapply<span class="punctuation">(</span>cl<span class="punctuation">,</span> data_list<span class="punctuation">,</span> plot_process<span class="punctuation">,</span> args<span class="punctuation">)</span> <span class="comment"># The first parameter specifies the cluster, and the rest are the same as lapply</span></span><br><span class="line">stopCluster<span class="punctuation">(</span>cl<span class="punctuation">)</span> <span class="comment"># Stop</span></span><br><span class="line"><span class="comment"># Since I&#x27;m only processing data separately and plotting, there&#x27;s no need for the merging step that many tutorials have.</span></span><br></pre></td></tr></table></figure><p>So it’s actually quite simple… The only slightly troublesome issue is that for each cluster node, you need to load the variables, packages, and functions separately. For variables, there are specific functions to pass them; for packages, you can write the loading statements inside <code>plot_process</code>. However, for custom functions, there isn’t a direct way to do it…<br>After searching for a long time without finding a solution, I suddenly had an idea of passing the functions as arguments to <code>plot_process</code>, and it worked…</p><p>After writing this script, I also saw another solution: write these custom functions in another file and then import them using <code>source()</code> inside <code>plot_process</code>. This should be a better approach, so I’ll try it out later….</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> Parallel Computing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>teamviewer+ssh jump = VPN</title>
      <link href="/en/2018/12/23/teamviewer-ssh%E8%B7%B3%E8%BD%AC-vpn/"/>
      <url>/en/2018/12/23/teamviewer-ssh%E8%B7%B3%E8%BD%AC-vpn/</url>
      
        <content type="html"><![CDATA[<!-- Abstract part --><p>It’s been a while since the last update. Today, I’ll record the upgraded version of my homemade VPN!</p><span id="more"></span><p>Previously, due to some reasons, my laptop was running Windows 10, and then I switched back to Manjaro. So, I had to reconfigure some things again, one of which was the VPN I used for working from home.</p><p>Since our company doesn’t have a VPN set up, I’ve always been using TeamViewer. However, it’s quite inconvenient. Because I use a virtual machine on my company computer, there are often mysterious issues, and during busy times, it shows noticeable lag.</p><p>During the time when I was running Windows 10, I偶然 discovered that the latest version of TeamViewer (version 14) has a VPN mode, so I tried it out, and it really works… So, I followed the homemade VPN setup from my previous company to create one again:</p><ul><li><p>Materials needed</p><ol><li>VirtualBox with Micro XP</li><li>TeamViewer 14 </li><li>Cygwin with OpenSSH</li></ol></li><li><p>Tip: This time, I tried the Tiny XP image… found that Cygwin couldn’t work properly inside it… so I had to download the original backup image from Baidu Cloud…</p></li><li><p>SSH Settings: Configure <code>~/.ssh/config</code>, set up the jump point there, where jumping to the company’s work computer is done via TeamViewer 14’s VPN. The address can be obtained after connecting through TeamViewer. It seems to be fixed, so I directly wrote it into the configuration file.</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Host vpn_vm</span><br><span class="line">    User Administrator</span><br><span class="line">    HostName 127.0.0.1</span><br><span class="line">    Port 8022</span><br><span class="line">    IdentityFile ~/.ssh/vpn_vm_key</span><br><span class="line"></span><br><span class="line">Host Jump</span><br><span class="line">    HostName 123.456.789.0</span><br><span class="line">    Port 8022</span><br><span class="line">    User silen</span><br><span class="line">    IdentityFile ~/.ssh/jump_key</span><br><span class="line">    ProxyCommand ssh Administrator@vpn_vm -W %h:%p</span><br><span class="line"></span><br><span class="line">Host Target</span><br><span class="line">    HostName 123.456.789.1</span><br><span class="line">    Port 22</span><br><span class="line">    User silen</span><br><span class="line">    IdentityFile ~/.ssh/target_key</span><br><span class="line">    ProxyCommand ssh silen@Jump -W %h:%p</span><br></pre></td></tr></table></figure><ul><li>Here, a two-level jump is set up. <code>vpn_vm</code> is the local virtual machine where TeamViewer is installed for VPN connection and OpenSSH is responsible for allowing this machine to jump through the virtual machine.</li><li><code>Jump</code> is the company’s machine, which has Manjaro installed in VirtualBox and starts the SSHD service.</li><li><code>Target</code> is the final server.</li><li>The <code>ProxyCommand</code> sets up the command for each level of jump, and also sets up keys to achieve passwordless login.</li><li>When logging in, you can directly use <code>ssh Target</code>, which is very convenient. <code>scp</code> and <code>sftp</code> can be used directly as well.</li></ul><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> teamviewer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using Snakemake for Workflow Control in Unconventional Ways</title>
      <link href="/en/2018/11/17/%E7%94%A8%E5%A4%96%E9%97%A8%E9%82%AA%E9%81%93%E7%9A%84%E6%96%B9%E5%BC%8F%E4%BD%BF%E7%94%A8snakemake%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/en/2018/11/17/%E7%94%A8%E5%A4%96%E9%97%A8%E9%82%AA%E9%81%93%E7%9A%84%E6%96%B9%E5%BC%8F%E4%BD%BF%E7%94%A8snakemake%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<!-- Summary --><p>Snakemake is indeed a very useful tool for workflow development and management. However, in certain scenarios, it can also bring some issues. Coincidentally, I discovered a rather unconventional way of using it: only use Snakemake’s dependency handling and task management, while generating scripts separately.</p><span id="more"></span><p>The reason was that when writing the workflow, I had to place an actual executable script at a specific location so that users could read these scripts and modify specific steps before resubmitting for execution.</p><p>The original intention was good: allowing users who are not familiar with Snakemake to easily modify analysis parameters for specific samples. However, the problem is that Snakemake does not support exporting actual executable scripts as files; it can only output the execution content directly in the log using the <code>-p</code> parameter. Moreover, before finding a solution, I was unaware that wildcards could be used in cluster submission commands… So, after several twists and turns, I found this rather unconventional solution.</p><ol><li>Divide the entire workflow into several parts and write programs to generate all required scripts.</li><li>When submitting to SGE, use the <code>-sync y</code> parameter with <code>qsub</code> so that the submission does not end immediately but waits for the completion&#x2F;failure of the submitted job. If the task fails, it will return a non-zero value.</li><li>Use Snakemake to build workflow dependencies as usual, specifying <code>input</code> and <code>output</code> normally. Add the execution script to <code>input</code>, and only write the submission command in <code>shell:</code>.</li></ol><p>This way, we can solve the problem of not being able to directly generate scripts by generating them ourselves and submitting them.<br>At the same time, we can also take advantage of Snakemake’s dependency resolution and task management features for progress monitoring and breakpoint continuation.<br>However, this approach also digs a huge pit: the script execution content and file names are not specified within Snakemake. If they do not match, the workflow will fail, and there is no good method to locate such issues; it relies entirely on the writer’s caution.</p><p>For example, you write a script <code>test.sh</code> like this:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#$ -sync y</span></span><br><span class="line"><span class="built_in">cat</span> test.txt | <span class="built_in">cut</span> -f 2 &gt; tset.col2.txt</span><br></pre></td></tr></table></figure><p>And your Snakemakefile is like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rule <span class="built_in">all</span>:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        test.col2.txt</span><br><span class="line"></span><br><span class="line">rule test:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        &#123;sample&#125;.txt</span><br><span class="line">    output:</span><br><span class="line">        &#123;sample&#125;.col2.txt</span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        qsub test.sh</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>When using Snakemake to run, it will never succeed… because the script generates a result file name that does not match the target file name in Snakemake.<br>By default, since <code>rule test</code> is determined to have failed, other result files used for judgment (if they exist) will be deleted…</p><p>In other words, using this method requires you to ensure consistency between the target file names. Excluding this drawback, this approach can fully leverage Snakemake’s advantages in task management while avoiding the time required to understand the wildcard mechanism when initially getting started with Snakemake.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> snakemake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>snakemake&#39;s Usage</title>
      <link href="/en/2018/10/30/snakemake%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/en/2018/10/30/snakemake%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Writing workflows is a common task in bioinformatics analysis, and a mature and well-designed tool can greatly improve the efficiency of work.</p><span id="more"></span><p>The simplest way to write a workflow is to write all the commands you need into a shell script and specify the order of tasks using <code>&amp;&amp;</code> or other methods. Then, you can run it in the background.</p><p>Although this approach is easy, its repetitiveness and error resistance are really worrying. Therefore, various workflow management tools have emerged: I used <code>sjm</code> at my previous unit, 10x Genomics developed <code>Martian</code>, Broad Institute’s <code>WDL</code>, and I am currently using <code>snakemake</code>.</p><h2 id="Introduction-to-snakemake"><a href="#Introduction-to-snakemake" class="headerlink" title="Introduction to snakemake"></a>Introduction to snakemake</h2><p><code>snakemake</code> is a bioinformatics analysis workflow management tool developed by the Köster lab at the University of Duisburg-Essen in Germany. Its entire code is written in Python, so it can be easily integrated with Python programs (although it also has a complete set of command-line programs).</p><p>The features of <code>snakemake</code> include but are not limited to:</p><ul><li>Simple and easy to use</li><li>Can directly use Python code</li><li>Built-in distributed computing cluster support (SGE, LSF, etc.)</li><li>Built-in Conda environment deployment support</li><li>Built-in container support (note that this container is not Docker)</li><li>Automatic handling of dependencies and breakpoint restarts</li><li>Built-in testing functionality (benchmarking)</li><li>Same execution logic as <code>make</code>, so people with a background in <code>make</code> can quickly get up to speed</li></ul><h2 id="Simple-Example-of-snakemake"><a href="#Simple-Example-of-snakemake" class="headerlink" title="Simple Example of snakemake"></a>Simple Example of snakemake</h2><p>In a <code>snakemake</code> file, the most basic unit is a <code>rule</code>, which represents a step in the workflow. Under a <code>rule</code>, you can define input files, output files, and the commands to be executed. Since <code>snakemake</code> is based on Python, its syntax format is consistent with Python, using indentation to define control scopes, such as writing a simple <code>rule</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rule samtools_sort:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        <span class="string">&quot;test.bam&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;test.srt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>This <code>rule</code> named “samtools_sort” executes the step of sorting the input <code>test.bam</code> using the <code>sort</code> command from <code>samtools</code>, and then specifies the output result as “test.srt.bam”.</p><p>The final <code>shell:</code> indicates that this is a shell command, with the command given as a string. Snakemake also supports directly executing Python code; in this case, the keyword needs to be changed to <code>run:</code>. Additionally, it supports calling R code and other external scripts. For more details, refer to the <a href="https://snakemake.readthedocs.io/en/stable/">official manual</a>.</p><h2 id="Using-snakemake-for-Batch-Processing-of-Samples"><a href="#Using-snakemake-for-Batch-Processing-of-Samples" class="headerlink" title="Using snakemake for Batch Processing of Samples"></a>Using snakemake for Batch Processing of Samples</h2><p>After understanding the basic writing of a <code>rule</code>, you can write a series of <code>rules</code> and then link them into a workflow. Although <code>snakemake</code> is simple and easy to learn, writing a complete workflow that can handle multiple samples still requires some knowledge.</p><h3 id="Special-String-Formatting-in-snakemake"><a href="#Special-String-Formatting-in-snakemake" class="headerlink" title="Special String Formatting in snakemake"></a>Special String Formatting in snakemake</h3><p>From the previous simple example, it can be seen that commands, input files, and output files in the <code>snakefile</code> are given as strings. These strings can use similar formatting string methods to reduce hardcoding and increase applicability.</p><p>For example, in the <code>&quot;samtools sort &#123;input&#125; &gt; &#123;output&#125;&quot;</code> from the previous example, <code>&#123;input&#125;</code> will be replaced with <strong>the</strong> string defined after <code>input</code> within this <code>rule</code> (if there are multiple inputs, they will be listed separated by spaces). Similarly, we can call any content defined within a <code>rule</code> to fill in text templates and generate the final commands or strings that need to be executed.</p><p>However, one thing to note is that for those who are used to using <code>format()</code>, it might look like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">path=<span class="string">&quot;path/to/input&quot;</span></span><br><span class="line"></span><br><span class="line">rule samtools_flt:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        <span class="string">&quot;test.bam&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;test.flt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort &#123;path&#125;/&#123;input&#125; &gt; &#123;output&#125;&quot;</span>.<span class="built_in">format</span>(path=path)</span><br></pre></td></tr></table></figure><p>This is mixing Python’s string formatting with snakemake’s string formatting. <del>This kind of writing cannot be correctly handled by snakemake; a string can either use the built-in formatting method or the original formatting method of Python. The above example, using <code>format()</code>, will be processed according to Python’s original method, filling in the string based on the information given in <code>format()</code>. Unspecified <code>input</code> and <code>output</code> will be left empty.</del> Snakemake can handle this situation; however, the writing style needs to be changed:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">path=<span class="string">&quot;path/to/input&quot;</span></span><br><span class="line"></span><br><span class="line">rule samtools_flt:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        <span class="string">&quot;test.bam&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;test.flt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort &#123;path&#125;/&#123;&#123;input&#125;&#125; &gt; &#123;&#123;output&#125;&#125;&quot;</span>.<span class="built_in">format</span>(path=path)</span><br></pre></td></tr></table></figure><p>For those who are more familiar with Python, you might know that <code>&quot;\&#123;\&#123;\&#125;\&#125;&quot;</code> represents not escaping the <code>&#123;&#125;</code> within a string but treating them as general symbols. Combining snakemake’s execution logic, it is known that snakemake will handle the pure string input itself after Python part execution is complete.</p><h3 id="Execution-Logic-of-snakemake-Workflows"><a href="#Execution-Logic-of-snakemake-Workflows" class="headerlink" title="Execution Logic of snakemake Workflows"></a>Execution Logic of snakemake Workflows</h3><p>Snakemake does not have a dedicated syntax for specifying order or dependencies; workflow connections are automatically completed based on input and output file dependencies. Since snakemake defaults to parsing and completing the first <code>rule</code>, it is recommended by the official documentation to create a <code>rule</code> named “all”. In this <code>rule</code>‘s <code>input</code> (note: not <code>output</code>), specify all final files. Then, the program will find which <code>rule</code> can produce the required file based on the <code>output</code> in the snakefile. It continues to parse the dependencies of this rule until it finds the source or determines that there is no source and reports an error, for example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rule <span class="built_in">all</span>:</span><br><span class="line">    <span class="string">&quot;test.flt.srt.bam&quot;</span></span><br><span class="line"></span><br><span class="line">rule samtools_flt:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        <span class="string">&quot;test.bam&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;test.flt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">rule samtools_sort:</span><br><span class="line">    <span class="built_in">input</span>: </span><br><span class="line">        rules.samtools_flt.output</span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;test.flt.srt.bam&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;samtools sort &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>In the above snakefile, the workflow execution logic is as follows:</p><ol><li>The final target is <code>test.flt.srt.bam</code>, search for a rule that can produce this file.</li><li>Discover that <code>samtools_sort</code> can produce the required file, and this rule requires input from <code>samtools_flt</code>. Therefore, <code>samtools_flt</code> executes first.</li><li><code>samtools_flt</code> needs input <code>test.bam</code>, check if the file exists. If it exists, follow the order <code>samtools_flt &gt; samtools_sort &gt; all</code> to execute the workflow. If not found, report a dependency error and stop the workflow.</li></ol><p>Due to this backtracking execution logic of workflows, it is very easy to implement breakpoint restarts in workflows: simply backtrack through each step’s dependencies to check if they are satisfied. If satisfied, start executing from the current step; if not, continue backtracking until finding the source or failing to find one and reporting an error.</p><p>Additionally, snakemake checks output file updates and integrity during workflow execution to determine whether rules run successfully. If a rule fails, the result files of that rule are deleted by default, so unless the snakemake process is terminated abnormally, it is unlikely for a step to be incomplete while the workflow continues running.</p><h3 id="Built-in-Useful-Functions-in-snakemake"><a href="#Built-in-Useful-Functions-in-snakemake" class="headerlink" title="Built-in Useful Functions in snakemake"></a>Built-in Useful Functions in snakemake</h3><p>Since snakefiles can directly write Python code, people familiar with Python can easily use list comprehensions and other similar things to quickly generate information needed for batch processing. For those without much Python experience, snakemake also provides some built-in functions to quickly achieve similar functionality. For example:</p><ul><li>expand:<ul><li>A function used to generate string lists, equivalent to combining list comprehensions and formatted strings. By default, it combines multiple replacement variables in pairs, but it can be set to a mode similar to <code>zip()</code>, where it sequentially pairs them, which can meet different needs.</li><li><code>samples = expand(&quot;&#123;sample_id&#125;.&#123;fq&#125;.fasta&quot;, sample_id=[&#39;sam1&#39;, &#39;sam2&#39;], fq=[&#39;fq1&#39;, &#39;fq2&#39;])</code></li></ul></li></ul><h3 id="Batch-Processing-of-Multiple-Samples-Files"><a href="#Batch-Processing-of-Multiple-Samples-Files" class="headerlink" title="Batch Processing of Multiple Samples&#x2F;Files"></a>Batch Processing of Multiple Samples&#x2F;Files</h3><p>Batch processing involves a built-in object in snakemake called <code>wildcards</code>. Although I am not very clear on how to translate this term… In general, this object is used for pattern matching with capture effects (regular expressions). For example, an example given in the official documentation:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rule complex_conversion:</span><br><span class="line">    <span class="built_in">input</span>:</span><br><span class="line">        <span class="string">&quot;&#123;dataset&#125;/inputfile&quot;</span></span><br><span class="line">    output:</span><br><span class="line">        <span class="string">&quot;&#123;dataset&#125;/file.&#123;group&#125;.txt&quot;</span></span><br><span class="line">    shell:</span><br><span class="line">        <span class="string">&quot;somecommand --group &#123;wildcards.group&#125; &lt; &#123;input&#125; &gt; &#123;output&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>Here, the <code>input</code> and <code>output</code> of the rule contain <code>&#123;dataset&#125;</code> and <code>&#123;group&#125;</code>, which are two <code>wildcard</code> objects. Each <code>wildcard</code> can match almost any character (corresponding to a regular expression of <code>.+</code>). If a rule needs a file named <code>file_path/file.001.txt</code>, snakemake will find that this file’s naming matches the pattern specified in the <code>output</code> of <code>complex_conversion</code>. Therefore, snakemake considers <code>file_path/file.001.txt</code> to be produced by this rule and sets <code>dataset</code> to “file_path”, <code>group</code> to “001”, then passes these variables up to <code>input</code>, continuing dependency resolution.</p><p>Thus, through dependencies, when the requested result files are named according to a certain rule (usually containing sample&#x2F;project IDs), you can use <code>wildcard</code> to match which steps each sample&#x2F;project needs to perform and automatically generate the complete workflow route before starting execution.</p><h2 id="snakemake-conda"><a href="#snakemake-conda" class="headerlink" title="snakemake &amp; conda"></a>snakemake &amp; conda</h2><p>To ensure the repeatability of completed workflows, snakemake includes built-in functionality for using Conda to manage workflow dependencies.<br>However, this feature is different from what I initially understood.</p><h2 id="snakemake-Containers"><a href="#snakemake-Containers" class="headerlink" title="snakemake &amp; Containers"></a>snakemake &amp; Containers</h2><p>In addition to Conda, snakemake supports using containers to manage dependencies. However, this container is not Docker; it is Singularity. I only discovered that Docker is just one implementation of container counting when using snakemake. The key features of snakemake’s Singularity compared to Docker are:</p><ul><li>No need for root permissions</li><li>Lower resource consumption</li></ul><p>This project started migrating from C++ to Go in version 3.0, and although I overcame network pressure to install it, due to distribution issues, I cannot use it normally at present, so I do not have practical experience with it.</p><h2 id="Problem-Solutions-Collection"><a href="#Problem-Solutions-Collection" class="headerlink" title="Problem Solutions Collection"></a>Problem Solutions Collection</h2><p>Throughout my use of snakemake, I occasionally encounter some large problems. Since the number of Chinese users for this software is not many, although the English materials are comprehensive, due to my lack of relevant knowledge, I cannot quickly find solutions from them. Therefore, I have collected the problems and their solutions here. Some descriptions of the problems may not be professional; in the future, I will gradually correct them.</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> snakemake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bash-it</title>
      <link href="/en/2018/10/29/bash-it/"/>
      <url>/en/2018/10/29/bash-it/</url>
      
        <content type="html"><![CDATA[<p>bash-it is a collection of bash plugins inspired by oh-my-zsh. Installing bash-it not only makes the bash interface more stylish but also makes the command line more convenient.</p><span id="more"></span><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>According to the installation tutorial on the bash-it homepage, it’s very easy to install.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/Bash-it/bash-it.git ~/.bash_it</span><br><span class="line">~/.bash_it/install.sh</span><br></pre></td></tr></table></figure><p>However, when choosing, you need to pay attention that it will ask whether to retain the original <code>.bashrc</code> and <code>.bash_profile</code>. Of course, if you don’t retain these two files, they won’t be deleted; only backed up. If there are any problems after installation, you can manually switch back.</p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p><code>bash-it -h</code> can display all available commands, and <code>bash-it show plugins</code> can show all available plugins. Currently, I have only used <code>base</code> and <code>git</code>, but I will gradually learn about the others later.</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/bash_it.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/bash_it.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="display"></p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
            <tag> plugin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python Command Line Parsing</title>
      <link href="/en/2018/10/22/Python%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/"/>
      <url>/en/2018/10/22/Python%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>I have been using <code>argparse</code> for command line parsing, but it wasn’t until recently that I discovered it can be used to create subcommands.</p><span id="more"></span><h2 id="General-Argument-Parsing"><a href="#General-Argument-Parsing" class="headerlink" title="General Argument Parsing"></a>General Argument Parsing</h2><p>General argument parsing is quite simple. You just instantiate an <code>argparse</code>, and then call the object’s add argument method.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> RawTextHelpFormatter</span><br><span class="line">parser = argparse.ArgumentParser(</span><br><span class="line">    prog=<span class="string">&#x27;program&#x27;</span>,</span><br><span class="line">    description=<span class="string">&#x27;Some description&#x27;</span>,</span><br><span class="line">    formatter_class=RawTextHelpFormatter</span><br><span class="line">)</span><br><span class="line">parser.add_argument(<span class="string">&#x27;-s&#x27;</span>,</span><br><span class="line">                    <span class="built_in">help</span>=<span class="string">&quot;description for args&quot;</span>,</span><br><span class="line">                    required=<span class="literal">False</span>,</span><br><span class="line">                    <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><h2 id="Subcommand-Creation"><a href="#Subcommand-Creation" class="headerlink" title="Subcommand Creation"></a>Subcommand Creation</h2><p>Subcommands need to first create a subparser object based on the main argument parser (above is <code>parser</code>), and then call this object’s method to add subcommands.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sub_parser = parser.add_subparsers(title=<span class="string">&#x27;sub-commands&#x27;</span>,</span><br><span class="line">                                    description=<span class="string">&#x27;Some description&#x27;</span>,</span><br><span class="line">                                    <span class="built_in">help</span>=<span class="string">&#x27;Some help description&#x27;</span>)</span><br><span class="line">sub_parser_a = sub_parser.add_parser(<span class="string">&#x27;a&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Some help description&#x27;</span>)</span><br><span class="line">sub_parser_a.add_argument(<span class="string">&#x27;-s&#x27;</span>, </span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&quot;description for args&quot;</span>,</span><br><span class="line">                        <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><p>This way, you can define subprograms under the main program. <code>argparse</code> also provides a method to specify a function to run when a specific subcommand is called. This function will receive all parameter values under the subcommand as a namespace and can start executing the subprogram after parsing the parameters.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sub_parser_a.set_defaults(func=subFun)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">countFun</span>(<span class="params">args</span>):</span><br><span class="line">    args = <span class="built_in">vars</span>(args)</span><br><span class="line">    <span class="built_in">print</span>(args)</span><br></pre></td></tr></table></figure><h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p><code>argparse</code> can also implement multiple subprograms and inherit main program parameters for subprograms. This has not been used yet, so I will update it later.</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> argparse </tag>
            
            <tag> Argument Parsing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Writing a Program Isn&#39;t Easy Either</title>
      <link href="/en/2018/10/18/%E5%86%99%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%E7%9C%9F%E4%B8%8D%E5%AE%B9%E6%98%93/"/>
      <url>/en/2018/10/18/%E5%86%99%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F%E7%9C%9F%E4%B8%8D%E5%AE%B9%E6%98%93/</url>
      
        <content type="html"><![CDATA[<p>There’s not much to say, just commemorating my first independent completion of a command-line program~</p><!-- Abstract part --><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/scSeq_pub.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/scSeq_pub.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="publish"></p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>conda Install sscClust</title>
      <link href="/en/2018/10/09/conda%E5%AE%89%E8%A3%85sscClust/"/>
      <url>/en/2018/10/09/conda%E5%AE%89%E8%A3%85sscClust/</url>
      
        <content type="html"><![CDATA[<p>It seems I hit a bug again…</p><span id="more"></span><p>I previously tried to install <code>sscClust</code> using conda, but it failed because of a bug. In certain cases, the R installed via conda might not be able to find the bioconductor packages installed via conda, leading to R reinstalling the dependencies when running. I recorded the complete installation method as follows (assuming conda is already installed):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/mro/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># After that, delete the &#x27;- defualt&#x27; in ~/.condarc. This step is very crucial!</span></span><br><span class="line"></span><br><span class="line">conda install -y bioconductor-SingleCellExperiment bioconductor-scran bioconductor-SC3 bioconductor-zinbwave bioconductor-BiocParallel r-base r-devtools r-rcolorbrewer r-rtsne r-class r-factoextra r-cowplot r-data.table r-ggplot2 r-mass r-rjson r-cluster r-ks r-fields r-doparallel r-plyr r-igraph r-densityclust r-e1071</span><br></pre></td></tr></table></figure><p>After that, supplement the packages not included in R:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span>repos<span class="operator">=</span><span class="string">&quot;https://mirrors.shu.edu.cn/CRAN/&quot;</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>BioC_mirror<span class="operator">=</span><span class="string">&quot;http://mirrors.ustc.edu.cn/bioc/&quot;</span><span class="punctuation">)</span></span><br><span class="line">source<span class="punctuation">(</span><span class="string">&quot;http://bioconductor.org/biocLite.R&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;RhpcBLASctl&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;ADPclust&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;varSelRF&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>unzip <span class="operator">=</span> <span class="string">&quot;internal&quot;</span><span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;SilenWang/sscClust&quot;</span><span class="punctuation">,</span> dependencies<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">,</span> ref<span class="operator">=</span><span class="string">&quot;dev&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><ul><li>Finally, when using <code>devtools::install_github</code>, make sure to set the parameter to not install dependencies. It might be due to issues with the build files, forcing a reinstallation of dependencies? Or is it because the package versions do not meet the requirements?</li></ul>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Testing Conda Inside Docker</title>
      <link href="/en/2018/10/06/docker%E5%86%85%E8%BF%9B%E8%A1%8Cconda%E6%B5%8B%E8%AF%95/"/>
      <url>/en/2018/10/06/docker%E5%86%85%E8%BF%9B%E8%A1%8Cconda%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>When installing software, I thought that the portability and feasibility of using conda were better, so I decided to try it out and see how Snakemake works…</p><span id="more"></span><h2 id="Creating-a-Docker-Container-and-Installing-Miniconda"><a href="#Creating-a-Docker-Container-and-Installing-Miniconda" class="headerlink" title="Creating a Docker Container and Installing Miniconda"></a>Creating a Docker Container and Installing Miniconda</h2><ul><li>Initialize a CentOS 7 container and install <code>minicoda</code> because the container is newly initialized, so there’s nothing installed… need to install some necessary things.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name <span class="string">&quot;conda_test&quot;</span> -dti IMAGE_ID /bin/bash</span><br><span class="line">docker <span class="built_in">exec</span> -it DOCKER_ID /bin/bash</span><br><span class="line">yum -y install wget bzip2.x86_64 vim</span><br><span class="line">wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">sh Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc  <span class="comment"># conda modified the environment variables, manually make it effective</span></span><br></pre></td></tr></table></figure><h2 id="Installing-R-and-sscClust"><a href="#Installing-R-and-sscClust" class="headerlink" title="Installing R and sscClust"></a>Installing R and sscClust</h2><ul><li><p>This time, we want to simulate a regular user installing <code>sscClust</code> (root access is not available), so all necessary packages will not be installed using yum. R packages will be installed within R itself, not using the binary versions provided by conda (to prevent issues with packages not included in conda or dependency problems).</p></li><li><p>Set up the conda mirror and then install R.</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls <span class="built_in">yes</span></span><br><span class="line">conda install r</span><br></pre></td></tr></table></figure><ul><li>Install necessary packages. Since conda does not provide the compilation components, we still need to compile some parts ourselves.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://xmlsoft.org/libxml2/libxml2-2.7.2.tar.gz ftp://ftp.gnu.org/gnu/gsl/gsl-2.5.tar.gz https://www.openssl.org/source/openssl-1.1.1.tar.gz https://curl.haxx.se/download/curl-7.61.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xvf openssl-1.1.1.tar.gz</span><br><span class="line">tar xvf gsl-2.5.tar.gz</span><br><span class="line">tar xvf libxml2-2.7.2.tar.gz</span><br></pre></td></tr></table></figure><ul><li><p>Extract and enter the corresponding directories to compile and install, note that before compiling, add <code>prefix=/path/to/install</code>, then configure the <code>PATH</code> to add the installation path of the above software at the beginning of <code>PATH</code>, so it will prioritize reading from there.</p></li><li><p>curl needs to be installed before libgit2.</p></li><li><p>Install sscClust within R.</p></li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span>repos<span class="operator">=</span><span class="string">&quot;https://mirrors.shu.edu.cn/CRAN/&quot;</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>BioC_mirror<span class="operator">=</span><span class="string">&quot;http://mirrors.ustc.edu.cn/bioc/&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;BiocInstaller&quot;</span><span class="punctuation">,</span>repos<span class="operator">=</span><span class="string">&quot;https://bioconductor.org/packages/3.7/bioc&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;devtools&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h2 id="Testing-Pause"><a href="#Testing-Pause" class="headerlink" title="Testing Pause"></a>Testing Pause</h2><ul><li>During the testing process, various dependency issues were encountered. Since conda does not provide the compilation components needed for <code>*-devel</code> series packages, if all build dependencies need to be compiled from scratch, it will take a lot of time.</li></ul><h2 id="Change-in-Approach"><a href="#Change-in-Approach" class="headerlink" title="Change in Approach"></a>Change in Approach</h2><ul><li>For newer packages that cannot be obtained from R source or Bioconductor, check their dependency situation and install the dependency items using conda before installing the package within R.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum install -y unzip wget curl make gcc gcc-gfortran gcc-c++ bzip2.x86_64 vim</span><br><span class="line"></span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/</span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">conda install -y -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/ bioconductor-SingleCellExperiment bioconductor-scran bioconductor-SC3 bioconductor-zinbwave bioconductor-BiocParallel</span><br><span class="line"></span><br><span class="line">conda install -y r-RColorBrewer r-Rtsne r-class r-factoextra r-cowplot r-data.table r-ggplot2 r-MASS r-rjson r-cluster r-ks r-fields r-doParallel r-plyr r-igraph r-densityClust r-e1071 r-devtools</span><br></pre></td></tr></table></figure><ul><li>Install some packages within R.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span>repos<span class="operator">=</span><span class="string">&quot;https://mirrors.shu.edu.cn/CRAN/&quot;</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>BioC_mirror<span class="operator">=</span><span class="string">&quot;http://mirrors.ustc.edu.cn/bioc/&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;varSelRF&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;RhpcBLASctl&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;ADPclust&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>unzip <span class="operator">=</span> <span class="string">&quot;internal&quot;</span><span class="punctuation">)</span></span><br><span class="line">source<span class="punctuation">(</span><span class="string">&quot;http://bioconductor.org/biocLite.R&quot;</span><span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&#x27;SilenWang/sscClust&#x27;</span><span class="punctuation">,</span> dependencies<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span> ref<span class="operator">=</span><span class="string">&quot;dev&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><ul><li>Even though the R package installed using conda still has dependency issues, it will be unable to load (dependencies are not fully installed).</li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Installing R packages without root access is particularly troublesome. It’s simpler to install necessary components first and then compile within R itself, or for administrators to set up Docker and give usage permissions to the user, allowing them to operate within Docker themselves.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Single Cell Related Notes</title>
      <link href="/en/2018/09/28/%E5%8D%95%E7%BB%86%E8%83%9E%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2018/09/28/%E5%8D%95%E7%BB%86%E8%83%9E%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>Because of my work, I had to learn some basic concepts and methods for single-cell research. I wrote this note to record it.</p><span id="more"></span><h1 id="Overall-Approach"><a href="#Overall-Approach" class="headerlink" title="Overall Approach"></a>Overall Approach</h1><p>In general, single-cell sequencing is a research method that considers the differences between cells by using cells as the unit for sequencing. Currently, what I see are mainly single-cell transcriptome sequencing, not genome sequencing. The experimental methods I have seen so far for implementing single-cell sequencing are:</p><ol><li>Using flow cytometry to sort cells and then performing subsequent reactions in individual wells</li><li>The single-cell sequencing solution provided by 10X Genomics. Although it has a hint of flow-based principles, instead of putting each cell in an individual well, it delivers the cells into GEM droplets, adds barcodes within the droplets, and then sequences them on Illumina machines</li></ol><p>From a principle standpoint, these two approaches differ in library construction and splitting. The former essentially involves selecting cells through flow cytometry and performing reactions and library construction individually in each well. Therefore, it treats each cell as an individual sample and mixes them for sequencing</p><p>On the other hand, the latter adopts a special library construction method using GEM-based experimental systems. Before constructing the library, it tags each cell’s nucleic acid with labels (16nt 10X Barcode and 10nt UMI), then mixes all the nucleic acids together to construct the library. In this way, the nucleic acids under one Illumina sample index actually come from different cells. Cell data is split based on the barcodes on the nucleic acids, and due to the presence of UMIs, they can be used for duplicate processing in subsequent steps</p><h1 id="Technical-Route"><a href="#Technical-Route" class="headerlink" title="Technical Route"></a>Technical Route</h1><h2 id="Flow-Cytometry-Based-Approach"><a href="#Flow-Cytometry-Based-Approach" class="headerlink" title="Flow Cytometry-Based Approach"></a>Flow Cytometry-Based Approach</h2><ul><li>Since it essentially follows a classic method for constructing transcriptome libraries, but uses flow cytometry to reduce sample size to individual cells, the software&#x2F;technological route under this approach is basically no different from that of single-sample methods. However, one may need to pay attention to issues such as duplicates and running efficiency</li></ul><h2 id="10X-GEM-Based-Approach"><a href="#10X-GEM-Based-Approach" class="headerlink" title="10X GEM-Based Approach"></a>10X GEM-Based Approach</h2><ul><li>Due to the use of a special library construction method, the most convenient way is to use the cellranger software suite provided by 10X Genomics. This software covers the entire analysis process from data demultiplexing to generating expression matrices and some downstream analyses (dimensionality reduction visualization, cell clustering, differential expression, marker selection), making it very convenient</li></ul><h1 id="Downstream-Analysis-Approach"><a href="#Downstream-Analysis-Approach" class="headerlink" title="Downstream Analysis Approach"></a>Downstream Analysis Approach</h1><p>Cell classification&#x2F;clustering -&gt; Differential expression -&gt; Marker selection -&gt; Association?</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> single cell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Usage Notes</title>
      <link href="/en/2018/09/28/Git%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
      <url>/en/2018/09/28/Git%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>I had read about Git tutorials a long time ago, but I never actually used it. Now that I’m using it, I feel like I’ve become a programmer in some way!</p><h1 id="Operation-Method-Records"><a href="#Operation-Method-Records" class="headerlink" title="Operation Method Records"></a>Operation Method Records</h1><ul><li>User Initialization, when first using on a new device:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Silen Wang&quot;</span> <span class="comment"># Set the user name</span></span><br><span class="line">git config --global user.email <span class="string">&quot;mymail@gmail.com&quot;</span> <span class="comment"># Set the user email</span></span><br><span class="line">git config --global core.editor <span class="string">&#x27;vim&#x27;</span> <span class="comment"># Set the editor used for commit messages</span></span><br></pre></td></tr></table></figure><ul><li>Clone a project’s entire code:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> PROJ_URL</span><br></pre></td></tr></table></figure><ul><li>Pull updates</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull <span class="comment"># Applicable when cloning a project, if there are multiple sources, specify which source to pull from</span></span><br><span class="line">git pull origin master <span class="comment"># Specify pulling the master branch of the origin remote repository</span></span><br></pre></td></tr></table></figure><ul><li>Push updates</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br><span class="line">git push origin master <span class="comment"># Specify pushing to the master branch of origin, if not specified, it might use a default setting? Not sure exactly what happens.</span></span><br></pre></td></tr></table></figure><ul><li>Remote management</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="comment"># View remote information</span></span><br><span class="line">git remote add REMOTE_URL <span class="comment"># Add remote repository information</span></span><br></pre></td></tr></table></figure><ul><li>Modify commits, Git stores local file modifications in a staging area. To submit these changes, first confirm the commit modifications.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add FILE <span class="comment"># Stage new files or mark changes to files as ready for submission</span></span><br><span class="line">git commit <span class="comment"># Commit all uncommitted modifications with a simple description of what was modified. This description can be used to trace back previous actions.</span></span><br><span class="line">git commit -a <span class="comment"># Directly commit all uncommitted modifications with the same description</span></span><br></pre></td></tr></table></figure><ul><li>Branch operations, the concept of branches allows creating a backup of the current project (a copy), then making modifications on this branch without affecting the original branch (e.g., master). Once the modified branch is tested and has no issues, merge the changes into the branch that needs modification.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b dev <span class="comment"># Create and switch to the dev branch</span></span><br><span class="line">git checkout dev <span class="comment"># Switch to the dev branch</span></span><br><span class="line">git merge dev <span class="comment"># Merge changes from the dev branch into the current branch</span></span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gogs Deployment</title>
      <link href="/en/2018/09/21/Gogs%E9%83%A8%E7%BD%B2-md/"/>
      <url>/en/2018/09/21/Gogs%E9%83%A8%E7%BD%B2-md/</url>
      
        <content type="html"><![CDATA[<p>Bought a VPS; the monthly traffic usage is so low that it’s really a waste… So let’s make better use of it. After all, it costs $5 per month.</p><span id="more"></span><h1 id="Deployment-Steps"><a href="#Deployment-Steps" class="headerlink" title="Deployment Steps"></a>Deployment Steps</h1><p>Gogs is a lightweight Git hosting service implemented in Go. Its resource consumption is so small that it can even run on a Raspberry Pi.</p><p>I previously set it up once but didn’t document the process. This time, I had to look it up again…</p><p>Overall, using Docker for deployment (it’s simple), so basically just configuring a file and running a few commands. The installation of Docker isn’t explained here; there are instructions in ArchWiki. The main installation command is:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.io/gogs/gogs</span><br></pre></td></tr></table></figure><p>Then prepare a <code>docker-compose.yml</code> file with the following content, execute it in the directory containing this file, and start using Gogs. The access port for Gogs is 10080.</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;2&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  gogs:</span><br><span class="line">    image: docker.io/gogs/gogs</span><br><span class="line"></span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;10022:22&quot;</span><br><span class="line">      - &quot;10080:3000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - /var/gogs:/data</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Then to enable passwordless push, you need to set up SSH. By default, Gogs doesn’t have the SSH server enabled. You need to edit <code>/var/gogs/gogs/conf/app.ini</code> and modify it as follows (this is my configuration file directory; adjust according to the actual mount path in <code>volumes</code>):</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">DOMAIN</span>           = http://XXX.XXX.XXX.XXX</span><br><span class="line"><span class="attr">HTTP_PORT</span>        = <span class="number">3000</span></span><br><span class="line"><span class="attr">ROOT_URL</span>         = http://localhost:<span class="number">10080</span>/</span><br><span class="line"><span class="attr">DISABLE_SSH</span>      = <span class="literal">false</span></span><br><span class="line"><span class="attr">SSH_PORT</span>         = <span class="number">10022</span></span><br><span class="line"><span class="attr">START_SSH_SERVER</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">OFFLINE_MODE</span>     = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>Then set up the SSH keys as you would with GitHub.</p><h1 id="Solving-the-Issue-of-Adding-Multiple-Keys-update-20180921"><a href="#Solving-the-Issue-of-Adding-Multiple-Keys-update-20180921" class="headerlink" title="Solving the Issue of Adding Multiple Keys (update@20180921)"></a>Solving the Issue of Adding Multiple Keys (update@20180921)</h1><p>Although Gogs has a graphical interface for setting up SSH keys, there might be a bug in the version I pulled. When adding the first key, it works fine, but when trying to add more than one key from multiple machines, even though it shows as added in the graphical interface, it can’t normally log in via SSH with passwordless access. You need to further set up:</p><ul><li><p>Since my Docker container mounts <code>/data</code> to a directory outside the container, there’s no need to log into the Docker system and modify directly.</p></li><li><p>The corresponding file is: <code>挂载目录/gogs/git/.ssh/authorized_keys</code>. Add public key content according to the format. For example:</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command=&quot;/app/gogs/gogs serv key-1 --config=&#x27;/data/gogs/conf/app.ini&#x27;&quot;,no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty ssh-rsa AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA test</span><br></pre></td></tr></table></figure></li><li><p>Save it and you can log in without restarting the container.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gogs </tag>
            
            <tag> vps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>G胖牛逼!!!!!!!!!!!!!!!</title>
      <link href="/en/2018/09/07/G%E8%83%96%E7%89%9B%E9%80%BC/"/>
      <url>/en/2018/09/07/G%E8%83%96%E7%89%9B%E9%80%BC/</url>
      
        <content type="html"><![CDATA[<p>This must be a historic moment!</p><span id="more"></span><p>A week ago, I read news that Steam’s latest Linux version integrated a feature called Steam Play, which combined Wine and Proton, allowing users to run Windows games directly on Linux. They also provided a list of the first 27 games to be fully compatible (when this was written). At the time, I didn’t care much because I thought this technology was still in development and would take a long time to mature.</p><p>But last night before bed, feeling bored, I decided to try Steam………………………………………</p><p>…………………………………………………………………….</p><p>Wow, it’s amazing, truly super amazing!!!!!!!!!!!!!!!!!!!</p><p>I was running an old version of Xian Jie 4 that I had previously purchased. Just by clicking the mouse, I could play the game! On a cheap laptop with just Core M5!</p><p><img src="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_1.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_2.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_3.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/PAL4_3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>F*ck…… my mood hasn’t calmed down for hours.</p><p>How many ordinary users are unable to play enough games on Windows and end up being stuck with it, or delete Linux after trying dual-booting? This situation is expected to change dramatically in the next year and a half!</p><p>GTMD windows!</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> steam </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R Small Tips Collection</title>
      <link href="/en/2018/09/07/R%E5%B0%8F%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/"/>
      <url>/en/2018/09/07/R%E5%B0%8F%E9%97%AE%E9%A2%98%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>Working with R often involves encountering various issues. Here are some collected tips.</p><span id="more"></span><h1 id="Data-Frame-Operations"><a href="#Data-Frame-Operations" class="headerlink" title="Data Frame Operations"></a>Data Frame Operations</h1><h2 id="Extracting-a-Single-Column-Row-Without-Returning-a-Vector"><a href="#Extracting-a-Single-Column-Row-Without-Returning-a-Vector" class="headerlink" title="Extracting a Single Column&#x2F;Row Without Returning a Vector"></a>Extracting a Single Column&#x2F;Row Without Returning a Vector</h2><ul><li>When using <code>df[]</code> to subset a data frame, if you extract a single column or row, or delete all but one column or row, the resulting object will be a vector instead of a data frame. You need to specify the parameter to ensure it returns a data frame.</li><li>This method also applies to matrices.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span> drop <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="Merging-Data-Using-row-names-as-Key"><a href="#Merging-Data-Using-row-names-as-Key" class="headerlink" title="Merging Data Using row.names as Key"></a>Merging Data Using row.names as Key</h2><ul><li>Many Chinese materials describe merging data by using one column as the key for row-wise merging. However, you can also use <code>row.names</code> as the key, but after merging, <code>row.names</code> will become a column of data. You need to specify <code>row.names</code> again.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Two-step process</span></span><br><span class="line">merge_data <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">merge_data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>merge_data<span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># One-step merge</span></span><br><span class="line">merge_data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>merge<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><h2 id="R’s-Python-Dict-Alternative"><a href="#R’s-Python-Dict-Alternative" class="headerlink" title="R’s Python Dict Alternative"></a>R’s Python Dict Alternative</h2><ul><li>Many online resources use lists combined with the <code>match</code> function to implement dictionary-like functionality. However, in R, named vectors can be used to achieve key-value mapping, which is very convenient. However, it’s unclear whether this approach is efficient.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>a<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="string">&quot;c&quot;</span><span class="punctuation">)</span></span><br><span class="line">tmp <span class="operator">&lt;-</span> a<span class="punctuation">[</span><span class="string">&quot;a&quot;</span><span class="punctuation">]</span></span><br><span class="line">print<span class="punctuation">(</span>tmp<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo syntax highlighting plugin</title>
      <link href="/en/2018/09/05/hexo%E9%AB%98%E4%BA%AE%E4%B8%BB%E9%A2%98%E6%8F%92%E4%BB%B6/"/>
      <url>/en/2018/09/05/hexo%E9%AB%98%E4%BA%AE%E4%B8%BB%E9%A2%98%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>I found that the default theme of Hexo is not very appealing, so I wanted to find a bright one and tried using a plugin.</p><span id="more"></span><p>The plugin can be found <a href="https://github.com/ele828/hexo-prism-plugin">here</a>. Installation is quite simple; just run <code>npm i -S hexo-prism-plugin</code>. Then, open the blog’s configuration file <code>_config.yml</code>, disable the built-in highlighting, and add the settings for this plugin.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">prism_plugin:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">&#x27;preprocess&#x27;</span>    <span class="comment"># realtime/preprocess</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">false</span>    <span class="comment"># default false</span></span><br><span class="line">  <span class="attr">custom_css:</span> <span class="string">&#x27;path/to/your/custom.css&#x27;</span>     <span class="comment"># optional</span></span><br></pre></td></tr></table></figure><p>After that, update as usual. This plugin supports multiple highlighting modes and custom CSS. The supported languages are listed on the above link.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R Install GitHub Package Timeout Issue Solution</title>
      <link href="/en/2018/09/05/R%E5%AE%89%E8%A3%85git%E5%8C%85%E5%87%BA%E7%8E%B0timeout%E9%97%AE%E9%A2%98/"/>
      <url>/en/2018/09/05/R%E5%AE%89%E8%A3%85git%E5%8C%85%E5%87%BA%E7%8E%B0timeout%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>When installing packages from GitHub in R, sometimes you may encounter a connection timeout issue with GitHub. Here’s how to solve it.</p><span id="more"></span><p>Essentially, this involves loading the <code>curl</code> package and using <code>curl</code> to download the package. This might only work on Linux systems.</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span>download.file.method <span class="operator">=</span> <span class="string">&quot;libcurl&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;curl&#x27;</span><span class="punctuation">)</span></span><br><span class="line">install_github<span class="punctuation">(</span>PACKAGENAME<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><ul><li>If the installed package still cannot return an object, try manually downloading the package and then modifying the source code to install directly from the source.</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.packages<span class="punctuation">(</span>path_to_file<span class="punctuation">,</span> repos <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;source&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker Usage Record</title>
      <link href="/en/2018/09/02/docker%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2018/09/02/docker%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>To make good use of the old, broken device… I decided to set up a server to accumulate experience. Considering the portability of the things I will be setting up, using Docker in containers is convenient for migration and usage.</p><span id="more"></span><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>The environment system uses Manjaro, since this is what I am most familiar with. And ArchWiki can provide help for many strange problems. Installing Docker is very simple:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S docker</span><br><span class="line"><span class="comment"># To allow ordinary users to use Docker, you need to add the corresponding user group and add the user to the group.</span></span><br><span class="line">sudo groupadd docker</span><br><span class="line">sudo gpasswd -a <span class="variable">$&#123;USER&#125;</span> docker</span><br><span class="line"><span class="comment"># Alternatively, you can use the `usermod` command:</span></span><br><span class="line">sudo usermod -Ga docker <span class="variable">$&#123;USER&#125;</span></span><br><span class="line"><span class="comment"># If it has already been enabled, restart it; no need to enable it again.</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>To speed up image (images) downloads, set up a domestic mirror source (registry mirror) for Docker Hub. The configuration file is <code>/etc/docker/daemon.json</code>. After configuring, execute <code>sudo systemctl restart docker</code>:</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn/&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Image-Creation-and-Internal-Operations"><a href="#Image-Creation-and-Internal-Operations" class="headerlink" title="Image Creation and Internal Operations"></a>Image Creation and Internal Operations</h1><p>Prepare to install R and the <code>sscClust</code> package in a container. The company’s server is CentOS6, so pull the corresponding image:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos:6</span><br></pre></td></tr></table></figure><p>However, after pulling the above image, it could not start normally. According to <a href="https://forums.docker.com/t/docker-run-it-has-started-failing-with-status-139/18309">here</a>, this might be an issue with the official image. So I switched to pulling <code>centos:7</code>, which worked fine after changing versions.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -dti IMAGE_ID /bin/bash</span><br><span class="line"><span class="comment"># Log in to Docker for operations. Note that when logged in, you are root; operate carefully...</span></span><br><span class="line">docker <span class="built_in">exec</span> -it CONTAINER_ID /bin/bash</span><br></pre></td></tr></table></figure><p>After logging in, install vim and set up basic environment variables. Then start installing R.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line"><span class="comment"># Change the image source</span></span><br><span class="line">yum install wget</span><br><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="comment"># Different image sources have different package versions, delete existing cache to prevent errors.</span></span><br><span class="line">yum clean all</span><br><span class="line">yum -y makecache</span><br><span class="line">yum -y install R</span><br></pre></td></tr></table></figure><p>Install some system software packages required for R package installation.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openssl-devel libcurl-devel libxml2-devel gsl-devel</span><br></pre></td></tr></table></figure><p>After entering R, start installing <code>sscClust</code> (installing R will automatically install a lot of dependencies; installing this package will have even more dependencies…)</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">options<span class="punctuation">(</span><span class="string">&quot;repos&quot;</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>CRAN<span class="operator">=</span><span class="string">&quot;https://mirrors.ustc.edu.cn/CRAN/&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">options<span class="punctuation">(</span>BioC_mirror<span class="operator">=</span><span class="string">&quot;http://mirrors.ustc.edu.cn/bioc/&quot;</span><span class="punctuation">)</span></span><br><span class="line">source<span class="punctuation">(</span><span class="string">&quot;http://bioconductor.org/biocLite.R&quot;</span><span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;devtools&quot;</span><span class="punctuation">)</span></span><br><span class="line">biocLite<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;SingleCellExperiment&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;scran&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;SC3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;zinbwave&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;BiocParallel&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;Japrin/sscClust&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>If there are no special network issues, <code>sscClust</code> should install smoothly. Finally, save the changes made to the Docker container as an image. After saving, it will display a series of sha256 values. Use <code>docker images</code> to see the saved images.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit CONTAINER_ID r/sscclust</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SGE System Usage Notes</title>
      <link href="/en/2018/08/30/SGE%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
      <url>/en/2018/08/30/SGE%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>When using SGE at a new company, the approach is somewhat different. Here are some notes.</p><span id="more"></span><h1 id="Script-Writing"><a href="#Script-Writing" class="headerlink" title="Script Writing"></a>Script Writing</h1><p>After writing the script, it is not specified when submitting; instead, it is written into the script to be submitted and then directly <code>qsub shell.sh</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！/bin/bash</span></span><br><span class="line"><span class="comment">#$ -S /bin/bash          // Indicates that this script is for bash</span></span><br><span class="line"><span class="comment">#$ -V                    // Passes all environment variables from the current command</span></span><br><span class="line"><span class="comment">#$ -cwd                  // Sets the current path as the working directory</span></span><br><span class="line"><span class="comment">#$ -N WorkName           // Task name</span></span><br><span class="line"><span class="comment">#$ -o WorkName.log       // Task output log file name</span></span><br><span class="line"><span class="comment">#$ -j y                  // Specifies whether the standard error stream of the task is merged with the standard output stream [yes] no</span></span><br><span class="line"></span><br><span class="line">shell script</span><br></pre></td></tr></table></figure><p>Submitting a script containing the above content is essentially equivalent to:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">qsub -S /bin/bash \</span><br><span class="line">    -V \</span><br><span class="line">    -cwd \</span><br><span class="line">    -N WorkName \</span><br><span class="line">    -o WorkName.<span class="built_in">log</span> \</span><br><span class="line">    -j y \</span><br><span class="line">    shell script</span><br></pre></td></tr></table></figure><h1 id="qlogin-Usage"><a href="#qlogin-Usage" class="headerlink" title="qlogin Usage"></a>qlogin Usage</h1><p>For testing purposes, you can use <code>qlogin</code> to log in to a compute node. Then, the operations performed on the compute node environment are consistent with submitting a script using <code>qsub</code>.<br>&#96;&#96;&#96;</p>]]></content>
      
      
      <categories>
          
          <category> Bioinformatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sge </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pandas Operation Notes</title>
      <link href="/en/2018/08/29/Pandas%E6%93%8D%E4%BD%9C%E7%AC%94%E8%AE%B0/"/>
      <url>/en/2018/08/29/Pandas%E6%93%8D%E4%BD%9C%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>Recently, I’ve been using Pandas a lot and have compiled some commonly used functions for future reference.</p><span id="more"></span><h1 id="Data-Reading"><a href="#Data-Reading" class="headerlink" title="Data Reading"></a>Data Reading</h1><ul><li>Basic reading can be done directly with <code>read_csv</code>, which involves several parameters.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(file_path, sep=<span class="string">&quot;\t&quot;</span>, index_col=<span class="number">0</span>, header=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># index_col is equivalent to row.names in R; it specifies a column to use as the row labels and removes that column from the data. If not specified, a 0-length numeric label will be generated.</span></span><br><span class="line"><span class="comment"># header functions are different from R&#x27;s logic; by default, header=0, which means the first row is used as the header. If you don&#x27;t want a header, use header=None. If you specify another row as the header, rows above that header will be discarded.</span></span><br></pre></td></tr></table></figure><ul><li>When dealing with large datasets to prevent memory overflow, it’s necessary to read the file in chunks.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># reader is a generator</span></span><br><span class="line">reader = pd.read_csv(file_path, sep=<span class="string">&quot;\t&quot;</span>, iterator=<span class="literal">True</span>, chunksize=<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># iterator / chunksize specifying either will generate an iterator. If you specify chunksize, you don&#x27;t need to write iterator.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If reader was specified with chunksize, you can directly call get_chunk()</span></span><br><span class="line"><span class="comment"># To obtain a specific number of rows; otherwise, use get_chunk(num), which I haven&#x27;t thoroughly tested.</span></span><br><span class="line"><span class="comment"># Note: The row count here refers to the data rows and does not include the header because when generating reader,</span></span><br><span class="line"><span class="comment"># it defaults to using the first row as the header. Therefore, all subsequent generated dfs have headers.</span></span><br><span class="line">chunk = reader.get_chunk()</span><br><span class="line">df = pd.DataFrame(chunk)</span><br></pre></td></tr></table></figure><ul><li>Additionally, Pandas can intelligently recognize whether a file is compressed (by extension) and read&#x2F;write files with specified delimiters without issues.</li></ul><details yellow><summary> Deprecated `read_table` </summary>              <div class='content'>              <p>I don’t remember from which version onwards, <code>read_table</code> was deprecated in favor of <code>read_csv</code>, which is said to have better performance for CSV files.</p><p>However, it’s quite annoying that bioinformatics fields often use <code>tsv</code> files or similar formats…</p>              </div>            </details><h1 id="Data-Writing"><a href="#Data-Writing" class="headerlink" title="Data Writing"></a>Data Writing</h1><ul><li>My most commonly used formats are <code>tsv</code> and <code>xlsx</code>.</li></ul><h2 id="Plain-Text-File"><a href="#Plain-Text-File" class="headerlink" title="Plain Text File"></a>Plain Text File</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="comment">## Write to Excel</span></span><br><span class="line"></span><br><span class="line">- The method <span class="keyword">is</span> very simple:</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">data.to_excel(FILE, sheet_name=<span class="string">&#x27;SHEET&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>Note that if you want to write multiple data tables to multiple sheets in one go, you can do this:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.to_excel(FILE, sheet_name=[<span class="string">&#x27;SHEET1&#x27;</span>, <span class="string">&#x27;SHEET2&#x27;</span>])</span><br></pre></td></tr></table></figure><h1 id="Subset-Selection"><a href="#Subset-Selection" class="headerlink" title="Subset Selection"></a>Subset Selection</h1><ul><li>Similar to R, Pandas supports various subset selection methods. The logic for some selections is similar to R, but there are differences. Generally, whatever can be achieved in Pandas can also be done in R, but the reverse may not be true. Here, I only record methods similar to R’s selection logic.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_table(file_path, sep=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="comment"># Use .loc[row, col] for selecting rows and columns based on labels.</span></span><br><span class="line">df = df.loc[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], [<span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]]</span><br><span class="line"><span class="comment"># Note that unlike R, when selecting a single column, there should be no space before the comma. When selecting a single row, you can leave the space after the comma.</span></span><br><span class="line">df = df.loc[:, [<span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]]</span><br><span class="line">df = df.loc[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], ]</span><br><span class="line"><span class="comment"># Corresponding to .loc is .iloc, which uses row/column indices instead of labels. Note that it starts from 0.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Row-and-Column-Deletion"><a href="#Row-and-Column-Deletion" class="headerlink" title="Row and Column Deletion"></a>Row and Column Deletion</h1><h1 id="Iteration-Processing"><a href="#Iteration-Processing" class="headerlink" title="Iteration Processing"></a>Iteration Processing</h1>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Installing R Packages with Conda and Configuring Jupyter</title>
      <link href="/en/2018/08/28/%E4%BD%BF%E7%94%A8conda%E5%AE%89%E8%A3%85R%E5%8C%85/"/>
      <url>/en/2018/08/28/%E4%BD%BF%E7%94%A8conda%E5%AE%89%E8%A3%85R%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<p>Due to work requirements, I needed to install a package mentioned in a literature. Initially, I thought it would be done with two commands, but who knew there were so many dependencies to resolve… and R packages on Linux need to be compiled, which is quite time-consuming… Fortunately, there’s Conda!</p><span id="more"></span><p>Speaking of which, when reading WeChat public accounts before, I didn’t know why they recommended using Conda to install necessary tools… This experience has made me realize how annoying the dependencies in Linux can be… And as a normal user without full permissions, many paths are restricted… Conda’s method is very useful, even though it wastes some space.</p><h1 id="Conda-Installation"><a href="#Conda-Installation" class="headerlink" title="Conda Installation"></a>Conda Installation</h1><ul><li>Conda comes in two versions… I don’t know if they can be called distributions. One is Anaconda, and the other is Miniconda. You can think of them as full installation and minimal installation. Anaconda comes with a complete Python environment, even Jupyter is included, while Miniconda only includes the basic Python and not much else. Since I mainly use it to install R, I chose <a href="https://conda.io/miniconda.html">Miniconda</a>.</li><li>The downloaded Linux installation file is an exceptionally large shell script. Running it will start the installation.</li><li>After installation, you can use the <code>conda</code> command to install what you want. For example, I can start installing R.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install r</span><br></pre></td></tr></table></figure><ul><li>Everything installed using Conda is uniformly placed in the Conda installation directory. The folder structure inside seems a bit different from the root directory.</li><li>When initially completing the Conda installation, if no special instructions are given, Conda will modify the original <code>~/.bashrc</code> file and add the Conda bin directory to the <code>PATH</code> variable. However, its priority is after the system default directories (<code>/bin</code>). Since I want to use Conda’s configuration to override the system defaults, I manually added this line to <code>~/.bash_profile</code> and placed Conda’s bin directory at the front of the system defaults.</li><li>Conda also has mirror sites in China. Edit <code>~/.condarc</code> (create it if it doesn’t exist) and add the following content to use the USTC mirror (Tsinghua’s reportedly has issues, so I didn’t use it). Of course, this is just an example; under <code>pkg</code>, there are other sources as well. Add them if needed.</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">channels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https://mirrors.ustc.edu.cn/anaconda/pkgs/free/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">defaults</span></span><br><span class="line"><span class="attr">show_channel_urls:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>After that, execute R and install the relevant packages inside. The installed R packages will not be placed in <code>~/R</code> but will also be entirely in Conda’s directory. Refer to the installation output for specifics.</li><li>Since R packages need to be compiled, I used Miniconda, so there were unsatisfied dependencies. Those packages can be installed using <code>conda install</code>. Additionally, you can check all available versions on Anaconda’s website and then execute the corresponding commands.</li></ul><p>This time, with Conda’s assistance, most dependency issues were resolved. The only one that couldn’t be resolved was compiled locally and uploaded… It took two days to finally package it up… I hope there won’t be any problems when using it.</p><h1 id="Jupyter-Installation-and-Configuration"><a href="#Jupyter-Installation-and-Configuration" class="headerlink" title="Jupyter Installation and Configuration"></a>Jupyter Installation and Configuration</h1><p>R is on the cluster, which makes debugging somewhat inconvenient since I’m used to writing and testing in RStudio or Jupyter Notebook. Fortunately, Conda can also install Jupyter, so I searched for remote access configuration methods.</p><ul><li>First, use Conda to install Jupyter.</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install jupyter</span><br></pre></td></tr></table></figure><ul><li>After completion, configure Jupyter.</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the configuration file</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"><span class="comment"># Set a password. Follow the prompts and enter twice.</span></span><br><span class="line">jupyter notebook password</span><br></pre></td></tr></table></figure><ul><li>Open the generated configuration file with an editor (for regular users, it’s usually <code>~/.jupyter/jupyter_notebook_config.py</code>, as indicated by the prompt when generating the file).</li><li>Find the following items, uncomment them, and change the corresponding values. The password is in the JSON file mentioned during generation; there will be a long string inside. Copy and paste it all over.</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.ip=&#x27;*&#x27;</span><br><span class="line">c.NotebookApp.password = u&#x27;your_key_str&#x27;</span><br><span class="line">c.NotebookApp.open_browser = False # Represents starting the notebook service without opening the browser and accessing it.</span><br><span class="line">c.NotebookApp.port = 8888 # This can be omitted; a port will be automatically assigned.</span><br></pre></td></tr></table></figure><ul><li>Then, you can open your browser on any computer that can connect to the cluster IP with <code>0.0.0.0:8888</code> and access it by entering the password.</li></ul><hr><p>Due to work requirements, I needed to install a package mentioned in a literature. Initially, I thought it would be done with two commands, but who knew there were so many dependencies to resolve… and R packages on Linux need to be compiled, which is quite time-consuming… Fortunately, there’s Conda!</p><!-- more --><p>Speaking of which, when reading wechat public accounts before, I didn’t know why they recommended using Conda to install necessary tools… This experience has made me realize how annoying the dependencies in Linux can be… And as a normal user without full permissions, many paths are written forbidden… Conda’s method is very useful, even though it wastes space.</p><h1 id="Conda-Installation-1"><a href="#Conda-Installation-1" class="headerlink" title="Conda Installation"></a>Conda Installation</h1><ul><li>Conda comes in two versions… I don’t know if they can be called distributions. One is Anaconda, and the other is Miniconda. You can think of them as full installation and minimal installation. Anaconda comes with a complete Python environment, even Jupyter is included, while Miniconda only includes the basic Python and not much else. Since I mainly use it to install R, I chose <a href="https://conda.io/miniconda.html">Miniconda</a>.</li><li>The downloaded Linux installation file is an exceptionally large shell script. Running it will start the installation.</li><li>After installation, you can use the <code>conda</code> command to install what you want. For example, I can start installing R.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install r</span><br></pre></td></tr></table></figure><ul><li>Everything installed using Conda is uniformly placed in the Conda installation directory. The folder structure inside seems a bit different from the root directory.</li><li>When initially completing the Conda installation, if no special instructions are given, Conda will modify the original <code>~/.bash</code> file and add the Conda bin directory to the <code>PATH</code> variable. However, its priority is after the system default directories (<code>/bin</code>). Since I want to use Conda’s configuration to override the system defaults, I manually added this line to <code>~/.bash_profile</code> and placed Conda’s bin directory at the front of the system defaults.</li><li>Conda also has mirror sites in China. Edit <code>~/.condarc</code> (create it if it doesn’t exist) and add the following content to use the USTC mirror (Tsinghua’s reportedly has issues, so I didn’t use it). Of course, this is just an example; under <code>pkg</code>, there are other sources as well. Add them if needed.</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">channels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https://mirrors.ustc.edu.cn/anaconda/pkgs/free/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">defaults</span></span><br><span class="line"><span class="attr">show_channel_urls:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>After that, excute R and install the relevant packages inside. The installed R packages will not be placed in <code>~/R</code> but will also be entirely in Conda’s directory. Refer to the installation output for specifics.</li><li>Since R packages need to be compiled, I used Miniconda, so there were unsatisfied dependencies. Those packages can be installed using <code>conda install</code>. Additionally, you can check all available versions on Anaconda’s website and then execute the corresponding commands.</li></ul><p>This time, with Conda’s assistance, most dependency issues were resolved. The only one that couldn’t be resolved was compiled locally and uploaded… It took two days to finally package it up… I hope there won’t be any problems when using it.</p><h1 id="Jupyter-Installation-and-Configuration-1"><a href="#Jupyter-Installation-and-Configuration-1" class="headerlink" title="Jupyter Installation and Configuration"></a>Jupyter Installation and Configuration</h1><p>R is on the cluster, which makes debugging somewhat inconvenient since I’m used to writing and testing in RStudio or Jupyter Notebook. Fortunately, Conda can also install Jupyter, so I searched for remote access configuration methods.</p><ul><li>First, use Conda to install Jupyter.</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install jupyter</span><br></pre></td></tr></table></figure><ul><li>After completion, configure Jupyter.</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the configuration file</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"><span class="comment"># Set a password. Follow the prompts and enter twice.</span></span><br><span class="line">jupyter notebook password</span><br></pre></td></tr></table></figure><ul><li>Open the generated configuration file with an editor (for regular users, it’s usually <code>~/.jupyter/jupyter_notebook_config.py</code>, as indicated by the prompt when generating the file).</li><li>Find the following items, uncomment them, and change the corresponding values. The password is in the JSON file mentioned during generation; there will be a long string inside. Copy and paste it all over.</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.ip=&#x27;*&#x27;</span><br><span class="line">c.NotebookApp.password = u&#x27;your_key_str&#x27;</span><br><span class="line">c.NotebookApp.open_browser = False # Represents starting the notebook service without opening the browser and accessing it.</span><br><span class="line">c.NotebookApp.port = 8888 # This can be omitted; a port will be automatically assigned.</span><br></pre></td></tr></table></figure><ul><li>Then, you can open your browser on any computer that can connect to the cluster IP with <code>0.0.0.0:8888</code> and access it by entering the password.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
            <tag> conda </tag>
            
            <tag> jupyter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Using minicap to Capture Screenshots from a Phone</title>
      <link href="/en/2018/08/28/%E4%BD%BF%E7%94%A8minicap%E4%BB%8E%E6%89%8B%E6%9C%BA%E4%B8%AD%E6%88%AA%E5%9B%BE/"/>
      <url>/en/2018/08/28/%E4%BD%BF%E7%94%A8minicap%E4%BB%8E%E6%89%8B%E6%9C%BA%E4%B8%AD%E6%88%AA%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<p>Practicing automated phone operations inevitably involves capturing the current image of the phone. The phone’s built-in screenshot is too slow, so replacing it with minicap.</p><span id="more"></span><h1 id="Software-Compilation"><a href="#Software-Compilation" class="headerlink" title="Software Compilation"></a>Software Compilation</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Clone the project code and initialize</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openstf/minicap</span><br><span class="line"><span class="built_in">cd</span> minicap/</span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line"><span class="comment"># Compile, ndk is required (archlinuxcn source has it, just install directly)</span></span><br><span class="line">sudo pacman -S android-ndk</span><br><span class="line"><span class="comment"># Compile, after installation, it won&#x27;t be added to bin automatically, so run with absolute path</span></span><br><span class="line">/opt/android-ndk/ndk-build</span><br></pre></td></tr></table></figure><h1 id="Software-Deployment-to-Phone"><a href="#Software-Deployment-to-Phone" class="headerlink" title="Software Deployment to Phone"></a>Software Deployment to Phone</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># To use adb connect to the device, if not installed first install adb</span></span><br><span class="line"><span class="comment"># manjaro community has it, I remember the official version is自带的, now using the community edition may be due to minimalization considerations not default installing</span></span><br><span class="line">sudo pacman -S android-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn on USB debugging on the phone and connect to the computer, if device is not registered in phone select allow current device debugging</span></span><br><span class="line">adb devices</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get phone basic information to push corresponding version of minicap to the phone</span></span><br><span class="line">ABI=$(adb shell getprop ro.product.cpu.abi | <span class="built_in">tr</span> -d <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">SDK=$(adb shell getprop ro.build.version.sdk | <span class="built_in">tr</span> -d <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">adb push libs/<span class="variable">$ABI</span>/minicap /data/local/tmp/</span><br><span class="line">adb push jni/minicap-shared/aosp/libs/android-<span class="variable">$SDK</span>/<span class="variable">$ABI</span>/minicap.so /data/local/tmp/</span><br><span class="line">adb shell <span class="built_in">chmod</span> 777 /data/local/tmp/minicap</span><br><span class="line"><span class="comment"># Test if it can run</span></span><br><span class="line">adb shell LD_LIBRARY_PATH=/data/local/tmp /data/local/tmp/minicap -P 1080x1920@1080x1920/0 –t</span><br><span class="line"><span class="comment"># If running successfully, the last will display &#x27;OK&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The environment variable setting is necessary because it needs to specify the library path, -P后面的参数是截图参数, 详情可参见minicap的项目网页, -s but表截图并输出到</span></span><br><span class="line"><span class="comment"># 标准输出, 所以重定向就好</span></span><br><span class="line">adb shell LD_LIBRARY_PATH=/data/local/tmp /data/local/tmp/minicap -P 1080x1920@1080x1920/0 –s &gt; /sdcard/minicap/test.jpg</span><br></pre></td></tr></table></figure><h1 id="To-be-completed"><a href="#To-be-completed" class="headerlink" title="To be completed"></a>To be completed</h1><ul><li>Wrap the above commands into a script, and set up wifi connection information at the same time, so you can control multiple devices simultaneously.</li></ul><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> android </tag>
            
            <tag> adb </tag>
            
            <tag> minicap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python使用Sqlite3</title>
      <link href="/en/2018/08/26/Python%E4%BD%BF%E7%94%A8Sqlite3/"/>
      <url>/en/2018/08/26/Python%E4%BD%BF%E7%94%A8Sqlite3/</url>
      
        <content type="html"><![CDATA[<p>To prepare for future operations using Sqlite3, I recently tried using it to operate on databases at work. I decided to use sqlite3 because it seemed convenient. However, I found that not all SQL statements are supported by sqlite3, and its free-form shell commands cannot be called directly by the Python sqlite module…</p><span id="more"></span><h2 id="Simple-Usage"><a href="#Simple-Usage" class="headerlink" title="Simple Usage:"></a>Simple Usage:</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3   <span class="comment"># Import the module</span></span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;test.db&#x27;</span>)   <span class="comment"># Connect to the database (it will be created if it doesn&#x27;t exist)</span></span><br><span class="line">cursor = conn.cursor()    <span class="comment"># Create a pointer from the database object</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;sql cmd&#x27;</span>)   <span class="comment"># Pass SQL statements to the database, note that operations are not immediately saved/synchronized to the database</span></span><br><span class="line">cursor.close()   <span class="comment"># Close the pointer</span></span><br><span class="line">conn.commit()   <span class="comment"># Confirm changes</span></span><br><span class="line">conn.close()   <span class="comment"># Close the connection</span></span><br></pre></td></tr></table></figure><ul><li>Usage Notes:<ul><li>Only standard SQL statements are supported. Since sqlite is being used, unsupported SQL syntax cannot be used, and sqlite-specific shell commands cannot be used either because these commands are essentially executed in the shell, not as SQL statements.</li><li>If you must use shell commands, you can use the os module or another module that can call the shell, effectively executing shell commands.</li><li>Not all operations need to be completed through the pointer object. Some can be done using the database object itself, which can save a few lines of code. See <a href="http://www.runoob.com/sqlite/sqlite-python.html">the introduction on the Coder’s Tutorial website</a> for more details.</li><li>Remember to confirm changes (<code>obj.commit()</code>), otherwise the content in the database will not change.</li><li>I tried using the with statement to connect, but it doesn’t automatically close the connection outside the with statement scope (<code>obj.close()</code>), so you still need to write it explicitly.</li></ul></li></ul><h2 id="Calling-Shell-Commands"><a href="#Calling-Shell-Commands" class="headerlink" title="Calling Shell Commands"></a>Calling Shell Commands</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, textwrap</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is where textwrap is used to adjust shell command indentation for better readability when outputting. It&#x27;s not necessary.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd_gen</span>(<span class="params">cmd_str</span>):</span><br><span class="line">    cmd_str = textwrap.dedent(cmd_str)</span><br><span class="line">    cmd_str = cmd_str.strip()</span><br><span class="line">    <span class="keyword">return</span> cmd_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db_file = <span class="string">&#x27;test.db&#x27;</span></span><br><span class="line">index_file = <span class="string">&#x27;index.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate the command, this is the only valid method I found online. The specific meaning will be explained later...</span></span><br><span class="line">cmd = cmd_gen(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    sqlite3 &#123;db_file&#125; &lt;&lt; EOF</span></span><br><span class="line"><span class="string">    .separator &quot;\\t&quot;</span></span><br><span class="line"><span class="string">    .import &#123;index_file&#125; idx_tab</span></span><br><span class="line"><span class="string">    EOF</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(db_file=db_file, index_file=index_file))</span><br><span class="line">os.system(cmd)</span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> sqlite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Desktop Migration</title>
      <link href="/en/2018/08/26/%E6%A1%8C%E9%9D%A2%E5%8F%92%E8%BF%81%E7%A7%BB/"/>
      <url>/en/2018/08/26/%E6%A1%8C%E9%9D%A2%E5%8F%92%E8%BF%81%E7%A7%BB/</url>
      
        <content type="html"><![CDATA[<p>After using Linux for a while, I often come across a famous quote: “Life goes on, fiddling never stops.” However, to be honest, after getting a job last year, due to the company being stingy and not providing a computer, I had to use my own computer for work… really不敢乱折腾 (I still remember the despair of losing my thesis papers on Baidu Cloud Disk…). But after changing jobs, putting everything on Baidu Cloud Disk… I was once again tempted.</p><p>Actually, this time the fiddling wasn’t due to being annoyed; rather, it was because the current system was actually having problems —- inexplicable screen flickering.<br>I don’t remember when this started, but my laptop’s screen would randomly and irregularly black out and flash. Sometimes there were horizontal snowflakes flashing. At first, I thought it might be related to the warranty expiration… after all, it was bought from a factory store (really cheap…), and when I got the computer, it seemed like it had been refurbished (the box was somewhat damaged, and the screws on the back of the laptop were worn out). Then, after using it for three months, the keyboard backlight failed. But after observing for some time, I found that this flickering was quite peculiar because it happened more when an external screen was connected or when using a browser; if not using a browser and not connecting an external screen, it almost never happened. Moreover, the flickering occurred in ordinary users, but if logged in as root, no matter how you played around, it wouldn’t happen…<br>So I concluded that I must have accidentally modified some configuration files causing software issues, so I decided to reinstall (absolutely not because contacting the merchant for warranty was ignored~).</p><p>Since we’re reinstalling, and since this laptop is no longer used for work, why don’t we try something new?</p><p>Actually, I’ve been watching Deepin’s DDE for a long time… to be honest… it’s always better to know your own people… I feel that the Deepin team really understands the needs of domestic users. From the very beginning, it was just fancy but had lots of bugs and didn’t allow customization (at first, it was really pretty, but there were many bugs and you couldn’t customize it), but now it still looks good, and its functionality, usability, and performance have improved… it’s really made great progress. As a result, Deepin has gained quite a few users internationally (Deepin’s international community also has many posts, and the Manjaro community maintenance distribution board often discusses Deepin).</p><p>Although I’ve always downloaded the latest Deepin community edition live CD to try it out whenever there was an update, it wasn’t until recently that I realized that some XFCE shortcuts and features were not available in Deepin. Moreover, before this version, Deepin’s resource consumption, fluidity, and stability were far inferior to XFCE, so I always tried for a night but ultimately didn’t install it on my real machine.</p><p>This time it’s different, one thing is that I don’t need to use my personal laptop for work anymore, secondly, I’m relatively free now, so there’s no lack of time to adapt to the new operation mode. Plus, Deepin updated to version 15.7 recently, and Manjaro’s Deepin source has also been updated. So I decided to format my computer and start using it.</p><p>I have to say… in the first few hours, the differences were still not too great, but after two days, I gradually got used to it… so people… once they accept a set…</p><p>By the way, I also discovered something really cool: Deepin had touchpad gesture support last year. It supports three-finger maximize and restore windows, as well as quickly splitting windows left and right. This gesture can greatly alleviate the discomfort of not being able to use <code>super+mouse drag window</code>. Note that this gesture is built into DDE and does not conflict with <code>libinput-gesture</code>, so if you install <code>libinput-gesture</code> again, both gestures will fight for control. The current DDE gesture configuration file is <code>/usr/share/dde-daemon/gesture.json</code>, which is in JSON format, feeling easier to understand than <code>libinput-gesture</code>.</p><p>Still, here are my desktop screenshots from the past:</p><ul><li><p>Mint (Cinnamon)<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-28%2016:51:03%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-28%2016:51:03%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>Manjaro (Cinnamon)<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/Manjaro-desktop-2016-05-15%2020-55-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/Manjaro-desktop-2016-05-15%2020-55-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>Manjaro (Xfce)<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="http://7xluqf.com1.z0.glb.clouddn.com/consel.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/consel.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>Manjaro (Deepin)<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/deepin_desktop.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/deepin_desktop.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="http://7xluqf.com1.z0.glb.clouddn.com/deepin_desktop2.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/deepin_desktop2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> manjaro </tag>
            
            <tag> deepin </tag>
            
            <tag> de </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Job Change Memoir</title>
      <link href="/en/2018/08/14/%E6%8D%A2%E5%B7%A5%E4%BD%9C%E5%B0%8F%E8%AE%B0/"/>
      <url>/en/2018/08/14/%E6%8D%A2%E5%B7%A5%E4%BD%9C%E5%B0%8F%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>Leaving one job for another, I wonder if it’s always going to be a struggle…</p><span id="more"></span><p>In July 2017, I finally bid farewell to my student life and officially joined the workforce. My position was a bioinformatics engineer at Tianjin Nuohe Zhiyuan.</p><p>In August 2018, after barely managing to complete the handover of tasks, I finally left Nuohe after one year and one month. My new company is Hangzhou Ruipei Gene, and I am still working as a bioinformatics engineer.</p><p>I don’t have many thoughts about my previous employer. Although I really worked like crazy since getting promoted early, I did learn something and felt that my efforts were rewarded. However, after accidentally learning about the IT department’s situation… well, let me shout out my frustration loudly. And wish all my fellow colleagues who are still stuck in this pit to find better opportunities soon and get out of it.</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Regular Expression Symbols Collection</title>
      <link href="/en/2018/07/29/%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E7%AC%A6%E5%8F%B7%E6%94%B6%E5%BD%95/"/>
      <url>/en/2018/07/29/%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E7%AC%A6%E5%8F%B7%E6%94%B6%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>Regular expressions are still quite useful in many situations. However, there are some differences in how they are written across different programs, so it’s a good idea to make a cheat sheet for reference!</p><span id="more"></span><h1 id="Basic-General-Part"><a href="#Basic-General-Part" class="headerlink" title="Basic General Part"></a>Basic General Part</h1><p>Table source: <a href="http://www.cnblogs.com/yirlin/archive/2006/04/12/373222.html">yirlin’s blog</a></p><ul><li><code>\</code>: Escapes the next character, which can be a special character, an ordinary character, a backreference, or an octal escape. For example, <code>n</code> matches the character <code>n</code>. <code>\n</code> matches a newline character. The sequence <code>\\</code> matches <code>\</code>, and <code>\(</code> matches <code>(</code>.</li><li><code>^</code>: Matches the start of the input string. If the Multiline property is set on the RegExp object, <code>^</code> also matches <code>\n</code> or <code>\r</code> after positions.</li><li><code>$</code>: Matches the end of the input string. If the Multiline property is set on the RegExp object, <code>$</code> also matches <code>\n</code> or <code>\r</code> before positions.</li><li><code>*</code>: Matches zero or more occurrences of the preceding subexpression. For example, <code>zo*</code> can match <code>z</code> and <code>zoo</code>. <code>*</code> is equivalent to <code>&#123;0,&#125;</code>.</li><li><code>+</code>: Matches one or more occurrences of the preceding subexpression. For example, <code>zo+</code> can match <code>zo</code> and <code>zoo</code>, but not <code>z</code>. <code>+</code> is equivalent to <code>&#123;1,&#125;</code>.</li><li><code>?</code>: Matches zero or one occurrence of the preceding subexpression. For example, <code>do(es)?</code> can match <code>do</code> or <code>does</code> in <code>do</code>. <code>?</code> is equivalent to <code>&#123;0,1&#125;</code>.</li><li><code>&#123;n&#125;</code>: n is a non-negative integer. Matches exactly n occurrences. For example, <code>o&#123;2&#125;</code> cannot match the <code>o</code> in <code>Bob</code>, but it can match all <code>o</code>s in <code>food</code>.</li><li><code>&#123;n,&#125;</code>: n is a non-negative integer. Matches at least n occurrences. For example, <code>o&#123;2,&#125;</code> cannot match the <code>o</code> in <code>Bob</code>, but it can match all <code>o</code>s in <code>foooood</code>. <code>&#123;1,&#125;</code> is equivalent to <code>+</code>. <code>&#123;0,&#125;</code> is equivalent to <code>*</code>.</li><li><code>&#123;n,m&#125;</code>: m and n are non-negative integers, where n &lt;&#x3D; m. Matches at least n occurrences and no more than m occurrences. For example, <code>o&#123;1,3&#125;</code> will match the first three <code>o</code>s in <code>fooooood</code>. <code>&#123;0,1&#125;</code> is equivalent to <code>?</code>. Note that there should be no space between the comma and the two numbers.</li><li><code>?</code>: When this character follows any other quantifier (<code>*, +, ?, &#123;n&#125;, &#123;n,&#125;, &#123;n,m&#125;</code>), it makes the matching pattern non-greedy. Non-greedy mode matches as few characters as possible in the searched string, while the default greedy mode matches as many characters as possible. For example, for the string <code>oooo</code>, <code>o+?</code> will match a single <code>o</code>, and <code>o+</code> will match all <code>o</code>s.</li><li><code>.</code>: Matches any single character except <code>\n</code>. To match any character including <code>\n</code>, use the pattern <code>[.\n]</code>.</li><li><code>(pattern)</code>: Matches pattern and captures this match. Captured matches can be obtained from the generated Matches collection, in VBScript using SubMatches collection, in JScript using $0…$9 properties. To match round bracket characters, use <code>\(</code> or <code>\)</code>.</li><li><code>(?:pattern)</code>: Matches pattern but does not capture the match result, i.e., a non-capturing group, which is useful when combining parts of a pattern with “or” characters. For example, <code>industr(?:y|ies)</code> is a more concise expression than <code>industry|industries</code>.</li><li><code>(?=pattern)</code>: Positive lookahead, matches at the start position of any string that matches pattern. This is a non-capturing group, which means this match does not need to be captured for later use. For example, <code>Windows (?=95|98|NT|2000)</code> can match <code>Windows 2000</code> in <code>Windows 2000</code>, but it cannot match <code>Windows 3.1</code> in <code>Windows 3.1</code>. Lookahead does not consume characters, so after a match occurs, the search for the next match starts immediately after the last match without starting from the character following the lookahead.</li><li><code>(?!pattern)</code>: Negative lookahead, matches at the start position of any string that does not match pattern. This is a non-capturing group, which means this match does not need to be captured for later use. For example, <code>Windows (?!95|98|NT|2000)</code> can match <code>Windows 3.1</code> in <code>Windows 3.1</code>, but it cannot match <code>Windows 2000</code> in <code>Windows 2000</code>. Lookahead does not consume characters, so after a match occurs, the search for the next match starts immediately after the last match without starting from the character following the lookahead.</li><li><code>x|y</code>: Matches x or y. For example, <code>z|food</code> can match <code>z</code> or <code>food</code>. <code>(z|f)ood</code> then matches <code>zood</code> or <code>food</code>.</li><li><code>[xyz]</code>: Character set. Matches any one of the characters contained within it. For example, <code>[abc]</code> can match <code>a</code> in <code>plain</code>.</li><li><code>[^xyz]</code>: Negative character set. Matches any character not contained within it. For example, <code>[^abc]</code> can match <code>p</code> in <code>plain</code>.</li><li><code>[a-z]</code>: Character range. Matches any character within the specified range. For example, <code>[a-z]</code> can match any lowercase letter from <code>a</code> to <code>z</code>.</li><li><code>[^a-z]</code>: Negative character range. Matches any character not within the specified range. For example, <code>[^a-z]</code> can match any character that is not a lowercase letter from <code>a</code> to <code>z</code>.</li><li><code>\b</code>: Matches a word boundary, i.e., the position between a word and a space. For example, <code>er\b</code> can match <code>er</code> in <code>never</code>, but it cannot match <code>er</code> in <code>verb</code>.</li><li><code>\B</code>: Matches a non-word boundary. <code>er\B</code> can match <code>er</code> in <code>verb</code>, but it cannot match <code>er</code> in <code>never</code>.</li><li><code>\cx</code>: Matches the control character specified by x. For example, <code>\cM</code> matches a Control-M or carriage return. The value of x must be A-Z or a-z; otherwise, c is treated as an ordinary <code>c</code> character.</li><li><code>\d</code>: Matches any digit character. Equivalent to <code>[0-9]</code>.</li><li><code>\D</code>: Matches any non-digit character. Equivalent to <code>[^0-9]</code>.</li><li><code>\f</code>: Matches a form feed. Equivalent to <code>\x0c</code> and <code>\cL</code>.</li><li><code>\n</code>: Matches a newline character. Equivalent to <code>\x0a</code> and <code>\cJ</code>.</li><li><code>\r</code>: Matches a carriage return character. Equivalent to <code>\x0d</code> and <code>\cM</code>.</li><li><code>\s</code>: Matches any whitespace character, including spaces, tabs, form feeds, etc. Equivalent to <code>[\f\n\r\t\v]</code>.</li><li><code>\S</code>: Matches any non-whitespace character. Equivalent to <code>[^\\f\\n\\r\\t\\v]</code>.</li><li><code>\t</code>: Matches a tab character. Equivalent to <code>\x09</code> and <code>\cI</code>.</li><li><code>\v</code>: Matches a vertical tab character. Equivalent to <code>\x0b</code> and <code>\cK</code>.</li><li><code>\w</code>: Matches any word character, including underscores. Equivalent to <code>[A-Za-z0-9_]</code>.</li><li><code>\W</code>: Matches any non-word character. Equivalent to <code>[^A-Za-z0-9_]</code>.</li><li><code>\xn</code>: Matches n, where n is a two-digit hexadecimal escape value. The hexadecimal escape value must be exactly two digits long. For example, <code>\x41</code> matches <code>A</code>. <code>\x041</code> is equivalent to <code>\x04 &amp;1</code>. Regular expressions can use ASCII encoding.</li><li><code>\num</code>: Matches num, where num is a positive integer. A reference to the captured match. For example, <code>(.)&#39;\1</code> matches two consecutive identical characters.</li><li><code>\n</code>: Identifies an octal escape value or a backreference. If <code>\n</code> has at least n captured subexpressions before it, then n is a backreference. Otherwise, if n is an octal digit (0-7), then n is an octal escape value.</li><li><code>\nm</code>: Identifies an octal escape value or a backreference. If <code>\nm</code> has at least nm captured subexpressions before it, then nm is a backreference. If <code>\nm</code> has at least n captured subexpressions, then n is a backreference followed by the letter m. If none of the above conditions are met, if both n and m are octal digits (0-7), then <code>\nm</code> matches the octal escape value nm.</li><li><code>\nml</code>: If n is an octal digit (0-3) and both m and l are octal digits (0-7), then it matches the octal escape value nml.</li><li><code>\un</code>: Matches n, where n is a four-digit hexadecimal representation of a Unicode character. For example, <code>\u00A9</code> matches the copyright symbol (?)&#96;.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Regular Expressions </tag>
            
            <tag> Perl </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>System Migration Record</title>
      <link href="/en/2018/07/29/%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/en/2018/07/29/%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>Since I started using Linux desktop distributions in my sophomore year, I have been constantly switching between different发行 versions. After a few years of fiddling around, I finally settled on Manjaro.</p><span id="more"></span><h1 id="Mint-Migration-Record"><a href="#Mint-Migration-Record" class="headerlink" title="Mint Migration Record"></a>Mint Migration Record</h1><p>Due to Ubuntu crashing, during the process of reinstalling Ubuntu, I decided to switch to the world’s most popular Linux distribution - Mint. It is said to be more user-friendly and comes with everything out of the box.</p><p>However, practice makes perfect… For someone who was already used to Unity, it wasn’t that simple…</p><p>Installation went smoothly, almost identical to Ubuntu’s liveCD. Initially, I thought about not formatting the home directory, but after realizing that yesterday’s Ubuntu still had issues, I decided to bite the bullet and format it. After copying some files back, it took me a while to get everything set up.</p><p>After logging into the Mint interface, the login window was really more beautiful than Ubuntu, with ultra-high-definition clear photos instead of dark tones. However, after logging in, the interface… It took half a year to get used to Unity’s layout, switching back to GNOME&#x2F;Win-like interfaces was really annoying. Besides the different layouts, Mint’s display effects didn’t feel as good as Ubuntu for me. Chinese fonts felt blurry, possibly due to Noto Sans? After switching to WenQuanYi Microhei, most places improved, but it still wasn’t perfect. Baidu said that WenQuanYi Microhei tends to be blurry when the font size is small… So I directly increased all the font sizes.</p><h2 id="Input-Method-Settings"><a href="#Input-Method-Settings" class="headerlink" title="Input Method Settings"></a>Input Method Settings</h2><p>Mint doesn’t come with any input methods by default. Although Firefox has them, without an input method, you can’t fully type in English…</p><p>The input method settings are under Language Settings, although it lists supported input methods, there are no packages available in the software sources, so they cannot be installed directly from the Software Center.</p><ul><li>PPA installation code:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:fcitx-team/nightly</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install fcitx</span><br></pre></td></tr></table></figure><p>After installation, some dependencies are needed. I didn’t use the PPA to install, instead, I went to Language -&gt; Input Method and selected Fcitx to directly install the necessary dependencies. After installation, download Sogou from the Sogou website and install it. Restart (logout whether works or not), and you can use the input method. When reinstalling, I copied my previous Ubuntu’s &#x2F;home over, but the Sogou input method’s dictionary didn’t seem to be retained.</p><h2 id="Software-Installation"><a href="#Software-Installation" class="headerlink" title="Software Installation"></a>Software Installation</h2><ul><li><p>PPA installation:</p><ul><li>VirtualBox</li><li>GoldenDict</li><li>Shadowsocks-Qt5</li><li>PlayOnLinux</li><li>Okular</li><li>WizNote</li><li>R-base</li><li>Numix-circle</li></ul></li><li><p>PPA addition code</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:hzwhuang/ss-qt5 ppa:wiznote-team ppa:numix/ppa</span><br></pre></td></tr></table></figure><ul><li>R-base directly added the source information <code>deb http://mirror.bjtu.edu.cn/cran/bin/linux/ubuntu trusty/</code> to the software sources</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/apt/sources.list</span><br></pre></td></tr></table></figure><ul><li>PPA installation</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install VirtualBox GoldenDict Shadowsocks-Qt5 PlayOnLinux Okular WizNote R-base numix-icon-theme-circle kolourpaint</span><br></pre></td></tr></table></figure><ul><li>Deb installation<ul><li>mendeley</li><li>haroopad</li><li>Rstudio</li><li>bcloud</li><li>wps</li></ul></li></ul><h2 id="Configuration-Migration"><a href="#Configuration-Migration" class="headerlink" title="Configuration Migration"></a>Configuration Migration</h2><p>Backup the original &#x2F;home, after reinstalling, copy it over. Most software configurations will be retained (Firefox plugins, configuration lost, reason unknown)</p><h2 id="Program-Settings"><a href="#Program-Settings" class="headerlink" title="Program Settings"></a>Program Settings</h2><p>Since I was already used to Unity, I made some adjustments to the Mint interface to lower the adaptation difficulty.</p><ul><li>Panel moved up</li><li>User小程序 placed at the far left</li></ul><h2 id="Firefox-Settings-and-Plugins"><a href="#Firefox-Settings-and-Plugins" class="headerlink" title="Firefox Settings and Plugins"></a>Firefox Settings and Plugins</h2><p>Due to Firefox configuration loss, I’m recording related settings here to prevent them from being lost again next time.</p><ul><li><p>Using plugins:</p><ul><li>Adblock Plus</li><li>FxoyProxy</li><li>Hide Cpation Titlebar Plus</li><li>Stylish</li></ul></li><li><p>Stylish setting (another post has it, repeating the record)</p></li><li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@-moz-document regexp(&quot;https?://(?!.+\\.coursera\\.org).*&quot;)&#123;</span><br><span class="line">*:not([class*=&quot;icon&quot;]):not(i)&#123;font-family: &quot;WenQuanYi Microhei&quot;  !important;&#125;</span><br><span class="line">    span.fui-logo-text&#123;font-family: &quot;IterCast-Icon&quot;  !important;&#125;</span><br><span class="line">    span.diffstat-bar&#123;font-family: &quot;octicons&quot;  !important;&#125;</span><br><span class="line">    span.diff-added&#123;font-family: &quot;octicons&quot;  !important;&#125;</span><br><span class="line">    #indexbutton&#123;font-family: &quot;html5test&quot;  !important;&#125;</span><br><span class="line">    .toolbox ins a&#123;font-family: &quot;2345&quot;  !important;&#125;</span><br><span class="line">    .tool_ul li a ins&#123;font-family: &quot;2345&quot;  !important;&#125;</span><br><span class="line">    .panel ins a&#123;font-family: &quot;2345&quot;  !important;&#125;</span><br><span class="line">    span.nba_matchnav_score&#123;font-family: &quot;Sans-Serif&quot;  !important;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Ubuntu-Unity-vs-Mint-Cinnamon-Usage-Comparison"><a href="#Ubuntu-Unity-vs-Mint-Cinnamon-Usage-Comparison" class="headerlink" title="Ubuntu Unity vs Mint Cinnamon Usage Comparison"></a>Ubuntu Unity vs Mint Cinnamon Usage Comparison</h2><ul><li>Display effects&#x2F;Interface layout</li></ul><p>Personally, I’m more used to Unity. Although Ubuntu’s default colors aren’t very appealing, after installing Numix themes and changing the wallpaper, it still looks quite nice. Unity places the program panel on the left, and the top panel for integrating title bars. This design is indeed saving a lot of space on 16:9 screens, allowing more content to be displayed. And Ubuntu’s default fonts and icons are quite large, making them easier to adapt after switching back to Windows or Mint. The display effects of Ubuntu also seem better than Mint, possibly because the fonts are larger, using WenQuanYi Microhei won’t be blurry…</p><ul><li>Usability</li></ul><p>Mint is indeed more user-friendly than Ubuntu. It’s no wonder it has the highest click-through rate. Mint provides a higher degree of graphicalization in its settings center, integrating many more options compared to Ubuntu. The login window software sources can be managed very conveniently through GUI. File operations have right-click menu options to open with root privileges without needing command-line operations. Of course… once you know the path, dragging and dropping is actually quite fast.</p><p>Details are also very贴心, for example, when opening a manager with root privileges, there will be special prompts, avoiding the confusion that Ubuntu users often encounter. </p><p>Mint’s panel extensions and theme switching are also very convenient, with resources directly downloadable without needing to find them separately.</p><p>Of course, because I migrated from Unity back then, some habits have a significant impact on usability. If it were for someone who directly migrated from Windows, Mint would be extremely user-friendly. Then I think in terms of software updates, Mint really does a great job… It sets special protection for core parts, preventing users from easily updating the kernel, which is very friendly to me as a half-newbie with强迫症 (I don’t know if my previous Ubuntu was because of an update that crashed).</p><ul><li>Small problems<br>From 3 years ago when I first used various Ubuntu-based distributions, small issues have never stopped. Due to the large user base of Windows, font乱码 is completely unavoidable. Besides some scattered issues that may not affect usage… we can only wait for future fixes.<ul><li>Ubuntu-related small problems<ol><li>Dual graphics card, independent graphics card driver (could not be solved)</li><li>Touchpad (turned on by default at boot)</li><li>Screen brightness (could not remember the last brightness setting)</li><li>Error reports (unknown error prompts that don’t have any actual impact)</li><li>Occasionally freezes when watching videos for a long time</li><li>Occasionally lags, I’m not sure why it lags (not many programs running)</li></ol></li><li>Mint-related small problems<ol><li>Dual graphics card, independent graphics card driver</li><li>Screen brightness</li><li>Occasionally lags</li><li>Sleep&#x2F;suspend cannot wake up</li><li>Fonts always feel a bit blurry</li><li>Some wireless mice automatically go to sleep</li><li>Firefox download menu clicking on open file location makes Firefox freeze</li></ol></li></ul></li></ul><h2 id="Interface-Reorganization"><a href="#Interface-Reorganization" class="headerlink" title="Interface Reorganization"></a>Interface Reorganization</h2><p>Sometimes, when I’m bored, I do boring things. Recently, for some reason, I felt that looking at my desktop wasn’t very satisfying and decided to start tweaking.<br>Basically, it boils down to preferring Unity’s layout style, although many people find this strange, after accepting this setting… really feels quite cool…. Unfortunately, the graphics card driver I couldn’t figure out.</p><p>At first, my Mint layout was like this:<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-14%2014:26:36%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-14%2014:26:36%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Basically, it was like Win (and XP) under the menu-&gt;quick start-&gt;open windows, notification bar. Initially, when switching from Ubuntu to Windows, I still retained the window button left placement, but after repeatedly mis-clicking the menu, I eventually switched back to the right…</p><p>But using it for a while felt that the position of the open windows in the middle was too small, and with four or more window tabs, they would be partially obscured, making it difficult to switch between them….</p><p>So I tried using dock tools to replace the toolbar’s quick start, resulting in this layout:<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-28%2016:51:03%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-02-28%2016:51:03%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>Ah, a little bit like Unity! But not as good as Unity…..<br>I tried using the toolbar mode, but docky was blocked by the system自带 toolbars….<br>This layout used for a few days and then I found problems, after all, quite many software have buttons or menus on the left side…. Habitually flying my mouse over would often mistakenly open other programs….</p><p>So, I still put docky at the bottom…<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>&#x3D; &#x3D;|||Ah….So my desktop layout became similar to most GNOME2-era users…….Was this arrangement really tested?……So my struggles were meaningless?…God…</p><h1 id="Mint-to-Manjaro"><a href="#Mint-to-Manjaro" class="headerlink" title="Mint to Manjaro"></a>Mint to Manjaro</h1><h2 id="From-Ubuntu-based-to-Arch-based"><a href="#From-Ubuntu-based-to-Arch-based" class="headerlink" title="From Ubuntu-based to Arch-based"></a>From Ubuntu-based to Arch-based</h2><p>I started trying Linux systems from my junior year, and I’ve always been using Ubuntu and its derivative distributions. This time, switching to a Manjaro based on Arch is quite a big change. Actually, before the switch, I was very anxious, after all, I’m known for being blacklisted…. And although I’ve used Linux for a long time, I’m still considered a beginner in Linux, so I was afraid that during the process, I might cause serious problems and crash my computer….. However, from this experience, things went well. To date, it has been exactly one week since switching systems, and all the commonly used software I need have been successfully installed (including games), there haven’t been any severe issues hindering use (although there are many small bugs scattered around…), and I plan to continue running for two more months. If everything goes well in the next two months, I might consider uninstalling Mint.</p><h2 id="Why-Choose-Manjaro"><a href="#Why-Choose-Manjaro" class="headerlink" title="Why Choose Manjaro"></a>Why Choose Manjaro</h2><p>Because it’s simple! Although I was recommended to switch to Arch-based systems, since I’m not very familiar with Linux, I didn’t consider installing the original Arch directly, instead, I searched for a popular Arch derivative on DistrioWatch, which is now what I’m using - Manjaro.<br>Although true Arch fans might think this belongs to heresy… because Manjaro doesn’t follow Arch’s principle of being as minimalistic as possible and leaving everything up to the user, but for me, who wants to experience Pacman but don’t want to spend too much time reading Arch Wiki, Manjaro is a very good solution…</p><h2 id="Installation-Plan"><a href="#Installation-Plan" class="headerlink" title="Installation Plan"></a>Installation Plan</h2><p>Since this was my first time using a Linux system other than Ubuntu-based ones, I naturally chose a dual-boot installation plan to leave myself an escape route.<br>My laptop’s hard drive uses GPT partitioning, and I only installed one Linux Mint, no Windows at all. Solving the boot problem was quite convenient, during installation, I set Manjaro to install its Grub2 into the existing EFI partition, then manually deleted the Linux Mint’s EFI files in the EFI partition.<br>There were two reasons for directly deleting:</p><ol><li>From Mint’s Grub2, it couldn’t correctly boot Manjaro, but Manjaro’s Grub2 could correctly boot Mint, the reason was unclear, possibly because Mint’s version was too low?</li><li>I didn’t know how to let the system automatically choose to use Manjaro’s installed Grub2, so I just deleted Mint’s and left only Manjaro’s.<br>Overall, the installation went quite smoothly, similar to installing Ubuntu or Mint, just a few mouse clicks were needed. However, after the first installation, I tried fiddling with the graphics card drivers, and then the desktop resolution became abnormal and couldn’t be restored, so I reinstalled it again….</li></ol><h2 id="Manjaro-Cinnamon-Edition-vs-Linux-Mint-Comparison"><a href="#Manjaro-Cinnamon-Edition-vs-Linux-Mint-Comparison" class="headerlink" title="Manjaro(Cinnamon Edition) vs Linux Mint Comparison"></a>Manjaro(Cinnamon Edition) vs Linux Mint Comparison</h2><h3 id="Desktop-Environment"><a href="#Desktop-Environment" class="headerlink" title="Desktop Environment"></a>Desktop Environment</h3><p>Manjaro supports multiple desktop environments, to reduce my migration resistance, I chose the version with Cinnamon. So although they are different systems, their appearance looks almost the same, in terms of default installed software, there are some differences:</p><ul><li>Some system options and driver management need to be done using “Manjaro Setting Manager”, while Mint’s settings are all integrated into the settings panel.</li><li>In Mint 17, language and input method were located under the same setting item, allowing simultaneous management of language and input method. In Manjaro, there is only an independent language setting item in “Manjaro Setting Manager” with no input method management.</li><li>For dual graphics card computers, Manjaro defaults to installing bumblebee, and there are no Nvidia Prime-related software packages in the software library, speculation that Arch-based systems use bumblebee for dual graphics card switching.</li><li>The package manager software is different from the source update software.</li><li>Manjaro does not have a default font management program.</li><li>Calculator programs are different.</li></ul><h3 id="Chinese-Localization"><a href="#Chinese-Localization" class="headerlink" title="Chinese Localization"></a>Chinese Localization</h3><p>In this aspect, Manjaro is much better than Mint. After selecting Chinese during installation, most of the Chinese localization was completed (including Gimp &#x2F; Firefox &#x2F; Libre Office). And for subsequent installed software with Chinese language packages, they would also be installed together, such as Okular &#x2F; Kolour Paint these KDE-based software.<br>While Mint 17 often has incomplete Chinese localization, after installing the system, only some common menu items are Chinese. Gimp &#x2F; Firefox &#x2F; Libre Office are all English, and you need to reinstall the language package yourself. And for subsequent installed software, they will always be in default English.</p><h3 id="Font-Effects"><a href="#Font-Effects" class="headerlink" title="Font Effects"></a>Font Effects</h3><p>Without any configuration, personally, I feel that Manjaro’s font effects are slightly worse than Mint. This was a surprise to me because I previously used the Live CD to experience Manjaro’s KDE version, and the fonts looked quite comfortable. Using the system settings’ font item for simple adjustments still felt like it wasn’t as good as Mint, feeling that Chinese characters had special blurriness… However, this can be solved by installing fontconfig-ubuntu and freetype2-ubuntu packages, after installation, you can get consistent display effects with Mint.</p><h3 id="Common-Software-Acquisition"><a href="#Common-Software-Acquisition" class="headerlink" title="Common Software Acquisition"></a>Common Software Acquisition</h3><p>A system based on Ubuntu, one based on Arch, naturally have different software package management. Arch is loved by many users for its almost everything available and always keeping the latest in its software repositories.<br>The official repository and AUR indeed have what software there is, all the software I used in U-series systems can be found in both the official repository and AUR. And like Rstudio &#x2F; sogou-pinyin &#x2F; WPS &#x2F; Steam etc., some software previously required downloading deb packages or adding PPA sources for installation, but after switching to Manjaro, a single command or clicking a few times in Pamac could solve it.<br>However, this convenience is established on the condition of good network environment.<br>In my school’s campus network, which is often unstable and slow, theoretically with a download speed of 512kb&#x2F;s, actual usage is generally only 100-200kb&#x2F;s, if downloading from overseas websites, the speed could be as low as 50kb&#x2F;s… So the software installation experience was really quite bad…… especially when installing from AUR, even though you don’t need to confirm, most packages require entering a password to get permissions. Because of the slow download speed and long time, it’s not possible to automatically install while installing software, I have to stand by one by one entering passwords…… and sometimes it can’t be installed successfully……<br>Good that there is an “archlinuxcn” source provided by Arch enthusiasts for domestic users, which has many packages from AUR that download very fast and install without any errors. <a href="https://wiki.archlinux.org/index.php/Unofficial_user_repositories#archlinuxcn">According to ArchWiki’s guidance to add “archlinuxcn” source</a> after adding it, I successfully installed most of the commonly used software.<br>Worth mentioning is that during the installation process, I found that not all software in the Arch repository are kept up to date. For example, R.<br>The official Arch repository provides version 3.2.4 of R, while the latest version is 3.3.0. Although AUR’s r-kml is the latest 3.3.0 version, I was afraid it might cause installation issues so I didn’t consider using it.<br>If using Mint, you can easily get the latest R through adding third-party PPAs, but in Arch-based systems, this cannot be done, so in the end, I chose to compile and install it, see the detailed installation process in my previous <a href="http://blog.leanote.com/post/silenseek/R-3.3.0-%E5%AE%89%E8%A3%85-Arch">another post</a>.</p><h3 id="Graphics-Card-Drivers"><a href="#Graphics-Card-Drivers" class="headerlink" title="Graphics Card Drivers"></a>Graphics Card Drivers</h3><p>Linux’s dual graphics card drivers have always been a problem I couldn’t figure out, which was also the main reason for me to migrate from the original Ubuntu to Mint: being able to install graphics card drivers in one click.<br>Perhaps Manjaro shares similar design ideas with Mint, so in terms of graphics card drivers, it does quite well. The system installs all drivers by default and there are no major issues when using them. However, I used Nvidia-prime for switching graphics cards in Mint, while Manjaro seems to only use Bumblebee. Recently, since I only play炉石传说和火炬之光2, I don’t really need the dedicated GPU, so I haven’t bothered with it…</p><h3 id="Input-Method"><a href="#Input-Method" class="headerlink" title="Input Method"></a>Input Method</h3><p>Manjaro doesn’t have a dedicated input method management item, directly installing input methods from the library is fine. It’s true that the Sogou Pinyin feels very good! Although I was used to Rime in Mint before, overall, it still isn’t as convenient as Sogou! Pray that fcitx won’t disappear again! I switched systems and you can’t let me down!!!!!!</p><h3 id="Small-Bugs-and-Issues"><a href="#Small-Bugs-and-Issues" class="headerlink" title="Small Bugs and Issues"></a>Small Bugs and Issues</h3><p>I don’t know if my face is really black, but from the moment I started using Linux, various small bugs have never stopped. This time, after switching from Mint to Manjaro, a part of it was also because Firefox’s Flash said it crashed, and I couldn’t find a solution……..<br>However, I switched to Manjaro……still encountered various small bugs continuously…..Organized them, the small bugs and issues encountered since switching to Manjaro are:</p><ul><li>Leanote default editor font is abnormal (solved after upgrading the kernel)</li><li>Vivaldi installing flash causes flashing (gave up using it)</li><li>Startup prompt: [failed] failed to start setup virtual console (already solved)</li><li>Startup without mouse pointer, re-login shows pointer (<a href="http://cncc.bingj.com/cache.aspx?q=Mouse+cursor+won%27t+appear+on+startup&d=4702496862111540&mkt=zh-CN&setlang=zh-CN&w=bFoHO6AgL5lacrZXtcV-NuAyXavoIkTi">already solved</a>)</li><li>Using screenshot program’s area screenshot function, the program does not respond (not solved)</li><li>unzip solves乱码 invalid (already solved)</li><li>Font blurry (already solved)</li><li>Steam cannot be started directly (already solved)</li><li>Neemo cannot lock to docky after starting, because docky recognizes it as root manager (not solved)</li><li>Rstudio cannot input Chinese (not solved)</li><li>Telegram cannot input Chinese (already solved)</li><li>PDF does not display Chinese (already solved)</li><li>Desktop display is abnormal, only low resolution can be used (reason unknown, reinstallation solves)</li><li>Text dragging and copying, dragging cannot cross windows through the panel (not solved)</li><li>Rename does not support regular expressions (already solved)</li><li>Global shortcuts occasionally fail (not solved)</li></ul><p>…There are so many problems, that my friends said, you’re not using Arch, but a version of Arch filled with bugs…<br>However, above issues did not significantly affect usage, and my computer can normally hibernate&#x2F;suspend, the failure rate of global shortcuts is also not as severe as in Mint. So overall, I successfully completed the migration from Mint to Manjaro.</p><h3 id="Learning-Resources"><a href="#Learning-Resources" class="headerlink" title="Learning Resources"></a>Learning Resources</h3><p>Arch Wiki’s detailed and meticulous content has always been praised by all Arch users and some non-Arch users. After using one week of an Arch derivative, I have a bit of experience with this too. But for me, compared to Ubuntu and its derivatives, searching for solutions to problems in Arch is much more difficult.<br>For example, the problem of Vivaldi installing Flash causing flashing, I directly searched “Arch Vivaldi Flash flashing” on Chinese&#x2F;Bing&#x2F;Google but couldn’t find any useful results……<br>Considering that Vivaldi is a small crowd within a small crowd, so changing “Vivaldi” to “Chrome” &#x2F; “Chromium”, still couldn’t find any useful results……This was quite awkward…<br>Actually, in Mint, I directly searched Chinese, if I really couldn’t find anything, then I would search English. After all, Mint is based on Ubuntu, and the number of users using Ubuntu domestically is still quite a lot, most of the time you can find effective solutions. Even if you can’t find an effective solution, through the Chinese search results, you can get a preliminary understanding of the problem, and then try to search for English results to find the solution.<br>Switching to Manjaro isn’t like that, not only are there few domestic users of Manjaro (no灌水 in forums&#x2F;bbs), but even the active degree of Archlinux Chinese forum&#x2F;bbs is far from Ubuntu, so the difficulty of searching in Chinese is really high by a notch or two.<br>Although many Linux problems are similar, using “Linux” as a keyword can get some problem solutions, but it’s not as convenient and quick as directly using “Ubuntu” as a keyword.</p><h2 id="After-Migration-Reflection"><a href="#After-Migration-Reflection" class="headerlink" title="After Migration Reflection"></a>After Migration Reflection</h2><p>Over one week, I can now complete all the things I previously completed on Manjaro, although there are still small bugs (like before…), there are also many surprises (Sogou works, hibernate&#x2F;suspend works normally) supporting me to continue using it. Looking forward to Manjaro staying stable for the next two months…….As for the kernel……should I update or not update good?</p><h2 id="Acknowledgment"><a href="#Acknowledgment" class="headerlink" title="Acknowledgment"></a>Acknowledgment</h2><p>Herein, I solemnly thank the person who introduced me into this! Having someone who has used it before is always more reassuring~</p><h2 id="Desktop-Screenshot-Remembrance"><a href="#Desktop-Screenshot-Remembrance" class="headerlink" title="Desktop Screenshot Remembrance"></a>Desktop Screenshot Remembrance</h2><p>Actually, the screenshots really don’t show much difference, after all, both are Cinnamon, and both have similar themes…</p><ul><li><p>Mint screenshot<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop-2016-03-06%2021:56:24%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>Manjaro screenshot<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/Manjaro-desktop-2016-05-15%2020-55-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/Manjaro-desktop-2016-05-15%2020-55-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ul><h2 id="Remembrance-Extra-Installed-Software-and-Package-List"><a href="#Remembrance-Extra-Installed-Software-and-Package-List" class="headerlink" title="Remembrance (Extra Installed Software and Package List)"></a>Remembrance (Extra Installed Software and Package List)</h2><h3 id="Official-Repository"><a href="#Official-Repository" class="headerlink" title="Official Repository"></a>Official Repository</h3><ul><li>docky</li><li>virtualbox</li><li>steam</li><li>fcitx</li><li>fcitx-sogoupinyin</li><li>steam-manjaro</li><li>steam-native</li><li>kdegraphics-okular</li><li>kdegraphics-kolourpaint</li><li>texmaker</li><li>uget</li><li>qbittorrent</li><li>flashplugin</li><li>perl-rename</li><li>gnome-font-viewer</li><li>goldendict</li></ul><h3 id="Archlinuxcn"><a href="#Archlinuxcn" class="headerlink" title="Archlinuxcn"></a>Archlinuxcn</h3><ul><li>telegram-desktop</li><li>mendeleydesktop</li><li>rstudio-desktop-bin</li><li>shadowsocks-qt5</li><li>atom-editor</li></ul><h3 id="AUR"><a href="#AUR" class="headerlink" title="AUR"></a>AUR</h3><ul><li>crossover</li></ul><h3 id="Download-and-Use"><a href="#Download-and-Use" class="headerlink" title="Download and Use"></a>Download and Use</h3><ul><li>Leanote</li><li>Unipro Ugene</li><li>VirtualBox Extension Pack</li></ul><h3 id="Compiled-Installation"><a href="#Compiled-Installation" class="headerlink" title="Compiled Installation"></a>Compiled Installation</h3><ul><li>R-3.3.0</li></ul><h1 id="Manjaro-Interface-Settings-manjaro"><a href="#Manjaro-Interface-Settings-manjaro" class="headerlink" title="Manjaro Interface Settings (manjaro)"></a>Manjaro Interface Settings (manjaro)</h1><p>Today I saw a video on YouTube about Manjaro Deepin 16.08 experience,</p><iframe width="560" height="315" src="https://www.youtube.com/embed/rMsOtFfrl6s" frameborder="0" allowfullscreen></iframe><p>I couldn’t help but download DDE to try.</p><p>It turns out that the Deepin team has put a lot of effort into making software, the latest Deepin 15.3 is quite smooth, and the entire interface design is simple and beautiful (in my opinion, second only to KDE…), feeling very promising~<br>However, since I’ve been using it for almost half a year now, switching to DDE feels so empty… Besides, since it’s still in development, there are fewer plugins and configurable options (well… for me, it’s through GUI configuration) compared to KDE. So although it looks beautiful… 15 minutes later, I uninstalled it and continued with XFCE…</p><p>…However… after watching the young and pretty one, returning to my original environment… cough… feels a bit uncomfortable…(I’m also a fickle old man…) so I started various theme changes again… while browsing Pamac’s software, I accidentally found a plugin: <code>xfce4-windowck-plugin</code>, this plugin can put the title bar and title buttons on the panel, which finally reminded me of Unity…</p><p>Thinking about what I said earlier, I still like Unity’s layout. Unfortunately, I couldn’t find a better solution when configuring it before. With this plugin, although it can’t reach Unity’s effect (Unity simultaneously integrates the title bar and menu to the panel), it at least saves some space!<br>Specific plan as follows:</p><ul><li>Install <code>xfce4-windowck-plugin</code></li><li>Put the plugin on the top panel</li><li>In the window manager settings, set the window maximized to hide the title bar</li><li>Set all buttons to the left</li><li>Move the menu button to the left panel, workspace indicator to the bottom panel</li><li>Ding ding ding~<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/leanote-xfce-unityLike.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/leanote-xfce-unityLike.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ul><h1 id="Manjaro-Crashed-Afterward"><a href="#Manjaro-Crashed-Afterward" class="headerlink" title="Manjaro Crashed Afterward"></a>Manjaro Crashed Afterward</h1><h2 id="Crashed-so-suddenly-had-to-die-big"><a href="#Crashed-so-suddenly-had-to-die-big" class="headerlink" title="Crashed so suddenly, had to die big"></a>Crashed so suddenly, had to die big</h2><p>When I migrated, I thought… with my luck, it would crash at least once within half a year, and sure enough, it did…<br>On Tuesday 2nd, for an unknown reason, the GUI couldn’t enter, stuck at the Manjaro Logo loading place, switching to the console showed nothing… completely didn’t know what was wrong, then I urgently needed to use my computer, thinking that previously when reinstalling Mint, I retained home, after reinstalling and mounting home, all software settings and personal files wouldn’t be lost, so I thought about not reinstalling!<br>Then I went! big!! dead!!!了!!!!<br>Reinstalling entered the GUI instantly confused… my home was formatted!!!<br>Speculation is that during reinstallation, I accidentally checked to format it…<br>Ah… really a thunderbolt lightning strike… all my experimental data were in home without backup…<br>After sulking for half an hour, I started looking for recovery methods, asked several stores on Taobao about data recovery services, but they were all Windows-based… really wanted to cry…<br>Tried using photorec and testdisk for repair, but it didn’t work at all…<br>On Tuesday night… finally realized the reality, had to start over…(you know what I mean…)</p><h2 id="Desktop-Environment-Change-don’t-know-how-many-times"><a href="#Desktop-Environment-Change-don’t-know-how-many-times" class="headerlink" title="Desktop Environment Change (don’t know how many times)"></a>Desktop Environment Change (don’t know how many times)</h2><p>Anyway, since the whole system needs to be reinstalled and reconfigured, so this time I wanted not only to change the desktop environment this time, but also to try something new. After all, I’ve always wanted to try the legendary Xfce… Fortunately, Xfce is officially supported by Manjaro, so I directly downloaded Manjaro Xfce prepared for a fresh reinstall.</p><h2 id="Installation-Process"><a href="#Installation-Process" class="headerlink" title="Installation Process"></a>Installation Process</h2><p>Manjaro’s various versions are quite simple to install… just click and click… as long as you don’t accidentally check to format it like me…</p><h2 id="Xfce-vs-Cinnamon"><a href="#Xfce-vs-Cinnamon" class="headerlink" title="Xfce vs Cinnamon"></a>Xfce vs Cinnamon</h2><p>Xfce is different from Unity or Cinnamon. Unity and Cinnamon aim to provide beautiful, user-friendly, and feature-rich operating interfaces, while Xfce prioritizes lightness as an important consideration. So the feeling when using them is quite different.<br>In simple terms, Xfce gives a very very fast feeling! Whether it’s starting the computer or loading programs, the speed difference is really visible to the naked eye… This can only be felt after trying. When I switched from Mint to Manjaro Cinnamon, I felt that the speed had a noticeable improvement. Now switching from Cinnamon to Xfce, the speed has improved again. Now reopening Mint feels so slow that it’s almost unbearable…<br>Lightweight &amp; Simple, Xfce fits these two points very well, but for me, who switched from Cinnamon, some small places being too simple made me feel uncomfortable:</p><ul><li>The volume control plugin on the panel is extremely simple… simple to the point where I often don’t know how to use this plugin… frequently accidentally adjusting the sound…</li><li>unzip does not support -O parameter… causing zip files to be displayed in乱码.</li><li>Keyboard shortcut settings do not have many preset schemes… need to first find out what command needs to be written to achieve the desired function (my laptop has no dedicated touchpad switch key, I must set up a shortcut myself)…</li><li>The built-in file manager does not support forward and backward keys, and there is no corresponding option in the settings… additionally… this thing really looks nothing like Nemo.</li><li>No disk (program for managing disk partitions and mounting)… instantly confused when setting automatic mount.</li><li>Cannot find the mousepad (text editor) setting anywhere… staring at a white background with small black text made me feel uncomfortable…</li><li>The built-in music player looks like it has many functions but completely doesn’t know how to use it… also does not support dragging to open files…</li><li>No network settings page for system proxy, only VPN</li></ul><p>These issues are not very big, more belong to suddenly switching desktop environments and not adapting. As a user, I can choose to slowly change habits to adapt, on the other hand, actually, you can modify the environment according to your habits… after all, this is Linux, as long as you want to mess around, most of it can be achieved.<br>For me personally, Xfce’s flying speed gave me enough motivation to continue using it. After all, fancy effects are nice, but there’s no object to look at, the feeling of being smooth and comfortable when using is more important…</p><h2 id="Revisiting-Arch-Wiki"><a href="#Revisiting-Arch-Wiki" class="headerlink" title="Revisiting Arch Wiki"></a>Revisiting Arch Wiki</h2><p>When I switched from U-series to A-series, I felt that A-series system documentation wasn’t as rich as U-series. Now after using Manjaro for a month and a half, my opinion has changed. Speaking of this… the documentation is indeed richer than Arch Wiki… in the past month and a half, over 80% of problems could be found in it. Problems that weren’t in Arch Wiki were also very difficult to find.<br>Actually, A-series documentation isn’t hard to find, but it’s not as user-friendly as U-series.<br>When using U-series systems, materials online generally include directly runnable problem-solving commands or codes. As long as the description of the problem is consistent, you can copy those few lines of code and run them in the terminal. Arch Wiki is different, when writing, it assumes that the reader has some Linux basics. It writes about the reason for the problem and the solution, but rarely directly provides one-click runnable codes.<br>From this angle, Arch is not suitable for beginners, but very good for learning Linux.</p><h2 id="System-Configuration"><a href="#System-Configuration" class="headerlink" title="System Configuration"></a>System Configuration</h2><p>My configuration principle is to尽量 fit my original work habits in Cinnamon, so I mainly reconfigured the panel (in the end, actually returned to Gnome2’s layout…), deleted some built-in software and replaced them with what I used in Cinnamon. Additionally, Steam’s runtime library had issues again in Xfce… previously using local runtime libraries in Cinnamon made all games run normally, but this didn’t work in Xfce. So I found another solution from Arch Wiki.<br>Specifically as follows:</p><h3 id="Replace-Volume-Control-Plugin"><a href="#Replace-Volume-Control-Plugin" class="headerlink" title="Replace Volume Control Plugin"></a>Replace Volume Control Plugin</h3><ul><li>Uninstall the built-in volume control plugin <code>pa-applet</code>, install <code>xfce4-pulseaudio-plugin</code>, manually add it to the panel (doesn’t support appearing in the notification bar)</li><li>Install the above plugin, adjusting the volume will have two volume change notifications. Right-click on the plugin’s properties and turn off one (the other might be the system default… don’t know how to turn it off).</li></ul><h3 id="Replace-unzip-package"><a href="#Replace-unzip-package" class="headerlink" title="Replace unzip package"></a>Replace unzip package</h3><ul><li>Install <code>unzip-iconv</code> (archlinuxcn repo) instead of <code>unzip</code></li></ul><h3 id="Set-up-touchpad-switch-shortcut-key"><a href="#Set-up-touchpad-switch-shortcut-key" class="headerlink" title="Set up touchpad switch shortcut key"></a>Set up touchpad switch shortcut key</h3><ul><li>Solution from <a href="https://wiki.archlinux.org/index.php/Touchpad_Synaptics#Software_toggle">Arch Wiki: Touchpad_Synaptics#Software_toggle</a></li><li>Go to the page, copy the script code and save it to a designated location. Then go to Xfce’s keyboard shortcut settings page for key binding.</li></ul><h3 id="Replace-file-manager"><a href="#Replace-file-manager" class="headerlink" title="Replace file manager"></a>Replace file manager</h3><ul><li>Install <code>nemo</code> (software source has it)</li><li>Also install <code>nemo-fileroller</code>, <code>nemo-previewer</code> and <code>nemo-share</code> to ensure complete functionality</li></ul><h3 id="Add-disk-management-program"><a href="#Add-disk-management-program" class="headerlink" title="Add disk management program"></a>Add disk management program</h3><ul><li>Install <code>gnome-disk-utility</code></li></ul><h3 id="Replace-text-editor"><a href="#Replace-text-editor" class="headerlink" title="Replace text editor"></a>Replace text editor</h3><ul><li>Uninstall <code>mousepad</code>, install <code>gedit</code></li></ul><h3 id="Replace-music-player"><a href="#Replace-music-player" class="headerlink" title="Replace music player"></a>Replace music player</h3><ul><li>Uninstall <code>guayadeque</code>, install <code>pragha</code>, <code>netease-cloud-music</code></li></ul><h3 id="Configure-Chinese-input-method"><a href="#Configure-Chinese-input-method" class="headerlink" title="Configure Chinese input method"></a>Configure Chinese input method</h3><ul><li>Follow the Arch Wiki instructions to declare environment variables for input methods, so most programs can normally input Chinese</li></ul><h3 id="Steam-cannot-start"><a href="#Steam-cannot-start" class="headerlink" title="Steam cannot start"></a>Steam cannot start</h3><ul><li>Solution from:<a href="https://wiki.archlinux.org/index.php/Steam/Troubleshooting#Steam_runtime_issues">Arch Wiki:Steam_runtime_issues</a></li><li>Follow the instructions to add environment variables.</li></ul><h2 id="Unresolved-Bugs"><a href="#Unresolved-Bugs" class="headerlink" title="Unresolved Bugs"></a>Unresolved Bugs</h2><ul><li>Pamac cannot update Archlinuxcn source software, can be updated normally in command line.</li><li>When using wireless network card, after waking up from sleep&#x2F;resume, the wireless network card cannot receive signals, must log out and re-login.</li><li>Leanote ordinary editor font display is not quite normal.</li><li>Lanting Ya Yuan font installation fails to display properly.</li><li>Bluetooth headphones pause button is useless.</li></ul><h2 id="Software-List"><a href="#Software-List" class="headerlink" title="Software List"></a>Software List</h2><ul><li><p>Installed software (repository):<br>docky<br>virtualbox<br>steam<br>fcitx<br>fcitx-sogoupinyin<br>steam-manjaro<br>steam-native<br>kdegraphics-kolourpaint<br>texmaker<br>uget<br>qbittorrent<br>flashplugin<br>perl-rename<br>gnome-font-viewer<br>goldendict<br>telegram-desktop<br>mendeleydesktop<br>rstudio-desktop-bin<br>r<br>shadowsocks-qt5<br>atom-editor<br>inkscape</p></li><li><p>AUR:<br>crossover</p></li><li><p>Download and use:<br>ugene<br>leanote</p></li></ul><h2 id="New-Desktop-Remembrance"><a href="#New-Desktop-Remembrance" class="headerlink" title="New Desktop Remembrance"></a>New Desktop Remembrance</h2><ul><li><p>As usual, a new desktop screenshot.<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/desktop.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/desktop.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>And show off the built-in drop-down console, actually using it feels quite cool~<br><img src="http://7xluqf.com1.z0.glb.clouddn.com/consel.png" class="lazyload" data-srcset="http://7xluqf.com1.z0.glb.clouddn.com/consel.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> manjaro </tag>
            
            <tag> linuxmint </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on Drawing Maps with R</title>
      <link href="/en/2018/07/29/%E7%94%A8R%E7%BB%98%E5%88%B6%E5%9C%B0%E5%9B%BE%E7%9A%84%E7%AC%94%E8%AE%B0/"/>
      <url>/en/2018/07/29/%E7%94%A8R%E7%BB%98%E5%88%B6%E5%9C%B0%E5%9B%BE%E7%9A%84%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>During my graduate studies, I had the need to display results using maps and used R to create them. I recorded the code from that time below.</p><span id="more"></span><h1 id="Epidemiological-Data-Map-Visualization"><a href="#Epidemiological-Data-Map-Visualization" class="headerlink" title="Epidemiological Data Map Visualization"></a>Epidemiological Data Map Visualization</h1><h2 id="Code-Source"><a href="#Code-Source" class="headerlink" title="Code Source"></a>Code Source</h2><p>The script code is mainly adapted from an article on Statistical Analysis:<br><a href="http://cos.name/2014/08/r-maps-for-china/">Drawing Maps of China and Displaying Epidemiological Data with R</a></p><h2 id="Code-Body-Includes-Comments"><a href="#Code-Body-Includes-Comments" class="headerlink" title="Code Body (Includes Comments)"></a>Code Body (Includes Comments)</h2><pre><code class="r">####loading packages Load necessary libraries####library(maptools) # Used for reading and manipulating map datalibrary(ggplot2) # Used for plotting maps####set working directory####getwd()setwd(&quot;/home/silen/R _Data/Map&quot;) # Set the current working directory to the location of the map data####loading map data(shape data)####map &lt;- readShapePoly(&quot;countries_shp/countries.shp&quot;) # Read *.shp format map data, note that *.shp files must be placed together with other files like *.shx to be readable; otherwise, errors will occur.####check loaded data Debugging part, used to check the loaded map data####names(map)str(map$NAME)table(map$EU)####Normal method, using geom_polygon / geom_path Using basic polygon and path methods for map plotting (unclear how to display epidemiological data)####DB &lt;- fortify(map) # Important statement: Through this step, the imported map data is converted into a format that ggplot can recognize.p &lt;- ggplot(DB, aes(x=long,y=lat, group = group)) # Create a plot, initialize the graph, determine the use of the database and map longitude and latitude to the x and y axes; group=group ensures that the plotted graph is not chaotic.# World map, using geom_path instead of geom_polygon (from ggplot help documentation, unclear why)World &lt;- p + geom_polygon(color=&quot;white&quot;, fill = &quot;grey&quot;) + # Use polygon (polygon) to draw the map, set the fill color to grey and line color to white  theme(panel.grid.major=element_blank(),# Theme() within are all style effect settings, mainly hiding x.y axis and corresponding text, background removal, grid removal,        panel.background=element_blank(),        axis.title.x=element_blank(),        axis.title.y=element_blank(),        axis.text.x=element_blank(),        axis.text.y=element_blank(),        axis.line=element_blank(),        axis.ticks=element_blank())+  ggtitle(&quot;World&quot;)+  scale_y_continuous(breaks = (-2:2) * 30) +# Forgot what it does  scale_x_continuous(breaks = (-4:4) * 45) +  #coord_map(&quot;orthographic&quot;) # Orthographic view  #coord_map(&quot;gilbert&quot;) # Ball shape view  coord_map(&quot;lagrange&quot;) # Flat# coord_map() within are special coordinate axis mapping, see ggplot package documentation for details####Epi method using geom_map Using the dedicated geom_map method to draw maps and display epidemiological data (heat map)##### Load data and prepare for plotting Generate the required map data, load part at the beginningDB &lt;- fortify(map, region = &quot;NAME&quot;)# Transform map shape data into an object that ggplot can read# DB &lt;- transform(DB, id = iconv(id, from = &#39;GBK&#39;), code = iconv(code, from = &#39;GBK&#39;))# Transform coding from GBKhead(DB) # Check the data situationnames(DB)[c(1, 2)] = c(&quot;x&quot;, &quot;y&quot;)# Change the header of the data, for the purpose of using expand_limits() Change the names of variables in the data table as required by geom_map method# Prepare epidemiological data -&gt; crude death rate Prepare the epidemiological data, note the correspondence issuemor &lt;- read.csv(&quot;mapRate.csv&quot;,head =T, sep =&quot;,&quot;) # Read epidemiological data from *.csv fileepi &lt;- data.frame(id = unique(sort(DB$id)))# Use epi data frame to save epidemiological data, obtain all region (or location) names from DB (map data)epi &lt;- merge(epi, mor, by.x= &quot;id&quot;, all.x = T)# Merge region names and corresponding epidemiological data based on id variable# write.csv(epi, &quot;1234.csv&quot;) # Debugging use# epip1 &lt;- ggplot(epi, fill = &quot;#595959&quot;) +               geom_map(aes(map_id = id, fill = rate ),# Use geom_map to draw the map and display data                       colour = &quot;white&quot;,                           map = DB) +                    expand_limits(DB) +# Important statement: Without this statement, the map cannot be drawn. The meaning of the statement is pending investigation                    # Changing theme, make background blank/transparent                    theme(panel.grid.major = element_blank(),# Theme settings, mainly hiding x.y axis and removing background, grid to make background transparent                          panel.background = element_blank(),                          plot.background = element_rect(fill = &quot;transparent&quot;,colour = NA),                          legend.background = element_rect(fill = &quot;transparent&quot;,colour = NA),                          legend.title = element_blank(),                          axis.title.x = element_blank(),                          axis.title.y = element_blank(),                          axis.text.x = element_blank(),                          axis.text.y = element_blank(),                          axis.line = element_blank(),                          axis.ticks = element_blank())+                    # ggtitle(&quot;World&quot;) + # Title of plot                    scale_fill_gradient(high = &quot;#F70909&quot;, low = &quot;#E99799&quot;) + # Set heat map color                    scale_y_continuous(breaks = (-2:2) * 30) +# Meaning unclear                    scale_x_continuous(breaks = (-4:4) * 45) +                    # coord_map(&quot;orthographic&quot;)                    # coord_map(&quot;gilbert&quot;) # Ball                    coord_map(&quot;lagrange&quot;) # Flat# Coordinate setting####print plot Output image, only used when a transparent background image is needed####png(&#39;world.png&#39;,width=600,height=600,units=&quot;px&quot;,bg = &quot;transparent&quot;)# Set name, size, size unit and set background to transparentprint (p1)# Output p1dev.off()# Indicates completion of output</code></pre>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R Training Notes</title>
      <link href="/en/2018/07/29/R%E5%9F%B9%E8%AE%AD%E7%AC%94%E8%AE%B0/"/>
      <url>/en/2018/07/29/R%E5%9F%B9%E8%AE%AD%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>Graduate training on R at the Guangdong Provincial CDC was my first serious programming course.</p><span id="more"></span><h1 id="R-Training-Notes-Summary"><a href="#R-Training-Notes-Summary" class="headerlink" title="R Training Notes Summary"></a>R Training Notes Summary</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><hr><p>The training lasted three days and covered five main topics:</p><ul><li>Introduction to R language and basic concepts, operations</li><li>Using R to draw statistical graphs (graph &amp; ggplot2)</li><li>Introduction to time series analysis and the use of Generalized Linear Models (GLM) and Generalized Additive Models (GAM)</li><li>Use of Distributed Lag Nonlinear Models</li><li>Meta-analysis in R</li></ul><h2 id="Introduction-to-R-Language-and-Basic-Concepts-Operations"><a href="#Introduction-to-R-Language-and-Basic-Concepts-Operations" class="headerlink" title="Introduction to R Language and Basic Concepts, Operations"></a>Introduction to R Language and Basic Concepts, Operations</h2><hr><h3 id="R-Features"><a href="#R-Features" class="headerlink" title="R Features"></a>R Features</h3><ul><li>Pros: Free, rich features, fast updates, process visualization, beautiful plots</li><li>Cons: Difficult to master, inconsistent, requires time to learn, slow (can be optimized with specific packages)</li></ul><h3 id="Software-Installation"><a href="#Software-Installation" class="headerlink" title="Software Installation"></a>Software Installation</h3><ul><li>R and RStudio can be downloaded from the official website</li><li>Packages can be installed manually or through the software itself</li><li>Functions in R need to load the corresponding package before use, and help can only be viewed after loading.</li></ul><h3 id="Software-Interface-Introduction-omitted"><a href="#Software-Interface-Introduction-omitted" class="headerlink" title="Software Interface Introduction (omitted)"></a>Software Interface Introduction (omitted)</h3><h3 id="Common-R-Syntax"><a href="#Common-R-Syntax" class="headerlink" title="Common R Syntax"></a>Common R Syntax</h3><ul><li>Case-sensitive</li><li>Statements are composed of functions and assignments</li><li>All symbols must be half-width English</li><li><code>#</code> is used for comments, <code>#text####</code> can be indexed (script mode)</li><li>No special symbol at the end of each line; if a statement is incomplete, the program will continue to execute on the next line until it is complete</li><li><code>&lt;-</code> is the assignment operator, e.g., <code>x&lt;-3</code>, <code>=</code> can replace it</li><li><code>==</code> is the logical equality operator, <code>&amp;</code> for AND, <code>|</code> for OR, <code>&gt;=</code> greater than or equal to, <code>&lt;=</code> less than or equal to</li><li>Single and double quotes are mostly interchangeable</li><li>There are two equivalent ways to express paths: <code>C:\\R\\Data</code> is equivalent to <code>C:/R/Data</code>; R has poor support for Chinese,尽量 use full English paths</li><li><code>$</code> can be used to extract variables within an object; after extraction, the variable can be assigned or modified.</li><li><code>[]</code> can be used to extract subsets of a data frame</li><li><code>!</code> is the negation symbol</li></ul><h3 id="Setting-Working-Directory-Data-Reading-Writing"><a href="#Setting-Working-Directory-Data-Reading-Writing" class="headerlink" title="Setting Working Directory &amp; Data Reading&#x2F;Writing"></a>Setting Working Directory &amp; Data Reading&#x2F;Writing</h3><ul><li>Directory:<br><code>getwd(&quot;path&quot;)/setwd(&quot;path&quot;)</code></li><li>Data Import:<ul><li>Excel (only supports .csv):<br>  <code>read.csv(&quot;path+filename, header= , sep=&quot;,&quot;)</code></li><li>txt:<br>  <code>read.table(&quot;path+filename&quot;, header= , )</code></li><li>SPSS (.sav):<br>  <code>read.spss(&quot;path+filename&quot;, use.value.labels= )</code></li><li>SAS (.sas7bdat):<br>  <code>read.sas7bdat(&quot;path+filename&quot;)</code></li><li>R (.rda):<br>  <code>load(&quot;path+filename&quot;)</code></li><li>Direct read:<br>  <code>read.table(textConnection(&quot;content&quot;), header=, sep=)</code></li></ul></li><li>Data Export<ul><li>R:<br>  <code>save(对象, file=&quot;path+filename&quot;)</code></li><li>Excel (.csv):<br>  <code>write.csv(对象, file=&quot;path+filename&quot;)</code></li><li>txt:<br>  <code>write.table(对象, file=&quot;test.txt&quot;,sep = &quot;delimiter&quot;)</code></li></ul></li></ul><h3 id="Viewing-Objects-Data"><a href="#Viewing-Objects-Data" class="headerlink" title="Viewing Objects (Data)"></a>Viewing Objects (Data)</h3><ul><li>Multiple functions can be used to view already loaded (created) objects, each function has its own focus.<ul><li><code>View(对象)</code> opens a window on the left to display object&#x2F;data information;</li><li><code>head(对象, 条目数)</code> displays the first n rows of data in the console; if no number is set, it defaults to 6 rows;</li><li><code>tail(对象, 条目数)</code> displays the last n rows of data in the console; if no number is set, it defaults to 6 rows;</li><li><code>names(对象)</code> displays all variable names (headers) of the object in the console.</li><li><code>str(对象)</code> displays the number of entries and variables of the object, as well as each variable’s name, type, and the first 10 values.</li><li><code>dim(对象)</code> displays the number of rows and columns of the object</li></ul></li></ul><h3 id="Statistical-Description-of-Objects-Data"><a href="#Statistical-Description-of-Objects-Data" class="headerlink" title="Statistical Description of Objects (Data)"></a>Statistical Description of Objects (Data)</h3><table><thead><tr><th>Function basic form</th><th>Function purpose</th><th>Notes</th></tr></thead><tbody><tr><td><code>summary(对象)</code></td><td>Displays maximum, minimum, arithmetic mean, median, quartile range for numerical variables; <br>Counts for categorical variables; <br>If missing values exist, displays the number of missing values.</td><td>Use <code>rm.na=</code> parameter to automatically remove missing values when calculating corresponding statistics.</td></tr></tbody></table><h3 id="Simple-Operations-on-Objects-Data"><a href="#Simple-Operations-on-Objects-Data" class="headerlink" title="Simple Operations on Objects (Data)"></a>Simple Operations on Objects (Data)</h3><table><thead><tr><th>Function expression</th><th>Operation effect</th><th>Notes</th></tr></thead><tbody><tr><td><code>names(data)&lt;-c(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;)</code></td><td>Renames the first three variables of data frame data to 1, 2, 3</td><td>If there are more than three variables in the data frame, the names of the variables after the third will be lost; if too many names are assigned, it cannot be executed</td></tr><tr><td><code>data=rename(data,c(&quot;old1&quot;=&quot;new1&quot;, &quot;old2&quot;=&quot;new2&quot;))</code></td><td>Replaces specified variable names in data frame data</td><td>rename() is a function from the plyr package</td></tr><tr><td><code>as.date(data)</code><br><code>as.numeric(data)</code><br><code>as.character(data)</code><br><code>as.factor(data)</code><br>etc.</td><td>Converts specified variables to types, after conversion, can be assigned to an object</td><td></td></tr><tr><td><code>subset(data, select=c(v1,v2))</code><br><code>subset(data, v1==n)</code><br><code>data[row,colum]</code></td><td>Extracts specified rows&#x2F;columns from data frame</td><td>Whether the two methods are completely equivalent is unknown; <code>t[]</code> defaults to taking rows</td></tr><tr><td><code>data$v=data$v1+test$v2</code></td><td>Performs calculations on existing data in data frame and writes it as a new variable</td><td></td></tr><tr><td><code>substr(strData,1,3)</code></td><td>Extracts a specified number of characters from a string variable</td><td></td></tr><tr><td><code>mutate(data,)</code></td><td>Simplifies code by performing multiple operations simultaneously on data frame data</td><td>The main function of mutate() is to simplify code</td></tr><tr><td><code>join(data1, data2, by= ,type=)</code></td><td>Merges different data frames according to certain standards</td><td>join() function does not require sorting of the table</td></tr></tbody></table><h2 id="Using-R-to-Draw-Statistical-Graphs"><a href="#Using-R-to-Draw-Statistical-Graphs" class="headerlink" title="Using R to Draw Statistical Graphs"></a>Using R to Draw Statistical Graphs</h2><hr><ul><li>Two common graph drawing packages in R are:<ul><li>graph (built-in): Basic plotting</li><li>ggplot2 (needs installation): Advanced plotting, high customization, beautiful finished products</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Talse of Destiny 2</title>
      <link href="/en/2016/07/22/%E5%AE%BF%E5%91%BD%E4%BC%A0%E8%AF%B42/"/>
      <url>/en/2016/07/22/%E5%AE%BF%E5%91%BD%E4%BC%A0%E8%AF%B42/</url>
      
        <content type="html"><![CDATA[<p>I had a cold with allergies… I stayed home for two and a half days, not doing anything. I finally got to play Destiny 2 (PSP version)… As expected, playing games is more motivating than anything else for me…</p><p>I knew this game when I was in elementary school… Back then, there were still many TV programs introducing video games, and convenience stores also sold various game strategy magazines. I remember seeing it on at least two TV shows and three magazines, and they all had very good reviews of the game…</p><p>However, I’m not a console player (and couldn’t have been back then, too expensive…), so for such a big game, I could only feel envious… But thanks to technological progress, 14 years later, I finally got the chance to play this game!</p><p>But maybe it’s true that high expectations lead to disappointment… This game is really terrible in many aspects…</p><p>Firstly, the graphics… Should I say people are changing too fast? Back then when I watched the opening animation, I thought it was still quite good. But now, looking at it again, these character portraits look so uncomfortable… Huge eyes… Thin body and limbs… And especially the protagonist’s clothes… It’s really a bit…</p><p>Then there’s the character setting… Mainly for the protagonist… Just like most people’s feelings, he’s a typical middle school boy with a big ego… Ah… Am I really grown up and can’t face my past self? &#x3D; &#x3D;|||</p><p>Next is the map and some puzzles… Especially the world map. Honestly, at first, I thought the game’s guidance was quite good, marking target locations on the mini-map. However, I found that apart from the Lang ruins where you can walk straight there, almost all other locations require detours to reach! And it’s impossible to see how to get there from the mini-map! So every time I go to a new location, I have to run around everywhere to find my way, and during the detour process, I have to kill countless monsters… Some trigger points are really not obvious enough… This also leads to running around and killing countless monsters before realizing how to do it…</p><p>Finally, there’s the battle… At first, when I played, I thought this battle system was quite interesting… But later, the enemies became more disgusting… The front-line enemies are difficult to knock down, and the back-line crystal chanting is incredibly fast. If you cast a higher-level crystal spell, at least two will fall… Trying to use a control character to directly go around and interrupt it, that person mostly jumps in and doesn’t come back… In the end, I can only avoid disgusting combinations by not fighting them…</p><p>Overall… From a game system perspective… Personally, this is a very tiring game to play… Regarding the plot, due to the protagonist being too middle school boyish, repeatedly crossing time with various illogicalities, villains’ IQ hard points, and finally forcing an unreasonable reunion at the end, it can’t add anything to this game either… So for me, beating this game is just eliminating my residual desire. As for playing again or recommending it to others… Forget it…</p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Talse of Destiny 2 </tag>
            
            <tag> Black History Plan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Melody&#39;s Escape</title>
      <link href="/en/2016/06/05/Melody-s-Escape/"/>
      <url>/en/2016/06/05/Melody-s-Escape/</url>
      
        <content type="html"><![CDATA[<p>I don’t know where the original song came from, but I heard it while playing Melody’s Escape…</p><p>One of the main features of this game is music selection. The official version only comes with 5 songs (including this Regain Control), but you can choose any music you have (supporting MP3s, WMAs, iTunes, FLAC formats, etc.). Running through your favorite ACG songs one by one is quite enjoyable~</p><p>For fans of video games, Melody’s Escape should be relatively easy. There are only eight keys in total… If I were a handless beginner like me when first playing a video game, starting with Medium (four keys) would be easier to get the hang of. Once both hands have some feel for it, you can try the eight-key version.</p><p>I think it’s best to start with songs that have strong rhythm if you’re new to the game. Most of the keys are on the beat points in these songs, making them easier to press.</p><p>Personally, I played for about a week and found that relatively simple and enjoyable songs were:</p><p>AlieZ, βios, X.U, Hero’s Come Back, only my railgun, hollow World</p><p>The only regret is that this game is currently a single-player game. I wonder if the author will add local multiplayer mode in the future…</p><p><a href="https://store.steampowered.com/app/270210/Melodys_Escape/">Steam link</a></p><iframe src="https://media.st.dl.bscstorage.net/steam/apps/256664362/movie480.webm?t=1463677466" width="700" height="500" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Video game </tag>
            
            <tag> Melody&#39;s Escape </tag>
            
            <tag> Idle game </tag>
            
            <tag> Black history plan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bilibili - ( ゜- ゜)つロ Cheers~</title>
      <link href="/en/2016/02/21/%E5%B0%8F%E7%94%B5%E8%A7%86%E9%BC%A0%E6%A0%87%E5%9E%AB/"/>
      <url>/en/2016/02/21/%E5%B0%8F%E7%94%B5%E8%A7%86%E9%BC%A0%E6%A0%87%E5%9E%AB/</url>
      
        <content type="html"><![CDATA[<!-- 摘要部分 --><span id="more"></span><p>Ah, the mousepad arrived yesterday… This is my first time buying a Bilibili peripheral…</p><p>I received a big box and was fantasizing about receiving a small TV along with it….</p><p>Of course, reality is always cruel… After all, I just bought a mousepad &#x3D; &#x3D;||||</p><p>But seeing the实物 after opening the box still made me exclaim, it’s really huge!!!!!</p><p>The effect on my desk is quite nice~ It makes me feel like 2233 and the small TV can sell for a year 2333333</p><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/bilibili_mouse.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/bilibili_mouse.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="bilibili_mouse"></p><p>I happily shared the photo with my friends, but his response &#x3D; &#x3D;||||………</p><p>Well… I wish you and your girlfriend a happy Lantern Festival &#x3D; &#x3D;|||||</p>]]></content>
      
      
      <categories>
          
          <category> Others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bilibili周边 </tag>
            
            <tag> 小电视 </tag>
            
            <tag> 机械之心桌垫 </tag>
            
            <tag> 败家 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Transistor</title>
      <link href="/en/2016/01/01/%E6%99%B6%E4%BD%93%E7%AE%A1/"/>
      <url>/en/2016/01/01/%E6%99%B6%E4%BD%93%E7%AE%A1/</url>
      
        <content type="html"><![CDATA[<p>This is a very distinctive game with stunning visuals. It’s a strategy game wrapped in an ARPG skin. The story narrative is a bit like Souls games (if you don’t explore the hidden information, you won’t know what it’s about). I remember this being the first game I bought on Steam when the region was just opened (it took a few days to arrive), and that’s how I started following the development team. Later, I also completed Bastion and later Pyre (I haven’t opened Pyre yet…).</p><!-- Summary part --><span id="more"></span><p><img src="https://raw.githubusercontent.com/SilenWang/Gallary/master/transistor.jpg" class="lazyload" data-srcset="https://raw.githubusercontent.com/SilenWang/Gallary/master/transistor.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> Gaming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> steam </tag>
            
            <tag> Gaming </tag>
            
            <tag> Transistor </tag>
            
            <tag> transistor </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
